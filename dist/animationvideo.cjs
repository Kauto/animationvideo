"use strict";var t=require("@ctrl/tinycolor"),i=require("pasition"),s=require("stackblur-canvas"),e=require("eases");function h(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=/*___PURE__*/h(i),n=/*___PURE__*/h(e),o=0;function a(t){return"__private_"+o+++"_"+t}function c(t,i){if(!Object.prototype.hasOwnProperty.call(t,i))throw new TypeError("attempted to use private field on non-instance");return t}function l(t){return"function"==typeof t?t(...[].slice.call(arguments,1)):t}function u(t){return null==t?[]:Array.isArray(t)?t:[t]}function d(t,i,s){if(!t.s){if(s instanceof f){if(!s.s)return void(s.o=d.bind(null,t,i));1&i&&(i=s.s),s=s.v}if(s&&s.then)return void s.then(d.bind(null,t,i),d.bind(null,t,2));t.s=i,t.v=s;const e=t.o;e&&e(t)}}var v=/*___PURE__*/a("output"),f=/*___PURE__*/function(){function t(){}return t.prototype.then=function(i,s){const e=new t,h=this.s;if(h){const t=1&h?i:s;if(t){try{d(e,1,t(this.v))}catch(t){d(e,2,t)}return e}return this}return this.o=function(t){try{const h=t.v;1&t.s?d(e,1,i?i(h):h):s?d(e,1,s(h)):d(e,2,h)}catch(t){d(e,2,t)}},e},t}();function b(t){return t instanceof f&&1&t.s}var m=/*___PURE__*/a("events"),w=/*___PURE__*/a("scene"),p=/*___PURE__*/a("newScene"),O=/*___PURE__*/a("sceneParameter"),y=/*___PURE__*/a("isSceneInitialized"),j=/*___PURE__*/a("recalculateCanvasIntend"),g=/*___PURE__*/a("lastTimestamp"),M=/*___PURE__*/a("referenceRequestAnimationFrame"),x=/*___PURE__*/a("autoSize"),P=/*___PURE__*/a("canvasCount"),C=/*___PURE__*/a("drawFrame"),k=/*___PURE__*/a("reduceFramerate"),T=/*___PURE__*/a("realLastTimestamp"),I=/*___PURE__*/a("isOddFrame"),F=/*___PURE__*/a("initializedStartTime"),S=/*___PURE__*/a("promiseSceneDestroying"),E=/*___PURE__*/a("runParameter"),A=/*___PURE__*/a("moveOnce"),z=/*___PURE__*/a("resolve"),D=new class{constructor(){this.Images=void 0,this.count=void 0,this.loaded=void 0,Object.defineProperty(this,z,{writable:!0,value:[]}),this.Images={},this.count=0,this.loaded=0}add(t,i){void 0===i&&(i=void 0);const s=this;for(const e in t)if(s.Images[e])i&&"function"==typeof i[e]&&i[e](e,s.Images[e]);else{const h=t[e];if(s.Images[e]=new window.Image,s.Images[e].onload=function(){s.loaded++,i&&"function"==typeof i?s.isLoaded()&&i():i&&"function"==typeof i[e]&&i[e](e,s.Images[e]),c(s,z)[z]&&s.isLoaded()&&(c(s,z)[z].forEach(t=>t(void 0)),c(s,z)[z]=[])},"<svg"===h.substr(0,4)){const t=window.URL||window.webkitURL,i=new window.Blob([h],{type:"image/svg+xml"});s.Images[e].src=t.createObjectURL(i)}else/^(https?:)?\/\//.test(h)&&(s.Images[e].onerror=()=>{const t=new window.Image;t.onload=s.Images[e].onload,s.Images[e]=t,s.Images[e].src=h},s.Images[e].crossOrigin="anonymous"),s.Images[e].src=h;s.count++}return i&&"function"==typeof i&&s.isLoaded()&&i(),c(s,z)[z]&&s.isLoaded()&&(c(s,z)[z].forEach(t=>t(void 0)),c(s,z)[z]=[]),s}reset(){return this.Images={},this.count=0,this.loaded=0,this}isLoaded(){return this.loaded===this.count}getImage(t){return"object"==typeof t?t:this.Images[t]}isLoadedPromise(){return!!this.isLoaded()||new Promise((t,i)=>{c(this,z)[z].push(t)})}},_=/*___PURE__*/a("layer"),L=/*___PURE__*/a("isFunction"),N=/*___PURE__*/a("start"),B=/*___PURE__*/a("nextFree"),X=/*___PURE__*/a("canvasIds");class Y{constructor(t){Object.defineProperty(this,_,{writable:!0,value:void 0}),Object.defineProperty(this,L,{writable:!0,value:void 0}),Object.defineProperty(this,N,{writable:!0,value:void 0}),Object.defineProperty(this,B,{writable:!0,value:void 0}),Object.defineProperty(this,X,{writable:!0,value:void 0}),c(this,_)[_]=[],c(this,L)[L]=[],c(this,N)[N]=0,c(this,B)[B]=0,c(this,X)[X]=void 0===t?[]:Array.isArray(t)?t:[t]}addElement(t){return this.addElementForId(t),t}addElements(t){return this.addElementsForIds(t),t}addElementForId(t){let i=c(this,_)[_].length,s=c(this,B)[B];c(this,_)[_][s]=t,c(this,L)[L][s]="function"==typeof t,i===s&&i++;let e=c(this,B)[B]+1;for(;e!==i&&c(this,_)[_][e];)e++;return c(this,B)[B]=e,c(this,N)[N]>s&&(c(this,N)[N]=s),s}addElementsForIds(t){let i=c(this,_)[_].length,s=c(this,B)[B];return i===s?(c(this,_)[_]=c(this,_)[_].concat(t),c(this,B)[B]=c(this,_)[_].length,t.forEach((t,s)=>{c(this,L)[L][i+s]="function"==typeof t}),Array.from({length:t.length},(t,s)=>s+i)):t.map(t=>this.addElement(t))}getById(t){return c(this,_)[_][t]}getIdByElement(t){return c(this,_)[_].indexOf(t)}deleteByElement(t){const i=this.getIdByElement(t);i>=0&&this.deleteById(i)}deleteById(t){let i=c(this,_)[_].length-1;if(i>0&&t===i){for(c(this,_)[_][t]=void 0;i&&!c(this,_)[_][i-1];)i--;c(this,_)[_].length=i,c(this,L)[L].length=i,c(this,B)[B]=Math.min(c(this,B)[B],i),c(this,N)[N]=Math.min(c(this,N)[N],i)}else c(this,_)[_][t]&&(c(this,_)[_][t]=void 0,c(this,B)[B]=Math.min(c(this,B)[B],t),c(this,N)[N]===t&&(c(this,N)[N]=t+1))}isCanvasId(t){return void 0===t||!c(this,X)[X].length||c(this,X)[X].includes(t)}forEach(t,i){let s,e;void 0===i&&(i=0);const h=c(this,_)[_].length;for(s=c(this,N)[N];s<h;s++)if(e=c(this,_)[_][s],e&&!1===t({elementId:s,layerId:i,element:e,isFunction:c(this,L)[L][s],layer:this}))return}getElementsByTag(t){let i=[];return this.forEach(s=>{let{element:e,isFunction:h}=s;if(!h){const s=e.getElementsByTag(t);s&&(i=i.concat(s))}}),i}play(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.forEach(s=>{let{element:e,isFunction:h}=s;return!h&&e.play(t,i)})}count(){let t=0;const i=c(this,_)[_].length;for(let s=c(this,N)[N];s<i;s++)c(this,_)[_][s]&&t++;return t}clear(){c(this,_)[_]=[],c(this,L)[L]=[],c(this,N)[N]=0,c(this,B)[B]=0}}var W=/*___PURE__*/a("layers");class U{constructor(){Object.defineProperty(this,W,{writable:!0,value:void 0}),c(this,W)[W]=[]}addLayer(t){return void 0===t&&(t=void 0),c(this,W)[W][c(this,W)[W].length]=new Y(t),c(this,W)[W][c(this,W)[W].length-1]}addLayers(t,i){void 0===t&&(t=1),void 0===i&&(i=void 0);let s=Array.from({length:t},t=>new Y(i));return c(this,W)[W]=c(this,W)[W].concat(s),s}addLayerForId(t){return void 0===t&&(t=void 0),c(this,W)[W][c(this,W)[W].length]=new Y(t),c(this,W)[W].length-1}addLayersForIds(t,i){void 0===t&&(t=1),void 0===i&&(i=void 0);const s=Array.from({length:t},(t,i)=>i+c(this,W)[W].length);return c(this,W)[W]=c(this,W)[W].concat(Array.from({length:t},t=>new Y(i))),s}getById(t){return c(this,W)[W][t]}forEach(t,i){let s;const e=c(this,W)[W].length;for(s=0;s<e;s++)c(this,W)[W][s].isCanvasId(i)&&c(this,W)[W][s].forEach(t,s)}play(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.forEach(s=>{let{element:e,isFunction:h}=s;return!h&&e.play(t,i)})}getElementsByTag(t){let i=[];return this.forEach(s=>{let{element:e,isFunction:h}=s;if(!h){const s=e.getElementsByTag(t);s&&(i=i.concat(s))}}),i}count(){return c(this,W)[W].length}clear(){c(this,W)[W]=[]}}class q{constructor(){this.m=[1,0,0,1,0,0]}t(){this.reset()}reset(){return this.m=[1,0,0,1,0,0],this}multiply(t){const i=this.m[1]*t.m[0]+this.m[3]*t.m[1],s=this.m[0]*t.m[2]+this.m[2]*t.m[3],e=this.m[1]*t.m[2]+this.m[3]*t.m[3],h=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],r=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=this.m[0]*t.m[0]+this.m[2]*t.m[1],this.m[1]=i,this.m[2]=s,this.m[3]=e,this.m[4]=h,this.m[5]=r,this}invert(){const t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),i=-this.m[1]*t,s=-this.m[2]*t,e=this.m[0]*t,h=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),r=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=this.m[3]*t,this.m[1]=i,this.m[2]=s,this.m[3]=e,this.m[4]=h,this.m[5]=r,this}rotate(t){const i=Math.cos(t),s=Math.sin(t),e=this.m[1]*i+this.m[3]*s,h=this.m[0]*-s+this.m[2]*i,r=this.m[1]*-s+this.m[3]*i;return this.m[0]=this.m[0]*i+this.m[2]*s,this.m[1]=e,this.m[2]=h,this.m[3]=r,this}translate(t,i){return this.m[4]+=this.m[0]*t+this.m[2]*i,this.m[5]+=this.m[1]*t+this.m[3]*i,this}scale(t,i){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=i,this.m[3]*=i,this}transformPoint(t,i){const s=t;return[t=s*this.m[0]+i*this.m[2]+this.m[4],i=s*this.m[1]+i*this.m[3]+this.m[5]]}clone(){const t=new q;return t.m=this.m.slice(0),t}}function R(t,i){return null==t||""===t?i:t}var H=/*___PURE__*/a("configuration"),G=/*___PURE__*/a("tickChunk"),V=/*___PURE__*/a("maxSkippedTickChunk"),Z=/*___PURE__*/a("tickChunkTolerance");class K{constructor(t){void 0===t&&(t={}),Object.defineProperty(this,H,{writable:!0,value:void 0}),Object.defineProperty(this,G,{writable:!0,value:void 0}),Object.defineProperty(this,V,{writable:!0,value:void 0}),Object.defineProperty(this,Z,{writable:!0,value:void 0}),this.type="timing",this.totalTimePassed=0,c(this,H)[H]=t,c(this,G)[G]=R(l(c(this,H)[H].tickChunk),120),c(this,V)[V]=R(l(c(this,H)[H].maxSkippedTickChunk),120),c(this,Z)[Z]=R(l(c(this,H)[H].tickChunkTolerance),.1)}init(t){}currentTime(){return window.performance?performance.now():Date.now()}clampTime(t){let{timePassed:i}=t;const s=c(this,G)[G]?c(this,G)[G]*c(this,V)[V]:2e3;return i>s?s:i}shiftTime(t){let{timePassed:i}=t;return c(this,G)[G]?-i%c(this,G)[G]:0}get tickChunk(){return c(this,G)[G]}isChunked(){return!!c(this,G)[G]}hasOneChunkedFrame(t){let{timePassed:i}=t;return i>=c(this,G)[G]-c(this,Z)[Z]}calcFrames(t){let{timePassed:i}=t;return Math.min(c(this,V)[V],Math.floor((i+c(this,Z)[Z])/c(this,G)[G]))}}const J="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function Q(t,i,s){if(!t.s){if(s instanceof $){if(!s.s)return void(s.o=Q.bind(null,t,i));1&i&&(i=s.s),s=s.v}if(s&&s.then)return void s.then(Q.bind(null,t,i),Q.bind(null,t,2));t.s=i,t.v=s;const e=t.o;e&&e(t)}}const $=/*___PURE__*/function(){function t(){}return t.prototype.then=function(i,s){const e=new t,h=this.s;if(h){const t=1&h?i:s;if(t){try{Q(e,1,t(this.v))}catch(t){Q(e,2,t)}return e}return this}return this.o=function(t){try{const h=t.v;1&t.s?Q(e,1,i?i(h):h):s?Q(e,1,s(h)):Q(e,2,h)}catch(t){Q(e,2,t)}},e},t}();function tt(t){return t instanceof $&&1&t.s}const it={i:[],init:[],isDrawFrame:[],initSprites:[],fixedUpdate:[],update:[],draw:[],destroy:[],reset:[],resize:[],currentTime:[],clampTime:[],shiftTime:[],isChunked:[],hasOneChunkedFrame:[],calcFrames:[],tickChunk:[],additionalModifier:[]};var st=/*___PURE__*/a("layerManager"),et=/*___PURE__*/a("imageManager"),ht=/*___PURE__*/a("totalTimePassed"),rt=/*___PURE__*/a("engine"),nt=/*___PURE__*/a("middleware"),ot=/*___PURE__*/a("stopPropagation"),at=/*___PURE__*/a("transform"),ct=/*___PURE__*/a("transformInvert"),lt=/*___PURE__*/a("additionalModifier"),ut=/*___PURE__*/a("initDone"),dt=/*___PURE__*/a("endTime"),vt=/*___PURE__*/a("resetIntend"),ft=/*___PURE__*/a("output"),bt=/*___PURE__*/a("param");function mt(){var t;return null==(t=c(this,rt)[rt])?void 0:t.getOutput()}function wt(t){return void 0===t&&(t=void 0),Object.assign({engine:c(this,rt)[rt],scene:this,imageManager:c(this,et)[et],layerManager:c(this,st)[st],totalTimePassed:c(this,ht)[ht],output:c(this,ft)[ft]()},t)}var pt,Ot=/*___PURE__*/a("duration");class yt{constructor(t){Object.defineProperty(this,Ot,{writable:!0,value:void 0}),c(this,Ot)[Ot]=l(t)-0}run(t,i){return i-c(this,Ot)[Ot]}}!function(t){t.FORCE_DISABLE="F",t.STOP="S",t.REMOVE="R"}(pt||(pt={}));var jt=/*___PURE__*/a("runSequence");class gt{constructor(){Object.defineProperty(this,jt,{value:Mt}),this.sequences=[],this.lastTimestamp=0,this.enabled=!0;var t=[].slice.call(arguments);let i=0;"number"==typeof t[0]&&(i=t.shift()),this.sequences=t.map(t=>{Array.isArray(t)||(t=[t]);let s=i;return"number"==typeof t[0]&&(s=t.shift()),{position:0,timelapsed:-s,sequence:t.map(t=>"function"!=typeof t.run?"number"==typeof t?new yt(t):{run:t}:t).filter(t=>"function"==typeof t.run),label:t.reduce((t,i,s)=>("string"==typeof i&&(t[i]=s-Object.keys(t).length),t),{}),enabled:!0}})}reset(t){void 0===t&&(t=0),this.sequences.forEach(i=>{var s;i.enabled=!0,i.position=0,i.timelapsed=t,null==(s=i.sequence[0])||null==s.reset||s.reset(t)}),this.enabled=!0}play(t,i){if(void 0===t&&(t=""),void 0===i&&(i=0),t){const s=this.sequences.reduce((s,e)=>{var h;return t in e.label?(s=!0,e.position=e.label[t],e.enabled=!0,e.timelapsed=i,null==(h=e.sequence[e.position])||null==h.reset||h.reset()):s=s||e.sequence.some(s=>null==s.play?void 0:s.play(t,i)),s},!1);return s&&(this.enabled=!0),s}return this.sequences.forEach(t=>t.enabled=!0),this.enabled=!0,!0}run(t,i,s){void 0===s&&(s=!1);let e=i;if(s||(e=i-this.lastTimestamp,this.lastTimestamp=i),!this.enabled)return e;const h=this.sequences.length;let r=0,n=Infinity;for(let i=0;i<h;i++)if(this.sequences[i].enabled){const s=c(this,jt)[jt](t,this.sequences[i],e);if(!0===s)return!0;n=Math.min(n,s)}else r++;return r===h?(this.enabled=!1,e):n}}function Mt(t,i,s){let e=s;for(;i.sequence[i.position]&&e>=0;){if(i.timelapsed+=e,i.timelapsed<0)return-1;const r=i.sequence[i.position].run(t,i.timelapsed);if(!0===r)e=0;else{if(!1===r)return-1;if(r===pt.FORCE_DISABLE)return i.enabled=!1,this.enabled=!1,s;if(r===pt.STOP)return i.enabled=!1,s;if(r===pt.REMOVE)return!0}var h;if(e=r,e>=0&&(i.position=(i.position+1)%i.sequence.length,null==(h=i.sequence[i.position])||null==h.reset||h.reset(),i.timelapsed=0,0===i.position))return i.enabled=!1,e}return e}class xt{constructor(t){this.h=!0,this.p=void 0,this.p=this.l(this.u(),t)}l(t,i){const s=Object.entries(t).map(t=>{let[s,e]=t;const h=i[s];return[s,"function"==typeof e?e(h,i):R(l(h),e)]});return Object.fromEntries(s)}O(){return{animation:(t,i)=>{const s=l(t);return Array.isArray(s)?new gt(s):s},enabled:!0,isClickable:!1,tag:(t,i)=>{const s=l(t);return Array.isArray(s)?s:s?[s]:[]}}}u(){return this.O()}getElementsByTag(t){if("function"==typeof t){if(this.p.tag.filter(t).length)return[this]}else if((Array.isArray(t)?t:[t]).filter(t=>this.p.tag.includes(t)).length)return[this];return[]}animate(t){return!(!this.p.animation||!0!==this.p.animation.run(this,t,!0)||(this.p.enabled=!1,0))}play(t,i){var s,e;void 0===t&&(t=""),void 0===i&&(i=0),this.p.animation&&(null==(s=(e=this.p.animation).play)||s.call(e,t,i))}init(t,i){}callInit(t,i){this.h&&(this.init(t,i),this.h=!1)}resize(t,i){}j(t,i,s,e,h){let r=!1;return t.enabled&&t.isClickable&&(i.save(),i.translate(t.x,t.y),i.scale(t.scaleX,t.scaleY),i.rotate(t.rotation),i.beginPath(),r=h(),i.restore()),r?this:void 0}M(t,i,s,e,h,r){let{enabled:n,isClickable:o,x:a=0,y:c=0,width:l=0,height:u=0,scaleX:d=1,scaleY:v=1,rotation:f=0}=t,b=!1;if(n&&o){const t=l/2,n=u/2;i.save(),h?i.translate(a+t,c+n):i.translate(a,c),i.scale(d,v),i.rotate(f),i.beginPath(),r?b=r(t,n):(i.rect(-t,-n,l,u),i.closePath(),b=i.isPointInPath(s,e)),i.restore()}return b?this:void 0}detectDraw(t,i){}detect(t,i,s){}draw(t,i){}}var Pt=/*___PURE__*/a("timePassed");const Ct=Math.PI/180,kt={x:0,y:0,rotation:(t,i)=>R(l(t),R(l(i.rotationInRadian),R(l(i.rotationInDegree),0)*Ct)),scaleX:(t,i)=>R(l(t),R(l(i.scale),1)),scaleY:(t,i)=>R(l(t),R(l(i.scale),1)),alpha:1,compositeOperation:"source-over",color:"_fff"};class Tt extends xt{constructor(t){super(t)}u(){return Object.assign({},super.u(),kt,{sprite:[]})}getElementsByTag(t){let i=super.getElementsByTag(t);for(const s of this.p.sprite){const e=s.getElementsByTag(t);e&&(i=i.concat(e))}return i}animate(t){let i=super.animate(t),s=!1;if(this.p.enabled)for(const i of this.p.sprite)s=s||!0===i.animate(t);return this.p.animation?i:(s&&(this.p.enabled=!1),s)}play(t,i){var s,e;void 0===t&&(t=""),void 0===i&&(i=0),this.p.animation&&(null==(s=(e=this.p.animation).play)||s.call(e,t,i));for(const s of this.p.sprite)null==s.play||s.play(t,i)}resize(t,i){for(const s of this.p.sprite)s.resize(t,i)}callInit(t,i){super.callInit(t,i);for(let s of this.p.sprite)s.callInit(t,i)}detectDraw(t,i){if(this.p.enabled)for(const s of this.p.sprite)s.detectDraw(t,i)}detect(t,i,s){if(this.p.enabled)for(const e of this.p.sprite){const h=e.detect(t,i,s);if(h)return h}}draw(t,i){if(this.p.enabled){this.p.alpha<1&&((i=Object.assign({},i)).alpha*=this.p.alpha),t.save(),t.translate(this.p.x,this.p.y),t.scale(this.p.scaleX,this.p.scaleY),t.rotate(this.p.rotation);for(const s of this.p.sprite)s.draw(t,i);t.restore()}}}var It=/*___PURE__*/a("currentGridSize"),Ft=/*___PURE__*/a("drawFrame"),St=/*___PURE__*/a("temp_canvas"),Et=/*___PURE__*/a("tctx"),At=/*___PURE__*/a("generateTempCanvas"),zt=/*___PURE__*/a("normalizeFullScreen"),Dt=/*___PURE__*/a("copyCanvas");function _t(t){const i=t.widthInPixel,s=t.heightInPixel,e=this.p;c(this,St)[St]=document.createElement("canvas"),e.canvasWidth&&e.canvasHeight?(c(this,St)[St].width=e.canvasWidth,c(this,St)[St].height=e.canvasHeight):e.gridSize?(c(this,It)[It]=e.gridSize,c(this,St)[St].width=Math.round(c(this,It)[It]),c(this,St)[St].height=Math.round(c(this,It)[It])):(c(this,St)[St].width=Math.round(i/e.scaleX),c(this,St)[St].height=Math.round(s/e.scaleY)),c(this,Et)[Et]=c(this,St)[St].getContext("2d")}function Lt(t){const i=this.p;(i.norm||void 0===i.x)&&(i.x=t.visibleScreen.x),(i.norm||void 0===i.y)&&(i.y=t.visibleScreen.y),(i.norm||void 0===i.width)&&(i.width=t.visibleScreen.width),(i.norm||void 0===i.height)&&(i.height=t.visibleScreen.height)}function Nt(t){const i=this.p;if(c(this,St)[St]&&c(this,It)[It]!==i.gridSize&&!i.canvasWidth){const i=c(this,St)[St];c(this,At)[At](t),c(this,Et)[Et].globalCompositeOperation="copy",c(this,Et)[Et].drawImage(i,0,0,i.width,i.height,0,0,c(this,St)[St].width,c(this,St)[St].height),c(this,Et)[Et].globalCompositeOperation="source-over",c(this,Ft)[Ft]=2}c(this,zt)[zt](t)}class Bt extends Tt{constructor(t){super(t.self||{});let i=R(l(t.count),1);this.p.sprite=[];const s=t.class;for(let e=0;e<i;e++){const i=Object.entries(t).reduce((t,i)=>{let[s,h]=i;return["self","class","count"].includes(s)||(t[s]=l(h,e)),t},{});this.p.sprite[e]=new s(i)}}}var Xt,Yt=/*___PURE__*/a("temp_canvas");class Wt extends xt{constructor(t){super(t),Object.defineProperty(this,Yt,{writable:!0,value:void 0}),this.P=void 0,this.C=void 0}u(){return Object.assign({},super.u(),{x:void 0,y:void 0,width:void 0,height:void 0,gridSize:void 0,darker:0,pixel:!1,clear:!1,norm:(t,i)=>R(l(t),void 0===l(i.x)&&void 0===l(i.y)&&void 0===l(i.width)&&void 0===l(i.height)),scaleX:(t,i)=>R(l(t),R(l(i.scale),1)),scaleY:(t,i)=>R(l(t),R(l(i.scale),1)),alpha:1,compositeOperation:"source-over"})}k(t){const i=t.widthInPixel,s=t.heightInPixel,e=this.p;c(this,Yt)[Yt]=document.createElement("canvas"),e.gridSize?(this.P=e.gridSize,c(this,Yt)[Yt].width=Math.round(this.P),c(this,Yt)[Yt].height=Math.round(this.P)):(c(this,Yt)[Yt].width=Math.ceil(i/e.scaleX),c(this,Yt)[Yt].height=Math.ceil(s/e.scaleY)),this.C=c(this,Yt)[Yt].getContext("2d"),this.C.globalCompositeOperation="source-over",this.C.globalAlpha=1}normalizeFullScreen(t){const i=this.p;(i.norm||void 0===i.x)&&(i.x=t.visibleScreen.x),(i.norm||void 0===i.y)&&(i.y=t.visibleScreen.y),(i.norm||void 0===i.width)&&(i.width=t.visibleScreen.width),(i.norm||void 0===i.height)&&(i.height=t.visibleScreen.height)}resize(t,i){if(c(this,Yt)[Yt]&&this.P!==this.p.gridSize){const t=c(this,Yt)[Yt];this.k(i),this.C.globalCompositeOperation="copy",this.C.drawImage(t,0,0,t.width,t.height,0,0,c(this,Yt)[Yt].width,c(this,Yt)[Yt].height),this.C.globalCompositeOperation="source-over"}this.normalizeFullScreen(i)}detect(t,i,s){return this.M(this.p,t,i,s,!1)}init(t,i){this.k(i),this.normalizeFullScreen(i)}draw(t,i){const s=this.p;if(s.enabled&&s.alpha>0){s.gridSize&&this.P!==s.gridSize&&this.resize(void 0,i);const h=s.alpha*i.alpha,r=s.width,n=s.height,o=c(this,Yt)[Yt].width,a=c(this,Yt)[Yt].height;if(h>0&&o&&a){var e;this.C.globalCompositeOperation="copy",this.C.globalAlpha=1,this.C.drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height,0,0,o,a),s.darker>0&&(this.C.globalCompositeOperation=s.clear?"source-atop":"source-over",this.C.fillStyle="rgba(0,0,0,"+s.darker+")",this.C.fillRect(0,0,o,a)),null==(e=this.additionalBlur)||e.call(this,o,a,i),s.clear&&(t.globalCompositeOperation="source-over",t.globalAlpha=1,t.clearRect(s.x,s.y,r,n)),t.globalCompositeOperation=s.compositeOperation,t.globalAlpha=h;const l=t.imageSmoothingEnabled;t.imageSmoothingEnabled=!s.pixel,t.drawImage(c(this,Yt)[Yt],0,0,o,a,s.x,s.y,r,n),t.imageSmoothingEnabled=l}}else s.clear&&(s.x||(s.x=i.x),s.y||(s.y=i.y),s.width||(s.width=i.width),s.height||(s.height=i.height),t.clearRect(s.x,s.y,s.width,s.height))}}exports.Position=void 0,(Xt=exports.Position||(exports.Position={}))[Xt.LEFT_TOP=0]="LEFT_TOP",Xt[Xt.CENTER=1]="CENTER";var Ut=/*___PURE__*/a("currentTintKey"),qt=/*___PURE__*/a("normScale"),Rt=/*___PURE__*/a("temp_canvas"),Ht=/*___PURE__*/a("tctx"),Gt=/*___PURE__*/a("tintCacheKey"),Vt=/*___PURE__*/a("temp_context");function Zt(){return[this.p.tint,this.p.frameWidth||this.p.image.width,this.p.frameHeight||this.p.image.height,this.p.color,this.p.frameX,this.p.frameY].join(";")}function Kt(t,i){return c(this,Rt)[Rt]||(c(this,Rt)[Rt]=document.createElement("canvas"),c(this,Ht)[Ht]=c(this,Rt)[Rt].getContext("2d")),c(this,Rt)[Rt].width=t,c(this,Rt)[Rt].height=i,c(this,Ht)[Ht]}class Jt extends xt{constructor(t){super(t)}u(){return Object.assign({},this.O(),kt,{text:t=>{const i=l(t);return(Array.isArray(i)?i.join(""):i)||""},font:"2em monospace",position:exports.Position.CENTER,color:void 0,borderColor:void 0,lineWidth:1})}detectDraw(t,i){this.p.enabled&&this.p.isClickable&&(t.save(),t.translate(this.p.x,this.p.y),t.scale(this.p.scaleX,this.p.scaleY),t.rotate(this.p.rotation),this.p.position||(t.textAlign="left",t.textBaseline="top"),t.font=this.p.font,t.fillStyle=i,t.fillText(this.p.text,0,0),t.restore())}detect(t,i,s){return"c"}draw(t,i){this.p.enabled&&(t.globalCompositeOperation=this.p.compositeOperation,t.globalAlpha=this.p.alpha*i.alpha,t.save(),this.p.position||(t.textAlign="left",t.textBaseline="top"),t.translate(this.p.x,this.p.y),t.scale(this.p.scaleX,this.p.scaleY),t.rotate(this.p.rotation),t.font=this.p.font,this.p.color&&(t.fillStyle=this.p.color,t.fillText(this.p.text,0,0)),this.p.borderColor&&(t.strokeStyle=this.p.borderColor,t.lineWidth=this.p.lineWidth,t.strokeText(this.p.text,0,0)),t.restore())}}var Qt=/*___PURE__*/a("currentScaleX"),$t=/*___PURE__*/a("currentPixelSmoothing"),ti=/*___PURE__*/a("Gradient");class ii extends xt{constructor(t){super(t),Object.defineProperty(this,Qt,{writable:!0,value:void 0}),Object.defineProperty(this,$t,{writable:!0,value:!1})}u(){return Object.assign({},super.u(),{x:0,y:0,scaleX:(t,i)=>R(l(t),R(l(i.scale),1)),scaleY:(t,i)=>R(l(t),R(l(i.scale),1)),color:"_FFF",alpha:1,compositeOperation:"source-over"})}static getGradientImage(t,i,s){let e=t>>4,h=i>>4,r=s>>4;if(!c(ii,ti)[ti]){const t=16;c(ii,ti)[ti]=Array.from({length:t},i=>Array.from({length:t},i=>Array.from({length:t})))}return c(ii,ti)[ti][e][h][r]||(c(ii,ti)[ti][e][h][r]=ii.generateGradientImage(e,h,r)),c(ii,ti)[ti][e][h][r]}static generateGradientImage(t,i,s){let e=document.createElement("canvas");e.width=e.height=64;let h=e.getContext("2d");h.globalAlpha=1,h.globalCompositeOperation="source-over",h.clearRect(0,0,64,64);let r=h.createRadialGradient(32,32,0,32,32,32);return r.addColorStop(0,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",1)"),r.addColorStop(.3,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",0.4)"),r.addColorStop(1,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",0)"),h.fillStyle=r,h.fillRect(0,0,64,64),e}resize(t,i){c(this,Qt)[Qt]=void 0}draw(i,s){const e=this.p;if(e.enabled&&e.alpha>0){e.color&&e.color.r||(e.color=new t.TinyColor(e.color).toRgb()),c(this,Qt)[Qt]!==e.scaleX&&(c(this,Qt)[Qt]=e.scaleX,c(this,$t)[$t]=e.scaleX*s.widthInPixel/s.width>64);const{r:h,g:r,b:n}=e.color;i.globalCompositeOperation=e.compositeOperation,i.globalAlpha=e.alpha*s.alpha,i.imageSmoothingEnabled=c(this,$t)[$t],i.drawImage(ii.getGradientImage(h,r,n),0,0,64,64,e.x-e.scaleX/2,e.y-e.scaleY/2,e.scaleX,e.scaleY),i.imageSmoothingEnabled=!0}}}Object.defineProperty(ii,ti,{writable:!0,value:[[[]]]});var si=/*___PURE__*/a("oldPath"),ei=/*___PURE__*/a("path2D"),hi=/*___PURE__*/a("normalizeFullScreen");function ri(t){(this.p.norm||void 0===this.p.width)&&(this.p.width=t.visibleScreen.width),(this.p.norm||void 0===this.p.height)&&(this.p.height=t.visibleScreen.height),(this.p.norm||void 0===this.p.x)&&(this.p.x=t.visibleScreen.x,this.p.position===exports.Position.CENTER&&(this.p.x+=this.p.width/2)),(this.p.norm||void 0===this.p.y)&&(this.p.y=t.visibleScreen.y,this.p.position===exports.Position.CENTER&&(this.p.y+=this.p.height/2))}var ni=/*___PURE__*/a("starsX"),oi=/*___PURE__*/a("starsY"),ai=/*___PURE__*/a("starsZ"),ci=/*___PURE__*/a("starsOldX"),li=/*___PURE__*/a("starsOldY"),ui=/*___PURE__*/a("starsNewX"),di=/*___PURE__*/a("starsNewY"),vi=/*___PURE__*/a("starsEnabled"),fi=/*___PURE__*/a("starsLineWidth"),bi=/*___PURE__*/a("centerX"),mi=/*___PURE__*/a("centerY"),wi=/*___PURE__*/a("scaleZ"),pi=/*___PURE__*/a("moveStar");function Oi(t,i,s){const e=this.p,h=e.width/2,r=e.height/2;s&&(c(this,vi)[vi][t]=!0);let n=c(this,ni)[ni][t]+e.moveX*i,o=c(this,oi)[oi][t]+e.moveY*i,a=c(this,ai)[ai][t]+e.moveZ*i;for(;n<-h;)n+=e.width,o=Math.random()*e.height-r,c(this,vi)[vi][t]=!1;for(;n>h;)n-=e.width,o=Math.random()*e.height-r,c(this,vi)[vi][t]=!1;for(;o<-r;)o+=e.height,n=Math.random()*e.width-h,c(this,vi)[vi][t]=!1;for(;o>r;)o-=e.height,n=Math.random()*e.width-h,c(this,vi)[vi][t]=!1;for(;a<=0;)a+=c(this,wi)[wi],n=Math.random()*e.width-h,o=Math.random()*e.height-r,c(this,vi)[vi][t]=!1;for(;a>c(this,wi)[wi];)a-=c(this,wi)[wi],n=Math.random()*e.width-h,o=Math.random()*e.height-r,c(this,vi)[vi][t]=!1;const l=c(this,bi)[bi]+n/a*h,u=c(this,mi)[mi]+o/a*r;if(c(this,vi)[vi][t]=c(this,vi)[vi][t]&&l>=e.x&&u>=e.y&&l<e.x+e.width&&u<e.y+e.height,s)c(this,ni)[ni][t]=n,c(this,oi)[oi][t]=o,c(this,ai)[ai][t]=a,c(this,ui)[ui][t]=l,c(this,di)[di][t]=u;else{c(this,ci)[ci][t]=l,c(this,li)[li][t]=u;let i=4*(1-c(this,ai)[ai][t]/c(this,wi)[wi]);e.highScale||(i=Math.ceil(i)),c(this,fi)[fi][t]=i}}var yi={Callback:class extends xt{constructor(t){"function"==typeof t&&(t={callback:t}),super(t),Object.defineProperty(this,Pt,{writable:!0,value:0})}u(){return Object.assign({},this.O(),{callback:t=>void 0===typeof t?()=>{}:t})}animate(t){return this.p.enabled&&(c(this,Pt)[Pt]+=t),super.animate(t)}draw(t,i){this.p.enabled&&this.p.callback(t,c(this,Pt)[Pt],i,this)}},Canvas:class extends Tt{constructor(t){super(t),Object.defineProperty(this,Dt,{value:Nt}),Object.defineProperty(this,zt,{value:Lt}),Object.defineProperty(this,At,{value:_t}),Object.defineProperty(this,It,{writable:!0,value:void 0}),Object.defineProperty(this,Ft,{writable:!0,value:2}),Object.defineProperty(this,St,{writable:!0,value:void 0}),Object.defineProperty(this,Et,{writable:!0,value:void 0})}u(){return Object.assign({},super.u(),{x:void 0,y:void 0,width:void 0,height:void 0,canvasWidth:void 0,canvasHeight:void 0,gridSize:void 0,compositeOperation:"source-over",norm:(t,i)=>R(l(t),void 0===l(i.x)&&void 0===l(i.y)&&void 0===l(i.width)&&void 0===l(i.height)),isDrawFrame:(t,i)=>R(t,1)})}resize(t,i){c(this,Dt)[Dt](i),super.resize(t,i)}detect(t,i,s){return this.M(this.p,t,i,s,!1)}init(t,i){c(this,At)[At](i),c(this,zt)[zt](i)}draw(t,i){const s=this.p;if(s.enabled){s.gridSize&&c(this,It)[It]!==s.gridSize&&c(this,Dt)[Dt](i),c(this,Ft)[Ft]=Math.max(c(this,Ft)[Ft]-1,l(s.isDrawFrame,t,i));const e=s.width,h=s.height,r=e/2,n=h/2,o=c(this,St)[St].width,a=c(this,St)[St].height;if(c(this,Ft)[Ft]){c(this,Et)[Et].textBaseline="middle",c(this,Et)[Et].textAlign="center",c(this,Et)[Et].globalAlpha=1,c(this,Et)[Et].globalCompositeOperation="source-over",c(this,Et)[Et].save();const t=i.cam;if(s.norm&&t){const i=Math.max(o,a)/2;c(this,Et)[Et].translate(o/2,a/2),c(this,Et)[Et].scale(i,i),c(this,Et)[Et].scale(t.zoom,t.zoom),c(this,Et)[Et].translate(-t.x,-t.y)}for(const t of s.sprite)t.draw(c(this,Et)[Et],s.norm?Object.assign({},i,{alpha:1,widthInPixel:o,heightInPixel:a}):{alpha:1,x:0,y:0,width:o,height:a,widthInPixel:o,heightInPixel:a,scaleCanvas:1,visibleScreen:{x:0,y:0,width:o,height:a},fullScreen:{x:0,y:0,width:o,height:a}});c(this,Et)[Et].restore()}t.save(),t.globalCompositeOperation=s.compositeOperation,t.globalAlpha=s.alpha*i.alpha,t.translate(s.x+r,s.y+n),t.scale(s.scaleX,s.scaleY),t.rotate(s.rotation),t.drawImage(c(this,St)[St],0,0,o,a,-r,-n,e,h),t.restore()}}},Circle:class extends xt{constructor(t){super(t)}u(){return Object.assign({},this.O(),kt)}detect(t,i,s){return this.j(this.p,t,i,s,()=>(t.arc(0,0,1,Math.PI/2+this.p.rotation,2.5*Math.PI-this.p.rotation,!1),t.isPointInPath(i,s)))}draw(t,i){this.p.enabled&&(t.globalCompositeOperation=this.p.compositeOperation,t.globalAlpha=this.p.alpha*i.alpha,t.save(),t.translate(this.p.x,this.p.y),t.scale(this.p.scaleX,this.p.scaleY),t.beginPath(),t.fillStyle=this.p.color,t.arc(0,0,1,Math.PI/2+this.p.rotation,2.5*Math.PI-this.p.rotation,!1),t.fill(),t.restore())}},Emitter:Bt,FastBlur:Wt,Group:Tt,Image:class extends xt{constructor(t){super(t),Object.defineProperty(this,Vt,{value:Kt}),Object.defineProperty(this,Gt,{value:Zt}),Object.defineProperty(this,Ut,{writable:!0,value:void 0}),Object.defineProperty(this,qt,{writable:!0,value:void 0}),Object.defineProperty(this,Rt,{writable:!0,value:void 0}),Object.defineProperty(this,Ht,{writable:!0,value:void 0})}u(){return Object.assign({},super.u(),kt,{image:t=>D.getImage(l(t)),position:exports.Position.CENTER,frameX:0,frameY:0,frameWidth:0,frameHeight:0,width:void 0,height:void 0,norm:!1,normCover:!1,normToScreen:!1,clickExact:!1,color:"_FFF",tint:0})}resize(t,i){this.h=!0}init(t,i){const s=this.p,e=s.frameWidth||s.image.width,h=s.frameHeight||s.image.height;c(this,qt)[qt]=s.normToScreen?s.normCover?Math.max(i.fullScreen.width/e,i.fullScreen.height/h):s.norm?Math.min(i.fullScreen.width/e,i.fullScreen.height/h):1:s.normCover?Math.max(i.width/e,i.height/h):s.norm?Math.min(i.width/e,i.height/h):1}detectDraw(t,i){const s=this.p;if(s.enabled&&s.isClickable&&s.clickExact){const e=s.frameWidth||s.image.width,h=s.frameHeight||s.image.height,r=(s.width?s.width:e)*c(this,qt)[qt]*s.scaleX,n=(s.height?s.height:h)*c(this,qt)[qt]*s.scaleY,o=s.position===exports.Position.LEFT_TOP,a=c(this,Vt)[Vt](e,h);a.globalAlpha=1,a.globalCompositeOperation="source-over",a.fillStyle=i,a.fillRect(0,0,e,h),a.globalCompositeOperation="destination-atop",a.drawImage(s.image,s.frameX,s.frameY,e,h,0,0,e,h),t.save(),t.translate(s.x,s.y),t.scale(s.scaleX,s.scaleY),t.rotate(s.rotation),t.drawImage(c(this,Rt)[Rt],0,0,e,h,o?0:-r/2,o?0:-n/2,r,n),t.restore(),c(this,Ut)[Ut]=void 0}}detect(t,i,s){return this.p.enabled&&this.p.isClickable&&this.p.clickExact?"c":this.M(this.p,t,i,s,!1)}draw(t,i){const s=this.p;if(s.enabled&&s.image&&s.alpha>0){const e=s.frameWidth||s.image.width,h=s.frameHeight||s.image.height,r=(s.width?s.width:e)*c(this,qt)[qt]*s.scaleX,n=(s.height?s.height:h)*c(this,qt)[qt]*s.scaleY;t.globalCompositeOperation=s.compositeOperation,t.globalAlpha=s.alpha*i.alpha;const o=s.position!==exports.Position.LEFT_TOP;let a=s.image,l=s.frameX,u=s.frameY;if(s.tint){const t=c(this,Gt)[Gt]();if(c(this,Ut)[Ut]!==t){const i=c(this,Vt)[Vt](e,h);i.globalAlpha=1,i.globalCompositeOperation="source-over",i.clearRect(0,0,e,h),i.globalAlpha=s.tint,i.fillStyle=s.color,i.fillRect(0,0,e,h),i.globalAlpha=1,i.globalCompositeOperation="destination-atop",i.drawImage(s.image,s.frameX,s.frameY,e,h,0,0,e,h),c(this,Ut)[Ut]=t}a=c(this,Rt)[Rt],l=0,u=0}let d=0,v=0;o&&(d=-r/2,v=-n/2),0==s.rotation?t.drawImage(a,l,u,e,h,s.x+d,s.y+v,r,n):(t.save(),t.translate(s.x,s.y),t.rotate(s.rotation),t.drawImage(a,l,u,e,h,d,v,r,n),t.restore())}}},Text:Jt,Particle:ii,Path:class extends Tt{constructor(t){if(super(t),Object.defineProperty(this,si,{writable:!0,value:void 0}),Object.defineProperty(this,ei,{writable:!0,value:new Path2D}),this.p.polyfill)if("function"!=typeof Path2D){let t=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.src="https://cdn.jsdelivr.net/npm/canvas-5-polyfill@0.1.5/canvas.min.js",t.appendChild(i)}else{let t=document.createElement("canvas").getContext("2d");t.stroke(new Path2D("M0,0H1")),t.getImageData(0,0,1,1).data[3]&&(this.p.polyfill=!1)}}u(){return Object.assign({},super.u(),{path:void 0,color:void 0,borderColor:void 0,lineWidth:1,clip:!1,fixed:!1,polyfill:!0})}changeToPathInit(t,i){return r.default.T("string"==typeof t?r.default.path2shapes(t):t,"string"==typeof i?r.default.path2shapes(i):i)}changeToPath(t,i){return r.default.I(i.pathFrom,i.pathTo,t)}detect(t,i,s){return this.M(this.p,t,i,s,!1,()=>t.isPointInPath(c(this,ei)[ei],i,s))}draw(t,i){const s=this.p;if(s.enabled){const e=s.alpha*i.alpha;c(this,si)[si]!==s.path&&(s.polyfill&&"string"==typeof s.path&&(s.path=r.default.path2shapes(s.path)),Array.isArray(s.path)?(c(this,ei)[ei]=new Path2D,s.path.forEach(t=>{c(this,ei)[ei].moveTo(t[0][0],t[0][1]),t.forEach(t=>{c(this,ei)[ei].bezierCurveTo(t[2],t[3],t[4],t[5],t[6],t[7])}),c(this,ei)[ei].closePath()})):s.path instanceof Path2D?c(this,ei)[ei]=s.path:c(this,ei)[ei]=new Path2D(s.path),c(this,si)[si]=s.path);let h=s.scaleX,n=s.scaleY;s.fixed&&(0==h&&(h=Number.EPSILON),0==n&&(n=Number.EPSILON)),t.globalCompositeOperation=s.compositeOperation,t.globalAlpha=e,t.save(),t.translate(s.x,s.y),t.scale(h,n),t.rotate(s.rotation),s.color&&(t.fillStyle=s.color,t.fill(c(this,ei)[ei])),t.save(),s.clip&&(t.clip(c(this,ei)[ei]),s.fixed&&(t.rotate(-s.rotation),t.scale(1/h,1/n),t.translate(-s.x,-s.y)));for(const e of s.sprite)e.draw(t,i);t.restore(),s.borderColor&&(t.strokeStyle=s.borderColor,t.lineWidth=s.lineWidth,t.stroke(c(this,ei)[ei])),t.restore()}}},Rect:class extends xt{constructor(t){super(t),Object.defineProperty(this,hi,{value:ri})}u(){return Object.assign({},super.u(),kt,{x:void 0,y:void 0,width:void 0,height:void 0,borderColor:void 0,color:void 0,lineWidth:1,clear:!1,norm:(t,i)=>R(l(t),void 0===l(i.x)&&void 0===l(i.y)&&void 0===l(i.width)&&void 0===l(i.height)),position:exports.Position.CENTER})}resize(t,i){this.h=!0}init(t,i){c(this,hi)[hi](i)}detect(t,i,s){return this.M(this.p,t,i,s,this.p.position===exports.Position.LEFT_TOP)}draw(t,i){const s=this.p;if(s.enabled&&s.alpha>0)if(t.globalCompositeOperation=s.compositeOperation,t.globalAlpha=s.alpha*i.alpha,0===s.rotation&&s.position===exports.Position.LEFT_TOP)s.clear?t.clearRect(s.x,s.y,s.width,s.height):s.color&&(t.fillStyle=s.color,t.fillRect(s.x,s.y,s.width,s.height)),s.borderColor&&(t.beginPath(),t.lineWidth=s.lineWidth,t.strokeStyle=s.borderColor,t.rect(s.x,s.y,s.width,s.height),t.stroke());else{let i=s.width/2,e=s.height/2;t.save(),s.position===exports.Position.LEFT_TOP?t.translate(s.x+i,s.y+e):t.translate(s.x,s.y),t.scale(s.scaleX,s.scaleY),t.rotate(s.rotation),s.clear?t.clearRect(-i,-e,s.width,s.height):s.color&&(t.fillStyle=s.color,t.fillRect(-i,-e,s.width,s.height)),s.borderColor&&(t.beginPath(),t.lineWidth=s.lineWidth,t.strokeStyle=s.borderColor,t.rect(-i,-e,s.width,s.height),t.stroke()),t.restore()}}},Scroller:class extends Bt{constructor(t){let i=l(t.text),s=Array.isArray(i)?i:[...i];super(Object.assign({},t,{class:Jt,count:s.length,text:t=>s[t],enabled:i=>" "!==s[i]&&l(t.enabled)}))}},StackBlur:class extends Wt{constructor(t){super(t),this.F=void 0}u(){return Object.assign({},super.u(),{onCanvas:!1,radius:void 0,radiusPart:void 0,radiusScale:!0})}normalizeFullScreen(t){const i=this.p;i.norm&&i.onCanvas?(i.x=0,i.y=0,i.width=t.widthInPixel,i.height=t.heightInPixel):super.normalizeFullScreen(t)}resize(t,i){super.resize(t,i),this.p.radiusPart&&(this.p.radius=void 0)}additionalBlur(t,i,e){const h=this.C.getImageData(0,0,t,i);s.imageDataRGBA(h,0,0,t,i,e.radius||1),this.C.putImageData(h,0,0)}draw(t,i){const e=this.p;if(e.enabled){void 0!==e.radius&&this.F===e.radiusPart||(e.radius=Math.round((i.widthInPixel+i.heightInPixel)/2/e.radiusPart),this.F=e.radiusPart);const h=Math.round(e.radius*(e.radiusScale&&i.cam?i.cam.zoom:1)/i.scaleCanvas);if(h)if(e.onCanvas){void 0!==e.width&&void 0!==e.height||this.normalizeFullScreen(i);const r=Math.round(e.x),n=Math.round(e.y),o=Math.round(e.width),a=Math.round(e.height),c=t.getImageData(r,n,o,a);s.imageDataRGBA(c,0,0,o-r,a-n,h),t.putImageData(c,r,n,0,0,o,a)}else i.radius=h,super.draw(t,i)}else super.draw(t,i)}},StarField:class extends xt{constructor(t){super(t),Object.defineProperty(this,pi,{value:Oi}),Object.defineProperty(this,ni,{writable:!0,value:[]}),Object.defineProperty(this,oi,{writable:!0,value:[]}),Object.defineProperty(this,ai,{writable:!0,value:[]}),Object.defineProperty(this,ci,{writable:!0,value:[]}),Object.defineProperty(this,li,{writable:!0,value:[]}),Object.defineProperty(this,ui,{writable:!0,value:[]}),Object.defineProperty(this,di,{writable:!0,value:[]}),Object.defineProperty(this,vi,{writable:!0,value:[]}),Object.defineProperty(this,fi,{writable:!0,value:[]}),Object.defineProperty(this,bi,{writable:!0,value:0}),Object.defineProperty(this,mi,{writable:!0,value:0}),Object.defineProperty(this,wi,{writable:!0,value:0})}u(){return Object.assign({},super.u(),{count:40,moveX:0,moveY:0,moveZ:0,lineWidth:void 0,highScale:!0,color:"_FFF"})}init(t,i){const s=this.p;function e(t,i,s){return void 0===s&&(s=-i),void 0===t||t<i||t>=s?Math.random()*(s-i)+i:t}s.width=s.width||i.width,s.height=s.height||i.height,s.x=void 0===s.x?i.x:s.x,s.y=void 0===s.y?i.y:s.y,s.lineWidth=s.lineWidth||Math.min(i.height/i.heightInPixel,i.width/i.widthInPixel)/2,c(this,bi)[bi]=s.width/2+s.x,c(this,mi)[mi]=s.height/2+s.y,c(this,wi)[wi]=Math.max(s.width,s.height)/2;for(let t=0;t<s.count;t++)c(this,ni)[ni][t]=e(c(this,ni)[ni][t],-s.width/2),c(this,oi)[oi][t]=e(c(this,oi)[oi][t],-s.height/2),c(this,ai)[ai][t]=e(c(this,ai)[ai][t],0,c(this,wi)[wi])}animate(t){let i=super.animate(t);if(this.p.enabled&&void 0!==c(this,bi)[bi]){let i=this.p.count;for(;i--;)c(this,pi)[pi](i,t/16,!0),c(this,vi)[vi][i]&&c(this,pi)[pi](i,-5,!1)}return i}resize(t,i){this.h=!0}detect(t,i,s){return this.M(this.p,t,i,s,!1)}draw(t,i){if(this.p.enabled){const s=this.p;if(t.globalCompositeOperation=s.compositeOperation,t.globalAlpha=s.alpha*i.alpha,0==s.moveY&&0==s.moveZ&&s.moveX<0){t.fillStyle=s.color;let i=s.count;for(;i--;)c(this,vi)[vi][i]&&t.fillRect(c(this,ui)[ui][i],c(this,di)[di][i]-c(this,fi)[fi][i]*s.lineWidth/2,c(this,ci)[ci][i]-c(this,ui)[ui][i],c(this,fi)[fi][i]*s.lineWidth)}else if(t.strokeStyle=s.color,s.highScale){let i=s.count;for(;i--;)c(this,vi)[vi][i]&&(t.beginPath(),t.lineWidth=c(this,fi)[fi][i]*s.lineWidth,t.moveTo(c(this,ci)[ci][i],c(this,li)[li][i]),t.lineTo(c(this,ui)[ui][i],c(this,di)[di][i]),t.stroke(),t.closePath())}else{let i,e=5;for(;--e;){for(t.beginPath(),t.lineWidth=e*s.lineWidth,i=s.count;i--;)c(this,vi)[vi][i]&&c(this,fi)[fi][i]===e&&(t.moveTo(c(this,ci)[ci][i],c(this,li)[li][i]),t.lineTo(c(this,ui)[ui][i],c(this,di)[di][i]));t.stroke(),t.closePath()}}}}}},ji=/*___PURE__*/a("callback"),gi=/*___PURE__*/a("duration"),Mi=/*___PURE__*/a("initialized");const xi=Math.PI/180;function Pi(t,i){return i.from+t*i.delta}function Ci(t,i){return t>=.5?i.to:i.from}function ki(t,i){for(var s,e=[...i.values],h=e.length;h>1;)for(h--,s=0;s<h;s++)e[s]=e[s]+t*(e[s+1]-e[s]);return e[0]}function Ti(t,i){return i.colorFrom.mix(i.colorTo,100*t).toString()}function Ii(t,i,s){let{pathFrom:e,pathTo:h}=i;return s.changeToPath(t,{pathFrom:e,pathTo:h})}var Fi=/*___PURE__*/a("initialized"),Si=/*___PURE__*/a("changeValues"),Ei=/*___PURE__*/a("duration"),Ai=/*___PURE__*/a("ease"),zi=/*___PURE__*/a("init");function Di(i,s){let e=c(this,Si)[Si].length;for(;e--;){const s=c(this,Si)[Si][e],h=i[s.name];s.isFunction?(s.from=h,s.to=s.isFunction(s.from),s.isColor?(s.colorFrom=new t.TinyColor(s.from),s.colorTo=new t.TinyColor(s.to),s.moveAlgorithm=Ti):s.isPath?([s.pathFrom,s.pathTo]=i.changeToPathInit(s.from,s.to),s.moveAlgorithm=Ii):Array.isArray(s.to)?(s.values=[h,...s.to],s.moveAlgorithm=ki):s.isStatic||(s.delta=s.to-s.from,s.moveAlgorithm=Pi)):s.isColor?(s.colorFrom=new t.TinyColor(h),s.colorTo=new t.TinyColor(s.to)):s.isPath?[s.pathFrom,s.pathTo]=i.changeToPathInit(h,s.to):s.bezier?s.values=[h,...s.bezier]:(s.from=h,s.delta=s.to-s.from)}}var _i=/*___PURE__*/a("Aniobject"),Li=/*___PURE__*/a("ifCallback"),Ni=/*___PURE__*/a("Aniobject"),Bi=/*___PURE__*/a("AniobjectElse"),Xi=/*___PURE__*/a("initialized"),Yi=/*___PURE__*/a("image"),Wi=/*___PURE__*/a("count"),Ui=/*___PURE__*/a("durationBetweenFrames"),qi=/*___PURE__*/a("duration"),Ri=/*___PURE__*/a("current"),Hi=/*___PURE__*/a("frameNumber"),Gi=/*___PURE__*/a("durationBetweenFrames"),Vi=/*___PURE__*/a("duration"),Zi=/*___PURE__*/a("framesToRight"),Ki=/*___PURE__*/a("Aniobject"),Ji=/*___PURE__*/a("times"),Qi=/*___PURE__*/a("timesOrg"),$i=/*___PURE__*/a("Aniobject"),ts=/*___PURE__*/a("times"),is=/*___PURE__*/a("initialized"),ss=/*___PURE__*/a("duration"),es=/*___PURE__*/a("shakeDiff"),hs=/*___PURE__*/a("shakeDiffHalf"),rs=/*___PURE__*/a("x"),ns=/*___PURE__*/a("y"),os=/*___PURE__*/a("showOnce"),as=/*___PURE__*/a("states"),cs=/*___PURE__*/a("transitions"),ls=/*___PURE__*/a("currentStateName"),us=/*___PURE__*/a("currentState"),ds=/*___PURE__*/a("isTransitioningToStateName"),vs={Callback:class{constructor(t,i){Object.defineProperty(this,ji,{writable:!0,value:void 0}),Object.defineProperty(this,gi,{writable:!0,value:void 0}),Object.defineProperty(this,Mi,{writable:!0,value:!1}),c(this,ji)[ji]=t,c(this,gi)[gi]=R(l(i),void 0)}reset(){c(this,Mi)[Mi]=!1}run(t,i){let s;return void 0!==c(this,gi)[gi]?(c(this,ji)[ji](t,Math.min(i,c(this,gi)[gi]),!c(this,Mi)[Mi]),c(this,Mi)[Mi]=!0,i-c(this,gi)[gi]):(s=c(this,ji)[ji](t,i,!c(this,Mi)[Mi]),c(this,Mi)[Mi]=!0,s)}},ChangeTo:class{constructor(t,i,s){Object.defineProperty(this,zi,{value:Di}),Object.defineProperty(this,Fi,{writable:!0,value:!1}),Object.defineProperty(this,Si,{writable:!0,value:void 0}),Object.defineProperty(this,Ei,{writable:!0,value:void 0}),Object.defineProperty(this,Ai,{writable:!0,value:void 0}),c(this,Si)[Si]=[];for(let i in t){const s=t[i],e="rotationInDegree"===i?s*xi:s,h="color"===i||"borderColor"===i,r="path"===i,n="text"===i,o="function"==typeof e,a=!h&&Array.isArray(e),u="scale"===i?["scaleX","scaleY"]:"rotationInRadian"===i||"rotationInDegree"===i?["rotation"]:[i];for(const t of u)c(this,Si)[Si].push({name:t,to:a?e[e.length-1]:l(e),bezier:a?e:void 0,isColor:h,isPath:r,isStatic:n,isFunction:o?e:void 0,moveAlgorithm:h?Ti:r?Ii:a?ki:n?Ci:Pi})}c(this,Ei)[Ei]=R(l(i),0),c(this,Ai)[Ai]=R(s,t=>t)}reset(){c(this,Fi)[Fi]=!1}run(t,i){if(c(this,Fi)[Fi]||(c(this,Fi)[Fi]=!0,c(this,zi)[zi](t,i)),c(this,Ei)[Ei]<=i){let i,s=c(this,Si)[Si].length;for(;s--;)i=c(this,Si)[Si][s],t[i.name]=i.to}else{let s,e=c(this,Si)[Si].length;const h=c(this,Ai)[Ai](i/c(this,Ei)[Ei]);for(;e--;)s=c(this,Si)[Si][e],t[s.name]=s.moveAlgorithm(h,s,t)}return i-c(this,Ei)[Ei]}},End:class{constructor(){}run(t,i){return pt.FORCE_DISABLE}},EndDisabled:class{constructor(){}run(t,i){return t.p.enabled=!1,pt.FORCE_DISABLE}},Forever:class{constructor(){Object.defineProperty(this,_i,{writable:!0,value:void 0});var t=[].slice.call(arguments);c(this,_i)[_i]=t[0]instanceof gt?t[0]:new gt(...t)}reset(t){var i,s;void 0===t&&(t=0),null==(i=(s=c(this,_i)[_i]).reset)||i.call(s,t)}play(t,i){var s,e;return void 0===t&&(t=""),void 0===i&&(i=0),null==(s=(e=c(this,_i)[_i]).play)?void 0:s.call(e,t,i)}run(t,i,s){let e=i;for(;e>=0;){if(e=c(this,_i)[_i].run(t,e,s),s=!0,!0===e)return!0;var h,r;e>=0&&(null==(h=(r=c(this,_i)[_i]).reset)||h.call(r))}return e}},If:class{constructor(t,i,s){Object.defineProperty(this,Li,{writable:!0,value:void 0}),Object.defineProperty(this,Ni,{writable:!0,value:void 0}),Object.defineProperty(this,Bi,{writable:!0,value:void 0}),c(this,Li)[Li]=t,c(this,Ni)[Ni]=i,c(this,Bi)[Bi]=R(s,()=>0)}play(t,i){var s,e,h,r;return void 0===t&&(t=""),void 0===i&&(i=0),(null==(s=(e=c(this,Ni)[Ni]).play)?void 0:s.call(e,t,i))||(null==(h=(r=c(this,Bi)[Bi]).play)?void 0:h.call(r,t,i))}run(t,i){const s=l(c(this,Li)[Li])?c(this,Ni)[Ni]:c(this,Bi)[Bi];return s.run?s.run(t,i):s(t,i)}},Image:class{constructor(t,i){Object.defineProperty(this,Xi,{writable:!0,value:!1}),Object.defineProperty(this,Yi,{writable:!0,value:void 0}),Object.defineProperty(this,Wi,{writable:!0,value:void 0}),Object.defineProperty(this,Ui,{writable:!0,value:void 0}),Object.defineProperty(this,qi,{writable:!0,value:void 0}),Object.defineProperty(this,Ri,{writable:!0,value:-1});const s=l(t);c(this,Ui)[Ui]=R(l(i),0),Array.isArray(s)?(c(this,Yi)[Yi]=s,c(this,Wi)[Wi]=s.length):(c(this,Yi)[Yi]=[s],c(this,Wi)[Wi]=1),c(this,qi)[qi]=c(this,Wi)[Wi]*c(this,Ui)[Ui]}reset(){c(this,Xi)[Xi]=!1}run(t,i){if(c(this,Xi)[Xi]||(c(this,Xi)[Xi]=!0,c(this,Ri)[Ri]=-1),i>=c(this,qi)[qi])t.p.image=D.getImage(c(this,Yi)[Yi][c(this,Yi)[Yi].length-1]);else{let s=Math.floor(i/c(this,Ui)[Ui]);s!==c(this,Ri)[Ri]&&(c(this,Ri)[Ri]=s,t.p.image=D.getImage(c(this,Yi)[Yi][c(this,Ri)[Ri]]))}return i-c(this,qi)[qi]}},ImageFrame:class{constructor(t,i,s){Object.defineProperty(this,Hi,{writable:!0,value:void 0}),Object.defineProperty(this,Gi,{writable:!0,value:void 0}),Object.defineProperty(this,Vi,{writable:!0,value:void 0}),Object.defineProperty(this,Zi,{writable:!0,value:void 0});const e=l(t);c(this,Zi)[Zi]=R(l(i),!0),c(this,Gi)[Gi]=R(l(s),0),c(this,Hi)[Hi]=Array.isArray(e)?e:[e],c(this,Vi)[Vi]=c(this,Hi)[Hi].length*c(this,Gi)[Gi]}run(t,i){let s=0;return s=i>=c(this,Vi)[Vi]?c(this,Hi)[Hi][c(this,Hi)[Hi].length-1]:c(this,Hi)[Hi][Math.floor(i/c(this,Gi)[Gi])],c(this,Zi)[Zi]?t.p.frameX=t.p.frameWidth*s:t.p.frameY=t.p.frameHeight*s,i-c(this,Vi)[Vi]}},Loop:class{constructor(t){Object.defineProperty(this,Ki,{writable:!0,value:void 0}),Object.defineProperty(this,Ji,{writable:!0,value:void 0}),Object.defineProperty(this,Qi,{writable:!0,value:void 0});var i=[].slice.call(arguments,1);c(this,Ki)[Ki]=i[0]instanceof gt?i[0]:new gt(...i),c(this,Ji)[Ji]=c(this,Qi)[Qi]=R(l(t),1)}reset(t){var i,s;void 0===t&&(t=0),c(this,Ji)[Ji]=c(this,Qi)[Qi],null==(i=(s=c(this,Ki)[Ki]).reset)||i.call(s,t)}play(t,i){var s,e;void 0===t&&(t=""),void 0===i&&(i=0),c(this,Ji)[Ji]=c(this,Qi)[Qi];const h=null==(s=(e=c(this,Ki)[Ki]).play)?void 0:s.call(e,t,i);return h&&(c(this,Ji)[Ji]=c(this,Qi)[Qi]),h}run(t,i,s){let e=i;for(;e>=0&&c(this,Ji)[Ji]>0;){if(e=c(this,Ki)[Ki].run(t,e,s),s=!0,!0===e)return!0;var h,r;e>=0&&(c(this,Ji)[Ji]--,null==(h=(r=c(this,Ki)[Ki]).reset)||h.call(r))}return e}},Once:class{constructor(t,i){Object.defineProperty(this,$i,{writable:!0,value:void 0}),Object.defineProperty(this,ts,{writable:!0,value:void 0}),c(this,$i)[$i]=t,c(this,ts)[ts]=R(l(i),1)}run(t,i){if(c(this,ts)[ts]<=0)return i;{let s=c(this,$i)[$i].run(t,i);return s>=0&&c(this,ts)[ts]--,s}}},Remove:class{constructor(){}run(t,i){return pt.REMOVE}},Sequence:gt,Shake:class{constructor(t,i){Object.defineProperty(this,is,{writable:!0,value:!1}),Object.defineProperty(this,ss,{writable:!0,value:void 0}),Object.defineProperty(this,es,{writable:!0,value:void 0}),Object.defineProperty(this,hs,{writable:!0,value:void 0}),Object.defineProperty(this,rs,{writable:!0,value:0}),Object.defineProperty(this,ns,{writable:!0,value:0}),c(this,ss)[ss]=l(i),c(this,es)[es]=l(t),c(this,hs)[hs]=c(this,es)[es]/2}reset(){c(this,is)[is]=!1}run(t,i){return c(this,is)[is]||(c(this,is)[is]=!0,c(this,rs)[rs]=t.p.x,c(this,ns)[ns]=t.p.y),i>=c(this,ss)[ss]?(t.p.x=c(this,rs)[rs],t.p.y=c(this,ns)[ns]):(t.p.x=c(this,rs)[rs]+Math.random()*c(this,es)[es]-c(this,hs)[hs],t.p.y=c(this,ns)[ns]+Math.random()*c(this,es)[es]-c(this,hs)[hs]),i-c(this,ss)[ss]}},ShowOnce:class{constructor(){Object.defineProperty(this,os,{writable:!0,value:!0})}run(t,i){return t.p.enabled=t.p.enabled&&c(this,os)[os],c(this,os)[os]=!1,0}},State:class{constructor(t){let{states:i={},transitions:s={},defaultState:e}=t;Object.defineProperty(this,as,{writable:!0,value:void 0}),Object.defineProperty(this,cs,{writable:!0,value:void 0}),Object.defineProperty(this,ls,{writable:!0,value:void 0}),Object.defineProperty(this,us,{writable:!0,value:void 0}),Object.defineProperty(this,ds,{writable:!0,value:void 0}),c(this,as)[as]=Object.fromEntries(Object.entries(i).map(t=>{let[i,s]=t;return[i,Array.isArray(s)?new gt(s):s]})),c(this,cs)[cs]=Object.fromEntries(Object.entries(s).map(t=>{let[i,s]=t;return[i,Array.isArray(s)?new gt(s):s]})),c(this,ls)[ls]=e,c(this,us)[us]=c(this,as)[as][e]}setState(t){if(t!==c(this,ls)[ls]){c(this,ds)[ds]=t;const e=""+t.charAt(0).toUpperCase()+t.slice(1),h=[c(this,ls)[ls]+"To"+e,c(this,ls)[ls]+"To","to"+e].find(t=>t in c(this,cs)[cs]);var i,s;h?(c(this,ls)[ls]=c(this,ds)[ds],c(this,us)[us]=c(this,cs)[cs][h],null==(i=c(this,us)[us])||null==i.reset||i.reset()):(c(this,ls)[ls]=c(this,ds)[ds],c(this,us)[us]=c(this,as)[as][c(this,ls)[ls]],null==(s=c(this,us)[us])||null==s.reset||s.reset(),c(this,ds)[ds]=void 0)}}play(t,i){var s;return void 0===t&&(t=""),void 0===i&&(i=0),null==(s=c(this,us)[us])||null==s.play?void 0:s.play(t,i)}run(t,i,s){let e=i,h=s;if(c(this,us)[us]){if(e=c(this,us)[us].run(t,e,h),!0===e)return!0;h=!0}var r;if(e>=0||!c(this,us)[us])if(c(this,ds)[ds]){if(c(this,ls)[ls]=c(this,ds)[ds],c(this,us)[us]=c(this,as)[as][c(this,ls)[ls]],null==(r=c(this,us)[us])||null==r.reset||r.reset(),c(this,ds)[ds]=void 0,e=c(this,us)[us].run(t,e,h),!0===e)return!0}else c(this,us)[us]=void 0;return-1}},Stop:class{constructor(){}run(t,i){return pt.STOP}},StopDisabled:class{constructor(){}run(t,i){return t.p.enabled=!1,pt.STOP}},Wait:yt,WaitDisabled:class{constructor(t){this.duration=void 0,this.duration=R(l(t),0)}run(t,i){return t.p.enabled=i>=this.duration,i-this.duration}}};class fs{constructor(t){void 0===t&&(t={}),this.type="camera",this.cam=void 0,this.type="camera",this.cam=Object.assign({zoom:1,x:0,y:0},t)}viewport(t,i){return i.scale(this.cam.zoom,this.cam.zoom).translate(-this.cam.x,-this.cam.y)}viewportByCam(t,i){let{engine:s}=t;const e=s.getWidth()/2,h=s.getHeight()/2,r=s.getRatio()>1?e:h;return(new q).translate(e,h).scale(r,r).scale(i.zoom,i.zoom).translate(-i.x,-i.y)}additionalModifier(t,i){return i.cam=Object.assign({},this.cam),i}clampView(t,i){const{engine:s,scene:e,clampLimits:h}=t,r=h||{x1:e.additionalModifier.x,y1:e.additionalModifier.y,x2:e.additionalModifier.x+e.additionalModifier.width,y2:e.additionalModifier.y+e.additionalModifier.height},n=this.viewportByCam(t,i).invert(),[o,a]=n.transformPoint(0,0),[c,l]=n.transformPoint(s.getWidth(),s.getHeight());return c-o<=r.x2-r.x1?o<r.x1?c<=r.x2&&(i.x+=r.x1-o):c>r.x2&&(i.x+=r.x2-c):o>r.x1?i.x+=r.x1-o:c<r.x2&&(i.x+=r.x2-c),l-a<=r.y2-r.y1?a<r.y1?l<=r.y2&&(i.y+=r.y1-a):l>r.y2&&(i.y+=r.y2-l):a>r.y1?i.y+=r.y1-a:l<r.y2&&(i.y+=r.y2-l),i}set zoom(t){this.cam.zoom=t}set camX(t){this.cam.x=t}set camY(t){this.cam.y=t}get zoom(){return this.cam.zoom}get camX(){return this.cam.x}get camY(){return this.cam.y}zoomToFullScreen(t){let{scene:i}=t;return Math.min(i.additionalModifier.fullScreen.width/i.additionalModifier.width,i.additionalModifier.fullScreen.height/i.additionalModifier.height)}zoomTo(t){const{scene:i,engine:s,cam:e,x1:h,y1:r,x2:n,y2:o}=t,a=i.additionalModifier.scaleCanvas,c=this.viewportByCam(t,e||this.cam).invert(),[l,u]=c.transformPoint(0,0),[d,v]=c.transformPoint(s.getWidth()*a,s.getHeight()*a),f=n-h,b=o-r,m={x:h+f/2,y:r+b/2,zoom:(e||this.cam).zoom*Math.max(Math.min((d-l)/f,(v-u)/b),Number.MIN_VALUE)};e?(e.x=m.x,e.y=m.y,e.zoom=m.zoom):this.cam=m}}var bs=/*___PURE__*/a("scene"),ms=/*___PURE__*/a("instant");class ws{constructor(t){void 0===t&&(t={}),this.type="control",this.S={},this.toCam={zoom:1,x:0,y:0},this.A=void 0,Object.defineProperty(this,bs,{writable:!0,value:void 0}),Object.defineProperty(this,ms,{writable:!0,value:!1}),this.A=Object.assign({zoomMax:10,zoomMin:.5,zoomFactor:1.2,tween:2,callResize:!0},t)}init(t){let{scene:i}=t;c(this,bs)[bs]=i,this.toCam=Object.assign({},i.camera.cam)}mouseDown(t){var i;let{event:s,position:[e,h],button:r}=t;this.S[r]=Object.assign({},this.S[r],{x:e,y:h,D:this.toCam.x,_:this.toCam.y,L:!0,N:(null==(i=s.touches)?void 0:i.length)||1,B:void 0,X:Date.now()})}mouseUp(t){var i;let{event:s,position:[e,h],button:r,scene:n}=t;this.S[r]||delete this.S[r];const o=this.S[r].L,a=(null==(i=s.changedTouches)?void 0:i.length)||1,c=Math.max(this.S[r].N,a);this.S[r].L=!1,this.S[r].N-=a,!o||c>1?n.stopPropagation():Date.now()-this.S[r].X<300&&Math.abs(this.S[r].x-e)<5&&Math.abs(this.S[r].y-h)<5&&1===r||n.stopPropagation()}mouseOut(t){let{button:i}=t;this.S[i]&&(this.S[i].L=!1)}mouseMove(t){var i;let{event:s,position:[e,h],button:r,scene:n}=t;if(!this.S[r]||!this.S[r].L||0===s.which&&!s.touches)return;const o=n.additionalModifier.scaleCanvas;if((null==(i=s.touches)?void 0:i.length)>=2){const t=s.touches,i=Math.sqrt((t[0].pageX-t[1].pageX)*(t[0].pageX-t[1].pageX)+(t[0].pageY-t[1].pageY)*(t[0].pageY-t[1].pageY));void 0===this.S[r].B?i>0&&(this.S[r].B=i,this.S[r].Y=this.toCam.zoom):(this.toCam.zoom=Math.max(this.A.zoomMin,Math.min(this.A.zoomMax,this.S[r].Y*i/this.S[r].B)),this.toCam=n.camera.clampView(arguments[0],this.toCam))}else{this.S[r].B=void 0;const t=n.camera.viewportByCam(arguments[0],this.toCam).invert(),[i,s]=t.transformPoint(this.S[r].x*o,this.S[r].y*o),[a,c]=t.transformPoint(e*o,h*o);this.toCam.x=this.S[r].D+i-a,this.toCam.y=this.S[r]._+s-c,this.toCam=n.camera.clampView(arguments[0],this.toCam)}}mouseWheel(t){let{event:i,position:[s,e],scene:h}=t;const r=h.additionalModifier.scaleCanvas,[n,o]=h.camera.viewportByCam(arguments[0],this.toCam).invert().transformPoint(s*r,e*r);if((i.wheelDelta||-1*i.deltaY)/120>0){this.zoomIn();const[t,i]=h.camera.viewportByCam(arguments[0],this.toCam).invert().transformPoint(s*r,e*r);this.toCam.x-=t-n,this.toCam.y-=i-o,this.toCam=h.camera.clampView(arguments[0],this.toCam)}else this.zoomOut(arguments[0])}hasCamChanged(){const t=this.A.tween||1;return Math.abs(this.toCam.x-c(this,bs)[bs].camera.cam.x)>=Number.EPSILON*t||Math.abs(this.toCam.y-c(this,bs)[bs].camera.cam.y)>=Number.EPSILON*t||Math.abs(this.toCam.zoom-c(this,bs)[bs].camera.cam.zoom)>=Number.EPSILON*t}fixedUpdate(t){let{scene:i,lastCall:s}=t;this.A.tween&&!c(this,ms)[ms]&&this.hasCamChanged()&&(i.camera.cam.x+=(this.toCam.x-i.camera.cam.x)/this.A.tween,i.camera.cam.y+=(this.toCam.y-i.camera.cam.y)/this.A.tween,i.camera.cam.zoom+=(this.toCam.zoom-i.camera.cam.zoom)/this.A.tween,s&&(i.additionalModifier.cam=i.camera.cam,this.A.callResize?i.resize():i.cacheClear()))}update(t){let{scene:i}=t;this.A.tween&&!c(this,ms)[ms]||!this.hasCamChanged()||(c(this,ms)[ms]=!1,i.camera.cam=Object.assign({},this.toCam),this.A.callResize?i.resize():i.cacheClear())}camInstant(){c(this,ms)[ms]=!0}resize(t){this.toCam=t.scene.camera.clampView(t,this.toCam)}zoomToNorm(){return this.toCam.zoom=1,this}zoomIn(){return this.toCam.zoom=Math.min(this.A.zoomMax,this.toCam.zoom*this.A.zoomFactor),this}zoomOut(t){return this.toCam.zoom=Math.max(this.A.zoomMin,this.toCam.zoom/this.A.zoomFactor),this.toCam=t.scene.camera.clampView(t,this.toCam),this}zoomTo(t){t.scene.camera.zoomTo(Object.assign(t,{cam:this.toCam}))}}var ps=/*___PURE__*/a("doubleClickElementTimer"),Os=/*___PURE__*/a("doubleClickDetectInterval"),ys=/*___PURE__*/a("clickIntend"),js=/*___PURE__*/a("hoverIntend"),gs=/*___PURE__*/a("hasDetectImage"),Ms=/*___PURE__*/a("doubleClickElementTimer"),xs=/*___PURE__*/a("doubleClickDetectInterval"),Ps=/*___PURE__*/a("dispatchEvent"),Cs=/*___PURE__*/a("dispatchNonEvent");function ks(t,i,s){i?t.has("doubleClickElement")?c(this,Ms)[Ms]?(window.clearTimeout(c(this,Ms)[Ms]),c(this,Ms)[Ms]=0,t.map("doubleClickElement",s)):c(this,Ms)[Ms]=window.setTimeout(()=>{c(this,Ms)[Ms]=0,t.map("clickElement",s)},c(this,xs)[xs]):t.map("clickElement",s):t.map("hoverElement",s)}function Ts(t,i,s){i?t.has("doubleClickNonElement")?c(this,Ms)[Ms]?(clearTimeout(c(this,Ms)[Ms]),c(this,Ms)[Ms]=void 0,t.map("doubleClickNonElement",s)):c(this,Ms)[Ms]=window.setTimeout(()=>{c(this,Ms)[Ms]=void 0,t.map("clickNonElement",s)},c(this,xs)[xs]):t.map("clickNonElement",s):t.map("hoverNonElement",s)}var Is=/*___PURE__*/a("events"),Fs=/*___PURE__*/a("pushEvent");function Ss(t,i,s){R(s.value("preventDefault"),!0)&&i.preventDefault();const[e,h]=this.getMousePosition({event:i}),[r,n]=s.transformPoint(e,h);s.pipeBack(t,{event:i,position:[e,h],x:r,y:n,button:this.getMouseButton({event:i})})}var Es=/*___PURE__*/a("maxSkippedTickChunk"),As=/*___PURE__*/a("audioStartTime"),zs=/*___PURE__*/a("audioPosition"),Ds=/*___PURE__*/a("enableAndroidHack"),_s=/*___PURE__*/a("audioElement"),Ls={Callback:fs,Camera:fs,CameraControl:ws,CameraControlSecondButton:class extends ws{mouseUp(t){var i;let{event:s,position:[e,h],button:r,scene:n}=t;this.S[r]||delete this.S[r];const o=this.S[r].L,a=(null==(i=s.changedTouches)?void 0:i.length)||1,c=Math.max(this.S[r].N,a);if(this.S[r].L=!1,this.S[r].N-=a,!o||c>1)n.stopPropagation();else if((Date.now()-this.S[r].X>300||Math.abs(this.S[r].x-e)>=5||Math.abs(this.S[r].y-h)>=5)&&1===r){n.stopPropagation();const[t,i]=n.transformPoint(e,h),[o,a]=n.transformPoint(this.S[r].x,this.S[r].y);n.map("region",{event:s,x1:Math.min(o,t),y1:Math.min(a,i),x2:Math.max(o,t),y2:Math.max(a,i),fromX:o,fromY:a,toX:t,toY:i})}}mouseMove(t){var i;let{event:s,position:[e,h],button:r,scene:n}=t;if(!this.S[r]||!this.S[r].L||0===s.which&&!s.touches)return;const o=n.additionalModifier.scaleCanvas;if((null==(i=s.touches)?void 0:i.length)>=2){const t=s.touches,i=Math.sqrt((t[0].pageX-t[1].pageX)*(t[0].pageX-t[1].pageX)+(t[0].pageY-t[1].pageY)*(t[0].pageY-t[1].pageY));if(void 0===this.S[r].B)i>0&&(this.S[r].B=i,this.S[r].Y=this.toCam.zoom);else{this.toCam.zoom=Math.max(this.A.zoomMin,Math.min(this.A.zoomMax,this.S[r].Y*i/this.S[r].B));const t=n.camera.viewportByCam(arguments[0],this.toCam).invert(),[s,a]=t.transformPoint(this.S[r].x*o,this.S[r].y*o),[c,l]=t.transformPoint(e*o,h*o);this.toCam.x=this.S[r].D+s-c,this.toCam.y=this.S[r]._+a-l,this.toCam=n.camera.clampView(arguments[0],this.toCam)}}else{if(this.S[r].B=void 0,2===r){const t=n.camera.viewportByCam(arguments[0],this.toCam).invert(),[i,s]=t.transformPoint(this.S[r].x*o,this.S[r].y*o),[a,c]=t.transformPoint(e*o,h*o);this.toCam.x=this.S[r].D+i-a,this.toCam.y=this.S[r]._+s-c,this.toCam=n.camera.clampView(arguments[0],this.toCam)}if(1===r&&n.has("regionMove")&&!(Date.now()-this.S[r].X<300&&Math.abs(this.S[r].x-e)<5&&Math.abs(this.S[r].y-h)<5)&&(!s.touches||1===s.touches.length)){const[t,i]=n.transformPoint(e,h),[o,a]=n.transformPoint(this.S[r].x,this.S[r].y);n.map("regionMove",{event:s,x1:Math.min(o,t),y1:Math.min(a,i),x2:Math.max(o,t),y2:Math.max(a,i),fromX:o,fromY:a,toX:t,toY:i})}}}},Click:class{constructor(t){let{doubleClickDetectInterval:i=350}=void 0===t?{}:t;Object.defineProperty(this,ps,{writable:!0,value:void 0}),Object.defineProperty(this,Os,{writable:!0,value:void 0}),c(this,Os)[Os]=i}mouseUp(t){const{scene:i,button:s}=t;1===s&&(i.has("doubleClick")?c(this,ps)[ps]?(clearTimeout(c(this,ps)[ps]),c(this,ps)[ps]=0,i.map("doubleClick",t)):c(this,ps)[ps]=window.setTimeout(()=>{c(this,ps)[ps]=0,i.map("click",t)},c(this,Os)[Os]):i.map("click",t))}},Element:class{constructor(t){let{doubleClickDetectInterval:i=350}=void 0===t?{}:t;Object.defineProperty(this,Cs,{value:Ts}),Object.defineProperty(this,Ps,{value:ks}),Object.defineProperty(this,ys,{writable:!0,value:void 0}),Object.defineProperty(this,js,{writable:!0,value:void 0}),Object.defineProperty(this,gs,{writable:!0,value:!1}),Object.defineProperty(this,Ms,{writable:!0,value:void 0}),Object.defineProperty(this,xs,{writable:!0,value:void 0}),c(this,xs)[xs]=i}isDrawFrame(){return c(this,gs)[gs]?1:0}initSprites(t){const{scene:i,output:s,layerManager:e,canvasId:h}=t;if(c(this,gs)[gs]=!1,c(this,ys)[ys]||c(this,js)[js]){const r=!!c(this,ys)[ys],{mx:n,my:o}=c(this,ys)[ys]||c(this,js)[js],a=i.additionalModifier.scaleCanvas,l=s.context[h||0],u=Math.round(n/a),d=Math.round(o/a),[v,f]=i.transformPoint(n,o);let b;if(l.save(),l.setTransform(...i.viewport().m),e.forEach(t=>{let{layerId:i,element:s,isFunction:e,elementId:h}=t;if(!e){const t=s.detect(l,u,d);if("c"===t)b="c";else if(t)return b={layerId:i,element:t,elementId:h},!1}}),l.restore(),"c"===b)c(this,gs)[gs]=!0;else{c(this,ys)[ys]=void 0,c(this,js)[js]=void 0;const s=Object.assign({mx:n,my:o,x:v,y:f},t);b?(Object.assign(s,b),c(this,Ps)[Ps](i,r,s)):c(this,Cs)[Cs](i,r,s)}}}draw(t){const{engine:i,scene:s,layerManager:e,output:h,canvasId:r}=t;if(!r&&c(this,gs)[gs]){const r=!!c(this,ys)[ys],{mx:n,my:o}=c(this,ys)[ys]||c(this,js)[js],a=s.additionalModifier.scaleCanvas,l=h.context[0],u=Math.round(n/a),d=Math.round(o/a),[v,f]=s.transformPoint(n,o),b=Object.assign({mx:n,my:o,x:v,y:f},t),m=l.imageSmoothingEnabled;l.imageSmoothingEnabled=!1,l.clearRect(0,0,l.canvas.width,l.canvas.height),l.save(),l.setTransform(...s.viewport().m),e.forEach(t=>{let{layerId:i,element:s,isFunction:e,elementId:h}=t;e||s.detectDraw(l,"rgb("+(255&h)+", "+((65280&h)>>8)+", "+(255&i)+")")},0),l.restore(),l.imageSmoothingEnabled=m,i.normContext(l),c(this,ys)[ys]=void 0,c(this,js)[js]=void 0;const w=l.getImageData(u,d,1,1).data;w[3]?(Object.assign(b,{layerId:w[2],elementId:w[0]+(w[1]<<8),element:e.getById(b.layerId).getById(b.elementId)}),c(this,Ps)[Ps](s,r,b)):c(this,Cs)[Cs](s,r,b)}}mouseUp(t){let{scene:i,position:[s,e],button:h}=t;c(this,ys)[ys]=1===h&&i.has("clickElement")?{mx:s,my:e}:void 0}mouseMove(t){let{scene:i,position:[s,e]}=t;c(this,js)[js]=i.has("hoverElement")?{mx:s,my:e}:void 0}},Event:class{constructor(){Object.defineProperty(this,Fs,{value:Ss}),this.type="events",Object.defineProperty(this,Is,{writable:!0,value:[]})}events(t){let{scene:i}=t;return[i.has("mouseDown")&&[["touchstart","mousedown"],t=>c(this,Fs)[Fs]("mouseDown",t,i)],i.has("mouseUp")&&[["touchend","mouseup"],t=>c(this,Fs)[Fs]("mouseUp",t,i)],i.has("mouseOut")&&[["touchendoutside","mouseout"],t=>c(this,Fs)[Fs]("mouseOut",t,i)],i.has("mouseMove")&&[["touchmove","mousemove"],t=>c(this,Fs)[Fs]("mouseMove",t,i)],i.has("mouseWheel")&&[["wheel"],t=>c(this,Fs)[Fs]("mouseWheel",t,i)],R(i.value("preventDefault"),!0)&&[["contextmenu"],t=>t.preventDefault()]].filter(t=>t)}init(t){let{output:i,scene:s}=t;const e=i.canvas[0],h=s.map("events",{});c(this,Is)[Is]=h.filter(Array.isArray).reduce((t,i)=>(t.push.apply(t,i),t),[]).map(t=>Array.isArray(t)?t:[[t],i=>{R(s.value("preventDefault"),!0)&&i.preventDefault(),s.pipeBack(t,{event:i})}]).map(t=>{let[i,s]=t;return i.map(t=>({n:e,e:t,f:s}))}).reduce((t,i)=>(Array.isArray(i)?t.push.apply(t,i):t.push(i),t),[]),c(this,Is)[Is].forEach(t=>{t.n.addEventListener(t.e,t.f,!0)})}destroy(){c(this,Is)[Is].forEach(t=>{t.n.removeEventListener(t.e,t.f,!0)}),c(this,Is)[Is]=[]}getMousePosition(t){let i,{event:s}=t;if(s.touches&&s.touches.length>0?i=s.targetTouches:s.changedTouches&&s.changedTouches.length>0&&(i=s.changedTouches),i){const t=s.target.getBoundingClientRect(),e=i.length;return i=Array.from(i),[i.reduce((t,i)=>t+i.pageX,0)/e-t.left,i.reduce((t,i)=>t+i.pageY,0)/e-t.top]}if(void 0===s.offsetX){const t=s.target.getBoundingClientRect();return[s.clientX-t.left,s.clientY-t.top]}return[s.offsetX,s.offsetY]}getMouseButton(t){let{event:i}=t;return i.touches?i.touches.length||i.changedTouches.length:R(i.buttons?i.buttons:[0,1,4,2][i.which],1)}},LoadingScreen:class{loading(t){let{output:i,progress:s}=t;const e=i.context[0],h="number"==typeof s,r=h?Math.max(1,s*i.height):i.height;e.globalCompositeOperation="source-over",e.globalAlpha=1,e.clearRect(0,0,i.width,i.height),e.fillStyle="_aaa",e.fillRect(0,i.height/2-r/2,i.width,r),e.font="20px Georgia",e.fillStyle="_fff",e.textAlign="left",e.textBaseline="bottom",e.fillText(h?"Loading "+Math.round(100*s)+"%":s,10+3*Math.random(),i.height-10+3*Math.random())}},Norm:class{viewport(t,i){let{engine:s}=t;const e=s.getWidth()/2,h=s.getHeight()/2,r=s.getRatio()>1?e:h;return i.translate(e,h).scale(r,r)}additionalModifier(t){let{engine:i,output:s,scene:e}=t;e.cacheClear();const[h,r]=e.transformPoint(0,0,1),[n,o]=e.transformPoint(s.width,s.height,1),a=i.getWidth()/2,c=i.getHeight()/2,l=i.getRatio()>1?a:c,u=(new q).translate(a,c).scale(l,l).invert(),[d,v]=u.transformPoint(0,0),[f,b]=u.transformPoint(s.width,s.height);return{alpha:1,x:-1,y:-1,width:2,height:2,widthInPixel:s.width,heightInPixel:s.height,scaleCanvas:s.width/s.canvas[0].clientWidth,visibleScreen:{x:h,y:r,width:n-h,height:o-r},fullScreen:{x:d,y:v,width:f-d,height:b-v}}}},TimingAudio:class extends K{constructor(t){super({...t,maxSkippedTickChunk:Number.POSITIVE_INFINITY}),Object.defineProperty(this,Es,{writable:!0,value:Number.POSITIVE_INFINITY}),Object.defineProperty(this,As,{writable:!0,value:void 0}),Object.defineProperty(this,zs,{writable:!0,value:void 0}),Object.defineProperty(this,Ds,{writable:!0,value:!1}),Object.defineProperty(this,_s,{writable:!0,value:void 0}),c(this,_s)[_s]=t.audioElement}get audioElement(){return c(this,_s)[_s]}init(t){if(c(this,_s)[_s])return"function"==typeof MediaController&&(c(this,_s)[_s].controller=new MediaController,c(this,Ds)[Ds]=!0),c(this,_s)[_s].preload="auto",new Promise(t=>{let i=()=>{c(this,_s)[_s].removeEventListener("canplaythrough",i);let s=c(this,_s)[_s].play();s&&s.catch(t=>{}),t(void 0)};c(this,_s)[_s].addEventListener("canplaythrough",i),c(this,_s)[_s].load()})}endTime(){return c(this,_s)[_s]?1e3*c(this,_s)[_s].duration:Number.POSITIVE_INFINITY}currentTime(){let t=super.currentTime();if(c(this,_s)[_s]){if(c(this,_s)[_s].ended&&c(this,_s)[_s].duration)return 1e3*c(this,_s)[_s].duration;const i=1e3*c(this,_s)[_s].currentTime;if(c(this,Ds)[Ds]){if(void 0===c(this,As)[As])return c(this,As)[As]=t,c(this,zs)[zs]=i,i;if("playing"===c(this,_s)[_s].controller.playbackState){if(i===c(this,zs)[zs])return c(this,zs)[zs]+Math.min(260,t-c(this,As)[As]);if(i-c(this,zs)[zs]<500&&i>c(this,zs)[zs]&&t-c(this,As)[As]<350)return c(this,As)[As]=c(this,As)[As]+(i-c(this,zs)[zs]),c(this,zs)[zs]=i,c(this,zs)[zs]+t-c(this,As)[As]}return c(this,As)[As]=t,c(this,zs)[zs]=i,c(this,zs)[zs]}return i}return t}clampTime(t){let{timePassed:i}=t;return i}shiftTime(){return 0}},TimingDefault:K};Object.defineProperty(exports,"Easing",{enumerable:!0,get:function(){return n.default}}),exports.Animations=vs,exports.Engine=class{constructor(t){Object.defineProperty(this,v,{writable:!0,value:void 0}),Object.defineProperty(this,m,{writable:!0,value:void 0}),Object.defineProperty(this,w,{writable:!0,value:void 0}),Object.defineProperty(this,p,{writable:!0,value:void 0}),Object.defineProperty(this,O,{writable:!0,value:void 0}),Object.defineProperty(this,y,{writable:!0,value:void 0}),Object.defineProperty(this,j,{writable:!0,value:void 0}),Object.defineProperty(this,g,{writable:!0,value:void 0}),Object.defineProperty(this,M,{writable:!0,value:void 0}),Object.defineProperty(this,x,{writable:!0,value:void 0}),Object.defineProperty(this,P,{writable:!0,value:void 0}),Object.defineProperty(this,C,{writable:!0,value:void 0}),Object.defineProperty(this,k,{writable:!0,value:void 0}),Object.defineProperty(this,T,{writable:!0,value:void 0}),Object.defineProperty(this,I,{writable:!0,value:!1}),Object.defineProperty(this,F,{writable:!0,value:void 0}),Object.defineProperty(this,S,{writable:!0,value:void 0}),Object.defineProperty(this,E,{writable:!0,value:void 0}),Object.defineProperty(this,A,{writable:!0,value:!1});let i=t;if("object"!=typeof t)throw new Error("No canvas given for Engine constructor");if(t.getContext)i={canvas:t};else if(!t.canvas)throw new Error("No canvas given for Engine constructor");let s=Object.assign({},i);if(c(this,v)[v]={canvas:[],context:[],width:0,height:0,ratio:1},c(this,m)[m]=[],c(this,w)[w]=null,c(this,y)[y]=!1,c(this,g)[g]=0,c(this,j)[j]=!1,c(this,M)[M]=void 0,c(this,v)[v].canvas=u(s.canvas),s.autoSize){const t={enabled:!0,scaleLimitMin:1,scaleLimitMax:2.5,scaleFactor:1.07,referenceWidth:()=>c(this,v)[v].canvas[0].clientWidth,referenceHeight:()=>c(this,v)[v].canvas[0].clientHeight,currentScale:1,waitTime:100,currentWaitedTime:0,currentOffsetTime:0,offsetTimeLimitUp:300,offsetTimeLimitDown:300,registerResizeEvents:!0,registerVisibilityEvents:!0,setCanvasStyle:!1};c(this,x)[x]="object"==typeof s.autoSize?Object.assign({},t,s.autoSize):t,c(this,x)[x].registerResizeEvents&&(c(this,m)[m]=["resize","orientationchange"].map(t=>({n:window,e:t,f:this.recalculateCanvas.bind(this)}))),c(this,x)[x].registerVisibilityEvents&&c(this,m)[m].push({n:document,e:"visibilitychange",f:this.handleVisibilityChange.bind(this)}),this.W()}else c(this,v)[v].width=c(this,v)[v].canvas[0].width,c(this,v)[v].height=c(this,v)[v].canvas[0].height,c(this,v)[v].ratio=c(this,v)[v].width/c(this,v)[v].height;c(this,v)[v].canvas.forEach((t,i)=>{c(this,v)[v].context[i]=t.getContext("2d")}),c(this,P)[P]=c(this,v)[v].canvas.length,c(this,C)[C]=Array.from({length:c(this,P)[P]},t=>0),s.clickToPlayAudio&&c(this,m)[m].push({n:c(this,v)[v].canvas[0],e:"click",f:this.playAudioOfScene.bind(this)}),c(this,k)[k]=!!s.reduceFramerate,c(this,m)[m].forEach(t=>{t.n.addEventListener(t.e,t.f)}),this.switchScene(s.scene,s.sceneParameter||{})}handleVisibilityChange(){c(this,x)[x]&&(c(this,x)[x].enabled=!("hidden"==document.visibilityState))}playAudioOfScene(){c(this,y)[y]&&c(this,w)[w]&&c(this,w)[w].timing.audioElement&&c(this,w)[w].timing.audioElement.play()}normContext(t){t.textBaseline="middle",t.textAlign="center",t.globalAlpha=1,t.globalCompositeOperation="source-over"}getWidth(){return c(this,v)[v].width}getHeight(){return c(this,v)[v].height}getRatio(){return c(this,v)[v].ratio}getOutput(){return c(this,v)[v]}recalculateCanvas(){return c(this,j)[j]=!0,this}W(){if(c(this,x)[x]){const t=l(c(this,x)[x].referenceWidth),i=l(c(this,x)[x].referenceHeight);if(t<=0||i<=0)return;c(this,v)[v].canvas.forEach(s=>{s.width=Math.round(t/c(this,x)[x].currentScale),s.height=Math.round(i/c(this,x)[x].currentScale),c(this,x)[x].setCanvasStyle&&(s.style.width=t+"px",s.style.height=i+"px")}),c(this,x)[x].currentWaitedTime=0,c(this,x)[x].currentOffsetTime=0}c(this,v)[v].width=c(this,v)[v].canvas[0].width,c(this,v)[v].height=c(this,v)[v].canvas[0].height,c(this,v)[v].ratio=c(this,v)[v].width/c(this,v)[v].height,this.resize()}recalculateFPS(){try{const t=this;return c(t,M)[M]&&(window.cancelAnimationFrame(c(t,M)[M]),c(t,M)[M]=void 0),Promise.resolve(new Promise(t=>requestAnimationFrame(t))).then(function(){function i(){const i=(t.U()-s)/e;c(t,x)[x].offsetTimeTarget=i,c(t,x)[x].offsetTimeDelta=i/3,void 0===c(t,M)[M]&&(c(t,T)[T]=void 0,c(t,M)[M]=window.requestAnimationFrame(t.q.bind(t)))}const s=t.U(),e=3;let h=e;const r=function(t,i,s){for(var e;;){var h=t();if(b(h)&&(h=h.v),!h)return r;if(h.then){e=0;break}var r=s();if(r&&r.then){if(!b(r)){e=1;break}r=r.s}}var n=new f,o=d.bind(null,n,2);return(0===e?h.then(c):1===e?r.then(a):(void 0).then(function(){(h=t())?h.then?h.then(c).then(void 0,o):c(h):d(n,1,r)})).then(void 0,o),n;function a(i){r=i;do{if(!(h=t())||b(h)&&!h.v)return void d(n,1,r);if(h.then)return void h.then(c).then(void 0,o);b(r=s())&&(r=r.v)}while(!r||!r.then);r.then(a).then(void 0,o)}function c(t){t?(r=s())&&r.then?r.then(a).then(void 0,o):a(r):d(n,1,r)}}(function(){return h--},0,function(){return Promise.resolve(new Promise(t=>requestAnimationFrame(t))).then(function(){})});return r&&r.then?r.then(i):i()})}catch(t){return Promise.reject(t)}}resize(){return c(this,w)[w]&&c(this,w)[w].resize&&c(this,w)[w].resize(),this}switchScene(t,i){return void 0===i&&(i=void 0),t&&(c(this,p)[p]=t,c(this,O)[O]=i),this}U(){return window.performance?performance.now():Date.now()}q(t){if(!c(this,M)[M])return;c(this,M)[M]=window.requestAnimationFrame(this.q.bind(this));let i=c(this,j)[j]&&(!c(this,k)[k]||!c(this,I)[I]);i&&(this.W(),c(this,j)[j]=!1);for(let t=0;t<c(this,P)[P];t++)c(this,C)[C][t]=Math.max(c(this,C)[C][t]-1,i?1:0);if(c(this,T)[T]||(c(this,T)[T]=t),c(this,F)[F]||(c(this,F)[F]=t),c(this,p)[p]&&!c(this,S)[S]&&(c(this,S)[S]=Promise.resolve(c(this,w)[w]?c(this,w)[w].destroy():void 0),c(this,S)[S].then(i=>{c(this,p)[p].callInit({run:c(this,E)[E],scene:c(this,O)[O],destroy:i},this),c(this,w)[w]=c(this,p)[p],c(this,p)[p]=void 0,c(this,S)[S]=void 0,c(this,y)[y]=!1,c(this,g)[g]=c(this,w)[w].currentTime(),c(this,F)[F]=t})),c(this,w)[w]&&(c(this,k)[k]&&(c(this,I)[I]=!c(this,I)[I]),!c(this,k)[k]||c(this,I)[I])){let i=c(this,w)[w].currentTime(),s=c(this,w)[w].clampTime(i-c(this,g)[g]);const e=c(this,w)[w].shiftTime(s);if(s+=e,c(this,g)[g]=i+e,c(this,y)[y]){const i=0!==s||c(this,A)[A];c(this,A)[A]=!1;const e=this.U();if(c(this,v)[v].canvas[0].width)for(let t=0;t<c(this,P)[P];t++){const i=c(this,v)[v].context[t];this.normContext(i),c(this,w)[w].initSprites(t)}const h=c(this,w)[w].isDrawFrame(s);if(Array.isArray(h))for(let t=0;t<c(this,P)[P];t++)c(this,C)[C][t]=Math.max(c(this,C)[C][t],h[t],0);else for(let t=0;t<c(this,P)[P];t++)c(this,C)[C][t]=Math.max(c(this,C)[C][t],h,0);if(i&&c(this,w)[w].move(s),c(this,v)[v].canvas[0].width)for(let t=0;t<c(this,P)[P];t++)c(this,C)[C][t]&&c(this,w)[w].draw(t);if(c(this,x)[x]&&c(this,x)[x].enabled){const s=t-c(this,T)[T];if(c(this,x)[x].currentWaitedTime<c(this,x)[x].waitTime)c(this,x)[x].currentWaitedTime+=s;else if(i){const t=c(this,x)[x].offsetTimeTarget*(c(this,k)[k]?2:1),i=this.U()-e,h=(Math.abs(s-t)>Math.abs(i-t)?s:i)-t;Math.abs(h)<=c(this,x)[x].offsetTimeDelta?c(this,x)[x].currentOffsetTime=c(this,x)[x].currentOffsetTime>=0?Math.max(0,c(this,x)[x].currentOffsetTime-c(this,x)[x].offsetTimeDelta):Math.min(0,c(this,x)[x].currentOffsetTime+c(this,x)[x].offsetTimeDelta):h<0&&c(this,x)[x].currentScale>c(this,x)[x].scaleLimitMin?(c(this,x)[x].currentOffsetTime+=h,c(this,x)[x].currentOffsetTime<=-c(this,x)[x].offsetTimeLimitDown&&(c(this,x)[x].currentScale=Math.max(c(this,x)[x].scaleLimitMin,c(this,x)[x].currentScale/c(this,x)[x].scaleFactor),c(this,j)[j]=!0)):h>0&&c(this,x)[x].currentScale<c(this,x)[x].scaleLimitMax&&(c(this,x)[x].currentOffsetTime+=h,c(this,x)[x].currentOffsetTime>=c(this,x)[x].offsetTimeLimitUp&&(c(this,x)[x].currentScale=Math.min(c(this,x)[x].scaleLimitMax,c(this,x)[x].currentScale*c(this,x)[x].scaleFactor),c(this,j)[j]=!0))}}}else{for(let t=0;t<c(this,P)[P];t++)this.normContext(c(this,v)[v].context[t]);c(this,y)[y]=c(this,w)[w].callLoading({timePassed:t-c(this,T)[T],totalTimePassed:t-c(this,F)[F]}),c(this,y)[y]&&(c(this,w)[w].reset(),c(this,g)[g]=c(this,w)[w].currentTime(),c(this,A)[A]=!0,c(this,x)[x]&&(c(this,x)[x].currentWaitedTime=0))}}c(this,T)[T]=t}run(t){try{const i=this;return c(i,E)[E]=t||{},Promise.resolve(i.stop()).then(function(){function t(){return c(i,M)[M]=window.requestAnimationFrame(i.q.bind(i)),i}c(i,T)[T]=c(i,F)[F]=void 0;const s=function(){if(c(i,x)[x]&&!c(i,x)[x].offsetTimeTarget)return Promise.resolve(i.recalculateFPS()).then(function(){})}();return s&&s.then?s.then(t):t()})}catch(t){return Promise.reject(t)}}stop(){try{const t=this;function i(t){}c(t,M)[M]&&window.cancelAnimationFrame(c(t,M)[M]),c(t,M)[M]=void 0;const s=c(t,w)[w];return Promise.resolve(s?Promise.resolve(c(t,w)[w].destroy()).then(i):void 0)}catch(e){return Promise.reject(e)}}destroy(){try{const t=this;return Promise.resolve(t.stop()).then(function(){return c(t,m)[m].forEach(t=>{t.n.removeEventListener(t.e,t.f)}),c(t,m)[m]=[],t})}catch(t){return Promise.reject(t)}}},exports.ImageManager=D,exports.Middleware=Ls,exports.Scene=class{constructor(){Object.defineProperty(this,bt,{value:wt}),Object.defineProperty(this,ft,{value:mt}),Object.defineProperty(this,st,{writable:!0,value:void 0}),Object.defineProperty(this,et,{writable:!0,value:void 0}),Object.defineProperty(this,ht,{writable:!0,value:void 0}),Object.defineProperty(this,rt,{writable:!0,value:void 0}),Object.defineProperty(this,nt,{writable:!0,value:it}),Object.defineProperty(this,ot,{writable:!0,value:!1}),Object.defineProperty(this,at,{writable:!0,value:void 0}),Object.defineProperty(this,ct,{writable:!0,value:void 0}),Object.defineProperty(this,lt,{writable:!0,value:void 0}),Object.defineProperty(this,ut,{writable:!0,value:!1}),Object.defineProperty(this,dt,{writable:!0,value:void 0}),Object.defineProperty(this,vt,{writable:!0,value:!1}),c(this,st)[st]=new U,c(this,ht)[ht]=0,c(this,et)[et]=D,this.middlewares=[].slice.call(arguments),this.middlewareByType("timing")||(this.middlewares=[K,...this.middlewares])}set middlewares(t){c(this,nt)[nt]=u(t).map(t=>"function"==typeof t?new t:t).reduce((t,i)=>{for(let s of Object.keys(t))s in i&&t[s].push(i);return t.i.push(i),"enabled"in i||(i.enabled=!0),i.type&&(t["t_"+i.type]=[i]),t},it)}get middlewares(){return c(this,nt)[nt].i}middlewareByType(t){const i=c(this,nt)[nt].i.filter(i=>i.type===t);if(i.length)return i[i.length-1]}has(t){return t in c(this,nt)[nt]||c(this,nt)[nt].i.some(i=>t in i)}do(t,i,s,e){let h=c(this,nt)[nt][t]||c(this,nt)[nt].i.filter(i=>t in i);return h=h.filter(t=>t.enabled),h.length?e(h,c(this,bt)[bt](i),s):s}map(t,i){return this.do(t,i,[],(i,s)=>i.map(i=>i[t](s)))}pipe(t,i,s){return void 0===s&&(s=void 0),this.do(t,i,s,(i,e)=>{let h=s;c(this,ot)[ot]=!1;for(let s of i)if(h=s[t](e,h),c(this,ot)[ot])break;return h})}pipeBack(t,i,s){return void 0===s&&(s=void 0),this.do(t,i,s,(i,e)=>{let h=s;c(this,ot)[ot]=!1;for(let s=i.length-1;s>=0&&(h=i[s][t](e,h),!c(this,ot)[ot]);s--);return h})}pipeMax(t,i,s){return void 0===s&&(s=void 0),this.do(t,i,Array.isArray(s)?s.map(t=>t-0):s-0,(i,s,e)=>{let h=e;if(c(this,ot)[ot]=!1,Array.isArray(h))for(let e of i){let i=e[t](s,h);if(h=Array.isArray(i)?h.map((t,s)=>Math.max(t,i[s])):h.map((t,s)=>Math.max(t,i)),c(this,ot)[ot])break}else for(let e of i){let i=e[t](s,h);if(h=Array.isArray(i)?i.map(t=>Math.max(t,h)):Math.max(i,h),c(this,ot)[ot])break}return h})}pipeAsync(t,i,s){void 0===s&&(s=void 0);try{const e=this;return Promise.resolve(e.do(t,i,s,function(i,h){try{let r,n=s;c(e,ot)[ot]=!1;const o=function(t,i,s){if("function"==typeof t[J]){var e,h,r,n=t[J]();function l(t){try{for(;!((e=n.next()).done||s&&s());)if((t=i(e.value))&&t.then){if(!tt(t))return void t.then(l,r||(r=Q.bind(null,h=new $,2)));t=t.v}h?Q(h,1,t):h=t}catch(t){Q(h||(h=new $),2,t)}}if(l(),n.return){var o=function(t){try{e.done||n.return()}catch(t){}return t};if(h&&h.then)return h.then(o,function(t){throw o(t)});o()}return h}if(!("length"in t))throw new TypeError("Object is not iterable");for(var a=[],c=0;c<t.length;c++)a.push(t[c]);return function(t,i,s){var e,h,r=-1;return function n(o){try{for(;++r<t.length&&(!s||!s());)if((o=i(r))&&o.then){if(!tt(o))return void o.then(n,h||(h=Q.bind(null,e=new $,2)));o=o.v}e?Q(e,1,o):e=o}catch(t){Q(e||(e=new $),2,t)}}(),e}(a,function(t){return i(a[t])},s)}(i,function(i){return Promise.resolve(i[t](h,n)).then(function(t){n=t,c(e,ot)[ot]&&(r=1)})},function(){return r});return Promise.resolve(o&&o.then?o.then(function(){return n}):n)}catch(t){return Promise.reject(t)}}))}catch(t){return Promise.reject(t)}}value(t,i){void 0===i&&(i=void 0);let s=c(this,nt)[nt][t]||c(this,nt)[nt].i.filter(i=>t in i);if(s.filter(t=>t.enabled),s.length)return l(s[s.length-1][t],c(this,bt)[bt](i||{}))}stopPropagation(){c(this,ot)[ot]=!0}currentTime(){return this.pipe("currentTime",{})}clampTime(t){return this.pipe("clampTime",{timePassed:t})}shiftTime(t){return this.pipe("shiftTime",{timePassed:t})}cacheClear(){c(this,at)[at]=void 0,c(this,ct)[ct]=void 0}viewport(){return c(this,rt)[rt]?(c(this,at)[at]||(c(this,at)[at]=this.pipe("viewport",{},new q),c(this,ct)[ct]=void 0),c(this,at)[at]):new q}transformPoint(t,i,s){return void 0===s&&(s=c(this,lt)[lt].scaleCanvas),c(this,ct)[ct]||(c(this,ct)[ct]=this.viewport().clone().invert()),c(this,ct)[ct].transformPoint(t*s,i*s)}callInit(t,i){c(this,rt)[rt]=i,this.resize();const s=this.value("images");s&&c(this,et)[et].add(s),Promise.all(this.map("init",{parameter:t})).then(t=>c(this,ut)[ut]=!0)}get additionalModifier(){return c(this,lt)[lt]}updateAdditionalModifier(){const t=c(this,ft)[ft]();c(this,lt)[lt]=this.pipe("additionalModifier",{},{alpha:1,x:0,y:0,width:t.width,height:t.height,widthInPixel:t.width,heightInPixel:t.height,scaleCanvas:1,visibleScreen:{x:0,y:0,width:t.width,height:t.height},fullScreen:{x:0,y:0,width:t.width,height:t.height}})}resize(){const t=c(this,ft)[ft]();this.updateAdditionalModifier(),this.pipe("resize",{}),c(this,st)[st].forEach(i=>{let{element:s,isFunction:e}=i;e||s.resize(t,c(this,lt)[lt])})}destroy(){try{const t=this;return Promise.resolve(t.pipeAsync("destroy",{})).then(function(i){return c(t,ut)[ut]=!1,i})}catch(t){return Promise.reject(t)}}get timing(){return c(this,nt)[nt].t_timing[0]}get camera(){return c(this,nt)[nt].t_camera[0]}get control(){return c(this,nt)[nt].t_control[0]}get totalTimePassed(){return c(this,ht)[ht]}callLoading(t){if(c(this,et)[et].isLoaded()&&c(this,ut)[ut]){c(this,dt)[dt]=this.value("endTime");const i="Click to play";return this.value("loading",{...t,progress:i}),!0}const i=c(this,et)[et].count?c(this,et)[et].loaded/c(this,et)[et].count:"Loading...";return this.value("loading",{...t,progress:i}),!1}fixedUpdate(t,i){this.map("fixedUpdate",{timePassed:t,lastCall:i})}isDrawFrame(t){return this.pipeMax("isDrawFrame",{timePassed:t},0!==t)}move(t){if(c(this,ht)[ht]+=t,c(this,vt)[vt]?this.reset():t<0?(t=c(this,ht)[ht],this.reset(),this.initSprites(),c(this,ht)[ht]=t):c(this,dt)[dt]&&c(this,dt)[dt]<=c(this,ht)[ht]&&(t-=c(this,ht)[ht]-c(this,dt)[dt],c(this,ht)[ht]=c(this,dt)[dt],this.map("end",{timePassed:t})),this.value("isChunked")){if(this.value("hasOneChunkedFrame",{timePassed:t})){const i=this.value("calcFrames",{timePassed:t})-1;for(let t=0;t<=i;t++)this.fixedUpdate(this.value("tickChunk",{}),t===i)}}else this.fixedUpdate(t,!0);this.map("update",{timePassed:t}),c(this,st)[st].forEach(i=>{let{element:s,isFunction:e,layer:h,elementId:r}=i;e||s.animate(t)&&h.deleteById(r)})}draw(t){this.map("draw",{canvasId:t});const i=c(this,ft)[ft]().context[t];i.save(),i.setTransform(...this.viewport().m),c(this,st)[st].forEach(t=>{let{layer:s,layerId:e,element:h,isFunction:r,elementId:n}=t;r?h(c(this,bt)[bt]({layerId:e,elementId:n,layer:s,context:i}))&&s.deleteById(n):h.draw(i,c(this,lt)[lt])},t),i.restore()}initSprites(t){void 0===t&&(t=void 0);const i=c(this,ft)[ft]().context[t||0];c(this,st)[st].forEach(t=>{let{element:s,isFunction:e}=t;e||s.callInit(i,c(this,lt)[lt])},t),this.map("initSprites",{canvasId:t})}resetIntend(){c(this,vt)[vt]=!0}reset(){c(this,ht)[ht]=0,c(this,vt)[vt]=!1;let t=this.pipe("reset",{},new U);if(Array.isArray(t)){const i=t;t=new U,i.forEach(i=>{t.addLayer().addElements(i)})}t&&(c(this,st)[st]=t)}},exports.Sprites=yi;
//_ sourceMappingURL=animationvideo.cjs.map
