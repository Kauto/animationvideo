!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t||self).AnimationVideo={})}(this,function(t){"use strict";function i(t,i=null){return"function"==typeof t?t.apply(i,[].slice.call(arguments,2)):t}function s(t){return null==t?[]:Array.isArray(t)?t:[t]}function h(t,i,s){if(!t.s){if(s instanceof e){if(!s.s)return void(s.o=h.bind(null,t,i));1&i&&(i=s.s),s=s.v}if(s&&s.then)return void s.then(h.bind(null,t,i),h.bind(null,t,2));t.s=i,t.v=s;const r=t.o;r&&r(t)}}const e=function(){function t(){}return t.prototype.then=function(i,s){const e=new t,r=this.s;if(r){const t=1&r?i:s;if(t){try{h(e,1,t(this.v))}catch(t){h(e,2,t)}return e}return this}return this.o=function(t){try{const r=t.v;1&t.s?h(e,1,i?i(r):r):s?h(e,1,s(r)):h(e,2,r)}catch(t){h(e,2,t)}},e},t}();function r(t){return t instanceof e&&1&t.s}class n{constructor(){this.Images={},this.count=0,this.loaded=0}static add(t,i){const s=this||n;for(const h in t)if(s.Images[h])i&&"function"==typeof i[h]&&i[h](h,s.Images[h]);else{if(s.Images[h]=new window.Image,s.Images[h].onload=function(){s.loaded++,i&&"function"==typeof i?s.isLoaded()&&i():i&&"function"==typeof i[h]&&i[h](h,s.Images[h]),s.resolve&&s.isLoaded()&&(s.resolve(),s.resolve=null)},"<svg"===t[h].substr(0,4)){const i=window.URL||window.webkitURL||window,e=new window.Blob([t[h]],{type:"image/svg+xml"});s.Images[h].src=i.createObjectURL(e)}else/^(https?:)?\/\//.test(t[h])&&(s.Images[h].onerror=()=>{const i=new window.Image;i.onload=s.Images[h].onload,s.Images[h]=i,s.Images[h].src=t[h]},s.Images[h].crossOrigin="anonymous"),s.Images[h].src=t[h];s.count++}return i&&"function"==typeof i&&s.isLoaded()&&i(),s.resolve&&s.isLoaded()&&(s.resolve(),s.resolve=null),s}static reset(){const t=this||n;return t.Images={},t.count=0,t.loaded=0,t}static getLoaded(){return(this||n).loaded}static getCount(){return(this||n).count}static isLoaded(){const t=this||n;return t.loaded===t.count}static getImage(t){return"object"==typeof t?t:(this||n).Images[t]}static isLoadedPromise(){const t=this||n;return!!t.isLoaded()||new Promise((i,s)=>{t.resolve=i})}}n.Images={},n.count=0,n.loaded=0;class o{constructor(t){this.i=[],this.u=[],this.p=0,this.M=0,this.k=void 0===t?[]:Array.isArray(t)?t:[t]}addElement(t){return this.addElementForId(t),t}addElements(t){return this.addElementsForIds(t),t}addElementForId(t){let i=this.i.length,s=this.M;this.i[s]=t,this.u[s]="function"==typeof t,i===s&&i++;let h=this.M+1;for(;h!==i&&this.i[h];)h++;return this.M=h,this.p>s&&(this.p=s),s}addElementsForIds(t){let i=this.i.length;return i===this.M?(this.i=this.i.concat(t),this.M=this.i.length,t.forEach((t,s)=>{this.u[i+s]="function"==typeof t}),Array.from({length:t.length},(t,s)=>s+i)):t.map(t=>this.addElement(t))}getById(t){return this.i[t]}getIdByElement(t){return this.i.indexOf(t)}deleteByElement(t){const i=this.getIdByElement(t);i>=0&&this.deleteById(i)}deleteById(t){let i=this.i.length-1;if(i>0&&t===i){for(this.i[t]=null;i&&!this.i[i-1];)i--;this.i.length=i,this.u.length=i,this.M=Math.min(this.M,i),this.p=Math.min(this.p,i)}else this.i[t]&&(this.i[t]=null,this.M=Math.min(this.M,t),this.p===t&&(this.p=t+1))}isCanvasId(t){return void 0===t||!this.k.length||this.k.includes(t)}forEach(t,i=0){let s,h;const e=this.i.length;for(s=this.p;s<e;s++)if(h=this.i[s],h&&!1===t({elementId:s,layerId:i,element:h,isFunction:this.u[s],layer:this}))return}getElementsByTag(t){let i=[];return this.forEach(({element:s,isFunction:h})=>{if(!h){const h=s.getElementsByTag(t);h&&(i=i.concat(h))}}),i}play(t="",i=0){this.forEach(({element:s,isFunction:h})=>!h&&s.play(t,i))}count(){let t=0;const i=this.i.length;for(let s=this.p;s<i;s++)this.i[s]&&t++;return t}clear(){this.i=[],this.u=[],this.p=0,this.M=0}}class a{constructor(){this.I=[]}addLayer(t){return this.I[this.I.length]=new o(t),this.I[this.I.length-1]}addLayers(t=1,i){let s=Array.from({length:t},t=>new o(i));return this.I=this.I.concat(s),s}addLayerForId(t){return this.I[this.I.length]=new o(t),this.I.length-1}addLayersForIds(t=1,i){const s=Array.from({length:t},(t,i)=>i+this.I.length);return this.I=this.I.concat(Array.from({length:t},t=>new o(i))),s}getById(t){return this.I[t]}forEach(t,i){let s;const h=this.I.length;for(s=0;s<h&&(!this.I[s].isCanvasId(i)||!1!==this.I[s].forEach(t,s));s++);}play(t="",i=0){this.forEach(({element:s,isFunction:h})=>!h&&s.play(t,i))}getElementsByTag(t){let i=[];return this.forEach(({element:s,isFunction:h})=>{if(!h){const h=s.getElementsByTag(t);h&&(i=i.concat(h))}}),i}count(){return this.I.length}clear(){this.I=[]}}function u(){this.reset()}function c(t,i){return null==t||""===t?i:t}u.prototype.reset=function(){return this.m=[1,0,0,1,0,0],this},u.prototype.multiply=function(t){var i=this.m[1]*t.m[0]+this.m[3]*t.m[1],s=this.m[0]*t.m[2]+this.m[2]*t.m[3],h=this.m[1]*t.m[2]+this.m[3]*t.m[3],e=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],r=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=this.m[0]*t.m[0]+this.m[2]*t.m[1],this.m[1]=i,this.m[2]=s,this.m[3]=h,this.m[4]=e,this.m[5]=r,this},u.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),i=-this.m[1]*t,s=-this.m[2]*t,h=this.m[0]*t,e=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),r=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=this.m[3]*t,this.m[1]=i,this.m[2]=s,this.m[3]=h,this.m[4]=e,this.m[5]=r,this},u.prototype.rotate=function(t){var i=Math.cos(t),s=Math.sin(t),h=this.m[1]*i+this.m[3]*s,e=this.m[0]*-s+this.m[2]*i,r=this.m[1]*-s+this.m[3]*i;return this.m[0]=this.m[0]*i+this.m[2]*s,this.m[1]=h,this.m[2]=e,this.m[3]=r,this},u.prototype.translate=function(t,i){return this.m[4]+=this.m[0]*t+this.m[2]*i,this.m[5]+=this.m[1]*t+this.m[3]*i,this},u.prototype.scale=function(t,i){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=i,this.m[3]*=i,this},u.prototype.transformPoint=function(t,i){var s=t;return[t=s*this.m[0]+i*this.m[2]+this.m[4],i=s*this.m[1]+i*this.m[3]+this.m[5]]},u.prototype.clone=function(){var t=new u;return t.m=this.m.slice(0),t};class f{constructor(t={}){this.type="timing",this.P=t,this.F=c(i(this.P.tickChunk),100/6),this.O=c(i(this.P.maxSkippedTickChunk),120),this.C=c(i(this.P.tickChunkTolerance),.1),this.totalTimePassed=0}init(){}currentTime(){return window.performance?performance.now():Date.now()}clampTime({timePassed:t}){const i=this.F?this.F*this.O:2e3;return t>i?i:t}shiftTime({timePassed:t}){return this.F?-t%this.F:0}get tickChunk(){return this.F}isChunked(){return this.F}hasOneChunkedFrame({timePassed:t}){return t>=this.F-this.C}calcFrames({timePassed:t}){return Math.min(this.O,Math.floor((t+this.C)/this.F))}}const l="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function d(t,i,s){if(!t.s){if(s instanceof v){if(!s.s)return void(s.o=d.bind(null,t,i));1&i&&(i=s.s),s=s.v}if(s&&s.then)return void s.then(d.bind(null,t,i),d.bind(null,t,2));t.s=i,t.v=s;const h=t.o;h&&h(t)}}const v=function(){function t(){}return t.prototype.then=function(i,s){const h=new t,e=this.s;if(e){const t=1&e?i:s;if(t){try{d(h,1,t(this.v))}catch(t){d(h,2,t)}return h}return this}return this.o=function(t){try{const e=t.v;1&t.s?d(h,1,i?i(e):e):s?d(h,1,s(e)):d(h,2,e)}catch(t){d(h,2,t)}},h},t}();function m(t){return t instanceof v&&1&t.s}class g{constructor(t){this.duration=i(t)-0}run(t,i){return i-this.duration}}class p{constructor(){var t=[].slice.call(arguments);let i=0;"number"==typeof t[0]&&(i=t.shift()),this.sequences=t.map(t=>{Array.isArray(t)||(t=[t]);let s=i;return"number"==typeof t[0]&&(s=t.shift()),{position:0,timelapsed:-s,sequence:t.map(t=>"function"!=typeof t.run?"number"==typeof t?new g(t):{run:t}:t).filter(t=>"function"==typeof t.run),label:t.reduce((t,i,s)=>("string"==typeof i&&(t[i]=s-Object.keys(t).length),t),{}),enabled:!0}}),this.lastTimestamp=0,this.enabled=!0}reset(t=0){this.sequences.forEach(i=>{i.enabled=!0,i.position=0,i.timelapsed=t,i.sequence[0]&&i.sequence[0].reset&&i.sequence[0].reset(t)}),this.enabled=!0}play(t="",i=0){if(t){const s=this.sequences.reduce((s,h)=>(h.label.hasOwnProperty(t)?(s=!0,h.position=h.label[t],h.enabled=!0,h.timelapsed=i,h.sequence[h.position]&&h.sequence[h.position].reset&&h.sequence[h.position].reset()):s|=h.sequence.find(s=>s.play&&s.play(t,i))>=0,s),!1);return s&&(this.enabled=!0),s}return this.sequences.forEach(t=>t.enabled=!0),this.enabled=!0,!0}T(t,i,s){let h=s;for(;i.sequence[i.position]&&h>=0;){if(i.timelapsed+=h,i.timelapsed<0)return-1;if(h=i.sequence[i.position].run(t,i.timelapsed),!0===h)h=0;else{if(!1===h)return-1;if(h===p.A)return i.enabled=!1,this.enabled=!1,s;if(h===p.S)return i.enabled=!1,s;if(h===p.j)return!0}if(h>=0&&(i.position=(i.position+1)%i.sequence.length,i.sequence[i.position]&&i.sequence[i.position].reset&&i.sequence[i.position].reset(),i.timelapsed=0,0===i.position))return i.enabled=!1,h}return h}run(t,i,s){let h=i;if(s||(h=i-this.lastTimestamp,this.lastTimestamp=i),!this.enabled)return h;const e=this.sequences.length;let r=0,n=Infinity;for(let i=0;i<e;i++)if(this.sequences[i].enabled){const s=this.T(t,this.sequences[i],h);if(!0===s)return!0;n=Math.min(n,s)}else r++;return r===e?(this.enabled=!1,h):n}}p.A="F",p.S="S",p.j="R";class M{constructor(t){this.D(this,this._(),t),this.L=!0}D(t,s,h){Object.keys(s).forEach(e=>{const r=s[e];t[e]="function"==typeof r?r(h[e],h,t):c(i(h[e]),r)})}N(){return{animation:(t,s)=>{let h=i(t);return Array.isArray(h)?new p(h):h},enabled:!0,isClickable:!1,tag:t=>Array.isArray(t)?t:t?[t]:[]}}_(){return Object.assign({},this.N(),{x:0,y:0,rotation:(t,s)=>c(i(t),c(i(s.rotationInRadian),.017453292519943295*c(i(s.rotationInDegree),0))),scaleX:(t,s)=>c(i(t),c(i(s.scale),1)),scaleY:(t,s)=>c(i(t),c(i(s.scale),1)),alpha:1,compositeOperation:"source-over",color:"#fff"})}getElementsByTag(t){if("function"==typeof t){if(this.tag.filter(t).length)return[this]}else if((Array.isArray(t)?t:[t]).filter(t=>this.tag.includes(t)).length)return[this];return[]}animate(t){return!(!this.animation||!0!==this.animation.run(this,t,!0)||(this.enabled=!1,0))}play(t="",i=0){this.animation&&this.animation.play&&this.animation.play(t,i)}init(t,i){}callInit(t,i){this.L&&(this.init(t,i),this.L=!1)}resize(t,i){}B(t,i,s,h,e){let r=!1;if(this.enabled&&this.isClickable){const n=this.width/2,o=this.height/2;t.save(),h?t.translate(this.x+n,this.y+o):t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.beginPath(),e?r=e(n,o):(t.rect(-n,-o,this.width,this.height),t.closePath(),r=t.isPointInPath(i,s)),t.restore()}return!!r&&this}detectDraw(t,i){}detect(t,i,s){return this.B(t,i,s,!1,()=>(t.arc(0,0,1,Math.PI/2+this.rotation,2.5*Math.PI-this.rotation,!1),t.isPointInPath(i,s)))}draw(t,i){this.enabled&&(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.beginPath(),t.fillStyle=this.color,t.arc(0,0,1,Math.PI/2+this.rotation,2.5*Math.PI-this.rotation,!1),t.fill(),t.restore())}}class b extends M{constructor(t){super(t)}_(){return Object.assign({},super._(),{sprite:[]})}getElementsByTag(t){let i=super.getElementsByTag(t);for(const s of this.sprite){const h=s.getElementsByTag(t);h&&(i=i.concat(h))}return i}animate(t){let i=super.animate(t),s=!1;if(this.enabled)for(const i of this.sprite)s=s||!0===i.animate(t);return this.animation?i:(s&&(this.enabled=!1),s)}play(t="",i=0){this.animation&&this.animation.play&&this.animation.play(t,i);for(const s of this.sprite)s.play&&s.play(t,i)}resize(t,i){for(const s of this.sprite)s.resize(t,i)}callInit(t,i){super.callInit(t,i);for(let s of this.sprite)s.callInit(t,i)}detectImage(t,i){if(this.enabled)for(const s of this.sprite)s.detectImage(t,i)}detect(t,i,s){if(this.enabled)for(const h of this.sprite){const e=h.detect(t,i,s);if(e)return e}return!1}draw(t,i){if(this.enabled){this.alpha<1&&((i=Object.assign({},i)).alpha*=this.alpha),t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation);for(const s of this.sprite)s.draw(t,i);t.restore()}}}class y extends b{constructor(t){super(t.self||{});let s=c(i(t.count),1);this.sprite=[];const h=t.class;for(let i=0;i<s;i++){let s={};for(let h in t)["self","class","count"].includes(h)||(s[h]="function"==typeof t[h]?t[h].call(t,i):t[h]);this.sprite[i]=new h(s)}}}class w extends M{constructor(t){super(t),this.R=!1}_(){return Object.assign({},super._(),{x:void 0,y:void 0,width:void 0,height:void 0,gridSize:void 0,darker:0,pixel:!1,clear:!1,norm:(t,s,h)=>c(i(t),void 0===h.x&&void 0===h.y&&void 0===h.width&&void 0===h.height)})}$(t){const i=t.widthInPixel,s=t.heightInPixel;this.W=document.createElement("canvas"),this.gridSize?(this.R=this.gridSize,this.W.width=Math.round(this.R),this.W.height=Math.round(this.R)):(this.W.width=Math.ceil(i/this.scaleX),this.W.height=Math.ceil(s/this.scaleY)),this.U=this.W.getContext("2d"),this.U.globalCompositeOperation="source-over",this.U.globalAlpha=1}normalizeFullScreen(t){(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y),(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height)}resize(t,i){if(this.W&&this.R!==this.gridSize){const t=this.W;this.$(i),this.U.globalCompositeOperation="copy",this.U.drawImage(t,0,0,t.width,t.height,0,0,this.W.width,this.W.height),this.U.globalCompositeOperation="source-over"}this.normalizeFullScreen(i)}detect(t,i,s){return this.B(t,i,s,!1)}init(t,i){this.$(i),this.normalizeFullScreen(i)}draw(t,i){if(this.enabled&&this.alpha>0){this.gridSize&&this.R!==this.gridSize&&this.resize(t,i);const s=this.alpha*i.alpha,h=this.width,e=this.height,r=this.W.width,n=this.W.height;if(s>0&&r&&n){this.U.globalCompositeOperation="copy",this.U.globalAlpha=1,this.U.drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height,0,0,r,n),this.darker>0&&(this.U.globalCompositeOperation=this.clear?"source-atop":"source-over",this.U.fillStyle="rgba(0,0,0,"+this.darker+")",this.U.fillRect(0,0,r,n)),this.additionalBlur&&this.additionalBlur(r,n,i),this.clear&&(t.globalCompositeOperation="source-over",t.globalAlpha=1,t.clearRect(this.x,this.y,h,e)),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=s;const o=t.imageSmoothingEnabled;t.imageSmoothingEnabled=!this.pixel,t.drawImage(this.W,0,0,r,n,this.x,this.y,h,e),t.imageSmoothingEnabled=o}}else this.clear&&(this.x||(this.x=i.x),this.y||(this.y=i.y),this.width||(this.width=i.width),this.height||(this.height=i.height),t.clearRect(this.x,this.y,this.width,this.height))}}class x extends M{constructor(t){super(t),this.X=!1}_(){return Object.assign({},super._(),{image:t=>n.getImage(i(t)),position:x.CENTER,frameX:0,frameY:0,frameWidth:0,frameHeight:0,width:void 0,height:void 0,norm:!1,normCover:!1,normToScreen:!1,clickExact:!1,color:"#FFF",tint:0})}resize(t,i){this.L=!0}init(t,i){const s=this.frameWidth||this.image.width,h=this.frameHeight||this.image.height;this.Y=this.normToScreen?this.normCover?Math.max(i.fullScreen.width/s,i.fullScreen.height/h):this.norm?Math.min(i.fullScreen.width/s,i.fullScreen.height/h):1:this.normCover?Math.max(i.width/s,i.height/h):this.norm?Math.min(i.width/s,i.height/h):1}H(){return[this.tint,this.frameWidth||this.image.width,this.frameHeight||this.image.height,this.color,this.frameX,this.frameY].join(";")}G(t,i){return this.W||(this.W=document.createElement("canvas"),this.U=this.W.getContext("2d")),this.W.width=t,this.W.height=i,this.U}detectDraw(t,i){if(this.enabled&&this.isClickable&&this.clickExact){const s=this.frameWidth||this.image.width,h=this.frameHeight||this.image.height,e=(this.width?this.width:s)*this.Y*this.scaleX,r=(this.height?this.height:h)*this.Y*this.scaleY,n=this.position===x.LEFT_TOP,o=this.G(s,h);o.globalAlpha=1,o.globalCompositeOperation="source-over",o.fillStyle=i,o.fillRect(0,0,s,h),o.globalCompositeOperation="destination-atop",o.drawImage(this.image,this.frameX,this.frameY,s,h,0,0,s,h),t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.drawImage(this.W,0,0,s,h,n?0:-e/2,n?0:-r/2,e,r),t.restore(),this.X=!1}}detect(t,i,s){return this.enabled&&this.isClickable&&this.clickExact?"c":this.B(t,i,s,!1)}draw(t,i){if(this.enabled&&this.image&&this.alpha>0){const s=this.frameWidth||this.image.width,h=this.frameHeight||this.image.height,e=(this.width?this.width:s)*this.Y*this.scaleX,r=(this.height?this.height:h)*this.Y*this.scaleY;t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha;const n=this.position!==x.LEFT_TOP;let o=this.image,a=this.frameX,u=this.frameY;if(this.tint){if(this.X!==this.H()){const t=this.G(s,h);t.globalAlpha=1,t.globalCompositeOperation="source-over",t.clearRect(0,0,s,h),t.globalAlpha=this.tint,t.fillStyle=this.color,t.fillRect(0,0,s,h),t.globalAlpha=1,t.globalCompositeOperation="destination-atop",t.drawImage(this.image,this.frameX,this.frameY,s,h,0,0,s,h),this.X=this.H()}o=this.W,a=0,u=0}let c=0,f=0;n&&(c=-e/2,f=-r/2),0==this.rotation?t.drawImage(o,a,u,s,h,this.x+c,this.y+f,e,r):(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.drawImage(o,a,u,s,h,c,f,e,r),t.restore())}}}x.LEFT_TOP=0,x.CENTER=1;class k extends M{constructor(t){super(t)}_(){return Object.assign({},super._(),{text:void 0,font:"2em monospace",position:k.CENTER,color:void 0,borderColor:void 0,lineWidth:1})}detectDraw(t,i){this.enabled&&this.isClickable&&(t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),this.position||(t.textAlign="left",t.textBaseline="top"),t.font=this.font,t.fillStyle=i,t.fillText(this.text,0,0),t.restore())}detect(t,i){return"c"}draw(t,i){this.enabled&&(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,t.save(),this.position||(t.textAlign="left",t.textBaseline="top"),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.font=this.font,this.color&&(t.fillStyle=this.color,t.fillText(this.text,0,0)),this.borderColor&&(t.strokeStyle=this.borderColor,t.lineWidth=this.lineWidth,t.strokeText(this.text,0,0)),t.restore())}}function I(t,i){(function(t){return"string"==typeof t&&-1!==t.indexOf(".")&&1===parseFloat(t)})(t)&&(t="100%");var s=function(t){return"string"==typeof t&&-1!==t.indexOf("%")}(t);return t=360===i?t:Math.min(i,Math.max(0,parseFloat(t))),s&&(t=parseInt(String(t*i),10)/100),Math.abs(t-i)<1e-6?1:t=360===i?(t<0?t%i+i:t%i)/parseFloat(String(i)):t%i/parseFloat(String(i))}function P(t){return Math.min(1,Math.max(0,t))}function F(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function O(t){return t<=1?100*Number(t)+"%":t}function C(t){return 1===t.length?"0"+t:String(t)}function T(t,i,s){t=I(t,255),i=I(i,255),s=I(s,255);var h=Math.max(t,i,s),e=Math.min(t,i,s),r=0,n=0,o=(h+e)/2;if(h===e)n=0,r=0;else{var a=h-e;switch(n=o>.5?a/(2-h-e):a/(h+e),h){case t:r=(i-s)/a+(i<s?6:0);break;case i:r=(s-t)/a+2;break;case s:r=(t-i)/a+4}r/=6}return{h:r,s:n,l:o}}function A(t,i,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*s*(i-t):s<.5?i:s<2/3?t+(i-t)*(2/3-s)*6:t}function S(t,i,s){t=I(t,255),i=I(i,255),s=I(s,255);var h=Math.max(t,i,s),e=Math.min(t,i,s),r=0,n=h,o=h-e,a=0===h?0:o/h;if(h===e)r=0;else{switch(h){case t:r=(i-s)/o+(i<s?6:0);break;case i:r=(s-t)/o+2;break;case s:r=(t-i)/o+4}r/=6}return{h:r,s:a,v:n}}function E(t,i,s,h){var e=[C(Math.round(t).toString(16)),C(Math.round(i).toString(16)),C(Math.round(s).toString(16))];return h&&e[0].startsWith(e[0].charAt(1))&&e[1].startsWith(e[1].charAt(1))&&e[2].startsWith(e[2].charAt(1))?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0):e.join("")}function z(t){return j(t)/255}function j(t){return parseInt(t,16)}k.LEFT_TOP=0,k.CENTER=1;var D={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},_="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",L="[\\s|\\(]+("+_+")[,|\\s]+("+_+")[,|\\s]+("+_+")\\s*\\)?",q="[\\s|\\(]+("+_+")[,|\\s]+("+_+")[,|\\s]+("+_+")[,|\\s]+("+_+")\\s*\\)?",N={CSS_UNIT:new RegExp(_),rgb:new RegExp("rgb"+L),rgba:new RegExp("rgba"+q),hsl:new RegExp("hsl"+L),hsla:new RegExp("hsla"+q),hsv:new RegExp("hsv"+L),hsva:new RegExp("hsva"+q),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function B(t){return Boolean(N.CSS_UNIT.exec(String(t)))}var R=function(){function t(i,s){var h;if(void 0===i&&(i=""),void 0===s&&(s={}),i instanceof t)return i;"number"==typeof i&&(i=function(t){return{r:t>>16,g:(65280&t)>>8,b:255&t}}(i)),this.originalInput=i;var e=function(t){var i,s,h={r:0,g:0,b:0},e=1,r=null,n=null,o=null,a=!1,u=!1;return"string"==typeof t&&(t=function(t){if(0===(t=t.trim().toLowerCase()).length)return!1;var i=!1;if(D[t])t=D[t],i=!0;else if("transparent"===t)return{r:0,g:0,b:0,a:0,format:"name"};var s=N.rgb.exec(t);return s?{r:s[1],g:s[2],b:s[3]}:(s=N.rgba.exec(t))?{r:s[1],g:s[2],b:s[3],a:s[4]}:(s=N.hsl.exec(t))?{h:s[1],s:s[2],l:s[3]}:(s=N.hsla.exec(t))?{h:s[1],s:s[2],l:s[3],a:s[4]}:(s=N.hsv.exec(t))?{h:s[1],s:s[2],v:s[3]}:(s=N.hsva.exec(t))?{h:s[1],s:s[2],v:s[3],a:s[4]}:(s=N.hex8.exec(t))?{r:j(s[1]),g:j(s[2]),b:j(s[3]),a:z(s[4]),format:i?"name":"hex8"}:(s=N.hex6.exec(t))?{r:j(s[1]),g:j(s[2]),b:j(s[3]),format:i?"name":"hex"}:(s=N.hex4.exec(t))?{r:j(s[1]+s[1]),g:j(s[2]+s[2]),b:j(s[3]+s[3]),a:z(s[4]+s[4]),format:i?"name":"hex8"}:!!(s=N.hex3.exec(t))&&{r:j(s[1]+s[1]),g:j(s[2]+s[2]),b:j(s[3]+s[3]),format:i?"name":"hex"}}(t)),"object"==typeof t&&(B(t.r)&&B(t.g)&&B(t.b)?(i=t.g,s=t.b,h={r:255*I(t.r,255),g:255*I(i,255),b:255*I(s,255)},a=!0,u="%"===String(t.r).substr(-1)?"prgb":"rgb"):B(t.h)&&B(t.s)&&B(t.v)?(r=O(t.s),n=O(t.v),h=function(t,i,s){t=6*I(t,360),i=I(i,100),s=I(s,100);var h=Math.floor(t),e=t-h,r=s*(1-i),n=s*(1-e*i),o=s*(1-(1-e)*i),a=h%6;return{r:255*[s,n,r,r,o,s][a],g:255*[o,s,s,n,r,r][a],b:255*[r,r,o,s,s,n][a]}}(t.h,r,n),a=!0,u="hsv"):B(t.h)&&B(t.s)&&B(t.l)&&(r=O(t.s),o=O(t.l),h=function(t,i,s){var h,e,r;if(t=I(t,360),i=I(i,100),s=I(s,100),0===i)e=s,r=s,h=s;else{var n=s<.5?s*(1+i):s+i-s*i,o=2*s-n;h=A(o,n,t+1/3),e=A(o,n,t),r=A(o,n,t-1/3)}return{r:255*h,g:255*e,b:255*r}}(t.h,r,o),a=!0,u="hsl"),Object.prototype.hasOwnProperty.call(t,"a")&&(e=t.a)),e=F(e),{ok:a,format:t.format||u,r:Math.min(255,Math.max(h.r,0)),g:Math.min(255,Math.max(h.g,0)),b:Math.min(255,Math.max(h.b,0)),a:e}}(i);this.originalInput=i,this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(h=s.format)&&void 0!==h?h:e.format,this.gradientType=s.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=e.ok}return t.prototype.isDark=function(){return this.getBrightness()<128},t.prototype.isLight=function(){return!this.isDark()},t.prototype.getBrightness=function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},t.prototype.getLuminance=function(){var t=this.toRgb(),i=t.r/255,s=t.g/255,h=t.b/255;return.2126*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.7152*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))+.0722*(h<=.03928?h/12.92:Math.pow((h+.055)/1.055,2.4))},t.prototype.getAlpha=function(){return this.a},t.prototype.setAlpha=function(t){return this.a=F(t),this.roundA=Math.round(100*this.a)/100,this},t.prototype.toHsv=function(){var t=S(this.r,this.g,this.b);return{h:360*t.h,s:t.s,v:t.v,a:this.a}},t.prototype.toHsvString=function(){var t=S(this.r,this.g,this.b),i=Math.round(360*t.h),s=Math.round(100*t.s),h=Math.round(100*t.v);return 1===this.a?"hsv("+i+", "+s+"%, "+h+"%)":"hsva("+i+", "+s+"%, "+h+"%, "+this.roundA+")"},t.prototype.toHsl=function(){var t=T(this.r,this.g,this.b);return{h:360*t.h,s:t.s,l:t.l,a:this.a}},t.prototype.toHslString=function(){var t=T(this.r,this.g,this.b),i=Math.round(360*t.h),s=Math.round(100*t.s),h=Math.round(100*t.l);return 1===this.a?"hsl("+i+", "+s+"%, "+h+"%)":"hsla("+i+", "+s+"%, "+h+"%, "+this.roundA+")"},t.prototype.toHex=function(t){return void 0===t&&(t=!1),E(this.r,this.g,this.b,t)},t.prototype.toHexString=function(t){return void 0===t&&(t=!1),"#"+this.toHex(t)},t.prototype.toHex8=function(t){return void 0===t&&(t=!1),function(t,i,s,h,e){var r,n=[C(Math.round(t).toString(16)),C(Math.round(i).toString(16)),C(Math.round(s).toString(16)),C((r=h,Math.round(255*parseFloat(r)).toString(16)))];return e&&n[0].startsWith(n[0].charAt(1))&&n[1].startsWith(n[1].charAt(1))&&n[2].startsWith(n[2].charAt(1))&&n[3].startsWith(n[3].charAt(1))?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0)+n[3].charAt(0):n.join("")}(this.r,this.g,this.b,this.a,t)},t.prototype.toHex8String=function(t){return void 0===t&&(t=!1),"#"+this.toHex8(t)},t.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},t.prototype.toRgbString=function(){var t=Math.round(this.r),i=Math.round(this.g),s=Math.round(this.b);return 1===this.a?"rgb("+t+", "+i+", "+s+")":"rgba("+t+", "+i+", "+s+", "+this.roundA+")"},t.prototype.toPercentageRgb=function(){var t=function(t){return Math.round(100*I(t,255))+"%"};return{r:t(this.r),g:t(this.g),b:t(this.b),a:this.a}},t.prototype.toPercentageRgbString=function(){var t=function(t){return Math.round(100*I(t,255))};return 1===this.a?"rgb("+t(this.r)+"%, "+t(this.g)+"%, "+t(this.b)+"%)":"rgba("+t(this.r)+"%, "+t(this.g)+"%, "+t(this.b)+"%, "+this.roundA+")"},t.prototype.toName=function(){if(0===this.a)return"transparent";if(this.a<1)return!1;for(var t="#"+E(this.r,this.g,this.b,!1),i=0,s=Object.entries(D);i<s.length;i++){var h=s[i];if(t===h[1])return h[0]}return!1},t.prototype.toString=function(t){var i=Boolean(t);t=null!=t?t:this.format;var s=!1;return i||!(this.a<1&&this.a>=0)||!t.startsWith("hex")&&"name"!==t?("rgb"===t&&(s=this.toRgbString()),"prgb"===t&&(s=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(s=this.toHexString()),"hex3"===t&&(s=this.toHexString(!0)),"hex4"===t&&(s=this.toHex8String(!0)),"hex8"===t&&(s=this.toHex8String()),"name"===t&&(s=this.toName()),"hsl"===t&&(s=this.toHslString()),"hsv"===t&&(s=this.toHsvString()),s||this.toHexString()):"name"===t&&0===this.a?this.toName():this.toRgbString()},t.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},t.prototype.clone=function(){return new t(this.toString())},t.prototype.lighten=function(i){void 0===i&&(i=10);var s=this.toHsl();return s.l+=i/100,s.l=P(s.l),new t(s)},t.prototype.brighten=function(i){void 0===i&&(i=10);var s=this.toRgb();return s.r=Math.max(0,Math.min(255,s.r-Math.round(-i/100*255))),s.g=Math.max(0,Math.min(255,s.g-Math.round(-i/100*255))),s.b=Math.max(0,Math.min(255,s.b-Math.round(-i/100*255))),new t(s)},t.prototype.darken=function(i){void 0===i&&(i=10);var s=this.toHsl();return s.l-=i/100,s.l=P(s.l),new t(s)},t.prototype.tint=function(t){return void 0===t&&(t=10),this.mix("white",t)},t.prototype.shade=function(t){return void 0===t&&(t=10),this.mix("black",t)},t.prototype.desaturate=function(i){void 0===i&&(i=10);var s=this.toHsl();return s.s-=i/100,s.s=P(s.s),new t(s)},t.prototype.saturate=function(i){void 0===i&&(i=10);var s=this.toHsl();return s.s+=i/100,s.s=P(s.s),new t(s)},t.prototype.greyscale=function(){return this.desaturate(100)},t.prototype.spin=function(i){var s=this.toHsl(),h=(s.h+i)%360;return s.h=h<0?360+h:h,new t(s)},t.prototype.mix=function(i,s){void 0===s&&(s=50);var h=this.toRgb(),e=new t(i).toRgb(),r=s/100;return new t({r:(e.r-h.r)*r+h.r,g:(e.g-h.g)*r+h.g,b:(e.b-h.b)*r+h.b,a:(e.a-h.a)*r+h.a})},t.prototype.analogous=function(i,s){void 0===i&&(i=6),void 0===s&&(s=30);var h=this.toHsl(),e=360/s,r=[this];for(h.h=(h.h-(e*i>>1)+720)%360;--i;)h.h=(h.h+e)%360,r.push(new t(h));return r},t.prototype.complement=function(){var i=this.toHsl();return i.h=(i.h+180)%360,new t(i)},t.prototype.monochromatic=function(i){void 0===i&&(i=6);for(var s=this.toHsv(),h=s.h,e=s.s,r=s.v,n=[],o=1/i;i--;)n.push(new t({h:h,s:e,v:r})),r=(r+o)%1;return n},t.prototype.splitcomplement=function(){var i=this.toHsl(),s=i.h;return[this,new t({h:(s+72)%360,s:i.s,l:i.l}),new t({h:(s+216)%360,s:i.s,l:i.l})]},t.prototype.onBackground=function(i){var s=this.toRgb(),h=new t(i).toRgb();return new t({r:h.r+(s.r-h.r)*s.a,g:h.g+(s.g-h.g)*s.a,b:h.b+(s.b-h.b)*s.a})},t.prototype.triad=function(){return this.polyad(3)},t.prototype.tetrad=function(){return this.polyad(4)},t.prototype.polyad=function(i){for(var s=this.toHsl(),h=s.h,e=[this],r=360/i,n=1;n<i;n++)e.push(new t({h:(h+n*r)%360,s:s.s,l:s.l}));return e},t.prototype.equals=function(i){return this.toRgbString()===new t(i).toRgbString()},t}();const $=64;class W extends M{constructor(t){super(t),this.J=void 0,this.V=!1}static getGradientImage(t,i,s){let h=t>>4,e=i>>4,r=s>>4;if(!W.Z){const t=16;W.Z=Array.from({length:t},i=>Array.from({length:t},i=>Array.from({length:t})))}return W.Z[h][e][r]||(W.Z[h][e][r]=W.generateGradientImage(h,e,r)),W.Z[h][e][r]}static generateGradientImage(t,i,s){let h=document.createElement("canvas");h.width=h.height=$;let e=h.getContext("2d");e.globalAlpha=1,e.globalCompositeOperation="source-over",e.clearRect(0,0,$,$);let r=e.createRadialGradient(32,32,0,32,32,32);return r.addColorStop(0,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",1)"),r.addColorStop(.3,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",0.4)"),r.addColorStop(1,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",0)"),e.fillStyle=r,e.fillRect(0,0,$,$),h}resize(t,i){this.J=void 0}draw(t,i){if(this.enabled){this.color&&this.color.r||(this.color=new R(this.color).toRgb()),this.J!==this.scaleX&&(this.J=this.scaleX,this.V=this.scaleX*i.widthInPixel/i.width>$);const{r:s,g:h,b:e}=this.color;t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,t.imageSmoothingEnabled=this.V,t.drawImage(W.getGradientImage(s,h,e),0,0,$,$,this.x-this.scaleX/2,this.y-this.scaleY/2,this.scaleX,this.scaleY),t.imageSmoothingEnabled=!0}}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var U=function(t){var i={exports:{}};return function(t,i){t.exports=function(){var t=2*Math.PI,i=function(t,i,s,h,e,r,n){var o=t.x,a=t.y;return{x:h*(o*=i)-e*(a*=s)+r,y:e*o+h*a+n}},s=function(t,i){var s=4/3*Math.tan(i/4),h=Math.cos(t),e=Math.sin(t),r=Math.cos(t+i),n=Math.sin(t+i);return[{x:h-e*s,y:e+h*s},{x:r+n*s,y:n-r*s},{x:r,y:n}]},h=function(t,i,s,h){var e=t*h-i*s<0?-1:1,r=(t*s+i*h)/(Math.sqrt(t*t+i*i)*Math.sqrt(t*t+i*i));return r>1&&(r=1),r<-1&&(r=-1),e*Math.acos(r)},e=function(e){var r=e.px,n=e.py,o=e.cx,a=e.cy,u=e.rx,c=e.ry,f=e.xAxisRotation,l=void 0===f?0:f,d=e.largeArcFlag,v=void 0===d?0:d,m=e.sweepFlag,g=void 0===m?0:m,p=[];if(0===u||0===c)return[];var M=Math.sin(l*t/360),b=Math.cos(l*t/360),y=b*(r-o)/2+M*(n-a)/2,w=-M*(r-o)/2+b*(n-a)/2;if(0===y&&0===w)return[];u=Math.abs(u),c=Math.abs(c);var x=Math.pow(y,2)/Math.pow(u,2)+Math.pow(w,2)/Math.pow(c,2);x>1&&(u*=Math.sqrt(x),c*=Math.sqrt(x));var k=function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,i){var s=[],h=!0,e=!1,r=void 0;try{for(var n,o=t[Symbol.iterator]();!(h=(n=o.next()).done)&&(s.push(n.value),!i||s.length!==i);h=!0);}catch(t){e=!0,r=t}finally{try{!h&&o.return&&o.return()}finally{if(e)throw r}}return s}(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(function(i,s,e,r,n,o,a,u,c,f,l,d){var v=Math.pow(n,2),m=Math.pow(o,2),g=Math.pow(l,2),p=Math.pow(d,2),M=v*m-v*p-m*g;M<0&&(M=0),M/=v*p+m*g;var b=(M=Math.sqrt(M)*(a===u?-1:1))*n/o*d,y=M*-o/n*l,w=f*b-c*y+(i+e)/2,x=c*b+f*y+(s+r)/2,k=(l-b)/n,I=(d-y)/o,P=(-l-b)/n,F=(-d-y)/o,O=h(1,0,k,I),C=h(k,I,P,F);return 0===u&&C>0&&(C-=t),1===u&&C<0&&(C+=t),[w,x,O,C]}(r,n,o,a,u,c,v,g,M,b,y,w),4),I=k[0],P=k[1],F=k[2],O=k[3],C=Math.max(Math.ceil(Math.abs(O)/(t/4)),1);O/=C;for(var T=0;T<C;T++)p.push(s(F,O)),F+=O;return p.map(function(t){var s=i(t[0],u,c,b,M,I,P),h=s.x,e=s.y,r=i(t[1],u,c,b,M,I,P),n=r.x,o=r.y,a=i(t[2],u,c,b,M,I,P);return{x1:h,y1:e,x2:n,y2:o,x:a.x,y:a.y}})},r={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},n=/([astvzqmhlc])([^astvzqmhlc]*)/gi,o=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;function a(t){var i=t[0][0],s=t[0][1],h=i,e=s;return t.forEach(function(t){var r=t[0],n=t[2],o=t[4],a=t[6],u=t[1],c=t[3],f=t[5],l=t[7];i=Math.min(i,r,n,o,a),s=Math.min(s,u,c,f,l),h=Math.max(h,r,n,o,a),e=Math.max(e,u,c,f,l)}),[i,s,h,e]}var u={};function c(t,i,s,h,e,r,n,o,a,u){var c=(s-t)*a+t,f=(h-i)*a+i,l=(e-s)*a+s,d=(r-h)*a+h,v=(l-c)*a+c,m=(d-f)*a+f,g=(((n-e)*a+e-l)*a+l-v)*a+v,p=(((o-r)*a+r-d)*a+d-m)*a+m;return u?[g,p,v,m,c,f,t,i]:[t,i,c,f,v,m,g,p]}function f(t,i){for(var s=function(i){var s=[];t[t.length-1].forEach(function(t){s.push(t.slice(0))}),t.push(s)},h=0;h<i;h++)s()}return u.parser=function(t){var i=[];return t.replace(n,function(t,s,h){var e=s.toLowerCase();for(h=function(t){var i=t.match(o);return i?i.map(Number):[]}(h),"m"==e&&h.length>2&&(i.push([s].concat(h.splice(0,2))),e="l",s="m"==s?"l":"L");;){if(h.length==r[e])return h.unshift(s),i.push(h);if(h.length<r[e])throw new Error("malformed path data");i.push([s].concat(h.splice(0,r[e])))}}),i},u.lerpCurve=function(t,i,s){return u.lerpPoints(t[0],t[1],i[0],i[1],s).concat(u.lerpPoints(t[2],t[3],i[2],i[3],s)).concat(u.lerpPoints(t[4],t[5],i[4],i[5],s)).concat(u.lerpPoints(t[6],t[7],i[6],i[7],s))},u.lerpPoints=function(t,i,s,h,e){return[t+(s-t)*e,i+(h-i)*e]},u.q2b=function(t,i,s,h,e,r){return[t,i,(t+2*s)/3,(i+2*h)/3,(e+2*s)/3,(r+2*h)/3,e,r]},u.path2shapes=function(t){for(var i=u.parser(t),s=0,h=0,r=0,n=i.length,o=[],a=null,c=void 0,f=void 0,l=void 0,d=void 0,v=void 0,m=void 0,g=void 0;r<n;r++){var p=i[r],M=i[r-1];switch(p[0]){case"m":o[v=o.length]=[],a=o[v],s+=p[1],h+=p[2];break;case"M":o[v=o.length]=[],a=o[v],s=p[1],h=p[2];break;case"l":a.push([s,h,s,h,s,h,s+p[1],h+p[2]]),s+=p[1],h+=p[2];break;case"L":a.push([s,h,p[1],p[2],p[1],p[2],p[1],p[2]]),s=p[1],h=p[2];break;case"h":a.push([s,h,s,h,s,h,s+p[1],h]),s+=p[1];break;case"H":a.push([s,h,p[1],h,p[1],h,p[1],h]),s=p[1];break;case"v":a.push([s,h,s,h,s,h,s,h+p[1]]),h+=p[1];break;case"V":a.push([s,h,s,p[1],s,p[1],s,p[1]]),h=p[1];break;case"C":a.push([s,h,p[1],p[2],p[3],p[4],p[5],p[6]]),s=p[5],h=p[6];break;case"S":"C"===M[0]||"c"===M[0]?a.push([s,h,s+M[5]-M[3],h+M[6]-M[4],p[1],p[2],p[3],p[4]]):"S"!==M[0]&&"s"!==M[0]||a.push([s,h,s+M[3]-M[1],h+M[4]-M[2],p[1],p[2],p[3],p[4]]),s=p[3],h=p[4];break;case"c":a.push([s,h,s+p[1],h+p[2],s+p[3],h+p[4],s+p[5],h+p[6]]),s+=p[5],h+=p[6];break;case"s":"C"===M[0]||"c"===M[0]?a.push([s,h,s+M[5]-M[3],h+M[6]-M[4],s+p[1],h+p[2],s+p[3],h+p[4]]):"S"!==M[0]&&"s"!==M[0]||a.push([s,h,s+M[3]-M[1],h+M[4]-M[2],s+p[1],h+p[2],s+p[3],h+p[4]]),s+=p[3],h+=p[4];break;case"a":g=(m=e({rx:p[1],ry:p[2],px:s,py:h,xAxisRotation:p[3],largeArcFlag:p[4],sweepFlag:p[5],cx:s+p[6],cy:h+p[7]}))[m.length-1],m.forEach(function(t,i){a.push(0===i?[s,h,t.x1,t.y1,t.x2,t.y2,t.x,t.y]:[m[i-1].x,m[i-1].y,t.x1,t.y1,t.x2,t.y2,t.x,t.y])}),s=g.x,h=g.y;break;case"A":g=(m=e({rx:p[1],ry:p[2],px:s,py:h,xAxisRotation:p[3],largeArcFlag:p[4],sweepFlag:p[5],cx:p[6],cy:p[7]}))[m.length-1],m.forEach(function(t,i){a.push(0===i?[s,h,t.x1,t.y1,t.x2,t.y2,t.x,t.y]:[m[i-1].x,m[i-1].y,t.x1,t.y1,t.x2,t.y2,t.x,t.y])}),s=g.x,h=g.y;break;case"Q":a.push(u.q2b(s,h,p[1],p[2],p[3],p[4])),s=p[3],h=p[4];break;case"q":a.push(u.q2b(s,h,s+p[1],h+p[2],p[3]+s,p[4]+h)),s+=p[3],h+=p[4];break;case"T":"Q"===M[0]||"q"===M[0]?a.push(u.q2b(s,h,l=s+M[3]-M[1],d=h+M[4]-M[2],p[1],p[2])):"T"!==M[0]&&"t"!==M[0]||(a.push(u.q2b(s,h,s+s-l,h+h-d,p[1],p[2])),l=s+s-l,d=h+h-d),s=p[1],h=p[2];break;case"t":"Q"===M[0]||"q"===M[0]?a.push(u.q2b(s,h,l=s+M[3]-M[1],d=h+M[4]-M[2],s+p[1],h+p[2])):"T"!==M[0]&&"t"!==M[0]||(a.push(u.q2b(s,h,s+s-l,h+h-d,s+p[1],h+p[2])),l=s+s-l,d=h+h-d),s+=p[1],h+=p[2];break;case"Z":case"z":a.push([s,h,c=a[0][0],f=a[0][1],c,f,c,f])}}return o},u.K=function(t,i){for(var s=0,h=0,e=t.length;s<i;s++)t.push(t[h].slice(0)),++h>e-1&&(h-=e)},u.tt=function(t,i){for(var s=0,h=0;s<i;s++){var e=t[h],r={left:c(n=e[0],o=e[1],a=e[2],u=e[3],f=e[4],l=e[5],d=e[6],v=e[7],.5),right:c(d,v,f,l,a,u,n,o,.5,!0)};t.splice(h,1),t.splice(h,0,r.left,r.right),(h+=2)>=t.length-1&&(h=0)}var n,o,a,u,f,l,d,v},u.lerp=function(t,i,s){return u.it(u.path2shapes(t),u.path2shapes(i),s)},u.MIM_CURVES_COUNT=100,u.st=function(t,i){var s=t.length,h=i.length,e=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(i));return s>h?f(r,s-h):s<h&&f(e,h-s),(e=function(t,i){var s=function(t){for(var i=[],s=0;s<t;s++)i.push(s);return h=[],e=[],function t(i){var s,r;for(s=0;s<i.length;s++)r=i.splice(s,1)[0],e.push(r),0==i.length&&h.push(e.slice()),t(i),i.splice(s,0,r),e.pop();return h}(i);var h,e}(t.length),h=[];s.forEach(function(s){var e=0;s.forEach(function(s){var h,r;e+=(h=a(t[s]),r=a(i[s]),Math.sqrt(Math.pow(h[0]-r[0],2)+Math.pow(h[1]-r[1],2))+Math.sqrt(Math.pow(h[2]-r[2],2)+Math.pow(h[3]-r[3],2)))}),h.push({index:s,distance:e})}),h.sort(function(t,i){return t.distance-i.distance});var e=[];return h[0].index.forEach(function(i){e.push(t[i])}),e}(e,r)).forEach(function(t,i){var s=t.length,h=r[i].length;s>h?s<u.MIM_CURVES_COUNT?(u.tt(t,u.MIM_CURVES_COUNT-s),u.tt(r[i],u.MIM_CURVES_COUNT-h)):u.tt(r[i],s-h):s<h&&(h<u.MIM_CURVES_COUNT?(u.tt(t,u.MIM_CURVES_COUNT-s),u.tt(r[i],u.MIM_CURVES_COUNT-h)):u.tt(t,h-s))}),e.forEach(function(t,i){e[i]=function(t,i){var s=function(t){for(var i=[],s=0;s<t;s++){for(var h=[],e=0;e<t;e++){var r=e+s;r>t-1&&(r-=t),h[r]=e}i.push(h)}return i}(t.length),h=[];s.forEach(function(s){var e=0,r=0;s.forEach(function(s){var h,n,o,a,u,c,f,l,d,v,m,g,p,M,b,y;e+=(n=i[r++],o=(h=t[s])[2],a=h[4],u=h[6],c=h[1],f=h[3],l=h[5],d=h[7],v=n[2],m=n[4],g=n[6],p=n[1],M=n[3],b=n[5],y=n[7],Math.sqrt(Math.pow(n[0]-h[0],2)+Math.pow(p-c,2))+Math.sqrt(Math.pow(v-o,2)+Math.pow(M-f,2))+Math.sqrt(Math.pow(m-a,2)+Math.pow(b-l,2))+Math.sqrt(Math.pow(g-u,2)+Math.pow(y-d,2)))}),h.push({index:s,distance:e})}),h.sort(function(t,i){return t.distance-i.distance});var e=[];return h[0].index.forEach(function(i){e.push(t[i])}),e}(t,r[i])}),[e,r]},u.it=function(t,i,s){var h=[];return t.forEach(function(t,e){var r=[];t.forEach(function(t,h){r.push(u.lerpCurve(t,i[e][h],s))}),h.push(r)}),h},u.animate=function(t){var i=u.path2shapes(t.from),s=u.path2shapes(t.to),h=u.st(i,s),e=new Date,r=t.end||function(){},n=t.progress||function(){},o=t.easing||function(t){return t},a=null,c=null,f=t.time;(t.begin||function(){})(i),function t(){var i=new Date-e;if(i>=f)return n(c=s,1),r(c),void cancelAnimationFrame(a);var l=o(i/f);c=u.it(h[0],h[1],l),n(c,l),a=requestAnimationFrame(t)}()},u}()}(i),i.exports}();class X extends M{constructor(t){super(t)}_(){return Object.assign({},super._(),{x:void 0,y:void 0,width:void 0,height:void 0,borderColor:void 0,color:void 0,lineWidth:1,clear:!1,norm:(t,s,h)=>c(i(t),void 0===h.x&&void 0===h.y&&void 0===h.width&&void 0===h.height),position:X.CENTER})}normalizeFullScreen(t){(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height),(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x,this.position===X.CENTER&&(this.x+=this.width/2)),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y,this.position===X.CENTER&&(this.y+=this.height/2))}resize(t,i){this.L=!0}init(t,i){this.normalizeFullScreen(i)}detect(t,i,s){return this.B(t,i,s,this.position===X.LEFT_TOP)}draw(t,i){if(this.enabled&&this.alpha>0)if(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,0===this.rotation&&this.position===X.LEFT_TOP)this.clear?t.clearRect(this.x,this.y,this.width,this.height):this.color&&(t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height)),this.borderColor&&(t.beginPath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.borderColor,t.rect(this.x,this.y,this.width,this.height),t.stroke());else{let i=this.width/2,s=this.height/2;t.save(),this.position===X.LEFT_TOP?t.translate(this.x+i,this.y+s):t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),this.clear?t.clearRect(-i,-s,this.width,this.height):this.color&&(t.fillStyle=this.color,t.fillRect(-i,-s,this.width,this.height)),this.borderColor&&(t.beginPath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.borderColor,t.rect(-i,-s,this.width,this.height),t.stroke()),t.restore()}}}X.LEFT_TOP=0,X.CENTER=1;var Y=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],H=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function G(t,i,s,h,e,r){for(var n,o=t.data,a=2*r+1,u=h-1,c=e-1,f=r+1,l=f*(f+1)/2,d=new J,v=d,m=1;m<a;m++)v=v.next=new J,m===f&&(n=v);v.next=d;for(var g=null,p=null,M=0,b=0,y=Y[r],w=H[r],x=0;x<e;x++){v=d;for(var k=o[b],I=o[b+1],P=o[b+2],F=o[b+3],O=0;O<f;O++)v.r=k,v.g=I,v.b=P,v.a=F,v=v.next;for(var C=0,T=0,A=0,S=0,E=f*k,z=f*I,j=f*P,D=f*F,_=l*k,L=l*I,q=l*P,N=l*F,B=1;B<f;B++){var R=b+((u<B?u:B)<<2),$=o[R],W=o[R+1],U=o[R+2],X=o[R+3],G=f-B;_+=(v.r=$)*G,L+=(v.g=W)*G,q+=(v.b=U)*G,N+=(v.a=X)*G,C+=$,T+=W,A+=U,S+=X,v=v.next}g=d,p=n;for(var V=0;V<h;V++){var Q=N*y>>w;if(o[b+3]=Q,0!==Q){var Z=255/Q;o[b]=(_*y>>w)*Z,o[b+1]=(L*y>>w)*Z,o[b+2]=(q*y>>w)*Z}else o[b]=o[b+1]=o[b+2]=0;_-=E,L-=z,q-=j,N-=D,E-=g.r,z-=g.g,j-=g.b,D-=g.a;var K=V+r+1;_+=C+=g.r=o[K=M+(K<u?K:u)<<2],L+=T+=g.g=o[K+1],q+=A+=g.b=o[K+2],N+=S+=g.a=o[K+3],g=g.next;var tt=p.r,it=p.g,st=p.b,ht=p.a;E+=tt,z+=it,j+=st,D+=ht,C-=tt,T-=it,A-=st,S-=ht,p=p.next,b+=4}M+=h}for(var et=0;et<h;et++){var rt=o[b=et<<2],nt=o[b+1],ot=o[b+2],at=o[b+3],ut=f*rt,ct=f*nt,ft=f*ot,lt=f*at,dt=l*rt,vt=l*nt,mt=l*ot,gt=l*at;v=d;for(var pt=0;pt<f;pt++)v.r=rt,v.g=nt,v.b=ot,v.a=at,v=v.next;for(var Mt=h,bt=0,yt=0,wt=0,xt=0,kt=1;kt<=r;kt++){var It=f-kt;dt+=(v.r=rt=o[b=Mt+et<<2])*It,vt+=(v.g=nt=o[b+1])*It,mt+=(v.b=ot=o[b+2])*It,gt+=(v.a=at=o[b+3])*It,xt+=rt,bt+=nt,yt+=ot,wt+=at,v=v.next,kt<c&&(Mt+=h)}b=et,g=d,p=n;for(var Pt=0;Pt<e;Pt++){var Ft=b<<2;o[Ft+3]=at=gt*y>>w,at>0?(o[Ft]=(dt*y>>w)*(at=255/at),o[Ft+1]=(vt*y>>w)*at,o[Ft+2]=(mt*y>>w)*at):o[Ft]=o[Ft+1]=o[Ft+2]=0,dt-=ut,vt-=ct,mt-=ft,gt-=lt,ut-=g.r,ct-=g.g,ft-=g.b,lt-=g.a,Ft=et+((Ft=Pt+f)<c?Ft:c)*h<<2,dt+=xt+=g.r=o[Ft],vt+=bt+=g.g=o[Ft+1],mt+=yt+=g.b=o[Ft+2],gt+=wt+=g.a=o[Ft+3],g=g.next,ut+=rt=p.r,ct+=nt=p.g,ft+=ot=p.b,lt+=at=p.a,xt-=rt,bt-=nt,yt-=ot,wt-=at,p=p.next,b+=h}}return t}var J=function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},V={Callback:class extends M{constructor(t){"function"==typeof t&&(t={callback:t}),super(t),this.ht=0,this.et=0}_(){return Object.assign({},this.N(),{callback:t=>void 0===typeof t?()=>{}:t})}animate(t){return this.enabled&&(this.ht+=t,this.et+=t),super.animate(t)}detect(t,i){}draw(t,i){this.enabled&&this.callback(t,this.ht,i,this),this.et=0}},Canvas:class extends b{constructor(t){super(t),this.R=!1,this.rt=2}_(){return Object.assign({},super._(),{x:void 0,y:void 0,width:void 0,height:void 0,canvasWidth:void 0,canvasHeight:void 0,gridSize:void 0,norm:(t,s,h)=>c(i(t),void 0===h.x&&void 0===h.y&&void 0===h.width&&void 0===h.height),isDrawFrame:(t,i,s)=>c(t,!0)})}$(t){const i=t.widthInPixel,s=t.heightInPixel;this.W=document.createElement("canvas"),this.canvasWidth&&this.canvasHeight?(this.W.width=this.canvasWidth,this.W.height=this.canvasHeight):this.gridSize?(this.R=this.gridSize,this.W.width=Math.round(this.R),this.W.height=Math.round(this.R)):(this.W.width=Math.round(i/this.scaleX),this.W.height=Math.round(s/this.scaleY)),this.U=this.W.getContext("2d")}normalizeFullScreen(t){(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y),(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height)}resize(t,i){if(this.W&&this.R!==this.gridSize&&!this.canvasWidth){const t=this.W;this.$(i),this.U.globalCompositeOperation="copy",this.U.drawImage(t,0,0,t.width,t.height,0,0,this.W.width,this.W.height),this.U.globalCompositeOperation="source-over",this.rt=2}this.normalizeFullScreen(i),super.resize(t,i)}detect(t,i,s){return this.B(t,i,s,!1)}init(t,i){this.$(i),this.normalizeFullScreen(i)}draw(t,s){if(this.enabled){this.gridSize&&this.R!==this.gridSize&&this.resize(s),this.rt=Math.max(this.rt-1,i(this.isDrawFrame,t,s));const h=this.width,e=this.height,r=h/2,n=e/2,o=this.W.width,a=this.W.height;if(this.rt){this.U.textBaseline="middle",this.U.textAlign="center",this.U.globalAlpha=1,this.U.globalCompositeOperation="source-over",this.U.save();const t=s.cam;if(this.norm&&t){const i=Math.max(o,a)/2;this.U.translate(o/2,a/2),this.U.scale(i,i),this.U.scale(t.zoom,t.zoom),this.U.translate(-t.x,-t.y)}for(const t of this.sprite)t.draw(this.U,this.norm?Object.assign({},s,{alpha:1,widthInPixel:o,heightInPixel:a}):{alpha:1,x:0,y:0,width:o,height:a,widthInPixel:o,heightInPixel:a,visibleScreen:{x:0,y:0,width:o,height:a}});this.U.restore()}t.save(),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*s.alpha,t.translate(this.x+r,this.y+n),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.drawImage(this.W,0,0,o,a,-r,-n,h,e),t.restore()}}},Circle:M,Emitter:y,FastBlur:w,Group:b,Image:x,Text:k,Particle:W,Path:class extends b{constructor(t){if(super(t),this.oldPath=void 0,this.path2D=new Path2D,this.polyfill)if("function"!=typeof Path2D){let t=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.src="https://cdn.jsdelivr.net/npm/canvas-5-polyfill@0.1.5/canvas.min.js",t.appendChild(i)}else{let t=document.createElement("canvas").getContext("2d");t.stroke(new Path2D("M0,0H1")),t.getImageData(0,0,1,1).data[3]&&(this.polyfill=!1)}}_(){return Object.assign({},super._(),{path:void 0,color:void 0,borderColor:void 0,lineWidth:1,clip:!1,fixed:!1,polyfill:!0})}changeToPathInit(t,i){return U.st("string"==typeof t?U.path2shapes(t):t,"string"==typeof i?U.path2shapes(i):i)}changeToPath(t,i,s){return U.it(i.pathFrom,i.pathTo,t)}detect(t,i,s){return this.B(t,i,s,!1,()=>t.isPath(this.path2D,i,s))}draw(t,i){if(this.enabled){const s=this.alpha*i.alpha;this.oldPath!==this.path&&(this.polyfill&&"string"==typeof this.path&&(this.path=U.path2shapes(this.path)),Array.isArray(this.path)?(this.path2D=new Path2D,this.path.forEach(t=>{this.path2D.moveTo(t[0][0],t[0][1]),t.forEach(t=>{this.path2D.bezierCurveTo(t[2],t[3],t[4],t[5],t[6],t[7])}),this.path2D.closePath()})):this.path2D=this.path instanceof Path2D?this.path:new Path2D(this.path),this.oldPath=this.path);let h=this.scaleX,e=this.scaleY;this.fixed&&(0==h&&(h=Number.EPSILON),0==e&&(e=Number.EPSILON)),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=s,t.save(),t.translate(this.x,this.y),t.scale(h,e),t.rotate(this.rotation),this.color&&(t.fillStyle=this.color,t.fill(this.path2D)),t.save(),this.clip&&(t.clip(this.path2D),this.fixed&&(t.rotate(-this.rotation),t.scale(1/h,1/e),t.translate(-this.x,-this.y)));for(const s of this.sprite)s.draw(t,i);t.restore(),this.borderColor&&(t.strokeStyle=this.borderColor,t.lineWidth=this.lineWidth,t.stroke(this.path2D)),t.restore()}}},Rect:X,Scroller:class extends y{constructor(t){let s=i(t.text),h=Array.isArray(s)?s:[...s];super(Object.assign({},t,{class:k,count:h.length,text:t=>h[t],enabled:s=>" "!==h[s]&&i(t.enabled,s)}))}},StackBlur:class extends w{constructor(t){super(t),this.R=!1,this.nt=void 0}_(){return Object.assign({},super._(),{onCanvas:!1,radius:void 0,radiusPart:void 0,radiusScale:!0})}normalizeFullScreen(t){this.norm&&this.onCanvas?(this.x=0,this.y=0,this.width=t.widthInPixel,this.height=t.heightInPixel):super.normalizeFullScreen(t)}resize(t,i){super.resize(t,i),this.radiusPart&&(this.radius=void 0)}additionalBlur(t,i,s){const h=this.U.getImageData(0,0,t,i);G(h,0,0,t,i,s.radius),this.U.putImageData(h,0,0)}detect(t,i,s){return this.B(t,i,s,!1)}draw(t,i){if(this.enabled){void 0!==this.radius&&this.nt===this.radiusPart||(this.radius=Math.round((i.widthInPixel+i.heightInPixel)/2/this.radiusPart),this.nt=this.radiusPart);const s=Math.round(this.radius*(this.radiusScale&&(i.cam?i.cam.zoom:1)/i.scaleCanvas));if(s)if(this.onCanvas){void 0!==this.width&&void 0!==this.height||this.normalizeFullScreen(i);const h=Math.round(this.x),e=Math.round(this.y),r=Math.round(this.width),n=Math.round(this.height);this.imageData=t.getImageData(h,e,r,n),G(this.imageData,0,0,r-h,n-e,s),t.putImageData(this.imageData,h,e,0,0,r,n)}else i.radius=s,super.draw(t,i)}else super.draw(t,i)}},StarField:class extends X{constructor(t){super(t),this.ot=[],this.at=[],this.ut=[],this.ct=[],this.ft=[],this.lt=[],this.dt=[],this.vt=[],this.gt=[]}_(){return Object.assign({},super._(),{count:40,moveX:0,moveY:0,moveZ:0,lineWidth:void 0,highScale:!0,color:"#FFF"})}init(t,i){function s(t,i,s=-i){return void 0===t||t<i||t>=s?Math.random()*(s-i)+i:t}this.width=this.width||i.width,this.height=this.height||i.height,this.x=void 0===this.x?i.x:this.x,this.y=void 0===this.y?i.y:this.y,this.lineWidth=this.lineWidth||Math.min(i.height/i.heightInPixel,i.width/i.widthInPixel)/2,this.Mt=this.width/2+this.x,this.bt=this.height/2+this.y,this.yt=Math.max(this.width,this.height)/2;for(let t=0;t<this.count;t++)this.ot[t]=s(this.ot[t],-this.width/2),this.at[t]=s(this.at[t],-this.height/2),this.ut[t]=s(this.ut[t],0,this.yt)}moveStar(t,i,s){s&&(this.vt[t]=!0);const h=this.width/2,e=this.height/2;let r=this.ot[t]+this.moveX*i,n=this.at[t]+this.moveY*i,o=this.ut[t]+this.moveZ*i;for(;r<-h;)r+=this.width,n=Math.random()*this.height-e,this.vt[t]=!1;for(;r>h;)r-=this.width,n=Math.random()*this.height-e,this.vt[t]=!1;for(;n<-e;)n+=this.height,r=Math.random()*this.width-h,this.vt[t]=!1;for(;n>e;)n-=this.height,r=Math.random()*this.width-h,this.vt[t]=!1;for(;o<=0;)o+=this.yt,r=Math.random()*this.width-h,n=Math.random()*this.height-e,this.vt[t]=!1;for(;o>this.yt;)o-=this.yt,r=Math.random()*this.width-h,n=Math.random()*this.height-e,this.vt[t]=!1;const a=this.Mt+r/o*h,u=this.bt+n/o*e;if(this.vt[t]=this.vt[t]&&a>=this.x&&u>=this.y&&a<this.x+this.width&&u<this.y+this.height,s)this.ot[t]=r,this.at[t]=n,this.ut[t]=o,this.lt[t]=a,this.dt[t]=u;else{this.ct[t]=a,this.ft[t]=u;let i=4*(1-this.ut[t]/this.yt);this.highScale||(i=Math.ceil(i)),this.gt[t]=i}}animate(t){let i=super.animate(t);if(this.enabled&&void 0!==this.Mt){let i=this.count;for(;i--;)this.moveStar(i,t/16,!0),this.vt[i]&&this.moveStar(i,-5,!1)}return i}resize(t,i){this.L=!0}detect(t,i,s){return this.B(t,i,s,!1)}draw(t,i){if(this.enabled)if(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,0==this.moveY&&0==this.moveZ&&this.moveX<0){t.fillStyle=this.color;let i=this.count;for(;i--;)this.vt[i]&&t.fillRect(this.lt[i],this.dt[i]-this.gt[i]*this.lineWidth/2,this.ct[i]-this.lt[i],this.gt[i]*this.lineWidth)}else if(t.strokeStyle=this.color,this.highScale){let i=this.count;for(;i--;)this.vt[i]&&(t.beginPath(),t.lineWidth=this.gt[i]*this.lineWidth,t.moveTo(this.ct[i],this.ft[i]),t.lineTo(this.lt[i],this.dt[i]),t.stroke(),t.closePath())}else{let i,s=5;for(;--s;){for(t.beginPath(),t.lineWidth=s*this.lineWidth,i=this.count;i--;)this.vt[i]&&this.gt[i]===s&&(t.moveTo(this.ct[i],this.ft[i]),t.lineTo(this.lt[i],this.dt[i]));t.stroke(),t.closePath()}}}}};function Q(t,i){return i.from+t*i.delta}function Z(t,i){for(var s,h=[...i.values],e=h.length;e>1;)for(e--,s=0;s<e;s++)h[s]=h[s]+t*(h[s+1]-h[s]);return h[0]}function K(t,i,s){return i.colorFrom.mix(i.colorTo,100*t).toString()}function tt(t,i,s){return s.changeToPath(t,i,s)}class it{constructor(t,s,h){this.initialized=!1,this.changeValues=[];for(let s in t){const h=t[s],e="rotationInDegree"===s?.017453292519943295*h:h,r="color"===s||"borderColor"===s,n="path"===s,o="function"==typeof e,a=!r&&Array.isArray(e),u="scale"===s?["scaleX","scaleY"]:"rotationInRadian"===s||"rotationInDegree"===s?["rotation"]:[s];for(const t of u)this.changeValues.push({name:t,to:a?e[e.length-1]:i(e,1,{}),bezier:!!a&&e,isColor:r,isPath:n,isFunction:!!o&&e,moveAlgorithm:r?K:n?tt:a?Z:Q})}this.duration=c(i(s),0),this.ease=c(h,t=>t)}reset(){this.initialized=!1}init(t,i){for(var s,h=this.changeValues.length;h--;)(s=this.changeValues[h]).isFunction?(s.from=t[s.name],s.to=s.isFunction(s.from),s.isColor?(s.colorFrom=new R(s.from),s.colorTo=new R(s.to),s.moveAlgorithm=K):s.isPath?([s.pathFrom,s.pathTo]=t.changeToPathInit(s.from,s.to),s.moveAlgorithm=tt):Array.isArray(s.to)?(s.values=[t[s.name],...s.to],s.moveAlgorithm=Z):(s.delta=s.to-s.from,s.moveAlgorithm=Q)):s.isColor?(s.colorFrom=new R(t[s.name]),s.colorTo=new R(s.to)):s.isPath?[s.pathFrom,s.pathTo]=t.changeToPathInit(t[s.name],s.to):s.bezier?s.values=[t[s.name],...s.bezier]:(s.from=t[s.name],s.delta=s.to-s.from)}run(t,i){if(this.initialized||(this.initialized=!0,this.init(t,i)),this.duration<=i){let i,s=this.changeValues.length;for(;s--;)i=this.changeValues[s],t[i.name]=i.to}else{let s,h=this.changeValues.length;const e=this.ease(i/this.duration);for(;h--;)s=this.changeValues[h],t[s.name]=s.moveAlgorithm(e,s,t)}return i-this.duration}}var st={Callback:class{constructor(t,s){this.callback=t,this.duration=c(i(s),void 0),this.initialized=!1}reset(){this.initialized=!1}run(t,i){let s;return void 0!==this.duration?(this.callback(t,Math.min(i,this.duration),!this.initialized),this.initialized=!0,i-this.duration):(s=this.callback(t,i,!this.initialized),this.initialized=!0,s)}},ChangeTo:it,End:class{constructor(){}run(t,i){return p.A}},EndDisabled:class{constructor(){}run(t,i){return t.enabled=!1,p.A}},Forever:class{constructor(){var t=[].slice.call(arguments);this.Aniobject=t[0]instanceof p?t[0]:new p(...t)}reset(t=0){this.Aniobject.reset&&this.Aniobject.reset(t)}play(t="",i=0){this.Aniobject.play&&this.Aniobject.play(t,i)}run(t,i,s){let h=i;for(;h>=0;){if(h=this.Aniobject.run(t,h,s),s=!0,!0===h)return!0;h>=0&&this.Aniobject.reset&&this.Aniobject.reset()}return h}},If:class{constructor(t,i,s){this.ifCallback=t,this.Aniobject=i,this.AniobjectElse=c(s,()=>0)}run(t,s){const h=i(this.ifCallback)?this.Aniobject:this.AniobjectElse;return h.run?h.run(t,s):h(t,s)}},Image:class{constructor(t,s){this.initialized=!1,this.image=i(t),this.durationBetweenFrames=c(i(s),0),Array.isArray(this.image)?this.count=this.image.length:(this.image=[this.image],this.count=1),this.duration=this.count*this.durationBetweenFrames}reset(){this.initialized=!1}run(t,i){if(this.initialized||(this.initialized=!0,this.current=-1),i>=this.duration)t.image=n.getImage(this.image[this.image.length-1]);else{let s=Math.floor(i/this.durationBetweenFrames);s!==this.current&&(this.current=s,t.image=n.getImage(this.image[this.current]))}return i-this.duration}},ImageFrame:class{constructor(t,s,h){this.initialized=!1,this.frameNumber=i(t),this.framesToRight=c(i(s),!0),this.durationBetweenFrames=c(i(h),0),Array.isArray(this.frameNumber)||(this.frameNumber=[this.frameNumber]),this.duration=this.frameNumber.length*this.durationBetweenFrames}run(t,i){let s=0;return s=i>=this.duration?this.frameNumber[this.frameNumber.length-1]:this.frameNumber[Math.floor(i/this.durationBetweenFrames)],this.framesToRight?t.frameX=t.frameWidth*s:t.frameY=t.frameHeight*s,i-this.duration}},Loop:class{constructor(t){var s=[].slice.call(arguments,1);this.Aniobject=s[0]instanceof p?s[0]:new p(...s),this.times=this.timesOrg=c(i(t),1)}reset(t=0){this.times=this.timesOrg,this.Aniobject.reset&&this.Aniobject.reset(t)}play(t="",i=0){this.times=this.timesOrg,this.Aniobject.play&&this.Aniobject.play(t,i)}run(t,i,s){let h=i;for(;h>=0&&this.times>0;){if(h=this.Aniobject.run(t,h,s),s=!0,!0===h)return!0;h>=0&&(this.times--,this.Aniobject.reset&&this.Aniobject.reset())}return h}},Move:class extends it{constructor(t,s,h,e){super({x:t,y:s},0,e),this.speed=i(h)||1}init(t,i){if(0==this.speed||this.targetX===t.x&&this.targetY===t.y)this.duration=0;else{let i=this.changeValues[0],s=this.changeValues[1];i.from=t.x,s.from=t.y,i.delta=i.to-i.from,s.delta=s.to-s.from;const h=Math.sqrt(i.delta*i.delta+s.delta*s.delta);this.duration=10*h/this.speed}super.init(t,i)}},Once:class{constructor(t,s){this.Aniobject=t,this.times=c(i(s),1)}run(t,i){if(this.times<=0)return i;{let s=this.Aniobject.run(t,i);return s>=0&&this.times--,s}}},Remove:class{constructor(){}run(t,i){return p.j}},Sequence:p,Shake:class{constructor(t,s){this.initialized=!1,this.duration=i(s),this.shakeDiff=i(t),this.shakeDiffHalf=this.shakeDiff/2}reset(){this.initialized=!1}run(t,i){return this.initialized||(this.initialized=!0,this.x=t.x,this.y=t.y),i>=this.duration?(t.x=this.x,t.y=this.y):(t.x=this.x+Math.random()*this.shakeDiff-this.shakeDiffHalf,t.y=this.y+Math.random()*this.shakeDiff-this.shakeDiffHalf),i-this.duration}},ShowOnce:class{constructor(){this.showOnce=!0}run(t,i){return t.enabled=t.enabled&&this.showOnce,this.showOnce=!1,0}},State:class{constructor({states:t={},transitions:i={},default:s,delegateTo:h}={}){this.states=t,Object.keys(this.states).forEach(t=>{Array.isArray(this.states[t])&&(this.states[t]=new p(this.states[t]))}),this.transitions=i,this.delegateTo=h,this.currentStateName=s,this.currentState=this.states[s],this.isTransitioningToStateName=void 0}setState(t,i){if(t!==this.currentStateName){this.isTransitioningToStateName=t;const i=`${t.charAt(0).toUpperCase()}${t.slice(1)}`,s=[`${this.currentStateName}To${i}`,`${this.currentStateName}To`,`to${i}`].find(t=>this.transitions[t]);s?(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.transitions[s],this.currentState&&this.currentState.reset&&this.currentState.reset()):(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.states[this.currentStateName],this.currentState&&this.currentState.reset&&this.currentState.reset(),this.isTransitioningToStateName=void 0)}}play(t="",i=0){this.currentState.play&&this.currentState.play(t,i)}run(t,i,s){let h=i,e=s;if(this.currentState){if(h=this.currentState.run(t,h,e),!0===h)return!0;e=!0}if(h>=0||!this.currentState)if(this.isTransitioningToStateName){if(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.states[this.currentStateName],this.currentState&&this.currentState.reset&&this.currentState.reset(),this.isTransitioningToStateName=void 0,h=this.currentState.run(t,h,e),!0===h)return!0}else this.currentState=void 0;return-1}},Stop:class{constructor(){}run(t,i){return p.S}},StopDisabled:class{constructor(){}run(t,i){return t.enabled=!1,p.S}},Wait:g,WaitDisabled:class{constructor(t){this.duration=c(i(t),0)}run(t,i){return t.enabled=i>=this.duration,i-this.duration}}},ht=function(t){var i=t*t;return t<4/11?7.5625*i:t<8/11?9.075*i-9.9*t+3.4:t<.9?4356/361*i-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72},et={backInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},backIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},backOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},bounceInOut:function(t){return t<.5?.5*(1-ht(1-2*t)):.5*ht(2*t-1)+.5},bounceIn:function(t){return 1-ht(1-t)},bounceOut:ht,circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},cubicInOut:function(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1},cubicIn:function(t){return t*t*t},cubicOut:function(t){var i=t-1;return i*i*i+1},elasticInOut:function(t){return t<.5?.5*Math.sin(13*Math.PI/2*2*t)*Math.pow(2,10*(2*t-1)):.5*Math.sin(-13*Math.PI/2*(2*t-1+1))*Math.pow(2,-10*(2*t-1))+1},elasticIn:function(t){return Math.sin(13*t*Math.PI/2)*Math.pow(2,10*(t-1))},elasticOut:function(t){return Math.sin(-13*(t+1)*Math.PI/2)*Math.pow(2,-10*t)+1},expoInOut:function(t){return 0===t||1===t?t:t<.5?.5*Math.pow(2,20*t-10):-.5*Math.pow(2,10-20*t)+1},expoIn:function(t){return 0===t?t:Math.pow(2,10*(t-1))},expoOut:function(t){return 1===t?t:1-Math.pow(2,-10*t)},linear:function(t){return t},quadInOut:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},quadIn:function(t){return t*t},quadOut:function(t){return-t*(t-2)},quartInOut:function(t){return t<.5?8*Math.pow(t,4):-8*Math.pow(t-1,4)+1},quartIn:function(t){return Math.pow(t,4)},quartOut:function(t){return Math.pow(t-1,3)*(1-t)+1},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},sineInOut:function(t){return-.5*(Math.cos(Math.PI*t)-1)},sineIn:function(t){var i=Math.cos(t*Math.PI*.5);return Math.abs(i)<1e-14?1:1-i},sineOut:function(t){return Math.sin(t*Math.PI/2)}};class rt{constructor(t={}){this.type="camera",this.cam=Object.assign({zoom:1,x:0,y:0},t)}viewport({},t){return t.scale(this.cam.zoom,this.cam.zoom).translate(-this.cam.x,-this.cam.y)}viewportByCam({engine:t},i){const s=t.getWidth()/2,h=t.getHeight()/2,e=t.getRatio()>1?s:h;return(new u).translate(s,h).scale(e,e).scale(i.zoom,i.zoom).translate(-i.x,-i.y)}additionalModifier({},t){return t.cam=Object.assign({},this.cam),t}clampView({engine:t,scene:i,clampLimits:s},h){const e=s||{x1:i.additionalModifier.x,y1:i.additionalModifier.y,x2:i.additionalModifier.x+i.additionalModifier.width,y2:i.additionalModifier.y+i.additionalModifier.height},r=this.viewportByCam({engine:t},h).invert(),[n,o]=r.transformPoint(0,0),[a,u]=r.transformPoint(t.getWidth(),t.getHeight());return a-n<=e.x2-e.x1?n<e.x1?a<=e.x2&&(h.x+=e.x1-n):a>e.x2&&(h.x+=e.x2-a):n>e.x1?h.x+=e.x1-n:a<e.x2&&(h.x+=e.x2-a),u-o<=e.y2-e.y1?o<e.y1?u<=e.y2&&(h.y+=e.y1-o):u>e.y2&&(h.y+=e.y2-u):o>e.y1?h.y+=e.y1-o:u<e.y2&&(h.y+=e.y2-u),h}set zoom(t){this.cam.zoom=t}set camX(t){this.cam.x=t}set camY(t){this.cam.y=t}get zoom(){return this.cam.zoom}get camX(){return this.cam.x}get camY(){return this.cam.y}zoomToFullScreen({scene:t}){return Math.min(t.additionalModifier.fullScreen.width/t.additionalModifier.width,t.additionalModifier.fullScreen.height/t.additionalModifier.height)}zoomTo({scene:t,engine:i,cam:s,x1:h,y1:e,x2:r,y2:n}){const o=t.additionalModifier.scaleCanvas,a=this.viewportByCam({engine:i},s||this.cam).invert(),[u,c]=a.transformPoint(0,0),[f,l]=a.transformPoint(i.getWidth()*o,i.getHeight()*o),d=r-h,v=n-e,m={x:h+d/2,y:e+v/2,zoom:s.zoom*Math.max(Math.min((f-u)/d,(l-c)/v),Number.MIN_VALUE)};s?(s.x=m.x,s.y=m.y,s.zoom=m.zoom):this.cam=m}}class nt{constructor(t={}){this.type="control",this.wt={},this.toCam={},this.config=Object.assign({zoomMax:10,zoomMin:.5,zoomFactor:1.2,tween:2,callResize:!0},t)}init({scene:t}){this.xt=t,this.toCam=Object.assign({},t.camera.cam)}mouseDown({event:t,position:[i,s],button:h}){this.wt[h]=Object.assign({},this.wt[h],{x:i,y:s,kt:this.toCam.x,It:this.toCam.y,Pt:!0,Ft:t.touches&&t.touches.length||1,Ot:void 0,Ct:Date.now()})}mouseUp({event:t,position:[i,s],button:h,scene:e}){this.wt[h]||(this.wt[h]={});const r=this.wt[h].Pt,n=t.changedTouches&&t.changedTouches.length||1,o=Math.max(this.wt[h].Ft,n);this.wt[h].Pt=!1,this.wt[h].Ft-=n,!r||o>1?e.stopPropagation():Date.now()-this.wt[h].Ct<300&&Math.abs(this.wt[h].x-i)<5&&Math.abs(this.wt[h].y-s)<5&&1===h||e.stopPropagation()}mouseOut({button:t}){this.wt[t]&&(this.wt[t].Pt=!1)}mouseMove({event:t,position:[i,s],button:h,scene:e}){if(!this.wt[h]||!this.wt[h].Pt||0===t.which&&!t.touches)return;const r=e.additionalModifier.scaleCanvas;if(t.touches&&t.touches.length>=2){const i=t.touches,s=Math.sqrt((i[0].pageX-i[1].pageX)*(i[0].pageX-i[1].pageX)+(i[0].pageY-i[1].pageY)*(i[0].pageY-i[1].pageY));void 0===this.wt[h].Ot?s>0&&(this.wt[h].Ot=s,this.wt[h].Tt=this.toCam.zoom):(this.toCam.zoom=Math.max(this.config.zoomMin,Math.min(this.config.zoomMax,this.wt[h].Tt*s/this.wt[h].Ot)),this.toCam=e.camera.clampView(arguments[0],this.toCam))}else{this.wt[h].Ot=void 0;const t=e.camera.viewportByCam(arguments[0],this.toCam).invert(),[n,o]=t.transformPoint(this.wt[h].x*r,this.wt[h].y*r),[a,u]=t.transformPoint(i*r,s*r);this.toCam.x=this.wt[h].kt+n-a,this.toCam.y=this.wt[h].It+o-u,this.toCam=e.camera.clampView(arguments[0],this.toCam)}}mouseWheel({event:t,position:[i,s],scene:h}){const e=h.additionalModifier.scaleCanvas,[r,n]=h.camera.viewportByCam(arguments[0],this.toCam).invert().transformPoint(i*e,s*e);if((t.wheelDelta||-1*t.deltaY)/120>0){this.zoomIn();const[t,o]=h.camera.viewportByCam(arguments[0],this.toCam).invert().transformPoint(i*e,s*e);this.toCam.x-=t-r,this.toCam.y-=o-n,this.toCam=h.camera.clampView(arguments[0],this.toCam)}else this.zoomOut(arguments[0])}hasCamChanged(){const t=this.config.tween||1;return Math.abs(this.toCam.x-this.xt.camera.cam.x)>=Number.EPSILON*t||Math.abs(this.toCam.y-this.xt.camera.cam.y)>=Number.EPSILON*t||Math.abs(this.toCam.zoom-this.xt.camera.cam.zoom)>=Number.EPSILON*t}fixedUpdate({scene:t,lastCall:i}){this.config.tween&&!this.At&&this.hasCamChanged()&&(t.camera.cam.x+=(this.toCam.x-t.camera.cam.x)/this.config.tween,t.camera.cam.y+=(this.toCam.y-t.camera.cam.y)/this.config.tween,t.camera.cam.zoom+=(this.toCam.zoom-t.camera.cam.zoom)/this.config.tween,i&&(t.additionalModifier.cam=this.cam,this.config.callResize?t.resize():t.cacheClear()))}update({scene:t}){this.config.tween&&!this.At||!this.hasCamChanged()||(this.At=!1,t.camera.cam=Object.assign({},this.toCam),this.config.callResize?t.resize():t.cacheClear())}camInstant(){this.At=!0}resize(t){this.toCam=t.scene.camera.clampView(t,this.toCam)}zoomToNorm(){return this.toCam.zoom=1,this}zoomIn(){return this.toCam.zoom=Math.min(this.config.zoomMax,this.toCam.zoom*this.config.zoomFactor),this}zoomOut(t){return this.toCam.zoom=Math.max(this.config.zoomMin,this.toCam.zoom/this.config.zoomFactor),t&&(this.toCam=this.xt.camera.clampView(t,this.toCam)),this}zoomTo(t){t.cam=this.toCam,t.scene.camera.zoomTo(t)}}var ot={Callback:rt,Camera:rt,CameraControl:nt,CameraControlSecondButton:class extends nt{mouseUp({event:t,position:[i,s],button:h,scene:e}){this.wt[h]||(this.wt[h]={});const r=this.wt[h].Pt,n=t.changedTouches&&t.changedTouches.length||1,o=Math.max(this.wt[h].Ft,n);if(this.wt[h].Pt=!1,this.wt[h].Ft-=n,!r||o>1)e.stopPropagation();else if((Date.now()-this.wt[h].Ct>300||Math.abs(this.wt[h].x-i)>=5||Math.abs(this.wt[h].y-s)>=5)&&1===h){e.stopPropagation();const[r,n]=e.transformPoint(i,s),[o,a]=e.transformPoint(this.wt[h].x,this.wt[h].y);e.map("region",{event:t,x1:Math.min(o,r),y1:Math.min(a,n),x2:Math.max(o,r),y2:Math.max(a,n),fromX:o,fromY:a,toX:r,toY:n})}}mouseMove({event:t,position:[i,s],button:h,scene:e}){if(!this.wt[h]||!this.wt[h].Pt||0===t.which&&!t.touches)return;const r=e.additionalModifier.scaleCanvas;if(t.touches&&t.touches.length>=2){const n=t.touches,o=Math.sqrt((n[0].pageX-n[1].pageX)*(n[0].pageX-n[1].pageX)+(n[0].pageY-n[1].pageY)*(n[0].pageY-n[1].pageY));if(void 0===this.wt[h].Ot)o>0&&(this.wt[h].Ot=o,this.wt[h].Tt=this.toCam.zoom);else{this.toCam.zoom=Math.max(this.config.zoomMin,Math.min(this.config.zoomMax,this.wt[h].Tt*o/this.wt[h].Ot));const t=e.camera.viewportByCam(arguments[0],this.toCam).invert(),[n,a]=t.transformPoint(this.wt[h].x*r,this.wt[h].y*r),[u,c]=t.transformPoint(i*r,s*r);this.toCam.x=this.wt[h].kt+n-u,this.toCam.y=this.wt[h].It+a-c,this.toCam=e.camera.clampView(arguments[0],this.toCam)}}else{if(this.wt[h].Ot=void 0,2===h){const t=e.camera.viewportByCam(arguments[0],this.toCam).invert(),[n,o]=t.transformPoint(this.wt[h].x*r,this.wt[h].y*r),[a,u]=t.transformPoint(i*r,s*r);this.toCam.x=this.wt[h].kt+n-a,this.toCam.y=this.wt[h].It+o-u,this.toCam=e.camera.clampView(arguments[0],this.toCam)}if(1===h&&e.has("regionMove")&&!(Date.now()-this.wt[h].Ct<300&&Math.abs(this.wt[h].x-i)<5&&Math.abs(this.wt[h].y-s)<5)&&(!t.touches||1===t.touches.length)){const[r,n]=e.transformPoint(i,s),[o,a]=e.transformPoint(this.wt[h].x,this.wt[h].y);e.map("regionMove",{event:t,x1:Math.min(o,r),y1:Math.min(a,n),x2:Math.max(o,r),y2:Math.max(a,n),fromX:o,fromY:a,toX:r,toY:n})}}}},Click:class{constructor({doubleClickDetectInterval:t=350}={}){this.St=t}mouseUp(t){const{scene:i,button:s}=t;1===s&&(i.has("doubleClick")?this.Et?(clearTimeout(this.Et),this.Et=0,i.map("doubleClick",t)):this.Et=setTimeout(()=>{this.Et=0,i.map("click",t)},this.St):i.map("click",t))}},Element:class{constructor({doubleClickDetectInterval:t=350}={}){this.St=t}isDrawFrame(){return this.zt?1:0}jt(t,i,s){i?t.has("doubleClickElement")?this.Et?(clearTimeout(this.Et),this.Et=0,t.map("doubleClickElement",s)):this.Et=setTimeout(()=>{this.Et=0,t.map("clickElement",s)},this.St):t.map("clickElement",s):t.map("hoverElement",s)}Dt(t,i,s){i?t.has("doubleClickNonElement")?this.Et?(clearTimeout(this.Et),this.Et=void 0,t.map("doubleClickNonElement",s)):this.Et=setTimeout(()=>{this.Et=void 0,t.map("clickNonElement",s)},this.St):t.map("clickNonElement",s):t.map("hoverNonElement",s)}initSprites({scene:t,output:i,layerManager:s,canvasId:h}){if(this.zt=!1,this._t||this.Lt){const e=!!this._t,{mx:r,my:n}=this._t||this.Lt,o=t.additionalModifier.scaleCanvas,a=i.context[h],u=Math.round(r/o),c=Math.round(n/o),[f,l]=t.transformPoint(r,n);a.save(),a.setTransform(...t.viewport().m);let d=0;if(s.forEach(({layerId:t,element:i,isFunction:s,elementId:h})=>{if(!s){const s=i.detect(a,u,c);if("c"===s)d="c";else if(s)return d={layerId:t,element:s,elementId:h},!1}}),a.restore(),"c"===d)this.zt=!0;else{this._t=!1,this.Lt=!1;const i={mx:r,my:n,x:f,y:l};d?(Object.assign(i,d),this.jt(t,e,i)):this.Dt(t,e,i)}}}draw({engine:t,scene:i,layerManager:s,output:h,canvasId:e}){if(!e&&this.zt){const r=!!this._t,{mx:n,my:o}=this._t||this.Lt,a=i.additionalModifier.scaleCanvas,u=h.context[e],c=Math.round(n/a),f=Math.round(o/a),[l,d]=i.transformPoint(n,o),v={mx:n,my:o,x:l,y:d},m=u.imageSmoothingEnabled;u.imageSmoothingEnabled=!1,u.clearRect(0,0,u.canvas.width,u.canvas.height),u.save(),u.setTransform(...i.viewport().m),s.forEach(({layerId:t,element:i,isFunction:s,elementId:h})=>{s||i.detectDraw(u,`rgb(${255&h}, ${(65280&h)>>8}, ${255&t})`)},0),u.restore(),u.imageSmoothingEnabled=m,t.normContext(u),this._t=!1,this.Lt=!1;const g=u.getImageData(c,f,1,1).data;g[3]?(v.layerId=g[2],v.elementId=g[0]+(g[1]<<8),v.element=s.getById(v.layerId).getById(v.elementId),this.jt(i,r,v)):this.Dt(i,r,v)}}mouseUp({scene:t,position:[i,s],button:h}){this._t=1===h&&t.has("clickElement")&&{mx:i,my:s}}mouseMove({scene:t,position:[i,s]}){this.Lt=t.has("hoverElement")&&{mx:i,my:s}}},Event:class{constructor(){this.type="events"}qt(t,i,s){c(s.value("preventDefault"),!0)&&i.preventDefault();const[h,e]=this.getMousePosition({event:i}),[r,n]=s.transformPoint(h,e);s.pipeBack(t,{event:i,position:[h,e],x:r,y:n,button:this.getMouseButton({event:i})})}events({scene:t}){return[t.has("mouseDown")&&[["touchstart","mousedown"],i=>this.qt("mouseDown",i,t)],t.has("mouseUp")&&[["touchend","mouseup"],i=>this.qt("mouseUp",i,t)],t.has("mouseOut")&&[["touchendoutside","mouseout"],i=>this.qt("mouseOut",i,t)],t.has("mouseMove")&&[["touchmove","mousemove"],i=>this.qt("mouseMove",i,t)],t.has("mouseWheel")&&[["wheel"],i=>this.qt("mouseWheel",i,t)],c(t.value("preventDefault"),!0)&&[["contextmenu"],t=>t.preventDefault()]].filter(t=>t)}init({output:t,scene:i}){const s=t.canvas[0],h=i.map("events");this.Nt=h.filter(Array.isArray).reduce((t,i)=>(t.push.apply(t,i),t),[]).map(t=>Array.isArray(t)?t:[[t],s=>{c(i.value("preventDefault"),!0)&&s.preventDefault(),i.pipeBack(t,{event:s})}]).map(([t,i])=>t.map(t=>({n:s,e:t,f:i}))).reduce((t,i)=>(Array.isArray(i)?t.push.apply(t,i):t.push(i),t),[]),this.Nt.forEach(t=>{t.n.addEventListener(t.e,t.f,!0)})}destroy(){this.Nt.forEach(t=>{t.n.removeEventListener(t.e,t.f,!0)}),this.Nt=[]}getMousePosition({event:t}){let i;if(t.touches&&t.touches.length>0?i=t.targetTouches:t.changedTouches&&t.changedTouches.length>0&&(i=t.changedTouches),i){const s=t.target.getBoundingClientRect(),h=i.length;return i=Array.from(i),[i.reduce((t,i)=>t+i.pageX,0)/h-s.left,i.reduce((t,i)=>t+i.pageY,0)/h-s.top]}if(void 0===t.offsetX){const i=t.target.getBoundingClientRect();return[t.clientX-i.left,t.clientY-i.top]}return[t.offsetX,t.offsetY]}getMouseButton({event:t}){return t.touches?t.touches.length||t.changedTouches.length:c(t.buttons?t.buttons:[0,1,4,2][t.which],1)}},LoadingScreen:class{loading({output:t,progress:i}){const s=t.context[0],h="number"==typeof i?Math.max(1,i*t.height):t.height;s.globalCompositeOperation="source-over",s.globalAlpha=1,s.clearRect(0,0,t.width,t.height),s.fillStyle="#aaa",s.fillRect(0,t.height/2-h/2,t.width,h),s.font="20px Georgia",s.fillStyle="#fff",s.textAlign="left",s.textBaseline="bottom",s.fillText(isNaN(parseFloat(i))?i:"Loading "+Math.round(100*i)+"%",10+3*Math.random(),t.height-10+3*Math.random())}},Norm:class{viewport({engine:t},i){const s=t.getWidth()/2,h=t.getHeight()/2,e=t.getRatio()>1?s:h;return i.translate(s,h).scale(e,e)}additionalModifier({engine:t,output:i,scene:s}){s.cacheClear();const h={alpha:1,x:-1,y:-1,width:2,height:2,widthInPixel:i.width,heightInPixel:i.height,scaleCanvas:i.width/i.canvas[0].clientWidth},[e,r]=s.transformPoint(0,0,1),[n,o]=s.transformPoint(i.width,i.height,1);h.visibleScreen={x:e,y:r,width:n-e,height:o-r};const a=t.getWidth()/2,c=t.getHeight()/2,f=t.getRatio()>1?a:c,l=(new u).translate(a,c).scale(f,f).invert(),[d,v]=l.transformPoint(0,0,1),[m,g]=l.transformPoint(i.width,i.height,1);return h.fullScreen={x:d,y:v,width:m-d,height:g-v},h}},TimingAudio:class extends f{constructor(t={}){super(t),this.O=Number.POSITIVE_INFINITY,this.Bt=null,this.Rt=null,this.$t=!1,this.Wt=this.P.audioElement}get audioElement(){return this.Wt}init(){if(this.Wt)return"function"==typeof MediaController&&(this.Wt.controller=new MediaController,this.$t=!0),this.Wt.preload="auto",new Promise(t=>{let i=()=>{this.Wt.removeEventListener("canplaythrough",i);let s=this.Wt.play();s&&s.catch(t=>{}),t()};this.Wt.addEventListener("canplaythrough",i),this.Wt.load()})}endTime(){return this.Wt?1e3*this.Wt.duration:Number.POSITIVE_INFINITY}currentTime(){let t=super.currentTime();if(this.Wt){if(this.Wt.ended&&this.Wt.duration)return 1e3*this.Wt.duration;const i=1e3*this.Wt.currentTime;if(this.$t){if(null===this.Bt)return this.Bt=t,this.Rt=i,i;if("playing"===this.Wt.controller.playbackState){if(i===this.Rt)return this.Rt+Math.min(260,t-this.Bt);if(i-this.Rt<500&&i>this.Rt&&t-this.Bt<350)return this.Bt=this.Bt+(i-this.Rt),this.Rt=i,this.Rt+t-this.Bt}return this.Bt=t,this.Rt=i,this.Rt}return i}return t}clampTime({timePassed:t}){return t}shiftTime(){return 0}},TimingDefault:f};t.Animations=st,t.Easing=et,t.Engine=class{constructor(t){let i=t;if("object"!=typeof t)throw new Error("No canvas given for Engine constructor");if(t.getContext)i={canvas:t};else if(!t.canvas)throw new Error("No canvas given for Engine constructor");let h=Object.assign({},i);if(this.Ut={canvas:[],context:[],width:0,height:0,ratio:1},this.Nt=[],this.xt=null,this.Xt=!1,this.Yt=0,this.Ht=!1,this.Gt=null,this.Ut.canvas=s(h.canvas),h.autoSize){const t={enabled:!0,scaleLimitMin:1,scaleLimitMax:2.5,scaleFactor:1.07,referenceWidth:()=>this.Ut.canvas[0].clientWidth,referenceHeight:()=>this.Ut.canvas[0].clientHeight,currentScale:1,waitTime:100,currentWaitedTime:0,currentOffsetTime:0,offsetTimeLimitUp:300,offsetTimeLimitDown:300,registerResizeEvents:!0,registerVisibilityEvents:!0,setCanvasStyle:!1};this.Jt="object"==typeof h.autoSize?Object.assign({},t,h.autoSize):t,this.Jt.registerResizeEvents&&(this.Nt=["resize","orientationchange"].map(t=>({n:window,e:t,f:this.recalculateCanvas.bind(this)}))),this.Jt.registerVisibilityEvents&&this.Nt.push({n:document,e:"visibilitychange",f:this.handleVisibilityChange.bind(this)}),this.Vt()}else this.Ut.width=this.Ut.canvas[0].width,this.Ut.height=this.Ut.canvas[0].height,this.Ut.ratio=this.Ut.width/this.Ut.height;this.Ut.canvas.forEach((t,i)=>{this.Ut.context[i]=t.getContext("2d")}),this.Qt=this.Ut.canvas.length,this.rt=Array.from({length:this.Qt},t=>0),h.clickToPlayAudio&&this.Nt.push({n:this.Ut.canvas[0],e:"click",f:this.playAudioOfScene.bind(this)}),this.Zt=h.reduceFramerate,this.Nt.forEach(t=>{t.n.addEventListener(t.e,t.f)}),this.switchScene(h.scene,h.sceneParameter||{})}handleVisibilityChange(){this.Jt.enabled=!("hidden"==document.visibilityState)}playAudioOfScene(){this.Xt&&this.xt&&this.xt.timing.audioElement&&this.xt.timing.audioElement.play()}normContext(t){t.textBaseline="middle",t.textAlign="center",t.globalAlpha=1,t.globalCompositeOperation="source-over"}getWidth(){return this.Ut.width}getHeight(){return this.Ut.height}getRatio(){return this.Ut.ratio}getOutput(){return this.Ut}recalculateCanvas(){return this.Ht=!0,this}Vt(){if(this.Jt){const t=i(this.Jt.referenceWidth),s=i(this.Jt.referenceHeight);if(t<=0||s<=0)return;this.Ut.canvas.forEach(i=>{i.width=Math.round(t/this.Jt.currentScale),i.height=Math.round(s/this.Jt.currentScale),this.Jt.setCanvasStyle&&(i.style.width=`${t}px`,i.style.height=`${s}px`)}),this.Jt.currentWaitedTime=0,this.Jt.currentOffsetTime=0}this.Ut.width=this.Ut.canvas[0].width,this.Ut.height=this.Ut.canvas[0].height,this.Ut.ratio=this.Ut.width/this.Ut.height,this.resize()}recalculateFPS(){try{const t=this;return t.Gt&&(window.cancelAnimationFrame(t.Gt),t.Gt=!1),Promise.resolve(new Promise(t=>requestAnimationFrame(t))).then(function(){function i(){const i=(t.Kt()-s)/n;t.Jt.offsetTimeTarget=i,t.Jt.offsetTimeDelta=i/3,!1===t.Gt&&(t.ti=!1,t.Gt=window.requestAnimationFrame(t.ii.bind(t)))}const s=t.Kt(),n=3;let o=n;const a=function(t,i,s){for(var n;;){var o=t();if(r(o)&&(o=o.v),!o)return a;if(o.then){n=0;break}var a=s();if(a&&a.then){if(!r(a)){n=1;break}a=a.s}}var u=new e,c=h.bind(null,u,2);return(0===n?o.then(l):1===n?a.then(f):(void 0).then(function(){(o=t())?o.then?o.then(l).then(void 0,c):l(o):h(u,1,a)})).then(void 0,c),u;function f(i){a=i;do{if(!(o=t())||r(o)&&!o.v)return void h(u,1,a);if(o.then)return void o.then(l).then(void 0,c);r(a=s())&&(a=a.v)}while(!a||!a.then);a.then(f).then(void 0,c)}function l(t){t?(a=s())&&a.then?a.then(f).then(void 0,c):f(a):h(u,1,a)}}(function(){return o--},0,function(){return Promise.resolve(new Promise(t=>requestAnimationFrame(t))).then(function(){})});return a&&a.then?a.then(i):i()})}catch(t){return Promise.reject(t)}}resize(){return this.xt&&this.xt.resize&&this.xt.resize(),this}switchScene(t,i){return t&&(this.si=t,this.hi=i),this}Kt(){return window.performance?performance.now():Date.now()}ii(t){if(!this.Gt)return;this.Gt=window.requestAnimationFrame(this.ii.bind(this));let i=this.Ht&&(!this.Zt||!this.ei);i&&(this.Vt(),this.Ht=!1);for(let t=0;t<this.Qt;t++)this.rt[t]=Math.max(this.rt[t]-1,i?1:0);if(this.ti||(this.ti=t),this.ri||(this.ri=t),this.si&&!this.ni&&(this.ni=Promise.resolve(this.xt?this.xt.destroy():{}),this.ni.then(i=>{this.si.callInit({run:this.oi,scene:this.hi,destroy:i},this),this.xt=this.si,this.si=void 0,this.ni=void 0,this.Xt=!1,this.Yt=this.xt.currentTime(),this.ri=t})),this.xt&&(this.Zt&&(this.ei=!this.ei),!this.Zt||this.ei)){let i=this.xt.currentTime(),s=this.xt.clampTime(i-this.Yt);const h=this.xt.shiftTime(s);if(s+=h,this.Yt=i+h,this.Xt){const i=0!==s||this.ai;this.ai=!1;const h=this.Kt();if(this.Ut.canvas[0].width)for(let t=0;t<this.Qt;t++)this.normContext(this.Ut.context[t]),this.xt.initSprites(t);const e=this.xt.isDrawFrame(s);if(Array.isArray(e))for(let t=0;t<this.Qt;t++)this.rt[t]=Math.max(this.rt[t],e[t],0);else for(let t=0;t<this.Qt;t++)this.rt[t]=Math.max(this.rt[t],e,0);if(i&&this.xt.move(s),this.Ut.canvas[0].width)for(let t=0;t<this.Qt;t++)this.rt[t]&&this.xt.draw(t);if(this.Jt&&this.Jt.enabled){const s=t-this.ti;if(this.Jt.currentWaitedTime<this.Jt.waitTime)this.Jt.currentWaitedTime+=s;else if(i){const t=this.Jt.offsetTimeTarget*(this.Zt?2:1),i=this.Kt()-h,e=(Math.abs(s-t)>Math.abs(i-t)?s:i)-t;Math.abs(e)<=this.Jt.offsetTimeDelta?this.Jt.currentOffsetTime=this.Jt.currentOffsetTime>=0?Math.max(0,this.Jt.currentOffsetTime-this.Jt.offsetTimeDelta):Math.min(0,this.Jt.currentOffsetTime+this.Jt.offsetTimeDelta):e<0&&this.Jt.currentScale>this.Jt.scaleLimitMin?(this.Jt.currentOffsetTime+=e,this.Jt.currentOffsetTime<=-this.Jt.offsetTimeLimitDown&&(this.Jt.currentScale=Math.max(this.Jt.scaleLimitMin,this.Jt.currentScale/this.Jt.scaleFactor),this.Ht=!0)):e>0&&this.Jt.currentScale<this.Jt.scaleLimitMax&&(this.Jt.currentOffsetTime+=e,this.Jt.currentOffsetTime>=this.Jt.offsetTimeLimitUp&&(this.Jt.currentScale=Math.min(this.Jt.scaleLimitMax,this.Jt.currentScale*this.Jt.scaleFactor),this.Ht=!0))}}}else{for(let t=0;t<this.Qt;t++)this.normContext(this.Ut.context[t]);this.Xt=this.xt.callLoading({timePassed:t-this.ti,totalTimePassed:t-this.ri}),this.Xt&&(this.xt.reset(),this.Yt=this.xt.currentTime(),this.ai=!0,this.Jt&&(this.Jt.currentWaitedTime=0))}}this.ti=t}run(t){try{const i=this;return i.oi=t||{},Promise.resolve(i.stop()).then(function(){function t(){return i.Gt=window.requestAnimationFrame(i.ii.bind(i)),i}i.ti=i.ri=!1;const s=function(){if(i.Jt&&!i.Jt.offsetTimeTarget)return Promise.resolve(i.recalculateFPS()).then(function(){})}();return s&&s.then?s.then(t):t()})}catch(t){return Promise.reject(t)}}stop(){try{const t=this;return window.cancelAnimationFrame(t.Gt),t.Gt=null,Promise.resolve(t.xt?Promise.resolve(t.xt.destroy()).then(function(t){}):void 0)}catch(t){return Promise.reject(t)}}destroy(){try{const t=this;return Promise.resolve(t.stop()).then(function(){return t.Nt.forEach(t=>{t.n.removeEventListener(t.e,t.f)}),t.Nt=[],t})}catch(t){return Promise.reject(t)}}},t.ImageManager=n,t.Middleware=ot,t.Scene=class{constructor(){this.ui=new a,this.ci=0,this.fi=n,this.middlewares=[].slice.call(arguments),this.middlewareByType("timing")||(this.middlewares=[f,...this.middlewares])}Ut(){return this.li.getOutput()}set middlewares(t){this.di=s(t).map(t=>"function"==typeof t?new t:t).reduce((t,i)=>{for(let s of Object.keys(t))s in i&&t[s].push(i);return t.vi.push(i),"enabled"in i||(i.enabled=!0),i.type&&(t[`t_${i.type}`]=i),t},{vi:[],init:[],isDrawFrame:[],initSprites:[],fixedUpdate:[],update:[],draw:[],destroy:[],reset:[],resize:[],currentTime:[],clampTime:[],shiftTime:[],isChunked:[],hasOneChunkedFrame:[],calcFrames:[],tickChunk:[],additionalModifier:[]})}get middlewares(){return this.di.vi}middlewareByType(t){const i=this.di.vi.filter(i=>i.type==t);if(i.length)return i[i.length-1]}has(t){return t in this.di||this.di.vi.filter(i=>t in i).length>0}do(t,i,s,h){let e=this.di[t]||this.di.vi.filter(i=>t in i);return e=e.filter(t=>t.enabled),e.length?h(e,this.mi(i),s):s}map(t,i={}){return this.do(t,i,[],(i,s)=>i.map(i=>i[t](s)))}pipe(t,i={},s){return this.do(t,i,s,(i,h)=>{let e=s;this.gi=!1;for(let s of i)if(e=s[t](h,e),this.gi)break;return e})}pipeBack(t,i={},s){return this.do(t,i,s,(i,h)=>{let e=s;this.gi=!1;for(let s=i.length-1;s>=0&&(e=i[s][t](h,e),!this.gi);s--);return e})}pipeMax(t,i={},s){return this.do(t,i,s,(i,h)=>{let e=s;this.gi=!1;for(let s of i){let i=s[t](h,e);if(e=Array.isArray(i)?Array.isArray(e)?e.map((t,s)=>Math.max(t,i[s])):i.map(t=>Math.max(t,e)):Array.isArray(e)?e.map((t,s)=>Math.max(t,i)):Math.max(i,e),this.gi)break}return e})}pipeAsync(t,i={},s){const h=this;return this.do(t,i,s,function(i,e){try{let r,n=s;h.gi=!1;const o=function(t,i,s){if("function"==typeof t[l]){var h,e,r,n=t[l]();if(function t(o){try{for(;!((h=n.next()).done||s&&s());)if((o=i(h.value))&&o.then){if(!m(o))return void o.then(t,r||(r=d.bind(null,e=new v,2)));o=o.v}e?d(e,1,o):e=o}catch(t){d(e||(e=new v),2,t)}}(),n.return){var o=function(t){try{h.done||n.return()}catch(t){}return t};if(e&&e.then)return e.then(o,function(t){throw o(t)});o()}return e}if(!("length"in t))throw new TypeError("Object is not iterable");for(var a=[],u=0;u<t.length;u++)a.push(t[u]);return function(t,i,s){var h,e,r=-1;return function n(o){try{for(;++r<t.length&&(!s||!s());)if((o=i(r))&&o.then){if(!m(o))return void o.then(n,e||(e=d.bind(null,h=new v,2)));o=o.v}h?d(h,1,o):h=o}catch(t){d(h||(h=new v),2,t)}}(),h}(a,function(t){return i(a[t])},s)}(i,function(i){return Promise.resolve(i[t](e,n)).then(function(t){n=t,h.gi&&(r=1)})},function(){return r});return Promise.resolve(o&&o.then?o.then(function(){return n}):n)}catch(t){return Promise.reject(t)}})}value(t,s={}){let h=this.di[t]||this.di.vi.filter(i=>t in i);if(h.filter(t=>t.enabled),!h.length)return;const e=h[h.length-1];return i(e[t],e,this.mi(s))}stopPropagation(){this.gi=!0}currentTime(){return this.pipe("currentTime")}clampTime(t){return this.pipe("clampTime",{timePassed:t})}shiftTime(t){return this.pipe("shiftTime",{timePassed:t})}cacheClear(){this.pi=0,this.Mi=0}viewport(){return this.li?(this.pi||(this.pi=this.pipe("viewport",{},new u),this.Mi=null),this.pi):new u}transformPoint(t,i,s=this.bi.scaleCanvas){return this.Mi||(this.Mi=this.viewport().clone().invert()),this.Mi.transformPoint(t*s,i*s)}callInit(t,i){this.li=i,this.resize();const s=this.value("images");s&&this.fi.add(s),Promise.all(this.map("init",{parameter:t})).then(t=>this.yi=!0)}get additionalModifier(){return this.bi}updateAdditionalModifier(){const t=this.Ut();this.bi=this.pipe("additionalModifier",{},{alpha:1,x:0,y:0,width:t.width,height:t.height,widthInPixel:t.width,heightInPixel:t.height,scaleCanvas:1,visibleScreen:{x:0,y:0,width:t.width,height:t.height},fullScreen:{x:0,y:0,width:t.width,height:t.height}})}resize(){const t=this.Ut();this.updateAdditionalModifier(),this.pipe("resize"),this.ui.forEach(({element:i,isFunction:s})=>{s||i.resize(t,this.bi)})}destroy(){try{const t=this;return Promise.resolve(t.pipeAsync("destroy")).then(function(i){return t.yi=!1,i})}catch(t){return Promise.reject(t)}}get timing(){return this.di.t_timing}get camera(){return this.di.t_camera}get control(){return this.di.t_control}get totalTimePassed(){return this.ci}mi(t){return Object.assign({engine:this.li,scene:this,imageManager:this.fi,layerManager:this.ui,totalTimePassed:this.ci,output:this.li&&this.Ut()},t)}callLoading(t){return this.fi.isLoaded()&&this.yi?(this.wi=this.value("endTime"),t.progress="Click to play",this.value("loading",t),!0):(t.progress=this.fi.getCount()?this.fi.getLoaded()/this.fi.getCount():"Loading...",this.value("loading",t),!1)}fixedUpdate(t,i){this.map("fixedUpdate",{timePassed:t,lastCall:i})}isDrawFrame(t){return this.pipeMax("isDrawFrame",{timePassed:t},0!==t)}move(t){if(this.ci+=t,this.xi?this.reset():t<0?(t=this.ci,this.reset(),this.initSprites(),this.ci=t):this.wi&&this.wi<=this.ci&&(t-=this.ci-this.wi,this.ci=this.wi,this.map("end",{timePassed:t})),this.value("isChunked")){if(this.value("hasOneChunkedFrame",{timePassed:t})){const i=this.value("calcFrames",{timePassed:t})-1;for(let t=0;t<=i;t++)this.fixedUpdate(this.value("tickChunk"),t===i)}}else this.fixedUpdate(t,!0);this.map("update",{timePassed:t}),this.ui.forEach(({element:i,isFunction:s,layer:h,elementId:e})=>{s||i.animate(t)&&h.deleteById(e)})}draw(t){this.map("draw",{canvasId:t});const i=this.Ut().context[t];i.save(),i.setTransform(...this.viewport().m),this.ui.forEach(({layer:t,layerId:s,element:h,isFunction:e,elementId:r})=>{e?h(this.mi({layerId:s,elementId:r,layer:t,context:i}))&&t.deleteById(r):h.draw(i,this.bi)},t),i.restore()}initSprites(t){const i=this.Ut().context[t];this.ui.forEach(({element:t,isFunction:s})=>{s||t.callInit(i,this.bi)},t),this.map("initSprites",{canvasId:t})}resetIntend(){this.xi=!0}reset(){this.ci=0,this.xi=!1;let t=this.pipe("reset",{engine:this.li,scene:this,layerManager:this.ui,imageManager:this.fi},new a);if(Array.isArray(t)){const i=t;t=new a,i.forEach(i=>{t.addLayer().addElements(i)})}t&&(this.ui=t)}},t.Sprites=V});
