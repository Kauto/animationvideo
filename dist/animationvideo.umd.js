!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t=t||self).AnimationVideo={})}(this,function(t){function i(t,i){return void 0===i&&(i=null),"function"==typeof t?t.apply(i,[].slice.call(arguments,2)):t}function n(t){return null==t?[]:Array.isArray(t)?t:[t]}function h(t,i,n){if(!t.s){if(n instanceof r){if(!n.s)return void(n.o=h.bind(null,t,i));1&i&&(i=n.s),n=n.v}if(n&&n.then)return void n.then(h.bind(null,t,i),h.bind(null,t,2));t.s=i,t.v=n;var s=t.o;s&&s(t)}}var s=function(){function t(t){var i=this,h=t;if("object"!=typeof t)throw new Error("No canvas given for Engine constructor");if(t.getContext)h={canvas:t};else if(!t.canvas)throw new Error("No canvas given for Engine constructor");var s=Object.assign({},h);if(this.i={canvas:[],context:[],width:0,height:0,ratio:1},this.u=[],this.M=null,this.p=!1,this.k=0,this.O=!1,this.A=null,this.i.canvas=n(s.canvas),s.autoSize){var r={enabled:!0,scaleLimitMin:1,scaleLimitMax:2.5,scaleFactor:1.07,referenceWidth:function(){return i.i.canvas[0].clientWidth},referenceHeight:function(){return i.i.canvas[0].clientHeight},currentScale:1,waitTime:100,currentWaitedTime:0,currentOffsetTime:0,offsetTimeLimitUp:300,offsetTimeLimitDown:300,registerResizeEvents:!0,registerVisibilityEvents:!0,setCanvasStyle:!1};this.S="object"==typeof s.autoSize?Object.assign({},r,s.autoSize):r,this.S.registerResizeEvents&&(this.u=["resize","orientationchange"].map(function(t){return{n:window,e:t,f:i.recalculateCanvas.bind(i)}})),this.S.registerVisibilityEvents&&this.u.push({n:document,e:"visibilitychange",f:this.handleVisibilityChange.bind(this)}),this.P()}else this.i.width=this.i.canvas[0].width,this.i.height=this.i.canvas[0].height,this.i.ratio=this.i.width/this.i.height;this.i.canvas.forEach(function(t,n){i.i.context[n]=t.getContext("2d")}),this.F=this.i.canvas.length,this.I=Array.from({length:this.F},function(t){return 0}),s.clickToPlayAudio&&this.u.push({n:this.i.canvas[0],e:"click",f:this.playAudioOfScene.bind(this)}),this.j=s.reduceFramerate,this.u.forEach(function(t){t.n.addEventListener(t.e,t.f)}),this.switchScene(s.scene,s.sceneParameter||{})}var s=t.prototype;return s.handleVisibilityChange=function(){this.S.enabled=!("hidden"==document.visibilityState)},s.playAudioOfScene=function(){this.p&&this.M&&this.M.timing.audioElement&&this.M.timing.audioElement.play()},s.normContext=function(t){t.textBaseline="middle",t.textAlign="center",t.globalAlpha=1,t.globalCompositeOperation="source-over"},s.getWidth=function(){return this.i.width},s.getHeight=function(){return this.i.height},s.getRatio=function(){return this.i.ratio},s.getOutput=function(){return this.i},s.recalculateCanvas=function(){return this.O=!0,this},s.P=function(){var t=this;if(this.S){var n=i(this.S.referenceWidth),h=i(this.S.referenceHeight);if(n<=0||h<=0)return;this.i.canvas.forEach(function(i){i.width=Math.round(n/t.S.currentScale),i.height=Math.round(h/t.S.currentScale),t.S.setCanvasStyle&&(i.style.width=n+"px",i.style.height=h+"px")}),this.S.currentWaitedTime=0,this.S.currentOffsetTime=0}this.i.width=this.i.canvas[0].width,this.i.height=this.i.canvas[0].height,this.i.ratio=this.i.width/this.i.height,this.resize()},s.recalculateFPS=function(){try{var t=this;return t.A&&(window.cancelAnimationFrame(t.A),t.A=!1),Promise.resolve(new Promise(function(t){return requestAnimationFrame(t)})).then(function(){function i(){var i=(t.C()-n)/s;t.S.offsetTimeTarget=i,t.S.offsetTimeDelta=i/3,!1===t.A&&(t.$=!1,t.A=window.requestAnimationFrame(t.T.bind(t)))}var n=t.C(),s=3,o=s,u=function(t,i,n){for(var s;;){var o=t();if(e(o)&&(o=o.v),!o)return u;if(o.then){s=0;break}var u=n();if(u&&u.then){if(!e(u)){s=1;break}u=u.s}}var a=new r,f=h.bind(null,a,2);return(0===s?o.then(v):1===s?u.then(c):(void 0).then(function(){(o=t())?o.then?o.then(v).then(void 0,f):v(o):h(a,1,u)})).then(void 0,f),a;function c(i){u=i;do{if(!(o=t())||e(o)&&!o.v)return void h(a,1,u);if(o.then)return void o.then(v).then(void 0,f);e(u=n())&&(u=u.v)}while(!u||!u.then);u.then(c).then(void 0,f)}function v(t){t?(u=n())&&u.then?u.then(c).then(void 0,f):c(u):h(a,1,u)}}(function(){return o--},0,function(){return Promise.resolve(new Promise(function(t){return requestAnimationFrame(t)})).then(function(){})});return u&&u.then?u.then(i):i()})}catch(t){return Promise.reject(t)}},s.resize=function(){return this.M&&this.M.resize&&this.M.resize(),this},s.switchScene=function(t,i){return t&&(this.D=t,this.N=i),this},s.C=function(){return window.performance?performance.now():Date.now()},s.T=function(t){var i=this;if(this.A){this.A=window.requestAnimationFrame(this.T.bind(this));var n=this.O&&(!this.j||!this.R);n&&(this.P(),this.O=!1);for(var h=0;h<this.F;h++)this.I[h]=Math.max(this.I[h]-1,n?1:0);if(this.$||(this.$=t),this.H||(this.H=t),this.D&&!this.L&&(this.L=Promise.resolve(this.M?this.M.destroy():{}),this.L.then(function(n){i.D.callInit({run:i.W,scene:i.N,destroy:n},i),i.M=i.D,i.D=void 0,i.L=void 0,i.p=!1,i.k=i.M.currentTime(),i.H=t})),this.M&&(this.j&&(this.R=!this.R),!this.j||this.R)){var s=this.M.currentTime(),r=this.M.clampTime(s-this.k),e=this.M.shiftTime(r);if(r+=e,this.k=s+e,this.p){var o=0!==r||this._;this._=!1;var u=this.C();if(this.i.canvas[0].width)for(var a=0;a<this.F;a++)this.normContext(this.i.context[a]),this.M.initSprites(a);var f=this.M.isDrawFrame(r);if(Array.isArray(f))for(var c=0;c<this.F;c++)this.I[c]=Math.max(this.I[c],f[c],0);else for(var v=0;v<this.F;v++)this.I[v]=Math.max(this.I[v],f,0);if(o&&this.M.move(r),this.i.canvas[0].width)for(var l=0;l<this.F;l++)this.I[l]&&this.M.draw(l);if(this.S&&this.S.enabled){var d=t-this.$;if(this.S.currentWaitedTime<this.S.waitTime)this.S.currentWaitedTime+=d;else if(o){var m=this.S.offsetTimeTarget*(this.j?2:1),b=this.C()-u,M=(Math.abs(d-m)>Math.abs(b-m)?d:b)-m;Math.abs(M)<=this.S.offsetTimeDelta?this.S.currentOffsetTime=this.S.currentOffsetTime>=0?Math.max(0,this.S.currentOffsetTime-this.S.offsetTimeDelta):Math.min(0,this.S.currentOffsetTime+this.S.offsetTimeDelta):M<0&&this.S.currentScale>this.S.scaleLimitMin?(this.S.currentOffsetTime+=M,this.S.currentOffsetTime<=-this.S.offsetTimeLimitDown&&(this.S.currentScale=Math.max(this.S.scaleLimitMin,this.S.currentScale/this.S.scaleFactor),this.O=!0)):M>0&&this.S.currentScale<this.S.scaleLimitMax&&(this.S.currentOffsetTime+=M,this.S.currentOffsetTime>=this.S.offsetTimeLimitUp&&(this.S.currentScale=Math.min(this.S.scaleLimitMax,this.S.currentScale*this.S.scaleFactor),this.O=!0))}}}else{for(var g=0;g<this.F;g++)this.normContext(this.i.context[g]);this.p=this.M.callLoading({timePassed:t-this.$,totalTimePassed:t-this.H}),this.p&&(this.M.reset(),this.k=this.M.currentTime(),this._=!0,this.S&&(this.S.currentWaitedTime=0))}}this.$=t}},s.run=function(t){try{var i=this;return i.W=t||{},Promise.resolve(i.stop()).then(function(){function t(){return i.A=window.requestAnimationFrame(i.T.bind(i)),i}i.$=i.H=!1;var n=function(){if(i.S&&!i.S.offsetTimeTarget)return Promise.resolve(i.recalculateFPS()).then(function(){})}();return n&&n.then?n.then(t):t()})}catch(t){return Promise.reject(t)}},s.stop=function(){try{return window.cancelAnimationFrame(this.A),this.A=null,Promise.resolve(this.M?Promise.resolve(this.M.destroy()).then(function(t){}):void 0)}catch(t){return Promise.reject(t)}},s.destroy=function(){try{var t=this;return Promise.resolve(t.stop()).then(function(){return t.u.forEach(function(t){t.n.removeEventListener(t.e,t.f)}),t.u=[],t})}catch(t){return Promise.reject(t)}},t}(),r=function(){function t(){}return t.prototype.then=function(i,n){var s=new t,r=this.s;if(r){var e=1&r?i:n;if(e){try{h(s,1,e(this.v))}catch(t){h(s,2,t)}return s}return this}return this.o=function(t){try{var r=t.v;1&t.s?h(s,1,i?i(r):r):n?h(s,1,n(r)):h(s,2,r)}catch(t){h(s,2,t)}},s},t}();function e(t){return t instanceof r&&1&t.s}function o(t,i){for(var n=0;n<i.length;n++){var h=i[n];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}function u(t,i,n){return i&&o(t.prototype,i),n&&o(t,n),t}function a(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i}function f(t,i){return(f=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function v(t,i,n){return(v=c()?Reflect.construct:function(t,i,n){var h=[null];h.push.apply(h,i);var s=new(Function.bind.apply(t,h));return n&&f(s,n.prototype),s}).apply(null,arguments)}function l(t){if(null==t)throw new TypeError("Cannot destructure undefined")}function d(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,h=new Array(i);n<i;n++)h[n]=t[n];return h}function m(t){var i=0;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,i){if(t){if("string"==typeof t)return d(t,void 0);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,void 0):void 0}}(t)))return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(i=t[Symbol.iterator]()).next.bind(i)}var b=function(){function t(){this.Images={},this.count=0,this.loaded=0}return t.add=function(i,n){var h=this||t,s=function(t){if(h.Images[t])n&&"function"==typeof n[t]&&n[t](t,h.Images[t]);else{if(h.Images[t]=new window.Image,h.Images[t].onload=function(){h.loaded++,n&&"function"==typeof n?h.isLoaded()&&n():n&&"function"==typeof n[t]&&n[t](t,h.Images[t]),h.resolve&&h.isLoaded()&&(h.resolve(),h.resolve=null)},"<svg"===i[t].substr(0,4)){var s=window.URL||window.webkitURL||window,r=new window.Blob([i[t]],{type:"image/svg+xml"});h.Images[t].src=s.createObjectURL(r)}else/^(https?:)?\/\//.test(i[t])&&(h.Images[t].onerror=function(){var n=new window.Image;n.onload=h.Images[t].onload,h.Images[t]=n,h.Images[t].src=i[t]},h.Images[t].crossOrigin="anonymous"),h.Images[t].src=i[t];h.count++}};for(var r in i)s(r);return n&&"function"==typeof n&&h.isLoaded()&&n(),h.resolve&&h.isLoaded()&&(h.resolve(),h.resolve=null),h},t.reset=function(){var i=this||t;return i.Images={},i.count=0,i.loaded=0,i},t.getLoaded=function(){return(this||t).loaded},t.getCount=function(){return(this||t).count},t.isLoaded=function(){var i=this||t;return i.loaded===i.count},t.getImage=function(i){return"object"==typeof i?i:(this||t).Images[i]},t.isLoadedPromise=function(){var i=this||t;return!!i.isLoaded()||new Promise(function(t,n){i.resolve=t})},t}();b.Images={},b.count=0,b.loaded=0;var M=function(){function t(t){this.X=[],this.Y=[],this.U=0,this.B=0,this.J=void 0===t?[]:Array.isArray(t)?t:[t]}var i=t.prototype;return i.addElement=function(t){return this.addElementForId(t),t},i.addElements=function(t){return this.addElementsForIds(t),t},i.addElementForId=function(t){var i=this.X.length,n=this.B;this.X[n]=t,this.Y[n]="function"==typeof t,i===n&&i++;for(var h=this.B+1;h!==i&&this.X[h];)h++;return this.B=h,this.U>n&&(this.U=n),n},i.addElementsForIds=function(t){var i=this,n=this.X.length;return n===this.B?(this.X=this.X.concat(t),this.B=this.X.length,t.forEach(function(t,h){i.Y[n+h]="function"==typeof t}),Array.from({length:t.length},function(t,i){return i+n})):t.map(function(t){return i.addElement(t)})},i.getById=function(t){return this.X[t]},i.getIdByElement=function(t){return this.X.indexOf(t)},i.deleteByElement=function(t){var i=this.getIdByElement(t);i>=0&&this.deleteById(i)},i.deleteById=function(t){var i=this.X.length-1;if(i>0&&t===i){for(this.X[t]=null;i&&!this.X[i-1];)i--;this.X.length=i,this.Y.length=i,this.B=Math.min(this.B,i),this.U=Math.min(this.U,i)}else this.X[t]&&(this.X[t]=null,this.B=Math.min(this.B,t),this.U===t&&(this.U=t+1))},i.isCanvasId=function(t){return void 0===t||!this.J.length||this.J.includes(t)},i.forEach=function(t,i){var n,h;void 0===i&&(i=0);var s=this.X.length;for(n=this.U;n<s;n++)if((h=this.X[n])&&!1===t({elementId:n,layerId:i,element:h,isFunction:this.Y[n],layer:this}))return},i.getElementsByTag=function(t){var i=[];return this.forEach(function(n){if(!n.isFunction){var h=n.element.getElementsByTag(t);h&&(i=i.concat(h))}}),i},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.forEach(function(n){return!n.isFunction&&n.element.play(t,i)})},i.count=function(){for(var t=0,i=this.X.length,n=this.U;n<i;n++)this.X[n]&&t++;return t},i.clear=function(){this.X=[],this.Y=[],this.U=0,this.B=0},t}(),g=function(){function t(){this.G=[]}var i=t.prototype;return i.addLayer=function(t){return this.G[this.G.length]=new M(t),this.G[this.G.length-1]},i.addLayers=function(t,i){void 0===t&&(t=1);var n=Array.from({length:t},function(t){return new M(i)});return this.G=this.G.concat(n),n},i.addLayerForId=function(t){return this.G[this.G.length]=new M(t),this.G.length-1},i.addLayersForIds=function(t,i){var n=this;void 0===t&&(t=1);var h=Array.from({length:t},function(t,i){return i+n.G.length});return this.G=this.G.concat(Array.from({length:t},function(t){return new M(i)})),h},i.getById=function(t){return this.G[t]},i.forEach=function(t,i){var n,h=this.G.length;for(n=0;n<h&&(!this.G[n].isCanvasId(i)||!1!==this.G[n].forEach(t,n));n++);},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.forEach(function(n){return!n.isFunction&&n.element.play(t,i)})},i.getElementsByTag=function(t){var i=[];return this.forEach(function(n){if(!n.isFunction){var h=n.element.getElementsByTag(t);h&&(i=i.concat(h))}}),i},i.count=function(){return this.G.length},i.clear=function(){this.G=[]},t}();function y(){this.reset()}function p(t,i){return null==t||""===t?i:t}y.prototype.reset=function(){return this.m=[1,0,0,1,0,0],this},y.prototype.multiply=function(t){var i=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],h=this.m[1]*t.m[2]+this.m[3]*t.m[3],s=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],r=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=this.m[0]*t.m[0]+this.m[2]*t.m[1],this.m[1]=i,this.m[2]=n,this.m[3]=h,this.m[4]=s,this.m[5]=r,this},y.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),i=-this.m[1]*t,n=-this.m[2]*t,h=this.m[0]*t,s=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),r=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=this.m[3]*t,this.m[1]=i,this.m[2]=n,this.m[3]=h,this.m[4]=s,this.m[5]=r,this},y.prototype.rotate=function(t){var i=Math.cos(t),n=Math.sin(t),h=this.m[1]*i+this.m[3]*n,s=this.m[0]*-n+this.m[2]*i,r=this.m[1]*-n+this.m[3]*i;return this.m[0]=this.m[0]*i+this.m[2]*n,this.m[1]=h,this.m[2]=s,this.m[3]=r,this},y.prototype.translate=function(t,i){return this.m[4]+=this.m[0]*t+this.m[2]*i,this.m[5]+=this.m[1]*t+this.m[3]*i,this},y.prototype.scale=function(t,i){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=i,this.m[3]*=i,this},y.prototype.transformPoint=function(t,i){var n=t;return[t=n*this.m[0]+i*this.m[2]+this.m[4],i=n*this.m[1]+i*this.m[3]+this.m[5]]},y.prototype.clone=function(){var t=new y;return t.m=this.m.slice(0),t};var w=function(){function t(t){void 0===t&&(t={}),this.type="timing",this.V=t,this.Z=p(i(this.V.tickChunk),100/6),this.K=p(i(this.V.maxSkippedTickChunk),120),this.tt=p(i(this.V.tickChunkTolerance),.1),this.totalTimePassed=0}var n=t.prototype;return n.init=function(){},n.currentTime=function(){return window.performance?performance.now():Date.now()},n.clampTime=function(t){var i=t.timePassed,n=this.Z?this.Z*this.K:2e3;return i>n?n:i},n.shiftTime=function(t){return this.Z?-t.timePassed%this.Z:0},n.isChunked=function(){return this.Z},n.hasOneChunkedFrame=function(t){return t.timePassed>=this.Z-this.tt},n.calcFrames=function(t){return Math.min(this.K,Math.floor((t.timePassed+this.tt)/this.Z))},u(t,[{key:"tickChunk",get:function(){return this.Z}}]),t}(),k="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function x(t,i,n){if(!t.s){if(n instanceof O){if(!n.s)return void(n.o=x.bind(null,t,i));1&i&&(i=n.s),n=n.v}if(n&&n.then)return void n.then(x.bind(null,t,i),x.bind(null,t,2));t.s=i,t.v=n;var h=t.o;h&&h(t)}}var O=function(){function t(){}return t.prototype.then=function(i,n){var h=new t,s=this.s;if(s){var r=1&s?i:n;if(r){try{x(h,1,r(this.v))}catch(t){x(h,2,t)}return h}return this}return this.o=function(t){try{var s=t.v;1&t.s?x(h,1,i?i(s):s):n?x(h,1,n(s)):x(h,2,s)}catch(t){x(h,2,t)}},h},t}();function A(t){return t instanceof O&&1&t.s}var S=function(){function t(){this.it=new g,this.nt=0,this.ht=b,this.middlewares=[].slice.call(arguments),this.middlewareByType("timing")||(this.middlewares=[w].concat(this.middlewares))}var h=t.prototype;return h.middlewareByType=function(t){var i=this.rt.st.filter(function(i){return i.type==t});if(i.length)return i[i.length-1]},h.has=function(t){return t in this.rt||this.rt.st.filter(function(i){return t in i}).length>0},h.do=function(t,i,n,h){var s=this.rt[t]||this.rt.st.filter(function(i){return t in i});return(s=s.filter(function(t){return t.enabled})).length?h(s,this.et(i),n):n},h.map=function(t,i){return void 0===i&&(i={}),this.do(t,i,[],function(i,n){return i.map(function(i){return i[t](n)})})},h.pipe=function(t,i,n){var h=this;return void 0===i&&(i={}),this.do(t,i,n,function(i,s){var r=n;h.ot=!1;for(var e,o=m(i);!(e=o()).done&&(r=e.value[t](s,r),!h.ot););return r})},h.pipeBack=function(t,i,n){var h=this;return void 0===i&&(i={}),this.do(t,i,n,function(i,s){var r=n;h.ot=!1;for(var e=i.length-1;e>=0&&(r=i[e][t](s,r),!h.ot);e--);return r})},h.pipeMax=function(t,i,n){var h=this;return void 0===i&&(i={}),this.do(t,i,n,function(i,s){var r=n;h.ot=!1;for(var e,o=function(){var i=e.value[t](s,r);if(r=Array.isArray(i)?Array.isArray(r)?r.map(function(t,n){return Math.max(t,i[n])}):i.map(function(t){return Math.max(t,r)}):Array.isArray(r)?r.map(function(t,n){return Math.max(t,i)}):Math.max(i,r),h.ot)return"break"},u=m(i);!(e=u()).done&&"break"!==o(););return r})},h.pipeAsync=function(t,i,n){var h=this;return void 0===i&&(i={}),this.do(t,i,n,function(i,s){try{var r,e=n;h.ot=!1;var o=function(t,i,n){if("function"==typeof t[k]){var h,s,r,e=t[k]();if(function t(o){try{for(;!((h=e.next()).done||n&&n());)if((o=i(h.value))&&o.then){if(!A(o))return void o.then(t,r||(r=x.bind(null,s=new O,2)));o=o.v}s?x(s,1,o):s=o}catch(t){x(s||(s=new O),2,t)}}(),e.return){var o=function(t){try{h.done||e.return()}catch(t){}return t};if(s&&s.then)return s.then(o,function(t){throw o(t)});o()}return s}if(!("length"in t))throw new TypeError("Object is not iterable");for(var u=[],a=0;a<t.length;a++)u.push(t[a]);return function(t,i,n){var h,s,r=-1;return function e(o){try{for(;++r<t.length&&(!n||!n());)if((o=i(r))&&o.then){if(!A(o))return void o.then(e,s||(s=x.bind(null,h=new O,2)));o=o.v}h?x(h,1,o):h=o}catch(t){x(h||(h=new O),2,t)}}(),h}(u,function(t){return i(u[t])},n)}(i,function(i){return Promise.resolve(i[t](s,e)).then(function(t){e=t,h.ot&&(r=1)})},function(){return r});return Promise.resolve(o&&o.then?o.then(function(){return e}):e)}catch(t){return Promise.reject(t)}})},h.value=function(t,n){void 0===n&&(n={});var h=this.rt[t]||this.rt.st.filter(function(i){return t in i});if(h.filter(function(t){return t.enabled}),h.length){var s=h[h.length-1];return i(s[t],s,this.et(n))}},h.stopPropagation=function(){this.ot=!0},h.currentTime=function(){return this.pipe("currentTime")},h.clampTime=function(t){return this.pipe("clampTime",{timePassed:t})},h.shiftTime=function(t){return this.pipe("shiftTime",{timePassed:t})},h.cacheClear=function(){this.ut=0,this.at=0},h.viewport=function(){return this.ft?(this.ut||(this.ut=this.pipe("viewport",{},new y),this.at=null),this.ut):new y},h.transformPoint=function(t,i,n){return void 0===n&&(n=this.ct.scaleCanvas),this.at||(this.at=this.viewport().clone().invert()),this.at.transformPoint(t*n,i*n)},h.callInit=function(t,i){var n=this;this.ft=i,this.resize();var h=this.value("images");h&&this.ht.add(h),Promise.all(this.map("init",{parameter:t})).then(function(t){return n.vt=!0})},h.updateAdditionalModifier=function(){var t=this.i;this.ct=this.pipe("additionalModifier",{},{alpha:1,x:0,y:0,width:t.width,height:t.height,widthInPixel:t.width,heightInPixel:t.height,scaleCanvas:1,visibleScreen:{x:0,y:0,width:t.width,height:t.height},fullScreen:{x:0,y:0,width:t.width,height:t.height}})},h.resize=function(){var t=this,i=this.i;this.updateAdditionalModifier(),this.pipe("resize"),this.it.forEach(function(n){n.isFunction||n.element.resize(i,t.ct)})},h.destroy=function(){try{var t=this;return Promise.resolve(t.pipeAsync("destroy")).then(function(i){return t.vt=!1,i})}catch(t){return Promise.reject(t)}},h.et=function(t){return Object.assign({engine:this.ft,scene:this,imageManager:this.ht,layerManager:this.it,totalTimePassed:this.nt,output:this.ft&&this.i},t)},h.callLoading=function(t){return this.ht.isLoaded()&&this.vt?(this.lt=this.value("endTime"),t.progress="Click to play",this.value("loading",t),!0):(t.progress=this.ht.getCount()?this.ht.getLoaded()/this.ht.getCount():"Loading...",this.value("loading",t),!1)},h.fixedUpdate=function(t,i){this.map("fixedUpdate",{timePassed:t,lastCall:i})},h.isDrawFrame=function(t){return this.pipeMax("isDrawFrame",{timePassed:t},0!==t)},h.move=function(t){if(this.nt+=t,this.dt?this.reset():t<0?(t=this.nt,this.reset(),this.initSprites(),this.nt=t):this.lt&&this.lt<=this.nt&&(t-=this.nt-this.lt,this.nt=this.lt,this.map("end",{timePassed:t})),this.value("isChunked")){if(this.value("hasOneChunkedFrame",{timePassed:t}))for(var i=this.value("calcFrames",{timePassed:t})-1,n=0;n<=i;n++)this.fixedUpdate(this.value("tickChunk"),n===i)}else this.fixedUpdate(t,!0);this.map("update",{timePassed:t}),this.it.forEach(function(i){var n=i.layer,h=i.elementId;i.isFunction||i.element.animate(t)&&n.deleteById(h)})},h.draw=function(t){var i=this;this.map("draw",{canvasId:t});var n=this.i.context[t];n.save(),n.setTransform.apply(n,this.viewport().m),this.it.forEach(function(t){var h=t.layer,s=t.element,r=t.elementId;t.isFunction?s(i.et({layerId:t.layerId,elementId:r,layer:h,context:n}))&&h.deleteById(r):s.draw(n,i.ct)},t),n.restore()},h.initSprites=function(t){var i=this,n=this.i.context[t];this.it.forEach(function(t){t.isFunction||t.element.callInit(n,i.ct)},t),this.map("initSprites",{canvasId:t})},h.resetIntend=function(){this.dt=!0},h.reset=function(){this.nt=0,this.dt=!1;var t=this.pipe("reset",{engine:this.ft,scene:this,layerManager:this.it,imageManager:this.ht},new g);if(Array.isArray(t)){var i=t;t=new g,i.forEach(function(i){t.addLayer().addElements(i)})}t&&(this.it=t)},u(t,[{key:"_output",get:function(){return this.ft.getOutput()}},{key:"middlewares",set:function(t){this.rt=n(t).map(function(t){return"function"==typeof t?new t:t}).reduce(function(t,i){for(var n=0,h=Object.keys(t);n<h.length;n++){var s=h[n];s in i&&t[s].push(i)}return t.st.push(i),"enabled"in i||(i.enabled=!0),i.type&&(t["t_"+i.type]=i),t},{st:[],init:[],isDrawFrame:[],initSprites:[],fixedUpdate:[],update:[],draw:[],destroy:[],reset:[],resize:[],currentTime:[],clampTime:[],shiftTime:[],isChunked:[],hasOneChunkedFrame:[],calcFrames:[],tickChunk:[],additionalModifier:[]})},get:function(){return this.rt.st}},{key:"additionalModifier",get:function(){return this.ct}},{key:"timing",get:function(){return this.rt.t_timing}},{key:"camera",get:function(){return this.rt.t_camera}},{key:"control",get:function(){return this.rt.t_control}},{key:"totalTimePassed",get:function(){return this.nt}}]),t}(),P=function(){function t(t){this.duration=i(t)-0}return t.prototype.run=function(t,i){return i-this.duration},t}(),F=function(){function t(){var t=[].slice.call(arguments),i=0;"number"==typeof t[0]&&(i=t.shift()),this.sequences=t.map(function(t){Array.isArray(t)||(t=[t]);var n=i;return"number"==typeof t[0]&&(n=t.shift()),{position:0,timelapsed:-n,sequence:t.map(function(t){return"function"!=typeof t.run?"number"==typeof t?new P(t):{run:t}:t}).filter(function(t){return"function"==typeof t.run}),label:t.reduce(function(t,i,n){return"string"==typeof i&&(t[i]=n-Object.keys(t).length),t},{}),enabled:!0}}),this.lastTimestamp=0,this.enabled=!0}var i=t.prototype;return i.reset=function(t){void 0===t&&(t=0),this.sequences.forEach(function(i){i.enabled=!0,i.position=0,i.timelapsed=t,i.sequence[0]&&i.sequence[0].reset&&i.sequence[0].reset(t)}),this.enabled=!0},i.play=function(t,i){if(void 0===t&&(t=""),void 0===i&&(i=0),t){var n=this.sequences.reduce(function(n,h){return h.label.hasOwnProperty(t)?(n=!0,h.position=h.label[t],h.enabled=!0,h.timelapsed=i,h.sequence[h.position]&&h.sequence[h.position].reset&&h.sequence[h.position].reset()):n|=h.sequence.find(function(n){return n.play&&n.play(t,i)})>=0,n},!1);return n&&(this.enabled=!0),n}return this.sequences.forEach(function(t){return t.enabled=!0}),this.enabled=!0,!0},i.bt=function(i,n,h){for(var s=h;n.sequence[n.position]&&s>=0;){if(n.timelapsed+=s,n.timelapsed<0)return-1;if(!0===(s=n.sequence[n.position].run(i,n.timelapsed)))s=0;else{if(!1===s)return-1;if(s===t.Mt)return n.enabled=!1,this.enabled=!1,h;if(s===t.gt)return n.enabled=!1,h;if(s===t.yt)return!0}if(s>=0&&(n.position=(n.position+1)%n.sequence.length,n.sequence[n.position]&&n.sequence[n.position].reset&&n.sequence[n.position].reset(),n.timelapsed=0,0===n.position))return n.enabled=!1,s}return s},i.run=function(t,i,n){var h=i;if(n||(h=i-this.lastTimestamp,this.lastTimestamp=i),!this.enabled)return h;for(var s=this.sequences.length,r=0,e=Infinity,o=0;o<s;o++)if(this.sequences[o].enabled){var u=this.bt(t,this.sequences[o],h);if(!0===u)return!0;e=Math.min(e,u)}else r++;return r===s?(this.enabled=!1,h):e},t}();F.Mt="F",F.gt="S",F.yt="R";var I=function(){function t(t){this.pt(this,this.wt(),t),this.kt=!0}var n=t.prototype;return n.pt=function(t,n,h){Object.keys(n).forEach(function(s){var r=n[s];t[s]="function"==typeof r?r(h[s],h,t):p(i(h[s]),r)})},n.xt=function(){return{animation:function(t,n){var h=i(t);return Array.isArray(h)?new F(h):h},enabled:!0,isClickable:!1,tag:function(t){return Array.isArray(t)?t:t?[t]:[]}}},n.wt=function(){return Object.assign({},this.xt(),{x:0,y:0,rotation:function(t,n){return p(i(t),p(i(n.rotationInRadian),.017453292519943295*p(i(n.rotationInDegree),0)))},scaleX:function(t,n){return p(i(t),p(i(n.scale),1))},scaleY:function(t,n){return p(i(t),p(i(n.scale),1))},alpha:1,compositeOperation:"source-over",color:"#fff"})},n.getElementsByTag=function(t){var i=this;if("function"==typeof t){if(this.tag.filter(t).length)return[this]}else if((Array.isArray(t)?t:[t]).filter(function(t){return i.tag.includes(t)}).length)return[this];return[]},n.animate=function(t){return!(!this.animation||!0!==this.animation.run(this,t,!0)||(this.enabled=!1,0))},n.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.animation&&this.animation.play&&this.animation.play(t,i)},n.init=function(t,i){},n.callInit=function(t,i){this.kt&&(this.init(t,i),this.kt=!1)},n.resize=function(t,i){},n.Ot=function(t,i,n,h,s){var r=!1;if(this.enabled&&this.isClickable){var e=this.width/2,o=this.height/2;t.save(),h?t.translate(this.x+e,this.y+o):t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.beginPath(),s?r=s(e,o):(t.rect(-e,-o,this.width,this.height),t.closePath(),r=t.isPointInPath(i,n)),t.restore()}return!!r&&this},n.detectDraw=function(t,i){},n.detect=function(t,i,n){var h=this;return this.Ot(t,i,n,!1,function(){return t.arc(0,0,1,Math.PI/2+h.rotation,2.5*Math.PI-h.rotation,!1),t.isPointInPath(i,n)})},n.draw=function(t,i){this.enabled&&(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.beginPath(),t.fillStyle=this.color,t.arc(0,0,1,Math.PI/2+this.rotation,2.5*Math.PI-this.rotation,!1),t.fill(),t.restore())},t}(),j=function(t){function i(i){var n;return"function"==typeof i&&(i={callback:i}),(n=t.call(this,i)||this).At=0,n.St=0,n}a(i,t);var n=i.prototype;return n.wt=function(){return Object.assign({},this.xt(),{callback:function(t){return void 0===typeof t?function(){}:t}})},n.animate=function(i){return this.enabled&&(this.At+=i,this.St+=i),t.prototype.animate.call(this,i)},n.detect=function(t,i){},n.draw=function(t,i){this.enabled&&this.callback(t,this.At,i,this),this.St=0},i}(I),C=function(t){function i(i){return t.call(this,i)||this}a(i,t);var n=i.prototype;return n.wt=function(){return Object.assign({},t.prototype.wt.call(this),{sprite:[]})},n.getElementsByTag=function(i){for(var n,h=t.prototype.getElementsByTag.call(this,i),s=m(this.sprite);!(n=s()).done;){var r=n.value.getElementsByTag(i);r&&(h=h.concat(r))}return h},n.animate=function(i){var n=t.prototype.animate.call(this,i),h=!1;if(this.enabled)for(var s,r=m(this.sprite);!(s=r()).done;)h=h||!0===s.value.animate(i);return this.animation?n:(h&&(this.enabled=!1),h)},n.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.animation&&this.animation.play&&this.animation.play(t,i);for(var n,h=m(this.sprite);!(n=h()).done;){var s=n.value;s.play&&s.play(t,i)}},n.resize=function(t,i){for(var n,h=m(this.sprite);!(n=h()).done;)n.value.resize(t,i)},n.callInit=function(i,n){t.prototype.callInit.call(this,i,n);for(var h,s=m(this.sprite);!(h=s()).done;)h.value.callInit(i,n)},n.detectImage=function(t,i){if(this.enabled)for(var n,h=m(this.sprite);!(n=h()).done;)n.value.detectImage(t,i)},n.detect=function(t,i,n){if(this.enabled)for(var h,s=m(this.sprite);!(h=s()).done;){var r=h.value.detect(t,i,n);if(r)return r}return!1},n.draw=function(t,i){if(this.enabled){this.alpha<1&&((i=Object.assign({},i)).alpha*=this.alpha),t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation);for(var n,h=m(this.sprite);!(n=h()).done;)n.value.draw(t,i);t.restore()}},i}(I),$=function(t){function n(i){var n;return(n=t.call(this,i)||this).Pt=!1,n.I=2,n}a(n,t);var h=n.prototype;return h.wt=function(){return Object.assign({},t.prototype.wt.call(this),{x:void 0,y:void 0,width:void 0,height:void 0,canvasWidth:void 0,canvasHeight:void 0,gridSize:void 0,norm:function(t,n,h){return p(i(t),void 0===h.x&&void 0===h.y&&void 0===h.width&&void 0===h.height)},isDrawFrame:function(t,i,n){return p(t,!0)}})},h.Ft=function(t){var i=t.widthInPixel,n=t.heightInPixel;this.It=document.createElement("canvas"),this.canvasWidth&&this.canvasHeight?(this.It.width=this.canvasWidth,this.It.height=this.canvasHeight):this.gridSize?(this.Pt=this.gridSize,this.It.width=Math.round(this.Pt),this.It.height=Math.round(this.Pt)):(this.It.width=Math.round(i/this.scaleX),this.It.height=Math.round(n/this.scaleY)),this.jt=this.It.getContext("2d")},h.normalizeFullScreen=function(t){(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y),(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height)},h.resize=function(i,n){if(this.It&&this.Pt!==this.gridSize&&!this.canvasWidth){var h=this.It;this.Ft(n),this.jt.globalCompositeOperation="copy",this.jt.drawImage(h,0,0,h.width,h.height,0,0,this.It.width,this.It.height),this.jt.globalCompositeOperation="source-over",this.I=2}this.normalizeFullScreen(n),t.prototype.resize.call(this,i,n)},h.detect=function(t,i,n){return this.Ot(t,i,n,!1)},h.init=function(t,i){this.Ft(i),this.normalizeFullScreen(i)},h.draw=function(t,n){if(this.enabled){this.gridSize&&this.Pt!==this.gridSize&&this.resize(n),this.I=Math.max(this.I-1,i(this.isDrawFrame,t,n));var h=this.width,s=this.height,r=h/2,e=s/2,o=this.It.width,u=this.It.height;if(this.I){this.jt.textBaseline="middle",this.jt.textAlign="center",this.jt.globalAlpha=1,this.jt.globalCompositeOperation="source-over",this.jt.save();var a=n.cam;if(this.norm&&a){var f=Math.max(o,u)/2;this.jt.translate(o/2,u/2),this.jt.scale(f,f),this.jt.scale(a.zoom,a.zoom),this.jt.translate(-a.x,-a.y)}for(var c,v=m(this.sprite);!(c=v()).done;)c.value.draw(this.jt,this.norm?Object.assign({},n,{alpha:1,widthInPixel:o,heightInPixel:u}):{alpha:1,x:0,y:0,width:o,height:u,widthInPixel:o,heightInPixel:u,visibleScreen:{x:0,y:0,width:o,height:u}});this.jt.restore()}t.save(),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*n.alpha,t.translate(this.x+r,this.y+e),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.drawImage(this.It,0,0,o,u,-r,-e,h,s),t.restore()}},n}(C),T=function(t){function n(n){var h;h=t.call(this,n.self||{})||this;var s=p(i(n.count),1);h.sprite=[];for(var r=n.class,e=0;e<s;e++){var o={};for(var u in n)["self","class","count"].includes(u)||(o[u]="function"==typeof n[u]?n[u].call(n,e):n[u]);h.sprite[e]=new r(o)}return h}return a(n,t),n}(C),E=function(t){function n(i){var n;return(n=t.call(this,i)||this).Pt=!1,n}a(n,t);var h=n.prototype;return h.wt=function(){return Object.assign({},t.prototype.wt.call(this),{x:void 0,y:void 0,width:void 0,height:void 0,gridSize:void 0,darker:0,pixel:!1,clear:!1,norm:function(t,n,h){return p(i(t),void 0===h.x&&void 0===h.y&&void 0===h.width&&void 0===h.height)}})},h.Ft=function(t){var i=t.widthInPixel,n=t.heightInPixel;this.It=document.createElement("canvas"),this.gridSize?(this.Pt=this.gridSize,this.It.width=Math.round(this.Pt),this.It.height=Math.round(this.Pt)):(this.It.width=Math.ceil(i/this.scaleX),this.It.height=Math.ceil(n/this.scaleY)),this.jt=this.It.getContext("2d"),this.jt.globalCompositeOperation="source-over",this.jt.globalAlpha=1},h.normalizeFullScreen=function(t){(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y),(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height)},h.resize=function(t,i){if(this.It&&this.Pt!==this.gridSize){var n=this.It;this.Ft(i),this.jt.globalCompositeOperation="copy",this.jt.drawImage(n,0,0,n.width,n.height,0,0,this.It.width,this.It.height),this.jt.globalCompositeOperation="source-over"}this.normalizeFullScreen(i)},h.detect=function(t,i,n){return this.Ot(t,i,n,!1)},h.init=function(t,i){this.Ft(i),this.normalizeFullScreen(i)},h.draw=function(t,i){if(this.enabled&&this.alpha>0){this.gridSize&&this.Pt!==this.gridSize&&this.resize(t,i);var n=this.alpha*i.alpha,h=this.width,s=this.height,r=this.It.width,e=this.It.height;if(n>0&&r&&e){this.jt.globalCompositeOperation="copy",this.jt.globalAlpha=1,this.jt.drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height,0,0,r,e),this.darker>0&&(this.jt.globalCompositeOperation=this.clear?"source-atop":"source-over",this.jt.fillStyle="rgba(0,0,0,"+this.darker+")",this.jt.fillRect(0,0,r,e)),this.additionalBlur&&this.additionalBlur(r,e,i),this.clear&&(t.globalCompositeOperation="source-over",t.globalAlpha=1,t.clearRect(this.x,this.y,h,s)),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=n;var o=t.imageSmoothingEnabled;t.imageSmoothingEnabled=!this.pixel,t.drawImage(this.It,0,0,r,e,this.x,this.y,h,s),t.imageSmoothingEnabled=o}}else this.clear&&(this.x||(this.x=i.x),this.y||(this.y=i.y),this.width||(this.width=i.width),this.height||(this.height=i.height),t.clearRect(this.x,this.y,this.width,this.height))},n}(I),D=function(t){function n(i){var n;return(n=t.call(this,i)||this).Ct=!1,n}a(n,t);var h=n.prototype;return h.wt=function(){return Object.assign({},t.prototype.wt.call(this),{image:function(t){return b.getImage(i(t))},position:n.CENTER,frameX:0,frameY:0,frameWidth:0,frameHeight:0,width:void 0,height:void 0,norm:!1,normCover:!1,normToScreen:!1,clickExact:!1,color:"#FFF",tint:0})},h.resize=function(t,i){this.kt=!0},h.init=function(t,i){var n=this.frameWidth||this.image.width,h=this.frameHeight||this.image.height;this.$t=this.normToScreen?this.normCover?Math.max(i.fullScreen.width/n,i.fullScreen.height/h):this.norm?Math.min(i.fullScreen.width/n,i.fullScreen.height/h):1:this.normCover?Math.max(i.width/n,i.height/h):this.norm?Math.min(i.width/n,i.height/h):1},h.Tt=function(){return[this.tint,this.frameWidth||this.image.width,this.frameHeight||this.image.height,this.color,this.frameX,this.frameY].join(";")},h.Et=function(t,i){return this.It||(this.It=document.createElement("canvas"),this.jt=this.It.getContext("2d")),this.It.width=t,this.It.height=i,this.jt},h.detectDraw=function(t,i){if(this.enabled&&this.isClickable&&this.clickExact){var h=this.frameWidth||this.image.width,s=this.frameHeight||this.image.height,r=(this.width?this.width:h)*this.$t*this.scaleX,e=(this.height?this.height:s)*this.$t*this.scaleY,o=this.position===n.LEFT_TOP,u=this.Et(h,s);u.globalAlpha=1,u.globalCompositeOperation="source-over",u.fillStyle=i,u.fillRect(0,0,h,s),u.globalCompositeOperation="destination-atop",u.drawImage(this.image,this.frameX,this.frameY,h,s,0,0,h,s),t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.drawImage(this.It,0,0,h,s,o?0:-r/2,o?0:-e/2,r,e),t.restore(),this.Ct=!1}},h.detect=function(t,i,n){return this.enabled&&this.isClickable&&this.clickExact?"c":this.Ot(t,i,n,!1)},h.draw=function(t,i){if(this.enabled&&this.image&&this.alpha>0){var h=this.frameWidth||this.image.width,s=this.frameHeight||this.image.height,r=(this.width?this.width:h)*this.$t*this.scaleX,e=(this.height?this.height:s)*this.$t*this.scaleY;t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha;var o=this.position===n.LEFT_TOP;if(this.tint&&this.Ct!==this.Tt()){var u=this.Et(h,s);u.globalAlpha=1,u.globalCompositeOperation="source-over",u.clearRect(0,0,h,s),u.globalAlpha=this.tint,u.fillStyle=this.color,u.fillRect(0,0,h,s),u.globalAlpha=1,u.globalCompositeOperation="destination-atop",u.drawImage(this.image,this.frameX,this.frameY,h,s,0,0,h,s),this.Ct=this.Tt()}0==this.rotation?o?t.drawImage(this.tint?this.It:this.image,this.tint?0:this.frameX,this.tint?0:this.frameY,h,s,this.x,this.y,r,e):t.drawImage(this.tint?this.It:this.image,this.tint?0:this.frameX,this.tint?0:this.frameY,h,s,this.x-r/2,this.y-e/2,r,e):(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.drawImage(this.tint?this.It:this.image,this.tint?0:this.frameX,this.tint?0:this.frameY,h,s,o?0:-r/2,o?0:-e/2,r,e),t.restore())}},n}(I);D.LEFT_TOP=0,D.CENTER=1;var q=function(t){function i(i){return t.call(this,i)||this}a(i,t);var n=i.prototype;return n.wt=function(){return Object.assign({},t.prototype.wt.call(this),{text:void 0,font:"2em monospace",position:i.CENTER,color:void 0,borderColor:void 0,lineWidth:1})},n.detectDraw=function(t,i){this.enabled&&this.isClickable&&(t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),this.position||(t.textAlign="left",t.textBaseline="top"),t.font=this.font,t.fillStyle=i,t.fillText(this.text,0,0),t.restore())},n.detect=function(t,i){return"c"},n.draw=function(t,i){this.enabled&&(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,t.save(),this.position||(t.textAlign="left",t.textBaseline="top"),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.font=this.font,this.color&&(t.fillStyle=this.color,t.fillText(this.text,0,0)),this.borderColor&&(t.strokeStyle=this.borderColor,t.lineWidth=this.lineWidth,t.strokeText(this.text,0,0)),t.restore())},i}(I);function N(t,i){(function(t){return"string"==typeof t&&t.includes(".")&&1===parseFloat(t)})(t)&&(t="100%");const n=function(t){return"string"==typeof t&&t.includes("%")}(t);return t=360===i?t:Math.min(i,Math.max(0,parseFloat(t))),n&&(t=parseInt(String(t*i),10)/100),Math.abs(t-i)<1e-6?1:t=360===i?(t<0?t%i+i:t%i)/parseFloat(String(i)):t%i/parseFloat(String(i))}function R(t){return Math.min(1,Math.max(0,t))}function z(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function H(t){return t<=1?100*Number(t)+"%":t}function L(t){return 1===t.length?"0"+t:String(t)}function W(t,i,n){t=N(t,255),i=N(i,255),n=N(n,255);const h=Math.max(t,i,n),s=Math.min(t,i,n);let r=0,e=0;const o=(h+s)/2;if(h===s)e=0,r=0;else{const u=h-s;switch(e=o>.5?u/(2-h-s):u/(h+s),h){case t:r=(i-n)/u+(i<n?6:0);break;case i:r=(n-t)/u+2;break;case n:r=(t-i)/u+4}r/=6}return{h:r,s:e,l:o}}function _(t,i,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*n*(i-t):n<.5?i:n<2/3?t+(i-t)*(2/3-n)*6:t}function X(t,i,n){t=N(t,255),i=N(i,255),n=N(n,255);const h=Math.max(t,i,n),s=Math.min(t,i,n);let r=0;const e=h,o=h-s,u=0===h?0:o/h;if(h===s)r=0;else{switch(h){case t:r=(i-n)/o+(i<n?6:0);break;case i:r=(n-t)/o+2;break;case n:r=(t-i)/o+4}r/=6}return{h:r,s:u,v:e}}function Y(t,i,n,h){const s=[L(Math.round(t).toString(16)),L(Math.round(i).toString(16)),L(Math.round(n).toString(16))];return h&&s[0].startsWith(s[0].charAt(1))&&s[1].startsWith(s[1].charAt(1))&&s[2].startsWith(s[2].charAt(1))?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function U(t){return B(t)/255}function B(t){return parseInt(t,16)}q.LEFT_TOP=0,q.CENTER=1;const J={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},Q="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",G=`[\\s|\\(]+(${Q})[,|\\s]+(${Q})[,|\\s]+(${Q})\\s*\\)?`,V=`[\\s|\\(]+(${Q})[,|\\s]+(${Q})[,|\\s]+(${Q})[,|\\s]+(${Q})\\s*\\)?`,Z={CSS_UNIT:new RegExp(Q),rgb:new RegExp("rgb"+G),rgba:new RegExp("rgba"+V),hsl:new RegExp("hsl"+G),hsla:new RegExp("hsla"+V),hsv:new RegExp("hsv"+G),hsva:new RegExp("hsva"+V),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function K(t){return Boolean(Z.CSS_UNIT.exec(String(t)))}class tt{constructor(t="",i={}){var n;if(t instanceof tt)return t;"number"==typeof t&&(t=function(t){return{r:t>>16,g:(65280&t)>>8,b:255&t}}(t)),this.originalInput=t;const h=function(t){let i={r:0,g:0,b:0},n=1,h=null,s=null,r=null,e=!1,o=!1;var u,a;return"string"==typeof t&&(t=function(t){if(0===(t=t.trim().toLowerCase()).length)return!1;let i=!1;if(J[t])t=J[t],i=!0;else if("transparent"===t)return{r:0,g:0,b:0,a:0,format:"name"};let n=Z.rgb.exec(t);return n?{r:n[1],g:n[2],b:n[3]}:(n=Z.rgba.exec(t),n?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=Z.hsl.exec(t),n?{h:n[1],s:n[2],l:n[3]}:(n=Z.hsla.exec(t),n?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=Z.hsv.exec(t),n?{h:n[1],s:n[2],v:n[3]}:(n=Z.hsva.exec(t),n?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=Z.hex8.exec(t),n?{r:B(n[1]),g:B(n[2]),b:B(n[3]),a:U(n[4]),format:i?"name":"hex8"}:(n=Z.hex6.exec(t),n?{r:B(n[1]),g:B(n[2]),b:B(n[3]),format:i?"name":"hex"}:(n=Z.hex4.exec(t),n?{r:B(n[1]+n[1]),g:B(n[2]+n[2]),b:B(n[3]+n[3]),a:U(n[4]+n[4]),format:i?"name":"hex8"}:(n=Z.hex3.exec(t),!!n&&{r:B(n[1]+n[1]),g:B(n[2]+n[2]),b:B(n[3]+n[3]),format:i?"name":"hex"})))))))))}(t)),"object"==typeof t&&(K(t.r)&&K(t.g)&&K(t.b)?(u=t.g,a=t.b,i={r:255*N(t.r,255),g:255*N(u,255),b:255*N(a,255)},e=!0,o="%"===String(t.r).substr(-1)?"prgb":"rgb"):K(t.h)&&K(t.s)&&K(t.v)?(h=H(t.s),s=H(t.v),i=function(t,i,n){t=6*N(t,360),i=N(i,100),n=N(n,100);const h=Math.floor(t),s=t-h,r=n*(1-i),e=n*(1-s*i),o=n*(1-(1-s)*i),u=h%6;return{r:255*[n,e,r,r,o,n][u],g:255*[o,n,n,e,r,r][u],b:255*[r,r,o,n,n,e][u]}}(t.h,h,s),e=!0,o="hsv"):K(t.h)&&K(t.s)&&K(t.l)&&(h=H(t.s),r=H(t.l),i=function(t,i,n){let h,s,r;if(t=N(t,360),i=N(i,100),n=N(n,100),0===i)s=n,r=n,h=n;else{const e=n<.5?n*(1+i):n+i-n*i,o=2*n-e;h=_(o,e,t+1/3),s=_(o,e,t),r=_(o,e,t-1/3)}return{r:255*h,g:255*s,b:255*r}}(t.h,h,r),e=!0,o="hsl"),Object.prototype.hasOwnProperty.call(t,"a")&&(n=t.a)),n=z(n),{ok:e,format:t.format||o,r:Math.min(255,Math.max(i.r,0)),g:Math.min(255,Math.max(i.g,0)),b:Math.min(255,Math.max(i.b,0)),a:n}}(t);this.originalInput=t,this.r=h.r,this.g=h.g,this.b=h.b,this.a=h.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(n=i.format)&&void 0!==n?n:h.format,this.gradientType=i.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=h.ok}isDark(){return this.getBrightness()<128}isLight(){return!this.isDark()}getBrightness(){const t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3}getLuminance(){const t=this.toRgb();let i,n,h;const s=t.r/255,r=t.g/255,e=t.b/255;return i=s<=.03928?s/12.92:((s+.055)/1.055)**2.4,n=r<=.03928?r/12.92:((r+.055)/1.055)**2.4,h=e<=.03928?e/12.92:((e+.055)/1.055)**2.4,.2126*i+.7152*n+.0722*h}getAlpha(){return this.a}setAlpha(t){return this.a=z(t),this.roundA=Math.round(100*this.a)/100,this}toHsv(){const t=X(this.r,this.g,this.b);return{h:360*t.h,s:t.s,v:t.v,a:this.a}}toHsvString(){const t=X(this.r,this.g,this.b),i=Math.round(360*t.h),n=Math.round(100*t.s),h=Math.round(100*t.v);return 1===this.a?`hsv(${i}, ${n}%, ${h}%)`:`hsva(${i}, ${n}%, ${h}%, ${this.roundA})`}toHsl(){const t=W(this.r,this.g,this.b);return{h:360*t.h,s:t.s,l:t.l,a:this.a}}toHslString(){const t=W(this.r,this.g,this.b),i=Math.round(360*t.h),n=Math.round(100*t.s),h=Math.round(100*t.l);return 1===this.a?`hsl(${i}, ${n}%, ${h}%)`:`hsla(${i}, ${n}%, ${h}%, ${this.roundA})`}toHex(t=!1){return Y(this.r,this.g,this.b,t)}toHexString(t=!1){return"#"+this.toHex(t)}toHex8(t=!1){return function(t,i,n,h,s){const r=[L(Math.round(t).toString(16)),L(Math.round(i).toString(16)),L(Math.round(n).toString(16)),L((e=h,Math.round(255*parseFloat(e)).toString(16)))];var e;return s&&r[0].startsWith(r[0].charAt(1))&&r[1].startsWith(r[1].charAt(1))&&r[2].startsWith(r[2].charAt(1))&&r[3].startsWith(r[3].charAt(1))?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0)+r[3].charAt(0):r.join("")}(this.r,this.g,this.b,this.a,t)}toHex8String(t=!1){return"#"+this.toHex8(t)}toRgb(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}}toRgbString(){const t=Math.round(this.r),i=Math.round(this.g),n=Math.round(this.b);return 1===this.a?`rgb(${t}, ${i}, ${n})`:`rgba(${t}, ${i}, ${n}, ${this.roundA})`}toPercentageRgb(){const t=t=>Math.round(100*N(t,255))+"%";return{r:t(this.r),g:t(this.g),b:t(this.b),a:this.a}}toPercentageRgbString(){const t=t=>Math.round(100*N(t,255));return 1===this.a?`rgb(${t(this.r)}%, ${t(this.g)}%, ${t(this.b)}%)`:`rgba(${t(this.r)}%, ${t(this.g)}%, ${t(this.b)}%, ${this.roundA})`}toName(){if(0===this.a)return"transparent";if(this.a<1)return!1;const t="#"+Y(this.r,this.g,this.b,!1);for(const[i,n]of Object.entries(J))if(t===n)return i;return!1}toString(t){const i=Boolean(t);t=null!=t?t:this.format;let n=!1;return i||!(this.a<1&&this.a>=0)||!t.startsWith("hex")&&"name"!==t?("rgb"===t&&(n=this.toRgbString()),"prgb"===t&&(n=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(n=this.toHexString()),"hex3"===t&&(n=this.toHexString(!0)),"hex4"===t&&(n=this.toHex8String(!0)),"hex8"===t&&(n=this.toHex8String()),"name"===t&&(n=this.toName()),"hsl"===t&&(n=this.toHslString()),"hsv"===t&&(n=this.toHsvString()),n||this.toHexString()):"name"===t&&0===this.a?this.toName():this.toRgbString()}toNumber(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)}clone(){return new tt(this.toString())}lighten(t=10){const i=this.toHsl();return i.l+=t/100,i.l=R(i.l),new tt(i)}brighten(t=10){const i=this.toRgb();return i.r=Math.max(0,Math.min(255,i.r-Math.round(-t/100*255))),i.g=Math.max(0,Math.min(255,i.g-Math.round(-t/100*255))),i.b=Math.max(0,Math.min(255,i.b-Math.round(-t/100*255))),new tt(i)}darken(t=10){const i=this.toHsl();return i.l-=t/100,i.l=R(i.l),new tt(i)}tint(t=10){return this.mix("white",t)}shade(t=10){return this.mix("black",t)}desaturate(t=10){const i=this.toHsl();return i.s-=t/100,i.s=R(i.s),new tt(i)}saturate(t=10){const i=this.toHsl();return i.s+=t/100,i.s=R(i.s),new tt(i)}greyscale(){return this.desaturate(100)}spin(t){const i=this.toHsl(),n=(i.h+t)%360;return i.h=n<0?360+n:n,new tt(i)}mix(t,i=50){const n=this.toRgb(),h=new tt(t).toRgb(),s=i/100;return new tt({r:(h.r-n.r)*s+n.r,g:(h.g-n.g)*s+n.g,b:(h.b-n.b)*s+n.b,a:(h.a-n.a)*s+n.a})}analogous(t=6,i=30){const n=this.toHsl(),h=360/i,s=[this];for(n.h=(n.h-(h*t>>1)+720)%360;--t;)n.h=(n.h+h)%360,s.push(new tt(n));return s}complement(){const t=this.toHsl();return t.h=(t.h+180)%360,new tt(t)}monochromatic(t=6){const i=this.toHsv(),{h:n}=i,{s:h}=i;let{v:s}=i;const r=[],e=1/t;for(;t--;)r.push(new tt({h:n,s:h,v:s})),s=(s+e)%1;return r}splitcomplement(){const t=this.toHsl(),{h:i}=t;return[this,new tt({h:(i+72)%360,s:t.s,l:t.l}),new tt({h:(i+216)%360,s:t.s,l:t.l})]}triad(){return this.polyad(3)}tetrad(){return this.polyad(4)}polyad(t){const i=this.toHsl(),{h:n}=i,h=[this],s=360/t;for(let r=1;r<t;r++)h.push(new tt({h:(n+r*s)%360,s:i.s,l:i.l}));return h}equals(t){return this.toRgbString()===new tt(t).toRgbString()}}var it=function(t){function i(i){var n;return(n=t.call(this,i)||this).Dt=void 0,n.qt=!1,n}a(i,t),i.getGradientImage=function(t,n,h){var s=t>>4,r=n>>4,e=h>>4;return i.Nt||(i.Nt=Array.from({length:16},function(t){return Array.from({length:16},function(t){return Array.from({length:16})})})),i.Nt[s][r][e]||(i.Nt[s][r][e]=i.generateGradientImage(s,r,e)),i.Nt[s][r][e]},i.generateGradientImage=function(t,i,n){var h=document.createElement("canvas");h.width=h.height=64;var s=h.getContext("2d");s.globalAlpha=1,s.globalCompositeOperation="source-over",s.clearRect(0,0,64,64);var r=s.createRadialGradient(32,32,0,32,32,32);return r.addColorStop(0,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(n<<4)-1)+",1)"),r.addColorStop(.3,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(n<<4)-1)+",0.4)"),r.addColorStop(1,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(n<<4)-1)+",0)"),s.fillStyle=r,s.fillRect(0,0,64,64),h};var n=i.prototype;return n.resize=function(t,i){this.Dt=void 0},n.draw=function(t,n){if(this.enabled){this.color&&this.color.r||(this.color=new tt(this.color).toRgb()),this.Dt!==this.scaleX&&(this.Dt=this.scaleX,this.qt=this.scaleX*n.widthInPixel/n.width>64);var h=this.color,s=h.r,r=h.g,e=h.b;t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*n.alpha,t.imageSmoothingEnabled=this.qt,t.drawImage(i.getGradientImage(s,r,e),0,0,64,64,this.x-this.scaleX/2,this.y-this.scaleY/2,this.scaleX,this.scaleY),t.imageSmoothingEnabled=!0}},i}(I);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var nt=function(t,i){return function(t,i){t.exports=function(){var t=2*Math.PI,i=function(t,i,n,h,s,r,e){var o=t.x,u=t.y;return{x:h*(o*=i)-s*(u*=n)+r,y:s*o+h*u+e}},n=function(t,i){var n=4/3*Math.tan(i/4),h=Math.cos(t),s=Math.sin(t),r=Math.cos(t+i),e=Math.sin(t+i);return[{x:h-s*n,y:s+h*n},{x:r+e*n,y:e-r*n},{x:r,y:e}]},h=function(t,i,n,h){var s=t*h-i*n<0?-1:1,r=(t*n+i*h)/(Math.sqrt(t*t+i*i)*Math.sqrt(t*t+i*i));return r>1&&(r=1),r<-1&&(r=-1),s*Math.acos(r)},s=function(s){var r=s.px,e=s.py,o=s.cx,u=s.cy,a=s.rx,f=s.ry,c=s.xAxisRotation,v=void 0===c?0:c,l=s.largeArcFlag,d=void 0===l?0:l,m=s.sweepFlag,b=void 0===m?0:m,M=[];if(0===a||0===f)return[];var g=Math.sin(v*t/360),y=Math.cos(v*t/360),p=y*(r-o)/2+g*(e-u)/2,w=-g*(r-o)/2+y*(e-u)/2;if(0===p&&0===w)return[];a=Math.abs(a),f=Math.abs(f);var k=Math.pow(p,2)/Math.pow(a,2)+Math.pow(w,2)/Math.pow(f,2);k>1&&(a*=Math.sqrt(k),f*=Math.sqrt(k));var x=function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,i){var n=[],h=!0,s=!1,r=void 0;try{for(var e,o=t[Symbol.iterator]();!(h=(e=o.next()).done)&&(n.push(e.value),4!==n.length);h=!0);}catch(t){s=!0,r=t}finally{try{!h&&o.return&&o.return()}finally{if(s)throw r}}return n}(t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(function(i,n,s,r,e,o,u,a,f,c,v,l){var d=Math.pow(e,2),m=Math.pow(o,2),b=Math.pow(v,2),M=Math.pow(l,2),g=d*m-d*M-m*b;g<0&&(g=0),g/=d*M+m*b;var y=(g=Math.sqrt(g)*(u===a?-1:1))*e/o*l,p=g*-o/e*v,w=c*y-f*p+(i+s)/2,k=f*y+c*p+(n+r)/2,x=(v-y)/e,O=(l-p)/o,A=(-v-y)/e,S=(-l-p)/o,P=h(1,0,x,O),F=h(x,O,A,S);return 0===a&&F>0&&(F-=t),1===a&&F<0&&(F+=t),[w,k,P,F]}(r,e,o,u,a,f,d,b,g,y,p,w)),O=x[0],A=x[1],S=x[2],P=x[3],F=Math.max(Math.ceil(Math.abs(P)/(t/4)),1);P/=F;for(var I=0;I<F;I++)M.push(n(S,P)),S+=P;return M.map(function(t){var n=i(t[0],a,f,y,g,O,A),h=n.x,s=n.y,r=i(t[1],a,f,y,g,O,A),e=r.x,o=r.y,u=i(t[2],a,f,y,g,O,A);return{x1:h,y1:s,x2:e,y2:o,x:u.x,y:u.y}})},r={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},e=/([astvzqmhlc])([^astvzqmhlc]*)/gi,o=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;function u(t){var i=t[0][0],n=t[0][1],h=i,s=n;return t.forEach(function(t){var r=t[0],e=t[2],o=t[4],u=t[6],a=t[1],f=t[3],c=t[5],v=t[7];i=Math.min(i,r,e,o,u),n=Math.min(n,a,f,c,v),h=Math.max(h,r,e,o,u),s=Math.max(s,a,f,c,v)}),[i,n,h,s]}var a={};function f(t,i,n,h,s,r,e,o,u,a){var f=(n-t)*u+t,c=(h-i)*u+i,v=(s-n)*u+n,l=(r-h)*u+h,d=(v-f)*u+f,m=(l-c)*u+c,b=(((e-s)*u+s-v)*u+v-d)*u+d,M=(((o-r)*u+r-l)*u+l-m)*u+m;return a?[b,M,d,m,f,c,t,i]:[t,i,f,c,d,m,b,M]}function c(t,i){for(var n=function(i){var n=[];t[t.length-1].forEach(function(t){n.push(t.slice(0))}),t.push(n)},h=0;h<i;h++)n()}return a.parser=function(t){var i=[];return t.replace(e,function(t,n,h){var s=n.toLowerCase();for(h=function(t){var i=t.match(o);return i?i.map(Number):[]}(h),"m"==s&&h.length>2&&(i.push([n].concat(h.splice(0,2))),s="l",n="m"==n?"l":"L");;){if(h.length==r[s])return h.unshift(n),i.push(h);if(h.length<r[s])throw new Error("malformed path data");i.push([n].concat(h.splice(0,r[s])))}}),i},a.lerpCurve=function(t,i,n){return a.lerpPoints(t[0],t[1],i[0],i[1],n).concat(a.lerpPoints(t[2],t[3],i[2],i[3],n)).concat(a.lerpPoints(t[4],t[5],i[4],i[5],n)).concat(a.lerpPoints(t[6],t[7],i[6],i[7],n))},a.lerpPoints=function(t,i,n,h,s){return[t+(n-t)*s,i+(h-i)*s]},a.q2b=function(t,i,n,h,s,r){return[t,i,(t+2*n)/3,(i+2*h)/3,(s+2*n)/3,(r+2*h)/3,s,r]},a.path2shapes=function(t){for(var i=a.parser(t),n=0,h=0,r=0,e=i.length,o=[],u=null,f=void 0,c=void 0,v=void 0,l=void 0,d=void 0,m=void 0,b=void 0;r<e;r++){var M=i[r],g=i[r-1];switch(M[0]){case"m":o[d=o.length]=[],u=o[d],n+=M[1],h+=M[2];break;case"M":o[d=o.length]=[],u=o[d],n=M[1],h=M[2];break;case"l":u.push([n,h,n,h,n,h,n+M[1],h+M[2]]),n+=M[1],h+=M[2];break;case"L":u.push([n,h,M[1],M[2],M[1],M[2],M[1],M[2]]),n=M[1],h=M[2];break;case"h":u.push([n,h,n,h,n,h,n+M[1],h]),n+=M[1];break;case"H":u.push([n,h,M[1],h,M[1],h,M[1],h]),n=M[1];break;case"v":u.push([n,h,n,h,n,h,n,h+M[1]]),h+=M[1];break;case"V":u.push([n,h,n,M[1],n,M[1],n,M[1]]),h=M[1];break;case"C":u.push([n,h,M[1],M[2],M[3],M[4],M[5],M[6]]),n=M[5],h=M[6];break;case"S":"C"===g[0]||"c"===g[0]?u.push([n,h,n+g[5]-g[3],h+g[6]-g[4],M[1],M[2],M[3],M[4]]):"S"!==g[0]&&"s"!==g[0]||u.push([n,h,n+g[3]-g[1],h+g[4]-g[2],M[1],M[2],M[3],M[4]]),n=M[3],h=M[4];break;case"c":u.push([n,h,n+M[1],h+M[2],n+M[3],h+M[4],n+M[5],h+M[6]]),n+=M[5],h+=M[6];break;case"s":"C"===g[0]||"c"===g[0]?u.push([n,h,n+g[5]-g[3],h+g[6]-g[4],n+M[1],h+M[2],n+M[3],h+M[4]]):"S"!==g[0]&&"s"!==g[0]||u.push([n,h,n+g[3]-g[1],h+g[4]-g[2],n+M[1],h+M[2],n+M[3],h+M[4]]),n+=M[3],h+=M[4];break;case"a":b=(m=s({rx:M[1],ry:M[2],px:n,py:h,xAxisRotation:M[3],largeArcFlag:M[4],sweepFlag:M[5],cx:n+M[6],cy:h+M[7]}))[m.length-1],m.forEach(function(t,i){u.push(0===i?[n,h,t.x1,t.y1,t.x2,t.y2,t.x,t.y]:[m[i-1].x,m[i-1].y,t.x1,t.y1,t.x2,t.y2,t.x,t.y])}),n=b.x,h=b.y;break;case"A":b=(m=s({rx:M[1],ry:M[2],px:n,py:h,xAxisRotation:M[3],largeArcFlag:M[4],sweepFlag:M[5],cx:M[6],cy:M[7]}))[m.length-1],m.forEach(function(t,i){u.push(0===i?[n,h,t.x1,t.y1,t.x2,t.y2,t.x,t.y]:[m[i-1].x,m[i-1].y,t.x1,t.y1,t.x2,t.y2,t.x,t.y])}),n=b.x,h=b.y;break;case"Q":u.push(a.q2b(n,h,M[1],M[2],M[3],M[4])),n=M[3],h=M[4];break;case"q":u.push(a.q2b(n,h,n+M[1],h+M[2],M[3]+n,M[4]+h)),n+=M[3],h+=M[4];break;case"T":"Q"===g[0]||"q"===g[0]?u.push(a.q2b(n,h,v=n+g[3]-g[1],l=h+g[4]-g[2],M[1],M[2])):"T"!==g[0]&&"t"!==g[0]||(u.push(a.q2b(n,h,n+n-v,h+h-l,M[1],M[2])),v=n+n-v,l=h+h-l),n=M[1],h=M[2];break;case"t":"Q"===g[0]||"q"===g[0]?u.push(a.q2b(n,h,v=n+g[3]-g[1],l=h+g[4]-g[2],n+M[1],h+M[2])):"T"!==g[0]&&"t"!==g[0]||(u.push(a.q2b(n,h,n+n-v,h+h-l,n+M[1],h+M[2])),v=n+n-v,l=h+h-l),n+=M[1],h+=M[2];break;case"Z":case"z":u.push([n,h,f=u[0][0],c=u[0][1],f,c,f,c])}}return o},a.Rt=function(t,i){for(var n=0,h=0,s=t.length;n<i;n++)t.push(t[h].slice(0)),++h>s-1&&(h-=s)},a.zt=function(t,i){for(var n,h,s,r,e,o,u,a,c=0,v=0;c<i;c++){var l=t[v],d={left:f(n=l[0],h=l[1],s=l[2],r=l[3],e=l[4],o=l[5],u=l[6],a=l[7],.5),right:f(u,a,e,o,s,r,n,h,.5,!0)};t.splice(v,1),t.splice(v,0,d.left,d.right),(v+=2)>=t.length-1&&(v=0)}},a.lerp=function(t,i,n){return a.Ht(a.path2shapes(t),a.path2shapes(i),n)},a.MIM_CURVES_COUNT=100,a.Lt=function(t,i){var n=t.length,h=i.length,s=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(i));return n>h?c(r,n-h):n<h&&c(s,h-n),(s=function(t,i){var n=function(t){for(var i=[],n=0;n<t;n++)i.push(n);return h=[],s=[],function t(i){var n,r;for(n=0;n<i.length;n++)r=i.splice(n,1)[0],s.push(r),0==i.length&&h.push(s.slice()),t(i),i.splice(n,0,r),s.pop();return h}(i);var h,s}(t.length),h=[];n.forEach(function(n){var s=0;n.forEach(function(n){var h,r;s+=(h=u(t[n]),r=u(i[n]),Math.sqrt(Math.pow(h[0]-r[0],2)+Math.pow(h[1]-r[1],2))+Math.sqrt(Math.pow(h[2]-r[2],2)+Math.pow(h[3]-r[3],2)))}),h.push({index:n,distance:s})}),h.sort(function(t,i){return t.distance-i.distance});var s=[];return h[0].index.forEach(function(i){s.push(t[i])}),s}(s,r)).forEach(function(t,i){var n=t.length,h=r[i].length;n>h?n<a.MIM_CURVES_COUNT?(a.zt(t,a.MIM_CURVES_COUNT-n),a.zt(r[i],a.MIM_CURVES_COUNT-h)):a.zt(r[i],n-h):n<h&&(h<a.MIM_CURVES_COUNT?(a.zt(t,a.MIM_CURVES_COUNT-n),a.zt(r[i],a.MIM_CURVES_COUNT-h)):a.zt(t,h-n))}),s.forEach(function(t,i){s[i]=function(t,i){var n=function(t){for(var i=[],n=0;n<t;n++){for(var h=[],s=0;s<t;s++){var r=s+n;r>t-1&&(r-=t),h[r]=s}i.push(h)}return i}(t.length),h=[];n.forEach(function(n){var s=0,r=0;n.forEach(function(n){var h,e,o,u,a,f,c,v,l,d,m,b,M,g,y,p;s+=(e=i[r++],o=(h=t[n])[2],u=h[4],a=h[6],f=h[1],c=h[3],v=h[5],l=h[7],d=e[2],m=e[4],b=e[6],M=e[1],g=e[3],y=e[5],p=e[7],Math.sqrt(Math.pow(e[0]-h[0],2)+Math.pow(M-f,2))+Math.sqrt(Math.pow(d-o,2)+Math.pow(g-c,2))+Math.sqrt(Math.pow(m-u,2)+Math.pow(y-v,2))+Math.sqrt(Math.pow(b-a,2)+Math.pow(p-l,2)))}),h.push({index:n,distance:s})}),h.sort(function(t,i){return t.distance-i.distance});var s=[];return h[0].index.forEach(function(i){s.push(t[i])}),s}(t,r[i])}),[s,r]},a.Ht=function(t,i,n){var h=[];return t.forEach(function(t,s){var r=[];t.forEach(function(t,h){r.push(a.lerpCurve(t,i[s][h],n))}),h.push(r)}),h},a.animate=function(t){var i=a.path2shapes(t.from),n=a.path2shapes(t.to),h=a.Lt(i,n),s=new Date,r=t.end||function(){},e=t.progress||function(){},o=t.easing||function(t){return t},u=null,f=null,c=t.time;(t.begin||function(){})(i),function t(){var i=new Date-s;if(i>=c)return e(f=n,1),r(f),void cancelAnimationFrame(u);var v=o(i/c);f=a.Ht(h[0],h[1],v),e(f,v),u=requestAnimationFrame(t)}()},a}()}(i={exports:{}}),i.exports}(),ht=function(t){function i(i){var n;if((n=t.call(this,i)||this).oldPath=void 0,n.path2D=new Path2D,n.polyfill)if("function"!=typeof Path2D){var h=document.getElementsByTagName("head")[0],s=document.createElement("script");s.type="text/javascript",s.src="https://cdn.jsdelivr.net/npm/canvas-5-polyfill@0.1.5/canvas.min.js",h.appendChild(s)}else{var r=document.createElement("canvas").getContext("2d");r.stroke(new Path2D("M0,0H1")),r.getImageData(0,0,1,1).data[3]&&(n.polyfill=!1)}return n}a(i,t);var n=i.prototype;return n.wt=function(){return Object.assign({},t.prototype.wt.call(this),{path:void 0,color:void 0,borderColor:void 0,lineWidth:1,clip:!1,fixed:!1,polyfill:!0})},n.changeToPathInit=function(t,i){return nt.Lt("string"==typeof t?nt.path2shapes(t):t,"string"==typeof i?nt.path2shapes(i):i)},n.changeToPath=function(t,i,n){return nt.Ht(i.pathFrom,i.pathTo,t)},n.detect=function(t,i,n){var h=this;return this.Ot(t,i,n,!1,function(){return t.isPath(h.path2D,i,n)})},n.draw=function(t,i){var n=this;if(this.enabled){var h=this.alpha*i.alpha;this.oldPath!==this.path&&(this.polyfill&&"string"==typeof this.path&&(this.path=nt.path2shapes(this.path)),Array.isArray(this.path)?(this.path2D=new Path2D,this.path.forEach(function(t){n.path2D.moveTo(t[0][0],t[0][1]),t.forEach(function(t){n.path2D.bezierCurveTo(t[2],t[3],t[4],t[5],t[6],t[7])}),n.path2D.closePath()})):this.path2D=this.path instanceof Path2D?this.path:new Path2D(this.path),this.oldPath=this.path);var s=this.scaleX,r=this.scaleY;this.fixed&&(0==s&&(s=Number.EPSILON),0==r&&(r=Number.EPSILON)),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=h,t.save(),t.translate(this.x,this.y),t.scale(s,r),t.rotate(this.rotation),this.color&&(t.fillStyle=this.color,t.fill(this.path2D)),t.save(),this.clip&&(t.clip(this.path2D),this.fixed&&(t.rotate(-this.rotation),t.scale(1/s,1/r),t.translate(-this.x,-this.y)));for(var e,o=m(this.sprite);!(e=o()).done;)e.value.draw(t,i);t.restore(),this.borderColor&&(t.strokeStyle=this.borderColor,t.lineWidth=this.lineWidth,t.stroke(this.path2D)),t.restore()}},i}(C),st=function(t){function n(i){return t.call(this,i)||this}a(n,t);var h=n.prototype;return h.wt=function(){return Object.assign({},t.prototype.wt.call(this),{x:void 0,y:void 0,width:void 0,height:void 0,borderColor:void 0,color:void 0,lineWidth:1,clear:!1,norm:function(t,n,h){return p(i(t),void 0===h.x&&void 0===h.y&&void 0===h.width&&void 0===h.height)},position:n.CENTER})},h.normalizeFullScreen=function(t){(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height),(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x,this.position===n.CENTER&&(this.x+=this.width/2)),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y,this.position===n.CENTER&&(this.y+=this.height/2))},h.resize=function(t,i){this.kt=!0},h.init=function(t,i){this.normalizeFullScreen(i)},h.detect=function(t,i,h){return this.Ot(t,i,h,this.position===n.LEFT_TOP)},h.draw=function(t,i){if(this.enabled&&this.alpha>0)if(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,0===this.rotation&&this.position===n.LEFT_TOP)this.clear?t.clearRect(this.x,this.y,this.width,this.height):this.color&&(t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height)),this.borderColor&&(t.beginPath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.borderColor,t.rect(this.x,this.y,this.width,this.height),t.stroke());else{var h=this.width/2,s=this.height/2;t.save(),this.position===n.LEFT_TOP?t.translate(this.x+h,this.y+s):t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),this.clear?t.clearRect(-h,-s,this.width,this.height):this.color&&(t.fillStyle=this.color,t.fillRect(-h,-s,this.width,this.height)),this.borderColor&&(t.beginPath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.borderColor,t.rect(-h,-s,this.width,this.height),t.stroke()),t.restore()}},n}(I);st.LEFT_TOP=0,st.CENTER=1;var rt=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],et=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function ot(t,i,n,h,s,r){var e,o,u,a,f,c,v,l,d,m,b,M,g,y,p,w,k,x,O,A,S,P,F,I,j,C=t.data,$=2*r+1,T=h-1,E=s-1,D=r+1,q=D*(D+1)/2,N=new ut,R=N;for(u=1;u<$;u++)R=R.next=new ut,u===D&&(j=R);R.next=N;var z=null,H=null;v=c=0;var L=rt[r],W=et[r];for(o=0;o<s;o++){for(w=k=x=O=l=d=m=b=0,M=D*(A=C[c]),g=D*(S=C[c+1]),y=D*(P=C[c+2]),p=D*(F=C[c+3]),l+=q*A,d+=q*S,m+=q*P,b+=q*F,R=N,u=0;u<D;u++)R.r=A,R.g=S,R.b=P,R.a=F,R=R.next;for(u=1;u<D;u++)l+=(R.r=A=C[a=c+((T<u?T:u)<<2)])*(I=D-u),d+=(R.g=S=C[a+1])*I,m+=(R.b=P=C[a+2])*I,b+=(R.a=F=C[a+3])*I,w+=A,k+=S,x+=P,O+=F,R=R.next;for(z=N,H=j,e=0;e<h;e++)C[c+3]=F=b*L>>W,0!==F?(C[c]=(l*L>>W)*(F=255/F),C[c+1]=(d*L>>W)*F,C[c+2]=(m*L>>W)*F):C[c]=C[c+1]=C[c+2]=0,l-=M,d-=g,m-=y,b-=p,M-=z.r,g-=z.g,y-=z.b,p-=z.a,a=v+((a=e+r+1)<T?a:T)<<2,l+=w+=z.r=C[a],d+=k+=z.g=C[a+1],m+=x+=z.b=C[a+2],b+=O+=z.a=C[a+3],z=z.next,M+=A=H.r,g+=S=H.g,y+=P=H.b,p+=F=H.a,w-=A,k-=S,x-=P,O-=F,H=H.next,c+=4;v+=h}for(e=0;e<h;e++){for(k=x=O=w=d=m=b=l=0,M=D*(A=C[c=e<<2]),g=D*(S=C[c+1]),y=D*(P=C[c+2]),p=D*(F=C[c+3]),l+=q*A,d+=q*S,m+=q*P,b+=q*F,R=N,u=0;u<D;u++)R.r=A,R.g=S,R.b=P,R.a=F,R=R.next;for(f=h,u=1;u<=r;u++)l+=(R.r=A=C[c=f+e<<2])*(I=D-u),d+=(R.g=S=C[c+1])*I,m+=(R.b=P=C[c+2])*I,b+=(R.a=F=C[c+3])*I,w+=A,k+=S,x+=P,O+=F,R=R.next,u<E&&(f+=h);for(c=e,z=N,H=j,o=0;o<s;o++)C[3+(a=c<<2)]=F=b*L>>W,F>0?(C[a]=(l*L>>W)*(F=255/F),C[a+1]=(d*L>>W)*F,C[a+2]=(m*L>>W)*F):C[a]=C[a+1]=C[a+2]=0,l-=M,d-=g,m-=y,b-=p,M-=z.r,g-=z.g,y-=z.b,p-=z.a,a=e+((a=o+D)<E?a:E)*h<<2,l+=w+=z.r=C[a],d+=k+=z.g=C[a+1],m+=x+=z.b=C[a+2],b+=O+=z.a=C[a+3],z=z.next,M+=A=H.r,g+=S=H.g,y+=P=H.b,p+=F=H.a,w-=A,k-=S,x-=P,O-=F,H=H.next,c+=h}return t}var ut=function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},at={Callback:j,Canvas:$,Circle:I,Emitter:T,FastBlur:E,Group:C,Image:D,Text:q,Particle:it,Path:ht,Rect:st,Scroller:function(t){function n(n){var h=i(n.text),s=Array.isArray(h)?h:[].concat(h);return t.call(this,Object.assign({},n,{class:q,count:s.length,text:function(t){return s[t]},enabled:function(t){return" "!==s[t]&&i(n.enabled,t)}}))||this}return a(n,t),n}(T),StackBlur:function(t){function i(i){var n;return(n=t.call(this,i)||this).Pt=!1,n.Wt=void 0,n}a(i,t);var n=i.prototype;return n.wt=function(){return Object.assign({},t.prototype.wt.call(this),{onCanvas:!1,radius:void 0,radiusPart:void 0,radiusScale:!0})},n.normalizeFullScreen=function(i){this.norm&&this.onCanvas?(this.x=0,this.y=0,this.width=i.widthInPixel,this.height=i.heightInPixel):t.prototype.normalizeFullScreen.call(this,i)},n.resize=function(i,n){t.prototype.resize.call(this,i,n),this.radiusPart&&(this.radius=void 0)},n.additionalBlur=function(t,i,n){var h=this.jt.getImageData(0,0,t,i);ot(h,0,0,t,i,n.radius),this.jt.putImageData(h,0,0)},n.detect=function(t,i,n){return this.Ot(t,i,n,!1)},n.draw=function(i,n){if(this.enabled){void 0!==this.radius&&this.Wt===this.radiusPart||(this.radius=Math.round((n.widthInPixel+n.heightInPixel)/2/this.radiusPart),this.Wt=this.radiusPart);var h=Math.round(this.radius*(this.radiusScale&&(n.cam?n.cam.zoom:1)/n.scaleCanvas));if(h)if(this.onCanvas){void 0!==this.width&&void 0!==this.height||this.normalizeFullScreen(n);var s=Math.round(this.x),r=Math.round(this.y),e=Math.round(this.width),o=Math.round(this.height);this.imageData=i.getImageData(s,r,e,o),ot(this.imageData,0,0,e-s,o-r,h),i.putImageData(this.imageData,s,r,0,0,e,o)}else n.radius=h,t.prototype.draw.call(this,i,n)}else t.prototype.draw.call(this,i,n)},i}(E),StarField:function(t){function i(i){var n;return(n=t.call(this,i)||this)._t=[],n.Xt=[],n.Yt=[],n.Ut=[],n.Bt=[],n.Jt=[],n.Qt=[],n.Gt=[],n.Vt=[],n}a(i,t);var n=i.prototype;return n.wt=function(){return Object.assign({},t.prototype.wt.call(this),{count:40,moveX:0,moveY:0,moveZ:0,lineWidth:void 0,highScale:!0,color:"#FFF"})},n.init=function(t,i){function n(t,i,n){return void 0===n&&(n=-i),void 0===t||t<i||t>=n?Math.random()*(n-i)+i:t}this.width=this.width||i.width,this.height=this.height||i.height,this.x=void 0===this.x?i.x:this.x,this.y=void 0===this.y?i.y:this.y,this.lineWidth=this.lineWidth||Math.min(i.height/i.heightInPixel,i.width/i.widthInPixel)/2,this.Zt=this.width/2+this.x,this.Kt=this.height/2+this.y,this.ti=Math.max(this.width,this.height)/2;for(var h=0;h<this.count;h++)this._t[h]=n(this._t[h],-this.width/2),this.Xt[h]=n(this.Xt[h],-this.height/2),this.Yt[h]=n(this.Yt[h],0,this.ti)},n.moveStar=function(t,i,n){n&&(this.Gt[t]=!0);for(var h=this.width/2,s=this.height/2,r=this._t[t]+this.moveX*i,e=this.Xt[t]+this.moveY*i,o=this.Yt[t]+this.moveZ*i;r<-h;)r+=this.width,e=Math.random()*this.height-s,this.Gt[t]=!1;for(;r>h;)r-=this.width,e=Math.random()*this.height-s,this.Gt[t]=!1;for(;e<-s;)e+=this.height,r=Math.random()*this.width-h,this.Gt[t]=!1;for(;e>s;)e-=this.height,r=Math.random()*this.width-h,this.Gt[t]=!1;for(;o<=0;)o+=this.ti,r=Math.random()*this.width-h,e=Math.random()*this.height-s,this.Gt[t]=!1;for(;o>this.ti;)o-=this.ti,r=Math.random()*this.width-h,e=Math.random()*this.height-s,this.Gt[t]=!1;var u=this.Zt+r/o*h,a=this.Kt+e/o*s;if(this.Gt[t]=this.Gt[t]&&u>=this.x&&a>=this.y&&u<this.x+this.width&&a<this.y+this.height,n)this._t[t]=r,this.Xt[t]=e,this.Yt[t]=o,this.Jt[t]=u,this.Qt[t]=a;else{this.Ut[t]=u,this.Bt[t]=a;var f=4*(1-this.Yt[t]/this.ti);this.highScale||(f=Math.ceil(f)),this.Vt[t]=f}},n.animate=function(i){var n=t.prototype.animate.call(this,i);if(this.enabled&&void 0!==this.Zt)for(var h=this.count;h--;)this.moveStar(h,i/16,!0),this.Gt[h]&&this.moveStar(h,-5,!1);return n},n.resize=function(t,i){this.kt=!0},n.detect=function(t,i,n){return this.Ot(t,i,n,!1)},n.draw=function(t,i){if(this.enabled)if(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,0==this.moveY&&0==this.moveZ&&this.moveX<0){t.fillStyle=this.color;for(var n=this.count;n--;)this.Gt[n]&&t.fillRect(this.Jt[n],this.Qt[n]-this.Vt[n]*this.lineWidth/2,this.Ut[n]-this.Jt[n],this.Vt[n]*this.lineWidth)}else if(t.strokeStyle=this.color,this.highScale)for(var h=this.count;h--;)this.Gt[h]&&(t.beginPath(),t.lineWidth=this.Vt[h]*this.lineWidth,t.moveTo(this.Ut[h],this.Bt[h]),t.lineTo(this.Jt[h],this.Qt[h]),t.stroke(),t.closePath());else for(var s,r=5;--r;){for(t.beginPath(),t.lineWidth=r*this.lineWidth,s=this.count;s--;)this.Gt[s]&&this.Vt[s]===r&&(t.moveTo(this.Ut[s],this.Bt[s]),t.lineTo(this.Jt[s],this.Qt[s]));t.stroke(),t.closePath()}},i}(st)},ft=function(){function t(t,n){this.callback=t,this.duration=p(i(n),void 0),this.initialized=!1}var n=t.prototype;return n.reset=function(){this.initialized=!1},n.run=function(t,i){var n;return void 0!==this.duration?(this.callback(t,Math.min(i,this.duration),!this.initialized),this.initialized=!0,i-this.duration):(n=this.callback(t,i,!this.initialized),this.initialized=!0,n)},t}();function ct(t,i){return i.from+t*i.delta}function vt(t,i){for(var n,h=[].concat(i.values),s=h.length;s>1;)for(s--,n=0;n<s;n++)h[n]=h[n]+t*(h[n+1]-h[n]);return h[0]}function lt(t,i,n){return i.colorFrom.mix(i.colorTo,100*t).toString()}function dt(t,i,n){return n.changeToPath(t,i,n)}var mt=function(){function t(t,n,h){for(var s in this.initialized=!1,this.changeValues=[],t)for(var r=t[s],e="rotationInDegree"===s?.017453292519943295*r:r,o="color"===s||"borderColor"===s,u="path"===s,a="function"==typeof e,f=!o&&Array.isArray(e),c=0,v="scale"===s?["scaleX","scaleY"]:"rotationInRadian"===s||"rotationInDegree"===s?["rotation"]:[s];c<v.length;c++)this.changeValues.push({name:v[c],to:f?e[e.length-1]:i(e,1,{}),bezier:!!f&&e,isColor:o,isPath:u,isFunction:!!a&&e,moveAlgorithm:o?lt:u?dt:f?vt:ct});this.duration=p(i(n),0),this.ease=p(h,function(t){return t})}var n=t.prototype;return n.reset=function(){this.initialized=!1},n.init=function(t,i){for(var n,h=this.changeValues.length;h--;)if((n=this.changeValues[h]).isFunction)if(n.from=t[n.name],n.to=n.isFunction(n.from),n.isColor)n.colorFrom=new tt(n.from),n.colorTo=new tt(n.to),n.moveAlgorithm=lt;else if(n.isPath){var s=t.changeToPathInit(n.from,n.to);n.pathFrom=s[0],n.pathTo=s[1],n.moveAlgorithm=dt}else Array.isArray(n.to)?(n.values=[t[n.name]].concat(n.to),n.moveAlgorithm=vt):(n.delta=n.to-n.from,n.moveAlgorithm=ct);else if(n.isColor)n.colorFrom=new tt(t[n.name]),n.colorTo=new tt(n.to);else if(n.isPath){var r=t.changeToPathInit(t[n.name],n.to);n.pathFrom=r[0],n.pathTo=r[1]}else n.bezier?n.values=[t[n.name]].concat(n.bezier):(n.from=t[n.name],n.delta=n.to-n.from)},n.run=function(t,i){if(this.initialized||(this.initialized=!0,this.init(t,i)),this.duration<=i)for(var n,h=this.changeValues.length;h--;)t[(n=this.changeValues[h]).name]=n.to;else for(var s,r=this.changeValues.length,e=this.ease(i/this.duration);r--;)t[(s=this.changeValues[r]).name]=s.moveAlgorithm(e,s,t);return i-this.duration},t}(),bt=function(){function t(){}return t.prototype.run=function(t,i){return F.Mt},t}(),Mt=function(){function t(){}return t.prototype.run=function(t,i){return t.enabled=!1,F.Mt},t}(),gt=function(){function t(){var t=[].slice.call(arguments);this.Aniobject=t[0]instanceof F?t[0]:v(F,t)}var i=t.prototype;return i.reset=function(t){void 0===t&&(t=0),this.Aniobject.reset&&this.Aniobject.reset(t)},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.Aniobject.play&&this.Aniobject.play(t,i)},i.run=function(t,i,n){for(var h=i;h>=0;){if(h=this.Aniobject.run(t,h,n),n=!0,!0===h)return!0;h>=0&&this.Aniobject.reset&&this.Aniobject.reset()}return h},t}(),yt=function(){function t(t,i,n){this.ifCallback=t,this.Aniobject=i,this.AniobjectElse=p(n,function(){return 0})}return t.prototype.run=function(t,n){var h=i(this.ifCallback)?this.Aniobject:this.AniobjectElse;return h.run?h.run(t,n):h(t,n)},t}(),pt=function(){function t(t,n){this.initialized=!1,this.image=i(t),this.durationBetweenFrames=p(i(n),0),Array.isArray(this.image)?this.count=this.image.length:(this.image=[this.image],this.count=1),this.duration=this.count*this.durationBetweenFrames}var n=t.prototype;return n.reset=function(){this.initialized=!1},n.run=function(t,i){if(this.initialized||(this.initialized=!0,this.current=-1),i>=this.duration)t.image=b.getImage(this.image[this.image.length-1]);else{var n=Math.floor(i/this.durationBetweenFrames);n!==this.current&&(this.current=n,t.image=b.getImage(this.image[this.current]))}return i-this.duration},t}(),wt=function(){function t(t,n,h){this.initialized=!1,this.frameNumber=i(t),this.framesToRight=p(i(n),!0),this.durationBetweenFrames=p(i(h),0),Array.isArray(this.frameNumber)||(this.frameNumber=[this.frameNumber]),this.duration=this.frameNumber.length*this.durationBetweenFrames}return t.prototype.run=function(t,i){var n;return n=i>=this.duration?this.frameNumber[this.frameNumber.length-1]:this.frameNumber[Math.floor(i/this.durationBetweenFrames)],this.framesToRight?t.frameX=t.frameWidth*n:t.frameY=t.frameHeight*n,i-this.duration},t}(),kt=function(){function t(t){var n=[].slice.call(arguments,1);this.Aniobject=n[0]instanceof F?n[0]:v(F,n),this.times=this.timesOrg=p(i(t),1)}var n=t.prototype;return n.reset=function(t){void 0===t&&(t=0),this.times=this.timesOrg,this.Aniobject.reset&&this.Aniobject.reset(t)},n.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.times=this.timesOrg,this.Aniobject.play&&this.Aniobject.play(t,i)},n.run=function(t,i,n){for(var h=i;h>=0&&this.times>0;){if(h=this.Aniobject.run(t,h,n),n=!0,!0===h)return!0;h>=0&&(this.times--,this.Aniobject.reset&&this.Aniobject.reset())}return h},t}(),xt=function(t){function n(n,h,s,r){var e;return(e=t.call(this,{x:n,y:h},0,r)||this).speed=i(s)||1,e}return a(n,t),n.prototype.init=function(i,n){if(0==this.speed||this.targetX===i.x&&this.targetY===i.y)this.duration=0;else{var h=this.changeValues[0],s=this.changeValues[1];h.from=i.x,s.from=i.y,h.delta=h.to-h.from,s.delta=s.to-s.from;var r=Math.sqrt(h.delta*h.delta+s.delta*s.delta);this.duration=10*r/this.speed}t.prototype.init.call(this,i,n)},n}(mt),Ot=function(){function t(){}return t.prototype.run=function(t,i){return F.yt},t}(),At=function(){function t(t,n){this.Aniobject=t,this.times=p(i(n),1)}return t.prototype.run=function(t,i){if(this.times<=0)return i;var n=this.Aniobject.run(t,i);return n>=0&&this.times--,n},t}(),St=function(){function t(t,n){this.initialized=!1,this.duration=i(n),this.shakeDiff=i(t),this.shakeDiffHalf=this.shakeDiff/2}var n=t.prototype;return n.reset=function(){this.initialized=!1},n.run=function(t,i){return this.initialized||(this.initialized=!0,this.x=t.x,this.y=t.y),i>=this.duration?(t.x=this.x,t.y=this.y):(t.x=this.x+Math.random()*this.shakeDiff-this.shakeDiffHalf,t.y=this.y+Math.random()*this.shakeDiff-this.shakeDiffHalf),i-this.duration},t}(),Pt=function(){function t(){this.showOnce=!0}return t.prototype.run=function(t,i){return t.enabled=t.enabled&&this.showOnce,this.showOnce=!1,0},t}(),Ft=function(){function t(t){var i=this,n=void 0===t?{}:t,h=n.states,s=n.transitions,r=void 0===s?{}:s,e=n.default,o=void 0===e?void 0:e,u=n.delegateTo,a=void 0===u?void 0:u;this.states=void 0===h?{}:h,Object.keys(this.states).forEach(function(t){Array.isArray(i.states[t])&&(i.states[t]=new F(i.states[t]))}),this.transitions=r,this.delegateTo=a,this.currentStateName=o,this.currentState=this.states[o],this.isTransitioningToStateName=void 0}var i=t.prototype;return i.setState=function(t,i){var n=this;if(t!==this.currentStateName){this.isTransitioningToStateName=t;var h=""+t.charAt(0).toUpperCase()+t.slice(1),s=[this.currentStateName+"To"+h,this.currentStateName+"To","to"+h].find(function(t){return n.transitions[t]});s?(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.transitions[s],this.currentState&&this.currentState.reset&&this.currentState.reset()):(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.states[this.currentStateName],this.currentState&&this.currentState.reset&&this.currentState.reset(),this.isTransitioningToStateName=void 0)}},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.currentState.play&&this.currentState.play(t,i)},i.run=function(t,i,n){var h=i,s=n;if(this.currentState){if(!0===(h=this.currentState.run(t,h,s)))return!0;s=!0}if(h>=0||!this.currentState)if(this.isTransitioningToStateName){if(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.states[this.currentStateName],this.currentState&&this.currentState.reset&&this.currentState.reset(),this.isTransitioningToStateName=void 0,!0===(h=this.currentState.run(t,h,s)))return!0}else this.currentState=void 0;return-1},t}(),It=function(){function t(){}return t.prototype.run=function(t,i){return F.gt},t}(),jt=function(){function t(){}return t.prototype.run=function(t,i){return t.enabled=!1,F.gt},t}(),Ct={Callback:ft,ChangeTo:mt,End:bt,EndDisabled:Mt,Forever:gt,If:yt,Image:pt,ImageFrame:wt,Loop:kt,Move:xt,Once:At,Remove:Ot,Sequence:F,Shake:St,ShowOnce:Pt,State:Ft,Stop:It,StopDisabled:jt,Wait:P,WaitDisabled:function(){function t(t){this.duration=p(i(t),0)}return t.prototype.run=function(t,i){return t.enabled=i>=this.duration,i-this.duration},t}()},$t=function(t){var i=t*t;return t<4/11?7.5625*i:t<8/11?9.075*i-9.9*t+3.4:t<.9?4356/361*i-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72},Tt={backInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},backIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},backOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},bounceInOut:function(t){return t<.5?.5*(1-$t(1-2*t)):.5*$t(2*t-1)+.5},bounceIn:function(t){return 1-$t(1-t)},bounceOut:$t,circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},cubicInOut:function(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1},cubicIn:function(t){return t*t*t},cubicOut:function(t){var i=t-1;return i*i*i+1},elasticInOut:function(t){return t<.5?.5*Math.sin(13*Math.PI/2*2*t)*Math.pow(2,10*(2*t-1)):.5*Math.sin(-13*Math.PI/2*(2*t-1+1))*Math.pow(2,-10*(2*t-1))+1},elasticIn:function(t){return Math.sin(13*t*Math.PI/2)*Math.pow(2,10*(t-1))},elasticOut:function(t){return Math.sin(-13*(t+1)*Math.PI/2)*Math.pow(2,-10*t)+1},expoInOut:function(t){return 0===t||1===t?t:t<.5?.5*Math.pow(2,20*t-10):-.5*Math.pow(2,10-20*t)+1},expoIn:function(t){return 0===t?t:Math.pow(2,10*(t-1))},expoOut:function(t){return 1===t?t:1-Math.pow(2,-10*t)},linear:function(t){return t},quadInOut:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},quadIn:function(t){return t*t},quadOut:function(t){return-t*(t-2)},quartInOut:function(t){return t<.5?8*Math.pow(t,4):-8*Math.pow(t-1,4)+1},quartIn:function(t){return Math.pow(t,4)},quartOut:function(t){return Math.pow(t-1,3)*(1-t)+1},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},sineInOut:function(t){return-.5*(Math.cos(Math.PI*t)-1)},sineIn:function(t){var i=Math.cos(t*Math.PI*.5);return Math.abs(i)<1e-14?1:1-i},sineOut:function(t){return Math.sin(t*Math.PI/2)}},Et=function(){function t(t){void 0===t&&(t={}),this.type="camera",this.cam=Object.assign({zoom:1,x:0,y:0},t)}var i=t.prototype;return i.viewport=function(t,i){return l(t),i.scale(this.cam.zoom,this.cam.zoom).translate(-this.cam.x,-this.cam.y)},i.viewportByCam=function(t,i){var n=t.engine,h=n.getWidth()/2,s=n.getHeight()/2,r=n.getRatio()>1?h:s;return(new y).translate(h,s).scale(r,r).scale(i.zoom,i.zoom).translate(-i.x,-i.y)},i.additionalModifier=function(t,i){return l(t),i.cam=Object.assign({},this.cam),i},i.clampView=function(t,i){var n=t.engine,h=t.scene,s=t.clampLimits||{x1:h.additionalModifier.x,y1:h.additionalModifier.y,x2:h.additionalModifier.x+h.additionalModifier.width,y2:h.additionalModifier.y+h.additionalModifier.height},r=this.viewportByCam({engine:n},i).invert(),e=r.transformPoint(0,0),o=e[0],u=e[1],a=r.transformPoint(n.getWidth(),n.getHeight()),f=a[0],c=a[1];return f-o<=s.x2-s.x1?o<s.x1?f<=s.x2&&(i.x+=s.x1-o):f>s.x2&&(i.x+=s.x2-f):o>s.x1?i.x+=s.x1-o:f<s.x2&&(i.x+=s.x2-f),c-u<=s.y2-s.y1?u<s.y1?c<=s.y2&&(i.y+=s.y1-u):c>s.y2&&(i.y+=s.y2-c):u>s.y1?i.y+=s.y1-u:c<s.y2&&(i.y+=s.y2-c),i},i.zoomToFullScreen=function(t){var i=t.scene;return Math.min(i.additionalModifier.fullScreen.width/i.additionalModifier.width,i.additionalModifier.fullScreen.height/i.additionalModifier.height)},i.zoomTo=function(t){var i=t.engine,n=t.cam,h=t.x1,s=t.y1,r=t.x2,e=t.y2,o=t.scene.additionalModifier.scaleCanvas,u=this.viewportByCam({engine:i},n||this.cam).invert(),a=u.transformPoint(0,0),f=a[0],c=a[1],v=u.transformPoint(i.getWidth()*o,i.getHeight()*o),l=r-h,d=e-s,m={x:h+l/2,y:s+d/2,zoom:n.zoom*Math.max(Math.min((v[0]-f)/l,(v[1]-c)/d),Number.MIN_VALUE)};n?(n.x=m.x,n.y=m.y,n.zoom=m.zoom):this.cam=m},u(t,[{key:"zoom",set:function(t){this.cam.zoom=t},get:function(){return this.cam.zoom}},{key:"camX",set:function(t){this.cam.x=t},get:function(){return this.cam.x}},{key:"camY",set:function(t){this.cam.y=t},get:function(){return this.cam.y}}]),t}(),Dt=function(){function t(t){void 0===t&&(t={}),this.type="control",this.ii={},this.toCam={},this.config=Object.assign({zoomMax:10,zoomMin:.5,zoomFactor:1.2,tween:2,callResize:!0},t)}var i=t.prototype;return i.init=function(t){var i=t.scene;this.M=i,this.toCam=Object.assign({},i.camera.cam)},i.mouseDown=function(t){var i=t.event,n=t.position,h=t.button;this.ii[h]=Object.assign({},this.ii[h],{x:n[0],y:n[1],ni:this.toCam.x,hi:this.toCam.y,si:!0,ri:i.touches&&i.touches.length||1,ei:void 0,oi:Date.now()})},i.mouseUp=function(t){var i=t.event,n=t.position,h=n[0],s=n[1],r=t.button,e=t.scene;this.ii[r]||(this.ii[r]={});var o=this.ii[r].si,u=i.changedTouches&&i.changedTouches.length||1,a=Math.max(this.ii[r].ri,u);this.ii[r].si=!1,this.ii[r].ri-=u,!o||a>1?e.stopPropagation():Date.now()-this.ii[r].oi<300&&Math.abs(this.ii[r].x-h)<5&&Math.abs(this.ii[r].y-s)<5&&1===r||e.stopPropagation()},i.mouseOut=function(t){var i=t.button;this.ii[i]&&(this.ii[i].si=!1)},i.mouseMove=function(t){var i=t.event,n=t.position,h=n[0],s=n[1],r=t.button,e=t.scene;if(this.ii[r]&&this.ii[r].si&&(0!==i.which||i.touches)){var o=e.additionalModifier.scaleCanvas;if(i.touches&&i.touches.length>=2){var u=i.touches,a=Math.sqrt((u[0].pageX-u[1].pageX)*(u[0].pageX-u[1].pageX)+(u[0].pageY-u[1].pageY)*(u[0].pageY-u[1].pageY));void 0===this.ii[r].ei?a>0&&(this.ii[r].ei=a,this.ii[r].ui=this.toCam.zoom):(this.toCam.zoom=Math.max(this.config.zoomMin,Math.min(this.config.zoomMax,this.ii[r].ui*a/this.ii[r].ei)),this.toCam=e.camera.clampView(arguments[0],this.toCam))}else{this.ii[r].ei=void 0;var f=e.camera.viewportByCam(arguments[0],this.toCam).invert(),c=f.transformPoint(this.ii[r].x*o,this.ii[r].y*o),v=c[0],l=c[1],d=f.transformPoint(h*o,s*o),m=d[0],b=d[1];this.toCam.x=this.ii[r].ni+v-m,this.toCam.y=this.ii[r].hi+l-b,this.toCam=e.camera.clampView(arguments[0],this.toCam)}}},i.mouseWheel=function(t){var i=t.event,n=t.position,h=n[0],s=n[1],r=t.scene,e=r.additionalModifier.scaleCanvas,o=r.camera.viewportByCam(arguments[0],this.toCam).invert().transformPoint(h*e,s*e),u=o[0],a=o[1],f=i.wheelDelta||-1*i.deltaY;if(f/120>0){this.zoomIn();var c=r.camera.viewportByCam(arguments[0],this.toCam).invert().transformPoint(h*e,s*e),v=c[0],l=c[1];this.toCam.x-=v-u,this.toCam.y-=l-a,this.toCam=r.camera.clampView(arguments[0],this.toCam)}else this.zoomOut(arguments[0])},i.hasCamChanged=function(){var t=this.config.tween||1;return Math.abs(this.toCam.x-this.M.camera.cam.x)>=Number.EPSILON*t||Math.abs(this.toCam.y-this.M.camera.cam.y)>=Number.EPSILON*t||Math.abs(this.toCam.zoom-this.M.camera.cam.zoom)>=Number.EPSILON*t},i.fixedUpdate=function(t){var i=t.scene,n=t.lastCall;this.config.tween&&!this.ai&&this.hasCamChanged()&&(i.camera.cam.x+=(this.toCam.x-i.camera.cam.x)/this.config.tween,i.camera.cam.y+=(this.toCam.y-i.camera.cam.y)/this.config.tween,i.camera.cam.zoom+=(this.toCam.zoom-i.camera.cam.zoom)/this.config.tween,n&&(i.additionalModifier.cam=this.cam,this.config.callResize?i.resize():i.cacheClear()))},i.update=function(t){var i=t.scene;this.config.tween&&!this.ai||!this.hasCamChanged()||(this.ai=!1,i.camera.cam=Object.assign({},this.toCam),this.config.callResize?i.resize():i.cacheClear())},i.camInstant=function(){this.ai=!0},i.resize=function(t){this.toCam=t.scene.camera.clampView(t,this.toCam)},i.zoomToNorm=function(){return this.toCam.zoom=1,this},i.zoomIn=function(){return this.toCam.zoom=Math.min(this.config.zoomMax,this.toCam.zoom*this.config.zoomFactor),this},i.zoomOut=function(t){return this.toCam.zoom=Math.max(this.config.zoomMin,this.toCam.zoom/this.config.zoomFactor),t&&(this.toCam=this.M.camera.clampView(t,this.toCam)),this},i.zoomTo=function(t){t.cam=this.toCam,t.scene.camera.zoomTo(t)},t}(),qt={Callback:Et,Camera:Et,CameraControl:Dt,CameraControlSecondButton:function(t){function i(){return t.apply(this,arguments)||this}a(i,t);var n=i.prototype;return n.mouseUp=function(t){var i=t.event,n=t.position,h=n[0],s=n[1],r=t.button,e=t.scene;this.ii[r]||(this.ii[r]={});var o=this.ii[r].si,u=i.changedTouches&&i.changedTouches.length||1,a=Math.max(this.ii[r].ri,u);if(this.ii[r].si=!1,this.ii[r].ri-=u,!o||a>1)e.stopPropagation();else if((Date.now()-this.ii[r].oi>300||Math.abs(this.ii[r].x-h)>=5||Math.abs(this.ii[r].y-s)>=5)&&1===r){e.stopPropagation();var f=e.transformPoint(h,s),c=f[0],v=f[1],l=e.transformPoint(this.ii[r].x,this.ii[r].y),d=l[0],m=l[1];e.map("region",{event:i,x1:Math.min(d,c),y1:Math.min(m,v),x2:Math.max(d,c),y2:Math.max(m,v),fromX:d,fromY:m,toX:c,toY:v})}},n.mouseMove=function(t){var i=t.event,n=t.position,h=n[0],s=n[1],r=t.button,e=t.scene;if(this.ii[r]&&this.ii[r].si&&(0!==i.which||i.touches)){var o=e.additionalModifier.scaleCanvas;if(i.touches&&i.touches.length>=2){var u=i.touches,a=Math.sqrt((u[0].pageX-u[1].pageX)*(u[0].pageX-u[1].pageX)+(u[0].pageY-u[1].pageY)*(u[0].pageY-u[1].pageY));if(void 0===this.ii[r].ei)a>0&&(this.ii[r].ei=a,this.ii[r].ui=this.toCam.zoom);else{this.toCam.zoom=Math.max(this.config.zoomMin,Math.min(this.config.zoomMax,this.ii[r].ui*a/this.ii[r].ei));var f=e.camera.viewportByCam(arguments[0],this.toCam).invert(),c=f.transformPoint(this.ii[r].x*o,this.ii[r].y*o),v=c[0],l=c[1],d=f.transformPoint(h*o,s*o),m=d[0],b=d[1];this.toCam.x=this.ii[r].ni+v-m,this.toCam.y=this.ii[r].hi+l-b,this.toCam=e.camera.clampView(arguments[0],this.toCam)}}else{if(this.ii[r].ei=void 0,2===r){var M=e.camera.viewportByCam(arguments[0],this.toCam).invert(),g=M.transformPoint(this.ii[r].x*o,this.ii[r].y*o),y=g[0],p=g[1],w=M.transformPoint(h*o,s*o),k=w[0],x=w[1];this.toCam.x=this.ii[r].ni+y-k,this.toCam.y=this.ii[r].hi+p-x,this.toCam=e.camera.clampView(arguments[0],this.toCam)}if(1===r&&e.has("regionMove")&&!(Date.now()-this.ii[r].oi<300&&Math.abs(this.ii[r].x-h)<5&&Math.abs(this.ii[r].y-s)<5)&&(!i.touches||1===i.touches.length)){var O=e.transformPoint(h,s),A=O[0],S=O[1],P=e.transformPoint(this.ii[r].x,this.ii[r].y),F=P[0],I=P[1];e.map("regionMove",{event:i,x1:Math.min(F,A),y1:Math.min(I,S),x2:Math.max(F,A),y2:Math.max(I,S),fromX:F,fromY:I,toX:A,toY:S})}}}},i}(Dt),Click:function(){function t(t){var i=(void 0===t?{}:t).doubleClickDetectInterval;this.fi=void 0===i?350:i}return t.prototype.mouseUp=function(t){var i=this,n=t.scene;1===t.button&&(n.has("doubleClick")?this.ci?(clearTimeout(this.ci),this.ci=0,n.map("doubleClick",t)):this.ci=setTimeout(function(){i.ci=0,n.map("click",t)},this.fi):n.map("click",t))},t}(),Element:function(){function t(t){var i=(void 0===t?{}:t).doubleClickDetectInterval;this.fi=void 0===i?350:i}var i=t.prototype;return i.isDrawFrame=function(){return this.vi?1:0},i.li=function(t,i,n){var h=this;i?t.has("doubleClickElement")?this.ci?(clearTimeout(this.ci),this.ci=0,t.map("doubleClickElement",n)):this.ci=setTimeout(function(){h.ci=0,t.map("clickElement",n)},this.fi):t.map("clickElement",n):t.map("hoverElement",n)},i.di=function(t,i,n){var h=this;i?t.has("doubleClickNonElement")?this.ci?(clearTimeout(this.ci),this.ci=void 0,t.map("doubleClickNonElement",n)):this.ci=setTimeout(function(){h.ci=void 0,t.map("clickNonElement",n)},this.fi):t.map("clickNonElement",n):t.map("hoverNonElement",n)},i.initSprites=function(t){var i=t.scene,n=t.output,h=t.layerManager,s=t.canvasId;if(this.vi=!1,this.mi||this.bi){var r=!!this.mi,e=this.mi||this.bi,o=e.mx,u=e.my,a=i.additionalModifier.scaleCanvas,f=n.context[s],c=Math.round(o/a),v=Math.round(u/a),l=i.transformPoint(o,u),d=l[0],m=l[1];f.save(),f.setTransform.apply(f,i.viewport().m);var b=0;if(h.forEach(function(t){var i=t.layerId,n=t.elementId;if(!t.isFunction){var h=t.element.detect(f,c,v);if("c"===h)b="c";else if(h)return b={layerId:i,element:h,elementId:n},!1}}),f.restore(),"c"===b)this.vi=!0;else{this.mi=!1,this.bi=!1;var M={mx:o,my:u,x:d,y:m};b?(Object.assign(M,b),this.li(i,r,M)):this.di(i,r,M)}}},i.draw=function(t){var i=t.engine,n=t.scene,h=t.layerManager,s=t.canvasId;if(!s&&this.vi){var r=!!this.mi,e=this.mi||this.bi,o=e.mx,u=e.my,a=n.additionalModifier.scaleCanvas,f=t.output.context[s],c=Math.round(o/a),v=Math.round(u/a),l=n.transformPoint(o,u),d={mx:o,my:u,x:l[0],y:l[1]},m=f.imageSmoothingEnabled;f.imageSmoothingEnabled=!1,f.clearRect(0,0,f.canvas.width,f.canvas.height),f.save(),f.setTransform.apply(f,n.viewport().m),h.forEach(function(t){var i=t.elementId;t.isFunction||t.element.detectDraw(f,"rgb("+(255&i)+", "+((65280&i)>>8)+", "+(255&t.layerId)+")")},0),f.restore(),f.imageSmoothingEnabled=m,i.normContext(f),this.mi=!1,this.bi=!1;var b=f.getImageData(c,v,1,1).data;b[3]?(d.layerId=b[2],d.elementId=b[0]+(b[1]<<8),d.element=h.getById(d.layerId).getById(d.elementId),this.li(n,r,d)):this.di(n,r,d)}},i.mouseUp=function(t){var i=t.position,n=i[0],h=i[1];this.mi=1===t.button&&t.scene.has("clickElement")&&{mx:n,my:h}},i.mouseMove=function(t){var i=t.position,n=i[0],h=i[1];this.bi=t.scene.has("hoverElement")&&{mx:n,my:h}},t}(),Event:function(){function t(){this.type="events"}var i=t.prototype;return i.Mi=function(t,i,n){p(n.value("preventDefault"),!0)&&i.preventDefault();var h=this.getMousePosition({event:i}),s=h[0],r=h[1],e=n.transformPoint(s,r);n.pipeBack(t,{event:i,position:[s,r],x:e[0],y:e[1],button:this.getMouseButton({event:i})})},i.init=function(t){var i=this,n=t.scene,h=t.output.canvas[0],s=n.map("events");s.push([n.has("mouseDown")&&[["touchstart","mousedown"],function(t){return i.Mi("mouseDown",t,n)}],n.has("mouseUp")&&[["touchend","mouseup"],function(t){return i.Mi("mouseUp",t,n)}],n.has("mouseOut")&&[["touchendoutside","mouseout"],function(t){return i.Mi("mouseOut",t,n)}],n.has("mouseMove")&&[["touchmove","mousemove"],function(t){return i.Mi("mouseMove",t,n)}],n.has("mouseWheel")&&[["wheel"],function(t){return i.Mi("mouseWheel",t,n)}],p(n.value("preventDefault"),!0)&&[["contextmenu"],function(t){return t.preventDefault()}]].filter(function(t){return t})),this.u=s.filter(Array.isArray).reduce(function(t,i){return t.push.apply(t,i),t},[]).map(function(t){var i=t[1];return t[0].map(function(t){return{n:h,e:t,f:i}})}).reduce(function(t,i){return Array.isArray(i)?t.push.apply(t,i):t.push(i),t},[]),this.u.forEach(function(t){t.n.addEventListener(t.e,t.f,!0)})},i.destroy=function(){this.u.forEach(function(t){t.n.removeEventListener(t.e,t.f,!0)}),this.u=[]},i.getMousePosition=function(t){var i,n=t.event;if(n.touches&&n.touches.length>0?i=n.targetTouches:n.changedTouches&&n.changedTouches.length>0&&(i=n.changedTouches),i){var h=n.target.getBoundingClientRect(),s=i.length;return[(i=Array.from(i)).reduce(function(t,i){return t+i.pageX},0)/s-h.left,i.reduce(function(t,i){return t+i.pageY},0)/s-h.top]}if(void 0===n.offsetX){var r=n.target.getBoundingClientRect();return[n.clientX-r.left,n.clientY-r.top]}return[n.offsetX,n.offsetY]},i.getMouseButton=function(t){var i=t.event;return i.touches?i.touches.length||i.changedTouches.length:p(i.buttons?i.buttons:[0,1,4,2][i.which],1)},t}(),LoadingScreen:function(){function t(){}return t.prototype.loading=function(t){var i=t.output,n=t.progress,h=i.context[0],s="number"==typeof n?Math.max(1,n*i.height):i.height;h.globalCompositeOperation="source-over",h.globalAlpha=1,h.clearRect(0,0,i.width,i.height),h.fillStyle="#aaa",h.fillRect(0,i.height/2-s/2,i.width,s),h.font="20px Georgia",h.fillStyle="#fff",h.textAlign="left",h.textBaseline="bottom",h.fillText(isNaN(parseFloat(n))?n:"Loading "+Math.round(100*n)+"%",10+3*Math.random(),i.height-10+3*Math.random())},t}(),Norm:function(){function t(){}var i=t.prototype;return i.viewport=function(t,i){var n=t.engine,h=n.getWidth()/2,s=n.getHeight()/2,r=n.getRatio()>1?h:s;return i.translate(h,s).scale(r,r)},i.additionalModifier=function(t){var i=t.engine,n=t.output,h=t.scene;h.cacheClear();var s={alpha:1,x:-1,y:-1,width:2,height:2,widthInPixel:n.width,heightInPixel:n.height,scaleCanvas:n.width/n.canvas[0].clientWidth},r=h.transformPoint(0,0,1),e=r[0],o=r[1],u=h.transformPoint(n.width,n.height,1);s.visibleScreen={x:e,y:o,width:u[0]-e,height:u[1]-o};var a=i.getWidth()/2,f=i.getHeight()/2,c=i.getRatio()>1?a:f,v=(new y).translate(a,f).scale(c,c).invert(),l=v.transformPoint(0,0,1),d=l[0],m=l[1],b=v.transformPoint(n.width,n.height,1);return s.fullScreen={x:d,y:m,width:b[0]-d,height:b[1]-m},s},t}(),TimingAudio:function(t){function i(i){var n;return void 0===i&&(i={}),(n=t.call(this,i)||this).K=Number.POSITIVE_INFINITY,n.gi=null,n.yi=null,n.pi=!1,n.wi=n.V.audioElement,n}a(i,t);var n=i.prototype;return n.init=function(){var t=this;if(this.wi)return"function"==typeof MediaController&&(this.wi.controller=new MediaController,this.pi=!0),this.wi.preload="auto",new Promise(function(i){t.wi.addEventListener("canplaythrough",function n(){t.wi.removeEventListener("canplaythrough",n);var h=t.wi.play();h&&h.catch(function(t){}),i()}),t.wi.load()})},n.endTime=function(){return 1e3*this.wi.duration},n.currentTime=function(){var i=t.prototype.currentTime.call(this);if(this.wi){var n=1e3*(this.wi.ended?this.wi.duration:this.wi.currentTime);if(this.pi){if(null===this.gi)return this.gi=i,this.yi=n,n;if("playing"===this.wi.controller.playbackState){if(n===this.yi)return this.yi+Math.min(260,i-this.gi);if(n-this.yi<500&&n>this.yi&&i-this.gi<350)return this.gi=this.gi+(n-this.yi),this.yi=n,this.yi+i-this.gi}return this.gi=i,this.yi=n,this.yi}return n}return i},n.clampTime=function(t){return t.timePassed},n.shiftTime=function(){return 0},u(i,[{key:"audioElement",get:function(){return this.wi}}]),i}(w),TimingDefault:w};t.Animations=Ct,t.Easing=Tt,t.Engine=s,t.ImageManager=b,t.Middleware=qt,t.Scene=S,t.Sprites=at});
//# sourceMappingURL=animationvideo.umd.js.map
