!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t=t||self).AnimationVideo={})}(this,function(t){function i(t){for(var i=arguments.length,s=new Array(i>1?i-1:0),h=1;h<i;h++)s[h-1]=arguments[h];return"function"==typeof t?t.apply(null,s):t}class s{constructor(t){var i=t;if("object"!=typeof t)throw new Error("No canvas given for Engine constructor");if(t.getContext)i={canvas:t};else if(!t.canvas)throw new Error("No canvas given for Engine constructor");var s=Object.assign({},i);if(this.i={canvas:[],context:[],width:0,height:0,ratio:1},this.o=[],this.u=null,this.M=!1,this.p=0,this.A=!1,this.k=null,this.i.canvas=Array.isArray(s.canvas)?s.canvas:[s.canvas],s.autoSize){var h={enabled:!0,scaleLimitMin:1,scaleLimitMax:3,scaleFactor:1.07,referenceWidth:()=>this.i.canvas[0].clientWidth,referenceHeight:()=>this.i.canvas[0].clientHeight,currentScale:1,waitTime:100,currentWaitedTime:0,currentOffsetTime:0,offsetTimeLimitUp:300,offsetTimeLimitDown:300,registerResizeEvents:!0,registerVisibilityEvents:!0,setCanvasStyle:!1};this.O="object"==typeof s.autoSize?Object.assign({},h,s.autoSize):h,this.O.registerResizeEvents&&(this.o=["resize","orientationchange"].map(t=>({n:window,e:t,f:this.recalculateCanvas.bind(this)}))),this.O.registerVisibilityEvents&&this.o.push({n:document,e:"visibilitychange",f:this.handleVisibilityChange.bind(this)}),this.I()}else this.i.width=this.i.canvas[0].width,this.i.height=this.i.canvas[0].height,this.i.ratio=this.i.width/this.i.height;this.i.canvas.forEach((t,i)=>{this.i.context[i]=t.getContext("2d")}),this.P=this.i.canvas.length,this.F=Array.from({length:this.P},t=>0),s.clickToPlayAudio&&this.o.push({n:this.i.canvas[0],e:"click",f:this.playAudioOfScene.bind(this)}),this.S=s.reduceFramerate,this.o.forEach(t=>{t.n.addEventListener(t.e,t.f)}),this.switchScene(s.scene,s.sceneParameter||{})}handleVisibilityChange(){this.O.enabled=!("hidden"==document.visibilityState)}playAudioOfScene(){this.M&&this.u&&this.u.timing.audioElement&&this.u.timing.audioElement.play()}_(t){t.textBaseline="middle",t.textAlign="center",t.globalAlpha=1,t.globalCompositeOperation="source-over"}getWidth(){return this.i.width}getHeight(){return this.i.height}getRatio(){return this.i.ratio}getOutput(){return this.i}recalculateCanvas(){return this.A=!0,this}I(){if(this.O){var t=i(this.O.referenceWidth),s=i(this.O.referenceHeight);if(t<=0||s<=0)return;this.i.canvas.forEach(i=>{i.width=Math.round(t/this.O.currentScale),i.height=Math.round(s/this.O.currentScale),this.O.setCanvasStyle&&(i.style.width=t+"px",i.style.height=s+"px")}),this.O.currentWaitedTime=0,this.O.currentOffsetTime=0}this.i.width=this.i.canvas[0].width,this.i.height=this.i.canvas[0].height,this.i.ratio=this.i.width/this.i.height,this.resize()}async recalculateFPS(){this.k&&(window.cancelAnimationFrame(this.k),this.k=!1),await new Promise(t=>requestAnimationFrame(t));for(var t=this.j(),i=3;i--;)await new Promise(t=>requestAnimationFrame(t));var s=(this.j()-t)/3;this.O.offsetTimeTarget=s,this.O.offsetTimeDelta=s/3,!1===this.k&&(this.C=!1,this.k=window.requestAnimationFrame(this.T.bind(this)))}resize(){return this.u&&this.u.resize&&this.u.resize(this.i),this}switchScene(t,i){return t&&(this.L=t,this.D=i),this}j(){return window.performance?performance.now():Date.now()}T(t){this.k=window.requestAnimationFrame(this.T.bind(this));var i=!1;!this.A||this.S&&this.N?this.B&&(i=!0):(this.I(),this.A=!1,i=!0);for(var s=0;s<this.P;s++)this.F[s]=Math.max(this.F[s]-1,i?1:0);if(this.C||(this.C=t),this.R||(this.R=t),this.L&&!this.W&&(this.W=Promise.resolve(this.u?this.u.destroy(this.i):{}),this.W.then(i=>{this.L.callInit(this.i,{run:this.G,scene:this.D,destroy:i},this),this.u=this.L,this.L=void 0,this.W=void 0,this.M=!1,this.p=this.u.currentTime(),this.R=t})),this.u&&(this.S&&(this.N=!this.N),!this.S||this.N)){var h=this.u.currentTime(),r=this.u.clampTime(h-this.p),e=this.u.shiftTime(r);if(r+=e,this.p=h+e,this.M){var n=0!==r||this.B;this.B=!1;var a=this.u.isDrawFrame(this.i,r);if(Array.isArray(a))for(var o=0;o<this.P;o++)this.F[o]=Math.max(this.F[o],a[o]);else for(var u=0;u<this.P;u++)this.F[u]=Math.max(this.F[u],a);var c=this.j();if(n&&this.u.move(this.i,r),this.i.canvas[0].width)for(var f=0;f<this.P;f++)this.F[f]&&(this._(this.i.context[f]),this.u.draw(this.i,f,i));if(this.O&&this.O.enabled){var l=t-this.C;if(this.O.currentWaitedTime<this.O.waitTime)this.O.currentWaitedTime+=l;else if(n){var v=this.O.offsetTimeTarget*(this.S?2:1),d=this.j()-c,m=(Math.abs(l-v)>Math.abs(d-v)?l:d)-v;Math.abs(m)<=this.O.offsetTimeDelta?this.O.currentOffsetTime=this.O.currentOffsetTime>=0?Math.max(0,this.O.currentOffsetTime-this.O.offsetTimeDelta):Math.min(0,this.O.currentOffsetTime+this.O.offsetTimeDelta):m<0&&this.O.currentScale>this.O.scaleLimitMin?(this.O.currentOffsetTime+=m,this.O.currentOffsetTime<=-this.O.offsetTimeLimitDown&&(this.O.currentScale=Math.max(this.O.scaleLimitMin,this.O.currentScale/this.O.scaleFactor),this.A=!0)):m>0&&this.O.currentScale<this.O.scaleLimitMax&&(this.O.currentOffsetTime+=m,this.O.currentOffsetTime>=this.O.offsetTimeLimitUp&&(this.O.currentScale=Math.min(this.O.scaleLimitMax,this.O.currentScale*this.O.scaleFactor),this.A=!0))}}}else{for(var y=0;y<this.P;y++)this._(this.i.context[y]);this.M=this.u.callLoading({output:this.i,timePassed:t-this.C,totalTimePassed:t-this.R}),this.M&&(this.u.reset(),this.p=this.u.currentTime(),this.B=!0,this.O&&(this.O.currentWaitedTime=0))}}this.C=t}async run(t){return this.G=t||{},await this.stop(),this.C=this.R=!1,this.O&&!this.O.offsetTimeTarget&&await this.recalculateFPS(),this.k=window.requestAnimationFrame(this.T.bind(this)),this}async stop(){this.k&&window.cancelAnimationFrame(this.k),this.k=null,this.u&&await this.u.destroy(this.i)}async destroy(){return await this.stop(),this.o.forEach(t=>{t.n.removeEventListener(t.e,t.f)}),this.o=[],this}}class h{constructor(){this.Images={},this.count=0,this.loaded=0}static add(t,i){var s=this||h,r=function(h){if(s.Images[h])i&&"function"==typeof i[h]&&i[h](h,s.Images[h]);else{if(s.Images[h]=new window.Image,s.Images[h].onload=function(){s.loaded++,i&&"function"==typeof i?s.isLoaded()&&i():i&&"function"==typeof i[h]&&i[h](h,s.Images[h]),s.resolve&&s.isLoaded()&&(s.resolve(),s.resolve=null)},"<svg"===t[h].substr(0,4)){var r=window.URL||window.webkitURL||window,e=new window.Blob([t[h]],{type:"image/svg+xml"});s.Images[h].src=r.createObjectURL(e)}else"http"===t[h].substr(0,4)&&(s.Images[h].crossOrigin=""),s.Images[h].src=t[h];s.count++}};for(var e in t)r(e);return i&&"function"==typeof i&&s.isLoaded()&&i(),s.resolve&&s.isLoaded()&&(s.resolve(),s.resolve=null),s}static reset(){var t=this||h;return t.Images={},t.count=0,t.loaded=0,t}static getLoaded(){return(this||h).loaded}static getCount(){return(this||h).count}static isLoaded(){var t=this||h;return t.loaded===t.count}static getImage(t){return"object"==typeof t?t:(this||h).Images[t]}static isLoadedPromise(){var t=this||h;return!!t.isLoaded()||new Promise((i,s)=>{t.resolve=i})}}h.Images={},h.count=0,h.loaded=0;class r{constructor(t){this.X=[],this.Y=[],this.H=0,this.U=0,this.V=void 0===t?[]:Array.isArray(t)?t:[t]}addElement(t){return this.addElementForId(t),t}addElements(t){return this.addElementsForIds(t),t}addElementForId(t){var i=this.X.length,s=this.U;this.X[s]=t,this.Y[s]="function"==typeof t,i===s&&i++;for(var h=this.U+1;h!==i&&this.X[h];)h++;return this.U=h,this.H>s&&(this.H=s),s}addElementsForIds(t){var i=this.X.length;return i===this.U?(this.X=this.X.concat(t),this.U=this.X.length,t.forEach((t,s)=>{this.Y[i+s]="function"==typeof t}),Array.from({length:t.length},(t,s)=>s+i)):t.map(t=>this.addElement(t))}getById(t){return this.X[t]}getIdByElement(t){return this.X.indexOf(t)}deleteByElement(t){var i=this.getIdByElement(t);i>=0&&this.deleteById(i)}deleteById(t){var i=this.X.length-1;if(i>0&&t===i){for(this.X[t]=null;i&&!this.X[i-1];)i--;this.X.length=i,this.Y.length=i,this.U=Math.min(this.U,i),this.H=Math.min(this.H,i)}else this.X[t]&&(this.X[t]=null,this.U=Math.min(this.U,t),this.H===t&&(this.H=t+1))}isCanvasId(t){return void 0===t||!this.V.length||this.V.includes(t)}forEach(t,i){var s,h;void 0===i&&(i=0);var r=this.X.length;for(s=this.H;s<r;s++)(h=this.X[s])&&t({elementId:s,layerId:i,element:h,isFunction:this.Y[s],layer:this})}play(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.forEach(s=>{var{element:h,isFunction:r}=s;return!r&&h.play(t,i)})}count(){for(var t=0,i=this.X.length,s=this.H;s<i;s++)this.X[s]&&t++;return t}clear(){this.X=[],this.Y=[],this.H=0,this.U=0}}class e{constructor(){this.J=[]}addLayer(t){return this.J[this.J.length]=new r(t),this.J[this.J.length-1]}addLayers(t,i){void 0===t&&(t=1);var s=Array.from({length:t},t=>new r(i));return this.J=this.J.concat(s),s}addLayerForId(t){return this.J[this.J.length]=new r(t),this.J.length-1}addLayersForIds(t,i){void 0===t&&(t=1);var s=Array.from({length:t},(t,i)=>i+this.J.length);return this.J=this.J.concat(Array.from({length:t},t=>new r(i))),s}getById(t){return this.J[t]}forEach(t,i){var s,h=this.J.length;for(s=0;s<h;s++)this.J[s].isCanvasId(i)&&this.J[s].forEach(t,s)}play(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.forEach(s=>{var{element:h,isFunction:r}=s;return!r&&h.play(t,i)})}count(){return this.J.length}clear(){this.J=[]}}function n(t,i){return null==t||""===t?i:t}class a{constructor(t){void 0===t&&(t={}),this.$=t,this.Z=n(i(this.$.tickChunk),100/6),this.K=n(i(this.$.maxSkippedTickChunk),120),this.tt=n(i(this.$.tickChunkTolerance),.1),this.totalTimePassed=0}init(){}isLoaded(){return!0}currentTime(){return window.performance?performance.now():Date.now()}clampTime(t){var i=this.Z?this.Z*this.K:2e3;return t>i?i:t}shiftTime(t){return this.Z?-t%this.Z:0}get tickChunk(){return this.Z}isChunked(){return this.Z}hasOneChunkedFrame(t){return t>=this.Z-this.tt}calcFrames(t){return Math.min(this.K,Math.floor((t+this.tt)/this.Z))}}class o{constructor(t){this.$="function"==typeof t?new t:t,this.it=new e,this.st=null,this.ht=!1,this.rt=void 0,this.et=h,this.nt=this.$.timing||new a}currentTime(){return this.nt.currentTime()}clampTime(t){return this.nt.clampTime(t)}shiftTime(t){return this.nt.shiftTime(t)}callInit(t,s,h){this.st=h,this.resize(t);var r=i(this.$.images);r&&this.et.add(r),this.nt.init(),Promise.resolve(this.$.init&&this.$.init({engine:h,output:t,scene:this,parameter:s,imageManager:this.et})).then(t=>this.ht=!0)}resize(t){this.rt={alpha:1,x:0,y:0,width:t.width,height:t.height,widthInPixel:t.width,heightInPixel:t.height,scaleCanvas:1,visibleScreen:{x:0,y:0,width:t.width,height:t.height},fullScreen:{x:0,y:0,width:t.width,height:t.height}},this.it.forEach(i=>{var{element:s,isFunction:h}=i;h||s.resize(t,this.rt)})}destroy(t){var i=this.$.destroy&&this.$.destroy({engine:this.st,scene:this,output:t,layerManager:this.it,imageManager:this.et});return this.ht=!1,i}get configuration(){return this.$}get timing(){return this.nt}loadingScreen(t){var{output:i,timePassed:s,totalTimePassed:h,progress:r}=t;if(this.$.loading)return this.$.loading({engine:this.st,scene:this,output:i,timePassed:s,totalTimePassed:h,progress:r,imageManager:this.et});var e=i.context[0],n="number"==typeof r?Math.max(1,r*i.height):i.height;e.globalCompositeOperation="source-over",e.globalAlpha=1,e.clearRect(0,0,i.width,i.height),e.fillStyle="#aaa",e.fillRect(0,i.height/2-n/2,i.width,n),e.font="20px Georgia",e.fillStyle="#fff",e.textAlign="left",e.textBaseline="bottom",e.fillText(isNaN(parseFloat(r))?r:"Loading "+Math.round(100*r)+"%",10+3*Math.random(),i.height-10+3*Math.random())}callLoading(t){var i=this.nt.isLoaded();return this.et.isLoaded()&&this.ht&&i?(this.$.endTime||!0===i||(this.$.endTime=i),t.progress="Click to play",this.loadingScreen(t),!0):(t.progress=this.et.getCount()?this.et.getLoaded()/this.et.getCount():"Loading...",this.loadingScreen(t),!1)}fixedUpdate(t,i,s){this.$.fixedUpdate&&this.$.fixedUpdate({engine:this.st,scene:this,layerManager:this.it,output:t,timePassed:i,totalTimePassed:this.nt.totalTimePassed,imageManager:this.et,lastCall:s})}isDrawFrame(t,i){return this.$.isDrawFrame?this.$.isDrawFrame({engine:this.st,scene:this,layerManager:this.it,output:t,timePassed:i,totalTimePassed:this.nt.totalTimePassed,imageManager:this.et}):0!==i}move(t,i){if(this.nt.totalTimePassed+=i,i<0?(i=this.nt.totalTimePassed,this.reset(),this.nt.totalTimePassed=i):this.$.endTime&&this.$.endTime<=this.nt.totalTimePassed&&(i-=this.nt.totalTimePassed-this.$.endTime,this.nt.totalTimePassed=this.$.endTime,this.$.end&&this.$.end({engine:this.st,scene:this,output:t,timePassed:i,totalTimePassed:this.nt.totalTimePassed,imageManager:this.et})),this.nt.isChunked()){if(this.nt.hasOneChunkedFrame(i))for(var s=this.nt.calcFrames(i)-1,h=0;h<=s;h++)this.fixedUpdate(t,this.nt.tickChunk,h===s)}else this.fixedUpdate(t,i,!0);this.$.update&&this.$.update({engine:this.st,scene:this,layerManager:this.it,output:t,timePassed:i,totalTimePassed:this.nt.totalTimePassed,imageManager:this.et}),this.it.forEach(t=>{var{element:s,isFunction:h,layer:r,elementId:e}=t;h||s.animate(i)&&r.deleteById(e)})}draw(t,i,s){var h=t.context[i];this.it.forEach(i=>{var{layer:s,layerId:r,element:e,isFunction:n,elementId:a}=i;n?e({layerId:r,elementId:a,engine:this.st,scene:this,layerManager:this.it,layer:s,output:t,context:h,totalTimePassed:this.nt.totalTimePassed,imageManager:this.et})&&s.deleteById(a):e.draw(h,this.rt)},i)}reset(){this.nt.totalTimePassed=0;var t=this.$.reset?this.$.reset({engine:this.st,scene:this,layerManager:this.it,output:this.st.getOutput(),imageManager:this.et}):new e;if(Array.isArray(t)){var i=t;t=new e,i.forEach(i=>{t.addLayer().addElements(i)})}t&&(this.it=t)}}function u(){this.reset()}u.prototype.reset=function(){return this.m=[1,0,0,1,0,0],this},u.prototype.multiply=function(t){var i=this.m[1]*t.m[0]+this.m[3]*t.m[1],s=this.m[0]*t.m[2]+this.m[2]*t.m[3],h=this.m[1]*t.m[2]+this.m[3]*t.m[3],r=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],e=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=this.m[0]*t.m[0]+this.m[2]*t.m[1],this.m[1]=i,this.m[2]=s,this.m[3]=h,this.m[4]=r,this.m[5]=e,this},u.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),i=-this.m[1]*t,s=-this.m[2]*t,h=this.m[0]*t,r=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),e=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=this.m[3]*t,this.m[1]=i,this.m[2]=s,this.m[3]=h,this.m[4]=r,this.m[5]=e,this},u.prototype.rotate=function(t){var i=Math.cos(t),s=Math.sin(t),h=this.m[1]*i+this.m[3]*s,r=this.m[0]*-s+this.m[2]*i,e=this.m[1]*-s+this.m[3]*i;return this.m[0]=this.m[0]*i+this.m[2]*s,this.m[1]=h,this.m[2]=r,this.m[3]=e,this},u.prototype.translate=function(t,i){return this.m[4]+=this.m[0]*t+this.m[2]*i,this.m[5]+=this.m[1]*t+this.m[3]*i,this},u.prototype.scale=function(t,i){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=i,this.m[3]*=i,this},u.prototype.transformPoint=function(t,i){var s=t;return[t=s*this.m[0]+i*this.m[2]+this.m[4],i=s*this.m[1]+i*this.m[3]+this.m[5]]},u.prototype.clone=function(){var t=new u;return t.m=this.m.slice(0),t};class c extends o{constructor(){super(...arguments),this.at=null,this.ot=null,this.cam={zoom:1,x:0,y:0}}ut(){return this.st?(this.at||(this.at=this.ct(this.cam),this.ot=null),this.at):new u}ct(t){var i=this.st.getWidth()/2,s=this.st.getHeight()/2,h=this.st.getRatio()>1?i:s;return(new u).translate(i,s).scale(h,h).scale(t.zoom,t.zoom).translate(-t.x,-t.y)}resize(t){this.at=null,this.ot=null,this.rt={alpha:1,x:-1,y:-1,width:2,height:2,widthInPixel:t.width,heightInPixel:t.height,scaleCanvas:t.width/t.canvas[0].clientWidth};var[i,s]=this.transformPoint(0,0,1),[h,r]=this.transformPoint(t.width,t.height,1);this.rt.visibleScreen={x:i,y:s,width:h-i,height:r-s};var e=this.ct({x:0,y:0,zoom:1}).invert(),[n,a]=e.transformPoint(0,0,1),[o,u]=e.transformPoint(t.width,t.height,1);this.rt.fullScreen={x:n,y:a,width:o-n,height:u-a},this.rt.cam=this.cam,this.it.forEach(i=>{var{element:s,isFunction:h}=i;h||s.resize(t,this.rt)})}transformPoint(t,i,s){return void 0===s&&(s=this.rt.scaleCanvas),this.ot||(this.ot=this.ut().clone().invert()),this.ot.transformPoint(t*s,i*s)}draw(t,i,s){var h=t.context[i];h.save(),h.setTransform(...this.ut().m),super.draw(t,i),h.restore()}}class f extends c{constructor(){super(...arguments),this.o=[],this.camConfig=Object.assign({},{zoomMax:10,zoomMin:.5,zoomFactor:1.2,tween:2,registerEvents:!0,preventDefault:!0,enabled:!0,callResize:!0,doubleClickDetectInterval:350,alternative:!1},i(this.$.cam)||{}),this.$.click||(this.$.click=()=>{}),this.toCam={x:this.camConfig.currentX||0,y:this.camConfig.currentY||0,zoom:this.camConfig.currentZoom||1},this.ft={lt:-1,vt:-1,dt:1,yt:1,gt:2,Mt:2},this.wt=[],this.pt=!1,this.bt=!1}camEnable(){return this.camConfig.enabled=!0,this}camDisable(){return this.camConfig.enabled=!1,this}camReset(){return this.toCam={x:0,y:0,zoom:1},this}camTween(t){return this.camConfig.tween=t,this}camAlternative(t){return this.wt=[],this.camConfig.alternative=t,this}setClampLimit(t,i,s,h){return this.ft={lt:t,vt:i,dt:s,yt:h,gt:s-t,Mt:h-i},this}callInit(t,i,s){return this.camConfig.registerEvents&&this.xt(t.canvas[0]),super.callInit(t,i,s)}destroy(t){return this.camConfig.registerEvents&&this.At(),super.destroy(t)}hasCamChanged(){var t=this.camConfig.tween||1;return Math.abs(this.toCam.x-this.cam.x)>=Number.EPSILON*t||Math.abs(this.toCam.y-this.cam.y)>=Number.EPSILON*t||Math.abs(this.toCam.zoom-this.cam.zoom)>=Number.EPSILON*t}fixedUpdate(t,i,s){return this.camConfig.tween&&this.hasCamChanged()&&(this.cam.x+=(this.toCam.x-this.cam.x)/this.camConfig.tween,this.cam.y+=(this.toCam.y-this.cam.y)/this.camConfig.tween,this.cam.zoom+=(this.toCam.zoom-this.cam.zoom)/this.camConfig.tween,s&&(this.rt.cam=this.cam,this.camConfig.callResize?super.resize(t):(this.at=null,this.ot=null))),super.fixedUpdate(t,i,s)}isDrawFrame(t,i){var s=super.isDrawFrame(t,i);return(this.pt||this.bt)&&(Array.isArray(s)?s[0]=Math.max(1,s[0]):s=Math.max(1,s)),s}move(t,i){var s=super.move(t,i);return!this.camConfig.tween&&this.hasCamChanged()&&(this.cam=Object.assign({},this.toCam),this.camConfig.callResize?super.resize(t):(this.at=null,this.ot=null)),s}draw(t,i,s){if(!i&&!s&&(this.pt||this.bt)){var h=this.rt.scaleCanvas,r=t.context[i];r.clearRect(0,0,r.canvas.width,r.canvas.height),r.save(),r.setTransform(...this.ut().m),this.it.forEach(t=>{var{layerId:i,element:s,isFunction:h,elementId:e}=t;h||s.detect(r,"rgb("+(255&e)+", "+((65280&e)>>8)+", "+(255&i)+")")},0),r.restore();var e=[];if(this.pt){var{mx:n,my:a}=this.pt;if((e=r.getImageData(Math.round(n/h),Math.round(a/h),1,1).data)[3]){var o=e[2],u=e[0]+(e[1]<<8),c=this.it.getById(o).getById(u),[f,l]=this.transformPoint(n,a);this.$.clickElement({element:c,layerId:o,elementId:u,mx:n,my:a,x:f,y:l,scene:this,engine:this.st,imageManager:this.et})}else if(this.$.clickNonElement){var[v,d]=this.transformPoint(n,a);this.$.clickNonElement({mx:n,my:a,x:v,y:d,scene:this,engine:this.st,imageManager:this.et})}this.pt=!1}if(!e[3]&&this.bt){var{mx:m,my:y}=this.bt;if((e=r.getImageData(Math.round(m/h),Math.round(y/h),1,1).data)[3]){var g=e[2],M=e[0]+(e[1]<<8),w=this.it.getById(g).getById(M),[p,b]=this.transformPoint(m,y);this.$.hoverElement({element:w,layerIndex:g,index:M,mx:m,my:y,x:p,y:b,scene:this,engine:this.st,imageManager:this.et})}this.bt=!1}}super.draw(t,i)}resize(t){super.resize(t),this.clampView()}xt(t){this.o=[[["touchstart","mousedown"],this.kt],[["touchend","mouseup"],this.Ot],[["touchendoutside","mouseout"],this.It],[["touchmove","mousemove"],this.Pt],[["wheel"],this.Ft],[["contextmenu"],this.ePrevent]].map(i=>{var[s,h]=i;return s.map(i=>({n:t,e:i,f:h.bind(this)}))}).reduce((t,i)=>(Array.isArray(i)?t.push.apply(t,i):t.push(i),t),[]),this.o.forEach(t=>{t.n.addEventListener(t.e,t.f,!0)})}At(){this.o.forEach(t=>{t.n.removeEventListener(t.e,t.f,!0)}),this.o=[]}ePrevent(t){t.preventDefault()}St(t){var i;if(t.touches&&t.touches.length>0?i=t.targetTouches:t.changedTouches&&t.changedTouches.length>0&&(i=t.changedTouches),i){var s=t.target.getBoundingClientRect(),h=i.length;return[(i=Array.from(i)).reduce((t,i)=>t+i.pageX,0)/h-s.left,i.reduce((t,i)=>t+i.pageY,0)/h-s.top]}if(void 0===t.offsetX){var r=t.target.getBoundingClientRect();return[t.clientX-r.left,t.clientY-r.top]}return[t.offsetX,t.offsetY]}_t(t){return this.camConfig.alternative?t.which?t.which-1:t.button||0:0}kt(t){this.camConfig.preventDefault&&t.preventDefault();var[i,s]=this.St(t),h=this._t(t);if(this.wt[h]=Object.assign({},this.wt[h],{x:i,y:s,jt:this.toCam.x,Ct:this.toCam.y,zt:!0,Tt:t.touches&&t.touches.length||1,Et:void 0,Lt:Date.now()}),this.$.mouseDown){var[r,e]=this.transformPoint(i,s);this.$.mouseDown({event:t,x:r,y:e,scene:this,engine:this.st,imageManager:this.et})}}Ot(t){this.camConfig.preventDefault&&t.preventDefault();var i=this._t(t);this.wt[i]||(this.wt[i]={});var s=this.wt[i].zt,h=t.changedTouches&&t.changedTouches.length||1,r=Math.max(this.wt[i].Tt,h);this.wt[i].zt=!1,this.wt[i].Tt-=h;var[e,n]=this.St(t);if(this.$.mouseUp){var[a,o]=this.transformPoint(e,n);this.$.mouseUp({event:t,x:a,y:o,scene:this,engine:this.st,imageManager:this.et})}if(s&&!(r>1))if(Date.now()-this.wt[i].Lt<300&&Math.abs(this.wt[i].x-e)<5&&Math.abs(this.wt[i].y-n)<5&&!i){var[u,c]=this.transformPoint(e,n);this.pt=this.$.clickElement&&{mx:e,my:n},this.$.doubleClick?this.wt[i].doubleClickTimer?(clearTimeout(this.wt[i].doubleClickTimer),this.wt[i].doubleClickTimer=void 0,this.$.doubleClick({event:t,x:u,y:c,scene:this,engine:this.st,imageManager:this.et})):this.wt[i].doubleClickTimer=setTimeout(()=>{this.wt[i].doubleClickTimer=void 0,this.$.click({event:t,x:u,y:c,scene:this,engine:this.st,imageManager:this.et})},this.camConfig.doubleClickDetectInterval):this.$.click({event:t,x:u,y:c,scene:this,engine:this.st,imageManager:this.et})}else if(this.camConfig.alternative&&!i){var[f,l]=this.transformPoint(e,n),[v,d]=this.transformPoint(this.wt[i].x,this.wt[i].y);this.$.region&&this.$.region({event:t,x1:Math.min(v,f),y1:Math.min(d,l),x2:Math.max(v,f),y2:Math.max(d,l),fromX:v,fromY:d,toX:f,toY:l,scene:this})}}It(t){var i=this._t(t);this.wt[i]&&(this.wt[i].zt=!1),this.$.mouseOut&&this.$.mouseOut({event:t,scene:this,engine:this.st,imageManager:this.et})}Pt(t){this.camConfig.preventDefault&&t.preventDefault();var i=this._t(t),[s,h]=this.St(t);if(this.bt=this.$.hoverElement&&{mx:s,my:h},this.$.mouseMove){var[r,e]=this.transformPoint(s,h);this.$.mouseMove({event:t,x:r,y:e,scene:this,engine:this.st,imageManager:this.et})}if(this.wt[i]&&this.wt[i].zt&&(0!==t.which||t.touches)){var n=this.rt.scaleCanvas;if(this.camConfig.enabled){if(t.touches&&t.touches.length>=2){var a=t.touches,o=Math.sqrt((a[0].pageX-a[1].pageX)*(a[0].pageX-a[1].pageX)+(a[0].pageY-a[1].pageY)*(a[0].pageY-a[1].pageY));if(void 0===this.wt[i].Et)o>0&&(this.wt[i].Et=o,this.wt[i].Dt=this.toCam.zoom);else{if(this.toCam.zoom=Math.max(this.camConfig.zoomMin,Math.min(this.camConfig.zoomMax,this.wt[i].Dt*o/this.wt[i].Et)),this.camConfig.alternative){var u=this.ct(this.toCam).invert(),[c,f]=u.transformPoint(this.wt[i].x*n,this.wt[i].y*n),[l,v]=u.transformPoint(s*n,h*n);this.toCam.x=this.wt[i].jt+c-l,this.toCam.y=this.wt[i].Ct+f-v}this.clampView()}return}if(this.wt[i].Et=void 0,!this.camConfig.alternative||2===i){var d=this.ct(this.toCam).invert(),[m,y]=d.transformPoint(this.wt[i].x*n,this.wt[i].y*n),[g,M]=d.transformPoint(s*n,h*n);this.toCam.x=this.wt[i].jt+m-g,this.toCam.y=this.wt[i].Ct+y-M,this.clampView()}}if(this.camConfig.alternative&&0===i&&this.$.regionMove&&!(Date.now()-this.wt[i].Lt<300&&Math.abs(this.wt[i].x-s)<5&&Math.abs(this.wt[i].y-h)<5)&&(!t.touches||1===t.touches.length)){var[w,p]=this.transformPoint(s,h),[b,x]=this.transformPoint(this.wt[i].x,this.wt[i].y);this.$.regionMove({event:t,x1:Math.min(b,w),y1:Math.min(x,p),x2:Math.max(b,w),y2:Math.max(x,p),fromX:b,fromY:x,toX:w,toY:p,scene:this})}}}Ft(t){if(this.camConfig.preventDefault&&t.preventDefault(),this.camConfig.enabled){var i=this.rt.scaleCanvas,[s,h]=this.St(t),[r,e]=this.ct(this.toCam).invert().transformPoint(s*i,h*i);if((t.wheelDelta||-1*t.deltaY)/120>0){this.zoomIn();var[n,a]=this.ct(this.toCam).invert().transformPoint(s*i,h*i);this.toCam.x-=n-r,this.toCam.y-=a-e,this.clampView()}else this.zoomOut()}}zoomIn(){return this.toCam.zoom=Math.min(this.camConfig.zoomMax,this.toCam.zoom*this.camConfig.zoomFactor),this}zoomOut(){return this.toCam.zoom=Math.max(this.camConfig.zoomMin,this.toCam.zoom/this.camConfig.zoomFactor),this.clampView(),this}zoomTo(t,i,s,h){var r=this.rt.scaleCanvas,e=this.ct(this.toCam).invert(),[n,a]=e.transformPoint(0,0),[o,u]=e.transformPoint(this.st.getWidth()*r,this.st.getHeight()*r),c=s-t,f=h-i,l=i+f/2,v=(o-n)/c,d=(u-a)/f;return this.toCam.x=t+c/2,this.toCam.y=l,this.toCam.zoom=this.toCam.zoom*Math.max(Math.min(v,d),Number.MIN_VALUE),this}clampView(){var t=this.ct(this.toCam).invert(),[i,s]=t.transformPoint(0,0),[h,r]=t.transformPoint(this.st.getWidth(),this.st.getHeight());return h-i<=this.ft.gt?i<this.ft.lt?h<=this.ft.dt&&(this.toCam.x+=this.ft.lt-i):h>this.ft.dt&&(this.toCam.x+=this.ft.dt-h):i>this.ft.lt?this.toCam.x+=this.ft.lt-i:h<this.ft.dt&&(this.toCam.x+=this.ft.dt-h),r-s<=this.ft.Mt?s<this.ft.vt?r<=this.ft.yt&&(this.toCam.y+=this.ft.vt-s):r>this.ft.yt&&(this.toCam.y+=this.ft.yt-r):s>this.ft.vt?this.toCam.y+=this.ft.vt-s:r<this.ft.yt&&(this.toCam.y+=this.ft.yt-r),this}}var l={Default:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new o(...i)},Norm:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new c(...i)},NormCamera:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new f(...i)}};class v{constructor(t){this.duration=i(t)-0}run(t,i){return i-this.duration}}class d{constructor(){for(var t=0,i=arguments.length,s=new Array(i),h=0;h<i;h++)s[h]=arguments[h];"number"==typeof s[0]&&(t=s.shift()),this.sequences=s.map(i=>{Array.isArray(i)||(i=[i]);var s=t;return"number"==typeof i[0]&&(s=i.shift()),{position:0,timelapsed:-s,sequence:i.map(t=>"function"!=typeof t.run?"number"==typeof t?new v(t):{run:t}:t).filter(t=>"function"==typeof t.run),label:i.reduce((t,i,s)=>("string"==typeof i&&(t[i]=s-Object.keys(t).length),t),{}),enabled:!0}}),this.lastTimestamp=0,this.enabled=!0}reset(t){void 0===t&&(t=0),this.sequences.forEach(i=>{i.enabled=!0,i.position=0,i.timelapsed=t,i.sequence[0]&&i.sequence[0].reset&&i.sequence[0].reset(t)}),this.enabled=!0}play(t,i){if(void 0===t&&(t=""),void 0===i&&(i=0),t){var s=this.sequences.reduce((s,h)=>(h.label.hasOwnProperty(t)?(s=!0,h.position=h.label[t],h.enabled=!0,h.timelapsed=i,h.sequence[h.position]&&h.sequence[h.position].reset&&h.sequence[h.position].reset()):s|=h.sequence.find(s=>s.play&&s.play(t,i))>=0,s),!1);return s&&(this.enabled=!0),s}return this.sequences.forEach(t=>t.enabled=!0),this.enabled=!0,!0}runSequence(t,i,s){for(var h=s;i.sequence[i.position]&&h>=0;){if(i.timelapsed+=h,i.timelapsed<0)return-1;if(!0===(h=i.sequence[i.position].run(t,i.timelapsed)))h=0;else{if(!1===h)return-1;if(h===d.TIMELAPSE_TO_FORCE_DISABLE)return i.enabled=!1,this.enabled=!1,s;if(h===d.TIMELAPSE_TO_STOP)return i.enabled=!1,s;if(h===d.TIMELAPSE_TO_REMOVE)return!0}if(h>=0&&(i.position=(i.position+1)%i.sequence.length,i.sequence[i.position]&&i.sequence[i.position].reset&&i.sequence[i.position].reset(),i.timelapsed=0,0===i.position))return i.enabled=!1,h}return h}run(t,i,s){var h=i;if(s||(h=i-this.lastTimestamp,this.lastTimestamp=i),!this.enabled)return h;for(var r=this.sequences.length,e=0,n=Infinity,a=0;a<r;a++)if(this.sequences[a].enabled){var o=this.runSequence(t,this.sequences[a],h);if(!0===o)return!0;n=Math.min(n,o)}else e++;return e===r?(this.enabled=!1,h):n}}d.TIMELAPSE_TO_FORCE_DISABLE="FORCE_DISABLE",d.TIMELAPSE_TO_STOP="STOP",d.TIMELAPSE_TO_REMOVE="REMOVE";class m{constructor(t){this.Nt(this,this.qt(),t)}Nt(t,s,h){Object.keys(s).forEach(r=>{var e=s[r];t[r]="function"==typeof e?e(h[r],h,t):n(i(h[r]),e)})}Bt(){return{animation:(t,s)=>{var h=i(t);return Array.isArray(h)?new d(h):h},enabled:!0,isClickable:!1}}qt(){return Object.assign({},this.Bt(),{x:0,y:0,rotation:(t,s)=>n(i(t),n(i(s.rotationInRadian),.017453292519943295*n(i(s.rotationInDegree),0))),scaleX:(t,s)=>n(i(t),n(i(s.scale),1)),scaleY:(t,s)=>n(i(t),n(i(s.scale),1)),alpha:1,compositeOperation:"source-over",color:"#fff"})}animate(t){return!(!this.animation||!0!==this.animation.run(this,t,!0)||(this.enabled=!1,0))}play(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.animation&&this.animation.play&&this.animation.play(t,i)}resize(t,i){}Rt(t,i,s,h){if(this.enabled&&this.isClickable){var r=this.width/2,e=this.height/2;t.save(),s?t.translate(this.x+r,this.y+e):t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),h?h(r,e):(t.fillStyle=i,t.fillRect(-r,-e,this.width,this.height)),t.restore()}}detect(t,i){this.Rt(t,i,!1,()=>{t.fillStyle=i,t.arc(0,0,1,Math.PI/2+this.rotation,2.5*Math.PI-this.rotation,!1),t.fill()})}draw(t,i){this.enabled&&(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.beginPath(),t.fillStyle=this.color,t.arc(0,0,1,Math.PI/2+this.rotation,2.5*Math.PI-this.rotation,!1),t.fill(),t.restore())}}class y extends m{constructor(t){"function"==typeof t&&(t={callback:t}),super(t),this.Wt=0,this.Gt=0}qt(){return Object.assign({},this.Bt(),{callback:t=>void 0===typeof t?()=>{}:t})}animate(t){return this.enabled&&(this.Wt+=t,this.Gt+=t),super.animate(t)}detect(t,i){}draw(t,i){this.enabled&&this.callback(t,this.Wt,i,this),this.Gt=0}}class g extends m{constructor(t){super(t)}qt(){return Object.assign({},super.qt(),{sprite:[]})}animate(t){var i=super.animate(t),s=!1;if(this.enabled)for(var h in this.sprite)s=s||!0===this.sprite[h].animate(t);return this.animation?i:(s&&(this.enabled=!1),s)}play(t,i){for(var s in void 0===t&&(t=""),void 0===i&&(i=0),this.animation&&this.animation.play&&this.animation.play(t,i),this.sprite)this.sprite[s].play&&this.sprite[s].play(t,i)}resize(t,i){for(var s in this.sprite)this.sprite[s].resize(t,i)}draw(t,i){if(this.enabled){for(var s in this.alpha<1&&((i=Object.assign({},i)).alpha*=this.alpha),t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),this.sprite)this.sprite[s].draw(t,i);t.restore()}}}class M extends g{constructor(t){super(t),this.Xt=!1,this.F=2}qt(){return Object.assign({},super.qt(),{x:void 0,y:void 0,width:void 0,height:void 0,canvasWidth:void 0,canvasHeight:void 0,gridSize:void 0,norm:(t,s,h)=>n(i(t),void 0===h.x&&void 0===h.y&&void 0===h.width&&void 0===h.height),isDrawFrame:(t,i,s)=>n(t,!0)})}generateTempCanvas(t){var i=t.widthInPixel,s=t.heightInPixel;this.Yt=document.createElement("canvas"),this.canvasWidth&&this.canvasHeight?(this.Yt.width=this.canvasWidth,this.Yt.height=this.canvasHeight):this.gridSize?(this.Xt=this.gridSize,this.Yt.width=Math.round(this.Xt),this.Yt.height=Math.round(this.Xt)):(this.Yt.width=Math.round(i/this.scaleX),this.Yt.height=Math.round(s/this.scaleY)),this.Ht=this.Yt.getContext("2d")}normalizeFullScreen(t){(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y),(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height)}resize(t,i){if(this.Yt&&this.Xt!==this.gridSize&&!this.canvasWidth){var s=this.Yt;this.generateTempCanvas(i),this.Ht.globalCompositeOperation="copy",this.Ht.drawImage(s,0,0,s.width,s.height,0,0,this.Yt.width,this.Yt.height),this.Ht.globalCompositeOperation="source-over",this.F=2}this.normalizeFullScreen(i),super.resize(t,i)}detect(t,i){this.Rt(t,i,!1)}draw(t,s){if(this.enabled){this.Yt||(this.generateTempCanvas(s),this.normalizeFullScreen(s)),this.gridSize&&this.Xt!==this.gridSize&&this.resize(s),this.F=Math.max(this.F-1,i(this.isDrawFrame,t,s));var h=this.width,r=this.height,e=h/2,n=r/2,a=this.Yt.width,o=this.Yt.height;if(this.F){this.Ht.textBaseline="middle",this.Ht.textAlign="center",this.Ht.globalAlpha=1,this.Ht.globalCompositeOperation="source-over",this.Ht.save();var u=s.cam;if(this.norm&&u){var c=Math.max(a,o)/2;this.Ht.translate(a/2,o/2),this.Ht.scale(c,c),this.Ht.scale(u.zoom,u.zoom),this.Ht.translate(-u.x,-u.y)}for(var f in this.sprite)this.sprite[f].draw(this.Ht,this.norm?Object.assign({},s,{alpha:1,widthInPixel:a,heightInPixel:o}):{alpha:1,x:0,y:0,width:a,height:o,widthInPixel:a,heightInPixel:o,visibleScreen:{x:0,y:0,width:a,height:o}});this.Ht.restore()}t.save(),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*s.alpha,t.translate(this.x+e,this.y+n),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.drawImage(this.Yt,0,0,a,o,-e,-n,h,r),t.restore()}}}class w extends g{constructor(t){super(t.self||{});var s=n(i(t.count),1);this.sprite=[];for(var h=t.class,r=0;r<s;r++){var e={};for(var a in t)["self","class","count"].includes(a)||(e[a]="function"==typeof t[a]?t[a].call(t,r):t[a]);this.sprite[r]=new h(e)}}}class p extends m{constructor(t){super(t),this.Xt=!1}qt(){return Object.assign({},super.qt(),{x:void 0,y:void 0,width:void 0,height:void 0,gridSize:void 0,darker:0,pixel:!1,clear:!1,norm:(t,s,h)=>n(i(t),void 0===h.x&&void 0===h.y&&void 0===h.width&&void 0===h.height)})}generateTempCanvas(t){var i=t.widthInPixel,s=t.heightInPixel;this.Yt=document.createElement("canvas"),this.gridSize?(this.Xt=this.gridSize,this.Yt.width=Math.round(this.Xt),this.Yt.height=Math.round(this.Xt)):(this.Yt.width=Math.ceil(i/this.scaleX),this.Yt.height=Math.ceil(s/this.scaleY)),this.Ht=this.Yt.getContext("2d"),this.Ht.globalCompositeOperation="source-over",this.Ht.globalAlpha=1}normalizeFullScreen(t){(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y),(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height)}resize(t,i){if(this.Yt&&this.Xt!==this.gridSize){var s=this.Yt;this.generateTempCanvas(i),this.Ht.globalCompositeOperation="copy",this.Ht.drawImage(s,0,0,s.width,s.height,0,0,this.Yt.width,this.Yt.height),this.Ht.globalCompositeOperation="source-over"}this.normalizeFullScreen(i)}detect(t,i){this.Rt(t,i,!1)}draw(t,i){if(this.enabled){this.Yt||(this.generateTempCanvas(i),this.normalizeFullScreen(i)),this.gridSize&&this.Xt!==this.gridSize&&this.resize(t,i);var s=this.alpha*i.alpha,h=this.width,r=this.height,e=this.Yt.width,n=this.Yt.height;s>0&&e&&n&&(this.Ht.globalCompositeOperation="copy",this.Ht.globalAlpha=1,this.Ht.drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height,0,0,e,n),this.darker>0&&(this.Ht.globalCompositeOperation=this.clear?"source-atop":"source-over",this.Ht.fillStyle="rgba(0,0,0,"+this.darker+")",this.Ht.fillRect(0,0,e,n)),this.additionalBlur&&this.additionalBlur(e,n,i),this.clear&&t.clearRect(this.x,this.y,h,r),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=s,t.imageSmoothingEnabled=!this.pixel,t.drawImage(this.Yt,0,0,e,n,this.x,this.y,h,r),t.imageSmoothingEnabled=!0)}else this.clear&&(this.x||(this.x=i.x),this.y||(this.y=i.y),this.width||(this.width=i.width),this.height||(this.height=i.height),t.clearRect(this.x,this.y,this.width,this.height))}}class b extends m{constructor(t){super(t)}qt(){return Object.assign({},super.qt(),{image:t=>h.getImage(i(t)),position:b.CENTER,frameX:0,frameY:0,frameWidth:0,frameHeight:0,width:void 0,height:void 0,norm:!1,normCover:!1,normToScreen:!1})}resize(t,i){this.Ut=void 0}detect(t,i){this.Rt(t,i,!1,()=>{var s=(this.width?this.width:this.frameWidth||this.image.width)*this.Ut*this.scaleX,h=(this.height?this.height:this.frameHeight||this.image.height)*this.Ut*this.scaleY,r=this.position===b.LEFT_TOP;t.fillStyle=i,t.fillRect(r?0:-s/2,r?0:-h/2,s,h)})}draw(t,i){if(this.enabled&&this.image){var s=this.frameWidth||this.image.width,h=this.frameHeight||this.image.height;this.Ut||(this.Ut=this.normToScreen?this.normCover?Math.max(i.fullScreen.width/s,i.fullScreen.height/h):this.norm?Math.min(i.fullScreen.width/s,i.fullScreen.height/h):1:this.normCover?Math.max(i.width/s,i.height/h):this.norm?Math.min(i.width/s,i.height/h):1);var r=(this.width?this.width:s)*this.Ut*this.scaleX,e=(this.height?this.height:h)*this.Ut*this.scaleY;t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha;var n=this.position===b.LEFT_TOP;0==this.rotation?n?t.drawImage(this.image,this.frameX,this.frameY,s,h,this.x,this.y,r,e):t.drawImage(this.image,this.frameX,this.frameY,s,h,this.x-r/2,this.y-e/2,r,e):(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.drawImage(this.image,this.frameX,this.frameY,s,h,n?0:-r/2,n?0:-e/2,r,e),t.restore())}}}b.LEFT_TOP=0,b.CENTER=1;class x extends m{constructor(t){super(t)}qt(){return Object.assign({},super.qt(),{text:void 0,font:"2em monospace",position:x.CENTER,color:void 0,borderColor:void 0,lineWidth:1})}detect(t,i){this.Rt(t,i,!1,()=>{this.position||(t.textAlign="left",t.textBaseline="top"),t.font=this.font,t.fillStyle=i,t.fillText(this.text,0,0)})}draw(t,i){this.enabled&&(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,t.save(),this.position||(t.textAlign="left",t.textBaseline="top"),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.font=this.font,this.color&&(t.fillStyle=this.color,t.fillText(this.text,0,0)),this.borderColor&&(t.strokeStyle=this.borderColor,t.lineWidth=this.lineWidth,t.strokeText(this.text,0,0)),t.restore())}}function A(t,i){return t(i={exports:{}},i.exports),i.exports}x.LEFT_TOP=0,x.CENTER=1,"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var k={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},O=A(function(t){var i=Array.prototype.concat,s=Array.prototype.slice,h=t.exports=function(t){for(var h,r=[],e=0,n=t.length;e<n;e++){var a=t[e];(h=a)&&"string"!=typeof h&&(h instanceof Array||Array.isArray(h)||h.length>=0&&(h.splice instanceof Function||Object.getOwnPropertyDescriptor(h,h.length-1)&&"String"!==h.constructor.name))?r=i.call(r,s.call(a)):r.push(a)}return r};h.wrap=function(t){return function(){return t(h(arguments))}}}),I=A(function(t){var i={};for(var s in k)k.hasOwnProperty(s)&&(i[k[s]]=s);var h=t.exports={to:{},get:{}};function r(t,i,s){return Math.min(Math.max(i,t),s)}function e(t){var i=t.toString(16).toUpperCase();return i.length<2?"0"+i:i}h.get=function(t){var i,s;switch(t.substring(0,3).toLowerCase()){case"hsl":i=h.get.hsl(t),s="hsl";break;case"hwb":i=h.get.hwb(t),s="hwb";break;default:i=h.get.rgb(t),s="rgb"}return i?{model:s,value:i}:null},h.get.rgb=function(t){if(!t)return null;var i,s,h,e=[0,0,0,1];if(i=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(h=i[2],i=i[1],s=0;s<3;s++){var n=2*s;e[s]=parseInt(i.slice(n,n+2),16)}h&&(e[3]=Math.round(parseInt(h,16)/255*100)/100)}else if(i=t.match(/^#([a-f0-9]{3,4})$/i)){for(h=(i=i[1])[3],s=0;s<3;s++)e[s]=parseInt(i[s]+i[s],16);h&&(e[3]=Math.round(parseInt(h+h,16)/255*100)/100)}else if(i=t.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(s=0;s<3;s++)e[s]=parseInt(i[s+1],0);i[4]&&(e[3]=parseFloat(i[4]))}else{if(!(i=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(i=t.match(/(\D+)/))?"transparent"===i[1]?[0,0,0,0]:(e=k[i[1]])?(e[3]=1,e):null:null;for(s=0;s<3;s++)e[s]=Math.round(2.55*parseFloat(i[s+1]));i[4]&&(e[3]=parseFloat(i[4]))}for(s=0;s<3;s++)e[s]=r(e[s],0,255);return e[3]=r(e[3],0,1),e},h.get.hsl=function(t){if(!t)return null;var i=t.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(i){var s=parseFloat(i[4]);return[(parseFloat(i[1])+360)%360,r(parseFloat(i[2]),0,100),r(parseFloat(i[3]),0,100),r(isNaN(s)?1:s,0,1)]}return null},h.get.hwb=function(t){if(!t)return null;var i=t.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(i){var s=parseFloat(i[4]);return[(parseFloat(i[1])%360+360)%360,r(parseFloat(i[2]),0,100),r(parseFloat(i[3]),0,100),r(isNaN(s)?1:s,0,1)]}return null},h.to.hex=function(){var t=O(arguments);return"#"+e(t[0])+e(t[1])+e(t[2])+(t[3]<1?e(Math.round(255*t[3])):"")},h.to.rgb=function(){var t=O(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},h.to.rgb.percent=function(){var t=O(arguments),i=Math.round(t[0]/255*100),s=Math.round(t[1]/255*100),h=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+i+"%, "+s+"%, "+h+"%)":"rgba("+i+"%, "+s+"%, "+h+"%, "+t[3]+")"},h.to.hsl=function(){var t=O(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},h.to.hwb=function(){var t=O(arguments),i="";return t.length>=4&&1!==t[3]&&(i=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+i+")"},h.to.keyword=function(t){return i[t.slice(0,3)]}}),P=A(function(t){var i={};for(var s in k)k.hasOwnProperty(s)&&(i[k[s]]=s);var h=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var r in h)if(h.hasOwnProperty(r)){if(!("channels"in h[r]))throw new Error("missing channels property: "+r);if(!("labels"in h[r]))throw new Error("missing channel labels property: "+r);if(h[r].labels.length!==h[r].channels)throw new Error("channel and label counts mismatch: "+r);var e=h[r].channels,n=h[r].labels;delete h[r].channels,delete h[r].labels,Object.defineProperty(h[r],"channels",{value:e}),Object.defineProperty(h[r],"labels",{value:n})}h.rgb.hsl=function(t){var i,s,h=t[0]/255,r=t[1]/255,e=t[2]/255,n=Math.min(h,r,e),a=Math.max(h,r,e),o=a-n;return a===n?i=0:h===a?i=(r-e)/o:r===a?i=2+(e-h)/o:e===a&&(i=4+(h-r)/o),(i=Math.min(60*i,360))<0&&(i+=360),s=(n+a)/2,[i,100*(a===n?0:s<=.5?o/(a+n):o/(2-a-n)),100*s]},h.rgb.hsv=function(t){var i,s,h,r,e,n=t[0]/255,a=t[1]/255,o=t[2]/255,u=Math.max(n,a,o),c=u-Math.min(n,a,o),f=function(t){return(u-t)/6/c+.5};return 0===c?r=e=0:(e=c/u,i=f(n),s=f(a),h=f(o),n===u?r=h-s:a===u?r=1/3+i-h:o===u&&(r=2/3+s-i),r<0?r+=1:r>1&&(r-=1)),[360*r,100*e,100*u]},h.rgb.hwb=function(t){var i=t[0],s=t[1],r=t[2];return[h.rgb.hsl(t)[0],1/255*Math.min(i,Math.min(s,r))*100,100*(r=1-1/255*Math.max(i,Math.max(s,r)))]},h.rgb.cmyk=function(t){var i,s=t[0]/255,h=t[1]/255,r=t[2]/255;return[100*((1-s-(i=Math.min(1-s,1-h,1-r)))/(1-i)||0),100*((1-h-i)/(1-i)||0),100*((1-r-i)/(1-i)||0),100*i]},h.rgb.keyword=function(t){var s=i[t];if(s)return s;var h,r,e,n=Infinity;for(var a in k)if(k.hasOwnProperty(a)){var o=(r=t,e=k[a],Math.pow(r[0]-e[0],2)+Math.pow(r[1]-e[1],2)+Math.pow(r[2]-e[2],2));o<n&&(n=o,h=a)}return h},h.keyword.rgb=function(t){return k[t]},h.rgb.xyz=function(t){var i=t[0]/255,s=t[1]/255,h=t[2]/255;return[100*(.4124*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.3576*(s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92)+.1805*(h=h>.04045?Math.pow((h+.055)/1.055,2.4):h/12.92)),100*(.2126*i+.7152*s+.0722*h),100*(.0193*i+.1192*s+.9505*h)]},h.rgb.lab=function(t){var i=h.rgb.xyz(t),s=i[0],r=i[1],e=i[2];return r/=100,e/=108.883,s=(s/=95.047)>.008856?Math.pow(s,1/3):7.787*s+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(s-r),200*(r-(e=e>.008856?Math.pow(e,1/3):7.787*e+16/116))]},h.hsl.rgb=function(t){var i,s,h,r,e,n=t[0]/360,a=t[1]/100,o=t[2]/100;if(0===a)return[e=255*o,e,e];i=2*o-(s=o<.5?o*(1+a):o+a-o*a),r=[0,0,0];for(var u=0;u<3;u++)(h=n+1/3*-(u-1))<0&&h++,h>1&&h--,r[u]=255*(e=6*h<1?i+6*(s-i)*h:2*h<1?s:3*h<2?i+(s-i)*(2/3-h)*6:i);return r},h.hsl.hsv=function(t){var i=t[0],s=t[1]/100,h=t[2]/100,r=s,e=Math.max(h,.01);return s*=(h*=2)<=1?h:2-h,r*=e<=1?e:2-e,[i,100*(0===h?2*r/(e+r):2*s/(h+s)),(h+s)/2*100]},h.hsv.rgb=function(t){var i=t[0]/60,s=t[1]/100,h=t[2]/100,r=Math.floor(i)%6,e=i-Math.floor(i),n=255*h*(1-s),a=255*h*(1-s*e),o=255*h*(1-s*(1-e));switch(h*=255,r){case 0:return[h,o,n];case 1:return[a,h,n];case 2:return[n,h,o];case 3:return[n,a,h];case 4:return[o,n,h];case 5:return[h,n,a]}},h.hsv.hsl=function(t){var i,s,h,r=t[0],e=t[1]/100,n=t[2]/100,a=Math.max(n,.01);return h=(2-e)*n,s=e*a,[r,100*(s=(s/=(i=(2-e)*a)<=1?i:2-i)||0),100*(h/=2)]},h.hwb.rgb=function(t){var i,s,h,r,e,n,a,o=t[0]/360,u=t[1]/100,c=t[2]/100,f=u+c;switch(f>1&&(u/=f,c/=f),h=6*o-(i=Math.floor(6*o)),0!=(1&i)&&(h=1-h),r=u+h*((s=1-c)-u),i){default:case 6:case 0:e=s,n=r,a=u;break;case 1:e=r,n=s,a=u;break;case 2:e=u,n=s,a=r;break;case 3:e=u,n=r,a=s;break;case 4:e=r,n=u,a=s;break;case 5:e=s,n=u,a=r}return[255*e,255*n,255*a]},h.cmyk.rgb=function(t){var i=t[1]/100,s=t[2]/100,h=t[3]/100;return[255*(1-Math.min(1,t[0]/100*(1-h)+h)),255*(1-Math.min(1,i*(1-h)+h)),255*(1-Math.min(1,s*(1-h)+h))]},h.xyz.rgb=function(t){var i,s,h,r=t[0]/100,e=t[1]/100,n=t[2]/100;return s=-.9689*r+1.8758*e+.0415*n,h=.0557*r+-.204*e+1.057*n,i=(i=3.2406*r+-1.5372*e+-.4986*n)>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:12.92*s,h=h>.0031308?1.055*Math.pow(h,1/2.4)-.055:12.92*h,[255*(i=Math.min(Math.max(0,i),1)),255*(s=Math.min(Math.max(0,s),1)),255*(h=Math.min(Math.max(0,h),1))]},h.xyz.lab=function(t){var i=t[0],s=t[1],h=t[2];return s/=100,h/=108.883,i=(i/=95.047)>.008856?Math.pow(i,1/3):7.787*i+16/116,[116*(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116)-16,500*(i-s),200*(s-(h=h>.008856?Math.pow(h,1/3):7.787*h+16/116))]},h.lab.xyz=function(t){var i,s,h;i=t[1]/500+(s=(t[0]+16)/116),h=s-t[2]/200;var r=Math.pow(s,3),e=Math.pow(i,3),n=Math.pow(h,3);return s=r>.008856?r:(s-16/116)/7.787,i=e>.008856?e:(i-16/116)/7.787,h=n>.008856?n:(h-16/116)/7.787,[i*=95.047,s*=100,h*=108.883]},h.lab.lch=function(t){var i,s=t[0],h=t[1],r=t[2];return(i=360*Math.atan2(r,h)/2/Math.PI)<0&&(i+=360),[s,Math.sqrt(h*h+r*r),i]},h.lch.lab=function(t){var i,s=t[1];return i=t[2]/360*2*Math.PI,[t[0],s*Math.cos(i),s*Math.sin(i)]},h.rgb.ansi16=function(t){var i=t[0],s=t[1],r=t[2],e=1 in arguments?arguments[1]:h.rgb.hsv(t)[2];if(0===(e=Math.round(e/50)))return 30;var n=30+(Math.round(r/255)<<2|Math.round(s/255)<<1|Math.round(i/255));return 2===e&&(n+=60),n},h.hsv.ansi16=function(t){return h.rgb.ansi16(h.hsv.rgb(t),t[2])},h.rgb.ansi256=function(t){var i=t[0],s=t[1],h=t[2];return i===s&&s===h?i<8?16:i>248?231:Math.round((i-8)/247*24)+232:16+36*Math.round(i/255*5)+6*Math.round(s/255*5)+Math.round(h/255*5)},h.ansi16.rgb=function(t){var i=t%10;if(0===i||7===i)return t>50&&(i+=3.5),[i=i/10.5*255,i,i];var s=.5*(1+~~(t>50));return[(1&i)*s*255,(i>>1&1)*s*255,(i>>2&1)*s*255]},h.ansi256.rgb=function(t){if(t>=232){var i=10*(t-232)+8;return[i,i,i]}var s;return t-=16,[Math.floor(t/36)/5*255,Math.floor((s=t%36)/6)/5*255,s%6/5*255]},h.rgb.hex=function(t){var i=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(i.length)+i},h.hex.rgb=function(t){var i=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!i)return[0,0,0];var s=i[0];3===i[0].length&&(s=s.split("").map(function(t){return t+t}).join(""));var h=parseInt(s,16);return[h>>16&255,h>>8&255,255&h]},h.rgb.hcg=function(t){var i,s=t[0]/255,h=t[1]/255,r=t[2]/255,e=Math.max(Math.max(s,h),r),n=Math.min(Math.min(s,h),r),a=e-n;return i=a<=0?0:e===s?(h-r)/a%6:e===h?2+(r-s)/a:4+(s-h)/a+4,i/=6,[360*(i%=1),100*a,100*(a<1?n/(1-a):0)]},h.hsl.hcg=function(t){var i,s=t[1]/100,h=t[2]/100,r=0;return(i=h<.5?2*s*h:2*s*(1-h))<1&&(r=(h-.5*i)/(1-i)),[t[0],100*i,100*r]},h.hsv.hcg=function(t){var i=t[2]/100,s=t[1]/100*i,h=0;return s<1&&(h=(i-s)/(1-s)),[t[0],100*s,100*h]},h.hcg.rgb=function(t){var i=t[1]/100,s=t[2]/100;if(0===i)return[255*s,255*s,255*s];var h,r=[0,0,0],e=t[0]/360%1*6,n=e%1,a=1-n;switch(Math.floor(e)){case 0:r[0]=1,r[1]=n,r[2]=0;break;case 1:r[0]=a,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=n;break;case 3:r[0]=0,r[1]=a,r[2]=1;break;case 4:r[0]=n,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=a}return[255*(i*r[0]+(h=(1-i)*s)),255*(i*r[1]+h),255*(i*r[2]+h)]},h.hcg.hsv=function(t){var i=t[1]/100,s=i+t[2]/100*(1-i),h=0;return s>0&&(h=i/s),[t[0],100*h,100*s]},h.hcg.hsl=function(t){var i=t[1]/100,s=t[2]/100*(1-i)+.5*i,h=0;return s>0&&s<.5?h=i/(2*s):s>=.5&&s<1&&(h=i/(2*(1-s))),[t[0],100*h,100*s]},h.hcg.hwb=function(t){var i=t[1]/100,s=i+t[2]/100*(1-i);return[t[0],100*(s-i),100*(1-s)]},h.hwb.hcg=function(t){var i=1-t[2]/100,s=i-t[1]/100,h=0;return s<1&&(h=(i-s)/(1-s)),[t[0],100*s,100*h]},h.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},h.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},h.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},h.gray.hsl=h.gray.hsv=function(t){return[0,0,t[0]]},h.gray.hwb=function(t){return[0,100,t[0]]},h.gray.cmyk=function(t){return[0,0,0,t[0]]},h.gray.lab=function(t){return[t[0],0,0]},h.gray.hex=function(t){var i=255&Math.round(t[0]/100*255),s=((i<<16)+(i<<8)+i).toString(16).toUpperCase();return"000000".substring(s.length)+s},h.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}});function F(t,i){return function(s){return i(t(s))}}function S(t,i){for(var s=[i[t].parent,t],h=P[i[t].parent][t],r=i[t].parent;i[r].parent;)s.unshift(i[r].parent),h=F(P[i[r].parent][r],h),r=i[r].parent;return h.conversion=s,h}var _={};Object.keys(P).forEach(function(t){_[t]={},Object.defineProperty(_[t],"channels",{value:P[t].channels}),Object.defineProperty(_[t],"labels",{value:P[t].labels});var i=function(t){for(var i=function(t){var i=function(){for(var t={},i=Object.keys(P),s=i.length,h=0;h<s;h++)t[i[h]]={distance:-1,parent:null};return t}(),s=[t];for(i[t].distance=0;s.length;)for(var h=s.pop(),r=Object.keys(P[h]),e=r.length,n=0;n<e;n++){var a=r[n],o=i[a];-1===o.distance&&(o.distance=i[h].distance+1,o.parent=h,s.unshift(a))}return i}(t),s={},h=Object.keys(i),r=h.length,e=0;e<r;e++){var n=h[e];null!==i[n].parent&&(s[n]=S(n,i))}return s}(t);Object.keys(i).forEach(function(s){var h=i[s];_[t][s]=function(t){var i=function(i){if(null==i)return i;arguments.length>1&&(i=Array.prototype.slice.call(arguments));var s=t(i);if("object"==typeof s)for(var h=s.length,r=0;r<h;r++)s[r]=Math.round(s[r]);return s};return"conversion"in t&&(i.conversion=t.conversion),i}(h),_[t][s].raw=function(t){var i=function(i){return null==i?i:(arguments.length>1&&(i=Array.prototype.slice.call(arguments)),t(i))};return"conversion"in t&&(i.conversion=t.conversion),i}(h)})});var j=_,C=[].slice,z=["keyword","gray","hex"],T={};Object.keys(j).forEach(function(t){T[C.call(j[t].labels).sort().join("")]=t});var E={};function L(t,i){if(!(this instanceof L))return new L(t,i);if(i&&i in z&&(i=null),i&&!(i in j))throw new Error("Unknown model: "+i);var s,h;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof L)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var r=I.get(t);if(null===r)throw new Error("Unable to parse color from string: "+t);this.model=r.model,this.color=r.value.slice(0,h=j[this.model].channels),this.valpha="number"==typeof r.value[h]?r.value[h]:1}else if(t.length){this.model=i||"rgb";var e=C.call(t,0,h=j[this.model].channels);this.color=B(e,h),this.valpha="number"==typeof t[h]?t[h]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var n=Object.keys(t);"alpha"in t&&(n.splice(n.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var a=n.sort().join("");if(!(a in T))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=T[a];var o=j[this.model].labels,u=[];for(s=0;s<o.length;s++)u.push(t[o[s]]);this.color=B(u)}if(E[this.model])for(h=j[this.model].channels,s=0;s<h;s++){var c=E[this.model][s];c&&(this.color[s]=c(this.color[s]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function D(t,i,s){return(t=Array.isArray(t)?t:[t]).forEach(function(t){(E[t]||(E[t]=[]))[i]=s}),t=t[0],function(h){var r;return arguments.length?(s&&(h=s(h)),(r=this[t]()).color[i]=h,r):(r=this[t]().color[i],s&&(r=s(r)),r)}}function N(t){return function(i){return Math.max(0,Math.min(t,i))}}function q(t){return Array.isArray(t)?t:[t]}function B(t,i){for(var s=0;s<i;s++)"number"!=typeof t[s]&&(t[s]=0);return t}L.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var i=this.model in I.to?this:this.rgb(),s=1===(i=i.round("number"==typeof t?t:1)).valpha?i.color:i.color.concat(this.valpha);return I.to[i.model](s)},percentString:function(t){var i=this.rgb().round("number"==typeof t?t:1),s=1===i.valpha?i.color:i.color.concat(this.valpha);return I.to.rgb.percent(s)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},i=j[this.model].channels,s=j[this.model].labels,h=0;h<i;h++)t[s[h]]=this.color[h];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new L(this.color.map(function(t){return function(i){return function(t,i){return Number(t.toFixed(i))}(i,t)}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new L(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:D("rgb",0,N(255)),green:D("rgb",1,N(255)),blue:D("rgb",2,N(255)),hue:D(["hsl","hsv","hsl","hwb","hcg"],0,function(t){return(t%360+360)%360}),saturationl:D("hsl",1,N(100)),lightness:D("hsl",2,N(100)),saturationv:D("hsv",1,N(100)),value:D("hsv",2,N(100)),chroma:D("hcg",1,N(100)),gray:D("hcg",2,N(100)),white:D("hwb",1,N(100)),wblack:D("hwb",2,N(100)),cyan:D("cmyk",0,N(100)),magenta:D("cmyk",1,N(100)),yellow:D("cmyk",2,N(100)),black:D("cmyk",3,N(100)),x:D("xyz",0,N(100)),y:D("xyz",1,N(100)),z:D("xyz",2,N(100)),l:D("lab",0,N(100)),a:D("lab",1),b:D("lab",2),keyword:function(t){return arguments.length?new L(t):j[this.model].keyword(this.color)},hex:function(t){return arguments.length?new L(t):I.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,i=[],s=0;s<t.length;s++){var h=t[s]/255;i[s]=h<=.03928?h/12.92:Math.pow((h+.055)/1.055,2.4)}return.2126*i[0]+.7152*i[1]+.0722*i[2]},contrast:function(t){var i=this.luminosity(),s=t.luminosity();return i>s?(i+.05)/(s+.05):(s+.05)/(i+.05)},level:function(t){var i=this.contrast(t);return i>=7.1?"AAA":i>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),i=0;i<3;i++)t.color[i]=255-t.color[i];return t},lighten:function(t){var i=this.hsl();return i.color[2]+=i.color[2]*t,i},darken:function(t){var i=this.hsl();return i.color[2]-=i.color[2]*t,i},saturate:function(t){var i=this.hsl();return i.color[1]+=i.color[1]*t,i},desaturate:function(t){var i=this.hsl();return i.color[1]-=i.color[1]*t,i},whiten:function(t){var i=this.hwb();return i.color[1]+=i.color[1]*t,i},blacken:function(t){var i=this.hwb();return i.color[2]+=i.color[2]*t,i},grayscale:function(){var t=this.rgb().color,i=.3*t[0]+.59*t[1]+.11*t[2];return L.rgb(i,i,i)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var i=this.hsl(),s=i.color[0];return i.color[0]=s=(s=(s+t)%360)<0?360+s:s,i},mix:function(t,i){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);var s=t.rgb(),h=this.rgb(),r=void 0===i?.5:i,e=2*r-1,n=s.alpha()-h.alpha(),a=((e*n==-1?e:(e+n)/(1+e*n))+1)/2,o=1-a;return L.rgb(a*s.red()+o*h.red(),a*s.green()+o*h.green(),a*s.blue()+o*h.blue(),s.alpha()*r+h.alpha()*(1-r))}},Object.keys(j).forEach(function(t){if(-1===z.indexOf(t)){var i=j[t].channels;L.prototype[t]=function(){if(this.model===t)return new L(this);if(arguments.length)return new L(arguments,t);var s="number"==typeof arguments[i]?i:this.valpha;return new L(q(j[this.model][t].raw(this.color)).concat(s),t)},L[t]=function(s){return"number"==typeof s&&(s=B(C.call(arguments),i)),new L(s,t)}}});var R=L;class W extends m{constructor(t){super(t),this.Vt=void 0,this.Jt=!1}static getGradientImage(t,i,s){var h=t>>4,r=i>>4,e=s>>4;return W.$t||(W.$t=Array.from({length:16},t=>Array.from({length:16},t=>Array.from({length:16})))),W.$t[h][r][e]||(W.$t[h][r][e]=W.generateGradientImage(h,r,e)),W.$t[h][r][e]}static generateGradientImage(t,i,s){var h=document.createElement("canvas");h.width=h.height=64;var r=h.getContext("2d");r.globalAlpha=1,r.globalCompositeOperation="source-over",r.clearRect(0,0,64,64);var e=r.createRadialGradient(32,32,0,32,32,32);return e.addColorStop(0,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",1)"),e.addColorStop(.3,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",0.4)"),e.addColorStop(1,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",0)"),r.fillStyle=e,r.fillRect(0,0,64,64),h}resize(t,i){this.Vt=void 0}draw(t,i){if(this.enabled){this.color&&this.color.color||(this.color=R(this.color).rgb()),this.Vt!==this.scaleX&&(this.Vt=this.scaleX,this.Jt=this.scaleX*i.widthInPixel/i.width>64);var s=this.color.color;t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,t.imageSmoothingEnabled=this.Jt,t.drawImage(W.getGradientImage(s[0],s[1],s[2]),0,0,64,64,this.x-this.scaleX/2,this.y-this.scaleY/2,this.scaleX,this.scaleY),t.imageSmoothingEnabled=!0}}}var G=A(function(t,i){t.exports=function(){var t=2*Math.PI,i=function(t,i,s,h,r,e,n){var a=t.x,o=t.y;return{x:h*(a*=i)-r*(o*=s)+e,y:r*a+h*o+n}},s=function(t,i){var s=4/3*Math.tan(i/4),h=Math.cos(t),r=Math.sin(t),e=Math.cos(t+i),n=Math.sin(t+i);return[{x:h-r*s,y:r+h*s},{x:e+n*s,y:n-e*s},{x:e,y:n}]},h=function(t,i,s,h){var r=t*h-i*s<0?-1:1,e=(t*s+i*h)/(Math.sqrt(t*t+i*i)*Math.sqrt(t*t+i*i));return e>1&&(e=1),e<-1&&(e=-1),r*Math.acos(e)},r=function(r){var e=r.px,n=r.py,a=r.cx,o=r.cy,u=r.rx,c=r.ry,f=r.xAxisRotation,l=void 0===f?0:f,v=r.largeArcFlag,d=void 0===v?0:v,m=r.sweepFlag,y=void 0===m?0:m,g=[];if(0===u||0===c)return[];var M=Math.sin(l*t/360),w=Math.cos(l*t/360),p=w*(e-a)/2+M*(n-o)/2,b=-M*(e-a)/2+w*(n-o)/2;if(0===p&&0===b)return[];u=Math.abs(u),c=Math.abs(c);var x=Math.pow(p,2)/Math.pow(u,2)+Math.pow(b,2)/Math.pow(c,2);x>1&&(u*=Math.sqrt(x),c*=Math.sqrt(x));var A=function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,i){var s=[],h=!0,r=!1,e=void 0;try{for(var n,a=t[Symbol.iterator]();!(h=(n=a.next()).done)&&(s.push(n.value),4!==s.length);h=!0);}catch(t){r=!0,e=t}finally{try{!h&&a.return&&a.return()}finally{if(r)throw e}}return s}(t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(function(i,s,r,e,n,a,o,u,c,f,l,v){var d=Math.pow(n,2),m=Math.pow(a,2),y=Math.pow(l,2),g=Math.pow(v,2),M=d*m-d*g-m*y;M<0&&(M=0),M/=d*g+m*y;var w=(M=Math.sqrt(M)*(o===u?-1:1))*n/a*v,p=M*-a/n*l,b=f*w-c*p+(i+r)/2,x=c*w+f*p+(s+e)/2,A=(l-w)/n,k=(v-p)/a,O=(-l-w)/n,I=(-v-p)/a,P=h(1,0,A,k),F=h(A,k,O,I);return 0===u&&F>0&&(F-=t),1===u&&F<0&&(F+=t),[b,x,P,F]}(e,n,a,o,u,c,d,y,M,w,p,b)),k=A[0],O=A[1],I=A[2],P=A[3],F=Math.max(Math.ceil(Math.abs(P)/(t/4)),1);P/=F;for(var S=0;S<F;S++)g.push(s(I,P)),I+=P;return g.map(function(t){var s=i(t[0],u,c,w,M,k,O),h=s.x,r=s.y,e=i(t[1],u,c,w,M,k,O),n=e.x,a=e.y,o=i(t[2],u,c,w,M,k,O);return{x1:h,y1:r,x2:n,y2:a,x:o.x,y:o.y}})},e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},n=/([astvzqmhlc])([^astvzqmhlc]*)/gi,a=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;function o(t){var i=t[0][0],s=t[0][1],h=i,r=s;return t.forEach(function(t){var e=t[0],n=t[2],a=t[4],o=t[6],u=t[1],c=t[3],f=t[5],l=t[7];i=Math.min(i,e,n,a,o),s=Math.min(s,u,c,f,l),h=Math.max(h,e,n,a,o),r=Math.max(r,u,c,f,l)}),[i,s,h,r]}var u={};function c(t,i,s,h,r,e,n,a,o,u){var c=(s-t)*o+t,f=(h-i)*o+i,l=(r-s)*o+s,v=(e-h)*o+h,d=(l-c)*o+c,m=(v-f)*o+f,y=(((n-r)*o+r-l)*o+l-d)*o+d,g=(((a-e)*o+e-v)*o+v-m)*o+m;return u?[y,g,d,m,c,f,t,i]:[t,i,c,f,d,m,y,g]}function f(t,i){for(var s=function(i){var s=[];t[t.length-1].forEach(function(t){s.push(t.slice(0))}),t.push(s)},h=0;h<i;h++)s()}return u.parser=function(t){var i=[];return t.replace(n,function(t,s,h){var r=s.toLowerCase();for(h=function(t){var i=t.match(a);return i?i.map(Number):[]}(h),"m"==r&&h.length>2&&(i.push([s].concat(h.splice(0,2))),r="l",s="m"==s?"l":"L");;){if(h.length==e[r])return h.unshift(s),i.push(h);if(h.length<e[r])throw new Error("malformed path data");i.push([s].concat(h.splice(0,e[r])))}}),i},u.lerpCurve=function(t,i,s){return u.lerpPoints(t[0],t[1],i[0],i[1],s).concat(u.lerpPoints(t[2],t[3],i[2],i[3],s)).concat(u.lerpPoints(t[4],t[5],i[4],i[5],s)).concat(u.lerpPoints(t[6],t[7],i[6],i[7],s))},u.lerpPoints=function(t,i,s,h,r){return[t+(s-t)*r,i+(h-i)*r]},u.q2b=function(t,i,s,h,r,e){return[t,i,(t+2*s)/3,(i+2*h)/3,(r+2*s)/3,(e+2*h)/3,r,e]},u.path2shapes=function(t){for(var i=u.parser(t),s=0,h=0,e=0,n=i.length,a=[],o=null,c=void 0,f=void 0,l=void 0,v=void 0,d=void 0,m=void 0,y=void 0;e<n;e++){var g=i[e],M=i[e-1];switch(g[0]){case"m":a[d=a.length]=[],o=a[d],s+=g[1],h+=g[2];break;case"M":a[d=a.length]=[],o=a[d],s=g[1],h=g[2];break;case"l":o.push([s,h,s,h,s,h,s+g[1],h+g[2]]),s+=g[1],h+=g[2];break;case"L":o.push([s,h,g[1],g[2],g[1],g[2],g[1],g[2]]),s=g[1],h=g[2];break;case"h":o.push([s,h,s,h,s,h,s+g[1],h]),s+=g[1];break;case"H":o.push([s,h,g[1],h,g[1],h,g[1],h]),s=g[1];break;case"v":o.push([s,h,s,h,s,h,s,h+g[1]]),h+=g[1];break;case"V":o.push([s,h,s,g[1],s,g[1],s,g[1]]),h=g[1];break;case"C":o.push([s,h,g[1],g[2],g[3],g[4],g[5],g[6]]),s=g[5],h=g[6];break;case"S":"C"===M[0]||"c"===M[0]?o.push([s,h,s+M[5]-M[3],h+M[6]-M[4],g[1],g[2],g[3],g[4]]):"S"!==M[0]&&"s"!==M[0]||o.push([s,h,s+M[3]-M[1],h+M[4]-M[2],g[1],g[2],g[3],g[4]]),s=g[3],h=g[4];break;case"c":o.push([s,h,s+g[1],h+g[2],s+g[3],h+g[4],s+g[5],h+g[6]]),s+=g[5],h+=g[6];break;case"s":"C"===M[0]||"c"===M[0]?o.push([s,h,s+M[5]-M[3],h+M[6]-M[4],s+g[1],h+g[2],s+g[3],h+g[4]]):"S"!==M[0]&&"s"!==M[0]||o.push([s,h,s+M[3]-M[1],h+M[4]-M[2],s+g[1],h+g[2],s+g[3],h+g[4]]),s+=g[3],h+=g[4];break;case"a":y=(m=r({rx:g[1],ry:g[2],px:s,py:h,xAxisRotation:g[3],largeArcFlag:g[4],sweepFlag:g[5],cx:s+g[6],cy:h+g[7]}))[m.length-1],m.forEach(function(t,i){o.push(0===i?[s,h,t.x1,t.y1,t.x2,t.y2,t.x,t.y]:[m[i-1].x,m[i-1].y,t.x1,t.y1,t.x2,t.y2,t.x,t.y])}),s=y.x,h=y.y;break;case"A":y=(m=r({rx:g[1],ry:g[2],px:s,py:h,xAxisRotation:g[3],largeArcFlag:g[4],sweepFlag:g[5],cx:g[6],cy:g[7]}))[m.length-1],m.forEach(function(t,i){o.push(0===i?[s,h,t.x1,t.y1,t.x2,t.y2,t.x,t.y]:[m[i-1].x,m[i-1].y,t.x1,t.y1,t.x2,t.y2,t.x,t.y])}),s=y.x,h=y.y;break;case"Q":o.push(u.q2b(s,h,g[1],g[2],g[3],g[4])),s=g[3],h=g[4];break;case"q":o.push(u.q2b(s,h,s+g[1],h+g[2],g[3]+s,g[4]+h)),s+=g[3],h+=g[4];break;case"T":"Q"===M[0]||"q"===M[0]?o.push(u.q2b(s,h,l=s+M[3]-M[1],v=h+M[4]-M[2],g[1],g[2])):"T"!==M[0]&&"t"!==M[0]||(o.push(u.q2b(s,h,s+s-l,h+h-v,g[1],g[2])),l=s+s-l,v=h+h-v),s=g[1],h=g[2];break;case"t":"Q"===M[0]||"q"===M[0]?o.push(u.q2b(s,h,l=s+M[3]-M[1],v=h+M[4]-M[2],s+g[1],h+g[2])):"T"!==M[0]&&"t"!==M[0]||(o.push(u.q2b(s,h,s+s-l,h+h-v,s+g[1],h+g[2])),l=s+s-l,v=h+h-v),s+=g[1],h+=g[2];break;case"Z":case"z":o.push([s,h,c=o[0][0],f=o[0][1],c,f,c,f])}}return a},u.Qt=function(t,i){for(var s=0,h=0,r=t.length;s<i;s++)t.push(t[h].slice(0)),++h>r-1&&(h-=r)},u.Zt=function(t,i){for(var s,h,r,e,n,a,o,u,f=0,l=0;f<i;f++){var v=t[l],d={left:c(s=v[0],h=v[1],r=v[2],e=v[3],n=v[4],a=v[5],o=v[6],u=v[7],.5),right:c(o,u,n,a,r,e,s,h,.5,!0)};t.splice(l,1),t.splice(l,0,d.left,d.right),(l+=2)>=t.length-1&&(l=0)}},u.lerp=function(t,i,s){return u.Kt(u.path2shapes(t),u.path2shapes(i),s)},u.MIM_CURVES_COUNT=100,u.ti=function(t,i){var s=t.length,h=i.length,r=JSON.parse(JSON.stringify(t)),e=JSON.parse(JSON.stringify(i));return s>h?f(e,s-h):s<h&&f(r,h-s),(r=function(t,i){var s=function(t){for(var i=[],s=0;s<t;s++)i.push(s);return h=[],r=[],function t(i){var s,e;for(s=0;s<i.length;s++)e=i.splice(s,1)[0],r.push(e),0==i.length&&h.push(r.slice()),t(i),i.splice(s,0,e),r.pop();return h}(i);var h,r}(t.length),h=[];s.forEach(function(s){var r=0;s.forEach(function(s){var h,e;r+=(h=o(t[s]),e=o(i[s]),Math.sqrt(Math.pow(h[0]-e[0],2)+Math.pow(h[1]-e[1],2))+Math.sqrt(Math.pow(h[2]-e[2],2)+Math.pow(h[3]-e[3],2)))}),h.push({index:s,distance:r})}),h.sort(function(t,i){return t.distance-i.distance});var r=[];return h[0].index.forEach(function(i){r.push(t[i])}),r}(r,e)).forEach(function(t,i){var s=t.length,h=e[i].length;s>h?s<u.MIM_CURVES_COUNT?(u.Zt(t,u.MIM_CURVES_COUNT-s),u.Zt(e[i],u.MIM_CURVES_COUNT-h)):u.Zt(e[i],s-h):s<h&&(h<u.MIM_CURVES_COUNT?(u.Zt(t,u.MIM_CURVES_COUNT-s),u.Zt(e[i],u.MIM_CURVES_COUNT-h)):u.Zt(t,h-s))}),r.forEach(function(t,i){r[i]=function(t,i){var s=function(t){for(var i=[],s=0;s<t;s++){for(var h=[],r=0;r<t;r++){var e=r+s;e>t-1&&(e-=t),h[e]=r}i.push(h)}return i}(t.length),h=[];s.forEach(function(s){var r=0,e=0;s.forEach(function(s){var h,n,a,o,u,c,f,l,v,d,m,y,g,M,w,p;r+=(n=i[e++],a=(h=t[s])[2],o=h[4],u=h[6],c=h[1],f=h[3],l=h[5],v=h[7],d=n[2],m=n[4],y=n[6],g=n[1],M=n[3],w=n[5],p=n[7],Math.sqrt(Math.pow(n[0]-h[0],2)+Math.pow(g-c,2))+Math.sqrt(Math.pow(d-a,2)+Math.pow(M-f,2))+Math.sqrt(Math.pow(m-o,2)+Math.pow(w-l,2))+Math.sqrt(Math.pow(y-u,2)+Math.pow(p-v,2)))}),h.push({index:s,distance:r})}),h.sort(function(t,i){return t.distance-i.distance});var r=[];return h[0].index.forEach(function(i){r.push(t[i])}),r}(t,e[i])}),[r,e]},u.Kt=function(t,i,s){var h=[];return t.forEach(function(t,r){var e=[];t.forEach(function(t,h){e.push(u.lerpCurve(t,i[r][h],s))}),h.push(e)}),h},u.animate=function(t){var i=u.path2shapes(t.from),s=u.path2shapes(t.to),h=u.ti(i,s),r=new Date,e=t.end||function(){},n=t.progress||function(){},a=t.easing||function(t){return t},o=null,c=null,f=t.time;(t.begin||function(){})(i),function t(){var i=new Date-r;if(i>=f)return n(c=s,1),e(c),void cancelAnimationFrame(o);var l=a(i/f);c=u.Kt(h[0],h[1],l),n(c,l),o=requestAnimationFrame(t)}()},u}()});class X extends g{constructor(t){if(super(t),this.oldPath=void 0,this.path2D=new Path2D,this.polyfill)if("function"!=typeof Path2D){var i=document.getElementsByTagName("head")[0],s=document.createElement("script");s.type="text/javascript",s.src="https://cdn.jsdelivr.net/npm/canvas-5-polyfill@0.1.5/canvas.min.js",i.appendChild(s)}else{var h=document.createElement("canvas").getContext("2d");h.stroke(new Path2D("M0,0H1")),h.getImageData(0,0,1,1).data[3]&&(this.polyfill=!1)}}qt(){return Object.assign({},super.qt(),{path:void 0,color:void 0,borderColor:void 0,lineWidth:1,clip:!1,fixed:!1,polyfill:!0})}changeToPathInit(t,i){return G.ti("string"==typeof t?G.path2shapes(t):t,"string"==typeof i?G.path2shapes(i):i)}changeToPath(t,i,s){return G.Kt(i.pathFrom,i.pathTo,t)}detect(t,i){this.Rt(t,i,!1,()=>{t.fillStyle=i,t.fill(this.path2D)})}draw(t,i){if(this.enabled){var s=this.alpha*i.alpha;this.oldPath!==this.path&&(this.polyfill&&"string"==typeof this.path&&(this.path=G.path2shapes(this.path)),Array.isArray(this.path)?(this.path2D=new Path2D,this.path.forEach(t=>{this.path2D.moveTo(t[0][0],t[0][1]),t.forEach(t=>{this.path2D.bezierCurveTo(t[2],t[3],t[4],t[5],t[6],t[7])}),this.path2D.closePath()})):this.path2D=this.path instanceof Path2D?this.path:new Path2D(this.path),this.oldPath=this.path);var h=this.scaleX,r=this.scaleY;for(var e in this.fixed&&(0==h&&(h=Number.EPSILON),0==r&&(r=Number.EPSILON)),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=s,t.save(),t.translate(this.x,this.y),t.scale(h,r),t.rotate(this.rotation),this.color&&(t.fillStyle=this.color,t.fill(this.path2D)),t.save(),this.clip&&(t.clip(this.path2D),this.fixed&&(t.rotate(-this.rotation),t.scale(1/h,1/r),t.translate(-this.x,-this.y))),this.sprite)this.sprite[e].draw(t,i);t.restore(),this.borderColor&&(t.strokeStyle=this.borderColor,t.lineWidth=this.lineWidth,t.stroke(this.path2D)),t.restore()}}}class Y extends m{constructor(t){super(t)}qt(){return Object.assign({},super.qt(),{x:void 0,y:void 0,width:void 0,height:void 0,borderColor:void 0,color:void 0,lineWidth:1,clear:!1,norm:(t,s,h)=>n(i(t),void 0===h.x&&void 0===h.y&&void 0===h.width&&void 0===h.height),position:Y.CENTER})}normalizeFullScreen(t){(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height),(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x,this.position===Y.CENTER&&(this.x+=this.width/2)),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y,this.position===Y.CENTER&&(this.y+=this.height/2))}resize(t,i){}detect(t,i){this.Rt(t,i,this.position===Y.LEFT_TOP)}draw(t,i){if(this.enabled)if(this.normalizeFullScreen(i),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,0===this.rotation&&this.position===Y.LEFT_TOP)this.clear?t.clearRect(this.x,this.y,this.width,this.height):this.color&&(t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height)),this.borderColor&&(t.beginPath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.borderColor,t.rect(this.x,this.y,this.width,this.height),t.stroke());else{var s=this.width/2,h=this.height/2;t.save(),this.position===Y.LEFT_TOP?t.translate(this.x+s,this.y+h):t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),this.clear?t.clearRect(-s,-h,this.width,this.height):this.color&&(t.fillStyle=this.color,t.fillRect(-s,-h,this.width,this.height)),this.borderColor&&(t.beginPath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.borderColor,t.rect(-s,-h,this.width,this.height),t.stroke()),t.restore()}}}Y.LEFT_TOP=0,Y.CENTER=1;class H extends w{constructor(t){var s=i(t.text),h=Array.isArray(s)?s:[...s];super(Object.assign({},t,{class:x,count:h.length,text:t=>h[t],enabled:s=>" "!==h[s]&&i(t.enabled,s)}))}}function U(t){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var V=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],J=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function $(t,i,s,h,r){if("string"==typeof t&&(t=document.getElementById(t)),!(t&&"object"===U(t)&&"getContext"in t))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var e=t.getContext("2d");try{return e.getImageData(i,s,h,r)}catch(t){throw new Error("unable to access image data: "+t)}}function Q(t,i,s,h,r,e){if(!(isNaN(e)||e<1)){e|=0;var n=$(t,i,s,h,r);n=Z(n,0,0,h,r,e),t.getContext("2d").putImageData(n,i,s)}}function Z(t,i,s,h,r,e){var n,a,o,u,c,f,l,v,d,m,y,g,M,w,p,b,x,A,k,O,I,P,F,S,_,j=t.data,C=2*e+1,z=h-1,T=r-1,E=e+1,L=E*(E+1)/2,D=new it,N=D;for(o=1;o<C;o++)N=N.next=new it,o===E&&(_=N);N.next=D;var q=null,B=null;l=f=0;var R=V[e],W=J[e];for(a=0;a<r;a++){for(b=x=A=k=v=d=m=y=0,g=E*(O=j[f]),M=E*(I=j[f+1]),w=E*(P=j[f+2]),p=E*(F=j[f+3]),v+=L*O,d+=L*I,m+=L*P,y+=L*F,N=D,o=0;o<E;o++)N.r=O,N.g=I,N.b=P,N.a=F,N=N.next;for(o=1;o<E;o++)v+=(N.r=O=j[u=f+((z<o?z:o)<<2)])*(S=E-o),d+=(N.g=I=j[u+1])*S,m+=(N.b=P=j[u+2])*S,y+=(N.a=F=j[u+3])*S,b+=O,x+=I,A+=P,k+=F,N=N.next;for(q=D,B=_,n=0;n<h;n++)j[f+3]=F=y*R>>W,0!==F?(j[f]=(v*R>>W)*(F=255/F),j[f+1]=(d*R>>W)*F,j[f+2]=(m*R>>W)*F):j[f]=j[f+1]=j[f+2]=0,v-=g,d-=M,m-=w,y-=p,g-=q.r,M-=q.g,w-=q.b,p-=q.a,u=l+((u=n+e+1)<z?u:z)<<2,v+=b+=q.r=j[u],d+=x+=q.g=j[u+1],m+=A+=q.b=j[u+2],y+=k+=q.a=j[u+3],q=q.next,g+=O=B.r,M+=I=B.g,w+=P=B.b,p+=F=B.a,b-=O,x-=I,A-=P,k-=F,B=B.next,f+=4;l+=h}for(n=0;n<h;n++){for(x=A=k=b=d=m=y=v=0,g=E*(O=j[f=n<<2]),M=E*(I=j[f+1]),w=E*(P=j[f+2]),p=E*(F=j[f+3]),v+=L*O,d+=L*I,m+=L*P,y+=L*F,N=D,o=0;o<E;o++)N.r=O,N.g=I,N.b=P,N.a=F,N=N.next;for(c=h,o=1;o<=e;o++)v+=(N.r=O=j[f=c+n<<2])*(S=E-o),d+=(N.g=I=j[f+1])*S,m+=(N.b=P=j[f+2])*S,y+=(N.a=F=j[f+3])*S,b+=O,x+=I,A+=P,k+=F,N=N.next,o<T&&(c+=h);for(f=n,q=D,B=_,a=0;a<r;a++)j[3+(u=f<<2)]=F=y*R>>W,F>0?(j[u]=(v*R>>W)*(F=255/F),j[u+1]=(d*R>>W)*F,j[u+2]=(m*R>>W)*F):j[u]=j[u+1]=j[u+2]=0,v-=g,d-=M,m-=w,y-=p,g-=q.r,M-=q.g,w-=q.b,p-=q.a,u=n+((u=a+E)<T?u:T)*h<<2,v+=b+=q.r=j[u],d+=x+=q.g=j[u+1],m+=A+=q.b=j[u+2],y+=k+=q.a=j[u+3],q=q.next,g+=O=B.r,M+=I=B.g,w+=P=B.b,p+=F=B.a,b-=O,x-=I,A-=P,k-=F,B=B.next,f+=h}return t}function K(t,i,s,h,r,e){if(!(isNaN(e)||e<1)){e|=0;var n=$(t,i,s,h,r);n=tt(n,0,0,h,r,e),t.getContext("2d").putImageData(n,i,s)}}function tt(t,i,s,h,r,e){var n,a,o,u,c,f,l,v,d,m,y,g,M,w,p,b,x,A,k,O,I,P=t.data,F=2*e+1,S=h-1,_=r-1,j=e+1,C=j*(j+1)/2,z=new it,T=z;for(o=1;o<F;o++)T=T.next=new it,o===j&&(I=T);T.next=z;var E=null,L=null;l=f=0;var D=V[e],N=J[e];for(a=0;a<r;a++){for(w=p=b=v=d=m=0,y=j*(x=P[f]),g=j*(A=P[f+1]),M=j*(k=P[f+2]),v+=C*x,d+=C*A,m+=C*k,T=z,o=0;o<j;o++)T.r=x,T.g=A,T.b=k,T=T.next;for(o=1;o<j;o++)v+=(T.r=x=P[u=f+((S<o?S:o)<<2)])*(O=j-o),d+=(T.g=A=P[u+1])*O,m+=(T.b=k=P[u+2])*O,w+=x,p+=A,b+=k,T=T.next;for(E=z,L=I,n=0;n<h;n++)P[f]=v*D>>N,P[f+1]=d*D>>N,P[f+2]=m*D>>N,v-=y,d-=g,m-=M,y-=E.r,g-=E.g,M-=E.b,u=l+((u=n+e+1)<S?u:S)<<2,v+=w+=E.r=P[u],d+=p+=E.g=P[u+1],m+=b+=E.b=P[u+2],E=E.next,y+=x=L.r,g+=A=L.g,M+=k=L.b,w-=x,p-=A,b-=k,L=L.next,f+=4;l+=h}for(n=0;n<h;n++){for(p=b=w=d=m=v=0,y=j*(x=P[f=n<<2]),g=j*(A=P[f+1]),M=j*(k=P[f+2]),v+=C*x,d+=C*A,m+=C*k,T=z,o=0;o<j;o++)T.r=x,T.g=A,T.b=k,T=T.next;for(c=h,o=1;o<=e;o++)v+=(T.r=x=P[f=c+n<<2])*(O=j-o),d+=(T.g=A=P[f+1])*O,m+=(T.b=k=P[f+2])*O,w+=x,p+=A,b+=k,T=T.next,o<_&&(c+=h);for(f=n,E=z,L=I,a=0;a<r;a++)P[u=f<<2]=v*D>>N,P[u+1]=d*D>>N,P[u+2]=m*D>>N,v-=y,d-=g,m-=M,y-=E.r,g-=E.g,M-=E.b,u=n+((u=a+j)<_?u:_)*h<<2,v+=w+=E.r=P[u],d+=p+=E.g=P[u+1],m+=b+=E.b=P[u+2],E=E.next,y+=x=L.r,g+=A=L.g,M+=k=L.b,w-=x,p-=A,b-=k,L=L.next,f+=h}return t}var it=function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},st={__proto__:null,BlurStack:it,image:function(t,i,s,h){if("string"==typeof t&&(t=document.getElementById(t)),t&&"naturalWidth"in t){var r=t.naturalWidth,e=t.naturalHeight;if("string"==typeof i&&(i=document.getElementById(i)),i&&"getContext"in i){i.style.width=r+"px",i.style.height=e+"px",i.width=r,i.height=e;var n=i.getContext("2d");n.clearRect(0,0,r,e),n.drawImage(t,0,0),isNaN(s)||s<1||(h?Q(i,0,0,r,e,s):K(i,0,0,r,e,s))}}},canvasRGBA:Q,canvasRGB:K,imageDataRGBA:Z,imageDataRGB:tt},{imageDataRGBA:ht}=st;class rt extends p{constructor(t){super(t),this.Xt=!1,this.ii=void 0}qt(){return Object.assign({},super.qt(),{onCanvas:!1,radius:void 0,radiusPart:void 0,radiusScale:!0})}normalizeFullScreen(t){this.norm&&this.onCanvas?(this.x=0,this.y=0,this.width=t.widthInPixel,this.height=t.heightInPixel):super.normalizeFullScreen(t)}resize(t,i){super.resize(t,i),this.radiusPart&&(this.radius=void 0)}additionalBlur(t,i,s){var h=this.Ht.getImageData(0,0,t,i);ht(h,0,0,t,i,s.radius),this.Ht.putImageData(h,0,0)}detect(t,i){this.Rt(t,i,!1)}draw(t,i){if(this.enabled){void 0!==this.radius&&this.ii===this.radiusPart||(this.radius=Math.round((i.widthInPixel+i.heightInPixel)/2/this.radiusPart),this.ii=this.radiusPart);var s=Math.round(this.radius*(this.radiusScale&&(i.cam?i.cam.zoom:1)/i.scaleCanvas));if(s)if(this.onCanvas){void 0!==this.width&&void 0!==this.height||this.normalizeFullScreen(i);var h=Math.round(this.x),r=Math.round(this.y),e=Math.round(this.width),n=Math.round(this.height);this.imageData=t.getImageData(h,r,e,n),ht(this.imageData,0,0,e-h,n-r,s),t.putImageData(this.imageData,h,r,0,0,e,n)}else i.radius=s,super.draw(t,i)}else super.draw(t,i)}}class et extends Y{constructor(t){super(t),void 0!==this.x&&void 0!==this.y&&this.width&&this.height&&this.lineWidth?this.init():this.si=void 0}qt(){return Object.assign({},super.qt(),{count:40,moveX:0,moveY:0,moveZ:0,lineWidth:void 0,highScale:!0,color:"#FFF"})}init(){this.si=this.width/2+this.x,this.hi=this.height/2+this.y,this.ri=Math.max(this.width,this.height)/2,this.ei=[],this.ni=[],this.ai=[],this.oi=[],this.ui=[],this.ci=[],this.fi=[],this.li=[],this.vi=[];for(var t=0;t<this.count;t++)this.ei[t]=Math.random()*this.width-this.width/2,this.ni[t]=Math.random()*this.height-this.height/2,this.ai[t]=Math.random()*this.ri}moveStar(t,i,s){s&&(this.li[t]=!0);for(var h=this.width/2,r=this.height/2,e=this.ei[t]+this.moveX*i,n=this.ni[t]+this.moveY*i,a=this.ai[t]+this.moveZ*i;e<-h;)e+=this.width,n=Math.random()*this.height-r,this.li[t]=!1;for(;e>h;)e-=this.width,n=Math.random()*this.height-r,this.li[t]=!1;for(;n<-r;)n+=this.height,e=Math.random()*this.width-h,this.li[t]=!1;for(;n>r;)n-=this.height,e=Math.random()*this.width-h,this.li[t]=!1;for(;a<=0;)a+=this.ri,e=Math.random()*this.width-h,n=Math.random()*this.height-r,this.li[t]=!1;for(;a>this.ri;)a-=this.ri,e=Math.random()*this.width-h,n=Math.random()*this.height-r,this.li[t]=!1;var o=this.si+e/a*h,u=this.hi+n/a*r;if(this.li[t]=this.li[t]&&o>=this.x&&u>=this.y&&o<this.x+this.width&&u<this.y+this.height,s)this.ei[t]=e,this.ni[t]=n,this.ai[t]=a,this.ci[t]=o,this.fi[t]=u;else{this.oi[t]=o,this.ui[t]=u;var c=4*(1-this.ai[t]/this.ri);this.highScale||(c=Math.ceil(c)),this.vi[t]=c}}animate(t){var i=super.animate(t);if(this.enabled&&void 0!==this.si)for(var s=this.count;s--;)this.moveStar(s,t/16,!0),this.li[s]&&this.moveStar(s,-5,!1);return i}resize(t,i){}detect(t,i){this.Rt(t,i,!1)}draw(t,i){if(this.enabled){if(void 0===this.si)return this.width=this.width||i.width,this.height=this.height||i.height,this.x=void 0===this.x?i.x:this.x,this.y=void 0===this.y?i.y:this.y,this.lineWidth=this.lineWidth||Math.min(i.height/i.heightInPixel,i.width/i.widthInPixel)/2,void this.init();if(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,0==this.moveY&&0==this.moveZ&&this.moveX<0){t.fillStyle=this.color;for(var s=this.count;s--;)this.li[s]&&t.fillRect(this.ci[s],this.fi[s]-this.vi[s]*this.lineWidth/2,this.oi[s]-this.ci[s],this.vi[s]*this.lineWidth)}else if(t.strokeStyle=this.color,this.highScale)for(var h=this.count;h--;)this.li[h]&&(t.beginPath(),t.lineWidth=this.vi[h]*this.lineWidth,t.moveTo(this.oi[h],this.ui[h]),t.lineTo(this.ci[h],this.fi[h]),t.stroke(),t.closePath());else for(var r,e=5;--e;){for(t.beginPath(),t.lineWidth=e*this.lineWidth,r=this.count;r--;)this.li[r]&&this.vi[r]===e&&(t.moveTo(this.oi[r],this.ui[r]),t.lineTo(this.ci[r],this.fi[r]));t.stroke(),t.closePath()}}}}var nt=function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new b(...i)},at=function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new x(...i)},ot=function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new Y(...i)};StarField=function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new et(...i)},nt.LEFT_TOP=b.LEFT_TOP,nt.CENTER=b.CENTER,ot.LEFT_TOP=Y.LEFT_TOP,ot.CENTER=Y.CENTER,at.LEFT_TOP=x.LEFT_TOP,at.CENTER=x.CENTER;var ut={Callback:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new y(...i)},Canvas:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new M(...i)},Circle:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new m(...i)},Emitter:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new w(...i)},FastBlur:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new p(...i)},Group:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new g(...i)},Image:nt,Text:at,Particle:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new W(...i)},Path:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new X(...i)},Rect:ot,Scroller:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new H(...i)},StackBlur:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new rt(...i)},StarField:StarField};class ct{constructor(t,s){this.callback=t,this.duration=n(i(s),void 0),this.initialized=!1}reset(){this.initialized=!1}run(t,i){var s;return void 0!==this.duration?(this.callback(t,Math.min(i,this.duration),!this.initialized),this.initialized=!0,i-this.duration):(s=this.callback(t,i,!this.initialized),this.initialized=!0,s)}}function ft(t,i){return i.from+t*i.delta}function lt(t,i){for(var s,h=[...i.values],r=h.length;r>1;)for(r--,s=0;s<r;s++)h[s]=h[s]+t*(h[s+1]-h[s]);return h[0]}function vt(t,i,s){return i.colorFrom.mix(i.colorTo,t).string()}function dt(t,i,s){return s.changeToPath(t,i,s)}class mt{constructor(t,s,h){for(var r in this.initialized=!1,this.changeValues=[],t){var e=t[r],a="rotationInDegree"===r?.017453292519943295*e:e,o="color"===r||"borderColor"===r,u="path"===r,c="function"==typeof a,f=!o&&Array.isArray(a),l="scale"===r?["scaleX","scaleY"]:"rotationInRadian"===r||"rotationInDegree"===r?["rotation"]:[r];for(var v of l)this.changeValues.push({name:v,to:f?a[a.length-1]:i(a,1,{}),bezier:!!f&&a,isColor:o,isPath:u,isFunction:!!c&&a,moveAlgorithm:o?vt:u?dt:f?lt:ft})}this.duration=n(i(s),0),this.ease=n(h,t=>t)}reset(){this.initialized=!1}init(t,i){for(var s,h=this.changeValues.length;h--;)(s=this.changeValues[h]).isFunction?(s.from=t[s.name],s.to=s.isFunction(s.from),s.isColor?(s.colorFrom=R(s.from),s.colorTo=R(s.to),s.moveAlgorithm=vt):s.isPath?([s.pathFrom,s.pathTo]=t.changeToPathInit(s.from,s.to),s.moveAlgorithm=dt):Array.isArray(s.to)?(s.values=[t[s.name],...s.to],s.moveAlgorithm=lt):(s.delta=s.to-s.from,s.moveAlgorithm=ft)):s.isColor?(s.colorFrom=R(t[s.name]),s.colorTo=R(s.to)):s.isPath?[s.pathFrom,s.pathTo]=t.changeToPathInit(t[s.name],s.to):s.bezier?s.values=[t[s.name],...s.bezier]:(s.from=t[s.name],s.delta=s.to-s.from)}run(t,i){if(this.initialized||(this.initialized=!0,this.init(t,i)),this.duration<=i)for(var s,h=this.changeValues.length;h--;)t[(s=this.changeValues[h]).name]=s.to;else for(var r,e=this.changeValues.length,n=this.ease(i/this.duration);e--;)t[(r=this.changeValues[e]).name]=r.moveAlgorithm(n,r,t);return i-this.duration}}class yt{constructor(){}run(t,i){return d.TIMELAPSE_TO_FORCE_DISABLE}}class gt{constructor(){}run(t,i){return t.enabled=!1,d.TIMELAPSE_TO_FORCE_DISABLE}}class Mt{constructor(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];this.Aniobject=i[0]instanceof d?i[0]:new d(...i)}reset(t){void 0===t&&(t=0),this.Aniobject.reset&&this.Aniobject.reset(t)}play(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.Aniobject.play&&this.Aniobject.play(t,i)}run(t,i,s){for(var h=i;h>=0;){if(h=this.Aniobject.run(t,h,s),s=!0,!0===h)return!0;h>=0&&this.Aniobject.reset&&this.Aniobject.reset()}return h}}class wt{constructor(t,i,s){this.ifCallback=t,this.Aniobject=i,this.AniobjectElse=n(s,()=>0)}run(t,s){var h=i(this.ifCallback)?this.Aniobject:this.AniobjectElse;return h.run?h.run(t,s):h(t,s)}}class pt{constructor(t,s){this.initialized=!1,this.image=i(t),this.durationBetweenFrames=n(i(s),0),Array.isArray(this.image)?this.count=this.image.length:(this.image=[this.image],this.count=1),this.duration=this.count*this.durationBetweenFrames}reset(){this.initialized=!1}run(t,i){if(this.initialized||(this.initialized=!0,this.current=-1),i>=this.duration)t.image=h.getImage(this.image[this.image.length-1]);else{var s=Math.floor(i/this.durationBetweenFrames);s!==this.current&&(this.current=s,t.image=h.getImage(this.image[this.current]))}return i-this.duration}}class bt{constructor(t,s,h){this.initialized=!1,this.frameNumber=i(t),this.framesToRight=n(i(s),!0),this.durationBetweenFrames=n(i(h),0),Array.isArray(this.frameNumber)||(this.frameNumber=[this.frameNumber]),this.duration=this.frameNumber.length*this.durationBetweenFrames}run(t,i){var s;return s=i>=this.duration?this.frameNumber[this.frameNumber.length-1]:this.frameNumber[Math.floor(i/this.durationBetweenFrames)],this.framesToRight?t.frameX=t.frameWidth*s:t.frameY=t.frameHeight*s,i-this.duration}}class xt{constructor(t){for(var s=arguments.length,h=new Array(s>1?s-1:0),r=1;r<s;r++)h[r-1]=arguments[r];this.Aniobject=h[0]instanceof d?h[0]:new d(...h),this.times=this.timesOrg=n(i(t),1)}reset(t){void 0===t&&(t=0),this.times=this.timesOrg,this.Aniobject.reset&&this.Aniobject.reset(t)}play(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.times=this.timesOrg,this.Aniobject.play&&this.Aniobject.play(t,i)}run(t,i,s){for(var h=i;h>=0&&this.times>0;){if(h=this.Aniobject.run(t,h,s),s=!0,!0===h)return!0;h>=0&&(this.times--,this.Aniobject.reset&&this.Aniobject.reset())}return h}}class At extends mt{constructor(t,s,h,r){super({x:t,y:s},0,r),this.speed=i(h)||1}init(t,i){if(0==this.speed||this.targetX===t.x&&this.targetY===t.y)this.duration=0;else{var s=this.changeValues[0],h=this.changeValues[1];s.from=t.x,h.from=t.y,s.delta=s.to-s.from,h.delta=h.to-h.from;var r=Math.sqrt(s.delta*s.delta+h.delta*h.delta);this.duration=10*r/this.speed}super.init(t,i)}}class kt{constructor(){}run(t,i){return d.TIMELAPSE_TO_REMOVE}}class Ot{constructor(t,s){this.Aniobject=t,this.times=n(i(s),1)}run(t,i){if(this.times<=0)return i;var s=this.Aniobject.run(t,i);return s>=0&&this.times--,s}}class It{constructor(t,s){this.initialized=!1,this.duration=i(s),this.shakeDiff=i(t),this.shakeDiffHalf=this.shakeDiff/2}reset(){this.initialized=!1}run(t,i){return this.initialized||(this.initialized=!0,this.x=t.x,this.y=t.y),i>=this.duration?(t.x=this.x,t.y=this.y):(t.x=this.x+Math.random()*this.shakeDiff-this.shakeDiffHalf,t.y=this.y+Math.random()*this.shakeDiff-this.shakeDiffHalf),i-this.duration}}class Pt{constructor(){this.showOnce=!0}run(t,i){return t.enabled=t.enabled&&this.showOnce,this.showOnce=!1,0}}class Ft{constructor(t){var{states:i={},transitions:s={},default:h,delegateTo:r}=void 0===t?{}:t;this.states=i,Object.keys(this.states).forEach(t=>{Array.isArray(this.states[t])&&(this.states[t]=new d(this.states[t]))}),this.transitions=s,this.delegateTo=r,this.currentStateName=h,this.currentState=this.states[h],this.isTransitioningToStateName=void 0}setState(t,i){if(t!==this.currentStateName){this.isTransitioningToStateName=t;var s=""+t.charAt(0).toUpperCase()+t.slice(1),h=[this.currentStateName+"To"+s,this.currentStateName+"To","to"+s].find(t=>this.transitions[t]);h?(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.transitions[h],this.currentState&&this.currentState.reset&&this.currentState.reset()):(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.states[this.currentStateName],this.currentState&&this.currentState.reset&&this.currentState.reset(),this.isTransitioningToStateName=void 0)}}play(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.currentState.play&&this.currentState.play(t,i)}run(t,i,s){var h=i,r=s;if(this.currentState){if(!0===(h=this.currentState.run(t,h,r)))return!0;r=!0}if(h>=0||!this.currentState)if(this.isTransitioningToStateName){if(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.states[this.currentStateName],this.currentState&&this.currentState.reset&&this.currentState.reset(),this.isTransitioningToStateName=void 0,!0===(h=this.currentState.run(t,h,r)))return!0}else this.currentState=void 0;return-1}}class St{constructor(){}run(t,i){return d.TIMELAPSE_TO_STOP}}class _t{constructor(){}run(t,i){return t.enabled=!1,d.TIMELAPSE_TO_STOP}}class jt{constructor(t){this.duration=n(i(t),0)}run(t,i){return t.enabled=i>=this.duration,i-this.duration}}var Ct=function(t){var i=t*t;return t<4/11?7.5625*i:t<8/11?9.075*i-9.9*t+3.4:t<.9?4356/361*i-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72},zt={backInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},backIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},backOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},bounceInOut:function(t){return t<.5?.5*(1-Ct(1-2*t)):.5*Ct(2*t-1)+.5},bounceIn:function(t){return 1-Ct(1-t)},bounceOut:Ct,circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},cubicInOut:function(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1},cubicIn:function(t){return t*t*t},cubicOut:function(t){var i=t-1;return i*i*i+1},elasticInOut:function(t){return t<.5?.5*Math.sin(13*Math.PI/2*2*t)*Math.pow(2,10*(2*t-1)):.5*Math.sin(-13*Math.PI/2*(2*t-1+1))*Math.pow(2,-10*(2*t-1))+1},elasticIn:function(t){return Math.sin(13*t*Math.PI/2)*Math.pow(2,10*(t-1))},elasticOut:function(t){return Math.sin(-13*(t+1)*Math.PI/2)*Math.pow(2,-10*t)+1},expoInOut:function(t){return 0===t||1===t?t:t<.5?.5*Math.pow(2,20*t-10):-.5*Math.pow(2,10-20*t)+1},expoIn:function(t){return 0===t?t:Math.pow(2,10*(t-1))},expoOut:function(t){return 1===t?t:1-Math.pow(2,-10*t)},linear:function(t){return t},quadInOut:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},quadIn:function(t){return t*t},quadOut:function(t){return-t*(t-2)},quartInOut:function(t){return t<.5?8*Math.pow(t,4):-8*Math.pow(t-1,4)+1},quartIn:function(t){return Math.pow(t,4)},quartOut:function(t){return Math.pow(t-1,3)*(1-t)+1},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},sineInOut:function(t){return-.5*(Math.cos(Math.PI*t)-1)},sineIn:function(t){var i=Math.cos(t*Math.PI*.5);return Math.abs(i)<1e-14?1:1-i},sineOut:function(t){return Math.sin(t*Math.PI/2)}},Tt={Default:a,Audio:class extends a{constructor(t){void 0===t&&(t={}),super(t),this.K=Number.POSITIVE_INFINITY,this.di=null,this.mi=null,this.yi=!1,this.gi=this.$.audioElement}get audioElement(){return this.gi}init(){this.gi&&("function"==typeof MediaController&&(this.gi.controller=new MediaController,this.yi=!0),this.gi.preload="auto",this.gi.load())}isLoaded(){if(this.gi){if(!(this.gi.readyState>=this.gi.HAVE_ENOUGH_DATA))return!1;var t=this.gi.play();if(t&&t.catch(t=>{}),this.gi.duration>0)return 1e3*this.gi.duration}return!0}currentTime(){var t=super.currentTime();if(this.gi){var i=1e3*(this.gi.ended?this.gi.duration:this.gi.currentTime);if(this.yi){if(null===this.di)return this.di=t,this.mi=i,i;if("playing"===this.gi.controller.playbackState){if(i===this.mi)return this.mi+Math.min(260,t-this.di);if(i-this.mi<500&&i>this.mi&&t-this.di<350)return this.di=this.di+(i-this.mi),this.mi=i,this.mi+t-this.di}return this.di=t,this.mi=i,this.mi}return i}return t}clampTime(t){return t}shiftTime(t){return 0}}};t.Animations={Callback:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new ct(...i)},ChangeTo:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new mt(...i)},End:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new yt(...i)},EndDisabled:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new gt(...i)},Forever:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new Mt(...i)},If:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new wt(...i)},Image:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new pt(...i)},ImageFrame:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new bt(...i)},Loop:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new xt(...i)},Move:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new At(...i)},Once:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new Ot(...i)},Remove:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new kt(...i)},Sequence:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new d(...i)},Shake:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new It(...i)},ShowOnce:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new Pt(...i)},State:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new Ft(...i)},Stop:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new St(...i)},StopDisabled:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new _t(...i)},Wait:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new v(...i)},WaitDisabled:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new jt(...i)}},t.Easing=zt,t.Engine=function(){for(var t=arguments.length,i=new Array(t),h=0;h<t;h++)i[h]=arguments[h];return new s(...i)},t.ImageManager=h,t.Scenes=l,t.Sprites=ut,t.Timing=Tt});
//# sourceMappingURL=animationvideo.umd.js.map
