!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t||self).AnimationVideo={})}(this,function(t){"use strict";function i(t){return"function"==typeof t?t(...[].slice.call(arguments,1)):t}function s(t){return null==t?[]:Array.isArray(t)?t:[t]}function e(t,i,s){if(!t.s){if(s instanceof h){if(!s.s)return void(s.o=e.bind(null,t,i));1&i&&(i=s.s),s=s.v}if(s&&s.then)return void s.then(e.bind(null,t,i),e.bind(null,t,2));t.s=i,t.v=s;const r=t.o;r&&r(t)}}const h=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(i,s){const h=new t,r=this.s;if(r){const t=1&r?i:s;if(t){try{e(h,1,t(this.v))}catch(t){e(h,2,t)}return h}return this}return this.o=function(t){try{const r=t.v;1&t.s?e(h,1,i?i(r):r):s?e(h,1,s(r)):e(h,2,r)}catch(t){e(h,2,t)}},h},t}();function r(t){return t instanceof h&&1&t.s}var n=new class{constructor(){this.Images=void 0,this.count=void 0,this.loaded=void 0,this.i=[],this.Images={},this.count=0,this.loaded=0}add(t,i){void 0===i&&(i=void 0);const s=this;for(const e in t)if(s.Images[e])i&&"function"==typeof i[e]&&i[e](e,s.Images[e]);else{const h=t[e];if(s.Images[e]=new window.Image,s.Images[e].onload=function(){s.loaded++,i&&"function"==typeof i?s.isLoaded()&&i():i&&"function"==typeof i[e]&&i[e](e,s.Images[e]),s.i&&s.isLoaded()&&(s.i.forEach(t=>t(void 0)),s.i=[])},"<svg"===h.substr(0,4)){const t=window.URL||window.webkitURL,i=new window.Blob([h],{type:"image/svg+xml"});s.Images[e].src=t.createObjectURL(i)}else/^(https?:)?\/\//.test(h)&&(s.Images[e].onerror=()=>{const t=new window.Image;t.onload=s.Images[e].onload,s.Images[e]=t,s.Images[e].src=h},s.Images[e].crossOrigin="anonymous"),s.Images[e].src=h;s.count++}return i&&"function"==typeof i&&s.isLoaded()&&i(),s.i&&s.isLoaded()&&(s.i.forEach(t=>t(void 0)),s.i=[]),s}reset(){return this.Images={},this.count=0,this.loaded=0,this}isLoaded(){return this.loaded===this.count}getImage(t){return"object"==typeof t?t:this.Images[t]}isLoadedPromise(){return!!this.isLoaded()||new Promise((t,i)=>{this.i.push(t)})}};class o{constructor(t){this.u=void 0,this.M=void 0,this.k=void 0,this.O=void 0,this.F=void 0,this.u=[],this.M=[],this.k=0,this.O=0,this.F=void 0===t?[]:Array.isArray(t)?t:[t]}addElement(t){return this.addElementForId(t),t}addElements(t){return this.addElementsForIds(t),t}addElementForId(t){let i=this.u.length,s=this.O;this.u[s]=t,this.M[s]="function"==typeof t,i===s&&i++;let e=this.O+1;for(;e!==i&&this.u[e];)e++;return this.O=e,this.k>s&&(this.k=s),s}addElementsForIds(t){let i=this.u.length;return i===this.O?(this.u=this.u.concat(t),this.O=this.u.length,t.forEach((t,s)=>{this.M[i+s]="function"==typeof t}),Array.from({length:t.length},(t,s)=>s+i)):t.map(t=>this.addElement(t))}getById(t){return this.u[t]}getIdByElement(t){return this.u.indexOf(t)}deleteByElement(t){const i=this.getIdByElement(t);i>=0&&this.deleteById(i)}deleteById(t){let i=this.u.length-1;if(i>0&&t===i){for(this.u[t]=void 0;i&&!this.u[i-1];)i--;this.u.length=i,this.M.length=i,this.O=Math.min(this.O,i),this.k=Math.min(this.k,i)}else this.u[t]&&(this.u[t]=void 0,this.O=Math.min(this.O,t),this.k===t&&(this.k=t+1))}isCanvasId(t){return void 0===t||!this.F.length||this.F.includes(t)}forEach(t,i){let s,e;void 0===i&&(i=0);const h=this.u.length;for(s=this.k;s<h;s++)if(e=this.u[s],e&&!1===t({elementId:s,layerId:i,element:e,isFunction:this.M[s],layer:this}))return}getElementsByTag(t){let i=[];return this.forEach(s=>{let{element:e,isFunction:h}=s;if(!h){const s=e.getElementsByTag(t);s&&(i=i.concat(s))}}),i}play(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.forEach(s=>{let{element:e,isFunction:h}=s;return!h&&e.play(t,i)})}count(){let t=0;const i=this.u.length;for(let s=this.k;s<i;s++)this.u[s]&&t++;return t}clear(){this.u=[],this.M=[],this.k=0,this.O=0}}class a{constructor(){this.P=void 0,this.P=[]}addLayer(t){return void 0===t&&(t=void 0),this.P[this.P.length]=new o(t),this.P[this.P.length-1]}addLayers(t,i){void 0===t&&(t=1),void 0===i&&(i=void 0);let s=Array.from({length:t},t=>new o(i));return this.P=this.P.concat(s),s}addLayerForId(t){return void 0===t&&(t=void 0),this.P[this.P.length]=new o(t),this.P.length-1}addLayersForIds(t,i){void 0===t&&(t=1),void 0===i&&(i=void 0);const s=Array.from({length:t},(t,i)=>i+this.P.length);return this.P=this.P.concat(Array.from({length:t},t=>new o(i))),s}getById(t){return this.P[t]}forEach(t,i){let s;const e=this.P.length;for(s=0;s<e;s++)this.P[s].isCanvasId(i)&&this.P[s].forEach(t,s)}play(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.forEach(s=>{let{element:e,isFunction:h}=s;return!h&&e.play(t,i)})}getElementsByTag(t){let i=[];return this.forEach(s=>{let{element:e,isFunction:h}=s;if(!h){const s=e.getElementsByTag(t);s&&(i=i.concat(s))}}),i}count(){return this.P.length}clear(){this.P=[]}}class u{constructor(){this.m=[1,0,0,1,0,0]}I(){this.reset()}reset(){return this.m=[1,0,0,1,0,0],this}multiply(t){const i=this.m[1]*t.m[0]+this.m[3]*t.m[1],s=this.m[0]*t.m[2]+this.m[2]*t.m[3],e=this.m[1]*t.m[2]+this.m[3]*t.m[3],h=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],r=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=this.m[0]*t.m[0]+this.m[2]*t.m[1],this.m[1]=i,this.m[2]=s,this.m[3]=e,this.m[4]=h,this.m[5]=r,this}invert(){const t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),i=-this.m[1]*t,s=-this.m[2]*t,e=this.m[0]*t,h=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),r=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=this.m[3]*t,this.m[1]=i,this.m[2]=s,this.m[3]=e,this.m[4]=h,this.m[5]=r,this}rotate(t){const i=Math.cos(t),s=Math.sin(t),e=this.m[1]*i+this.m[3]*s,h=this.m[0]*-s+this.m[2]*i,r=this.m[1]*-s+this.m[3]*i;return this.m[0]=this.m[0]*i+this.m[2]*s,this.m[1]=e,this.m[2]=h,this.m[3]=r,this}translate(t,i){return this.m[4]+=this.m[0]*t+this.m[2]*i,this.m[5]+=this.m[1]*t+this.m[3]*i,this}scale(t,i){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=i,this.m[3]*=i,this}transformPoint(t,i){const s=t;return[t=s*this.m[0]+i*this.m[2]+this.m[4],i=s*this.m[1]+i*this.m[3]+this.m[5]]}clone(){const t=new u;return t.m=this.m.slice(0),t}}function c(t,i){return null==t||""===t?i:t}class l{constructor(t){void 0===t&&(t={}),this.C=void 0,this.T=void 0,this.S=void 0,this.A=void 0,this.type="timing",this.totalTimePassed=0,this.C=t,this.T=c(i(this.C.tickChunk),1e3/60),this.S=c(i(this.C.maxSkippedTickChunk),120),this.A=c(i(this.C.tickChunkTolerance),.1)}init(t){}currentTime(){return window.performance?window.performance.now():Date.now()}clampTime(t){let{timePassed:i}=t;const s=this.T?this.T*this.S:2e3;return i>s?s:i}shiftTime(t){let{timePassed:i}=t;return this.T?-i%this.T:0}get tickChunk(){return this.T}isChunked(){return!!this.T}hasOneChunkedFrame(t){let{timePassed:i}=t;return i>=this.T-this.A}calcFrames(t){let{timePassed:i}=t;return Math.min(this.S,Math.floor((i+this.A)/this.T))}}const f="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function d(t,i,s){if(!t.s){if(s instanceof v){if(!s.s)return void(s.o=d.bind(null,t,i));1&i&&(i=s.s),s=s.v}if(s&&s.then)return void s.then(d.bind(null,t,i),d.bind(null,t,2));t.s=i,t.v=s;const e=t.o;e&&e(t)}}const v=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(i,s){const e=new t,h=this.s;if(h){const t=1&h?i:s;if(t){try{d(e,1,t(this.v))}catch(t){d(e,2,t)}return e}return this}return this.o=function(t){try{const h=t.v;1&t.s?d(e,1,i?i(h):h):s?d(e,1,s(h)):d(e,2,h)}catch(t){d(e,2,t)}},e},t}();function m(t){return t instanceof v&&1&t.s}class p{constructor(t){this.j=void 0,this.j=i(t)-0}run(t,i){return i-this.j}}var g;!function(t){t.FORCE_DISABLE="F",t.STOP="S",t.REMOVE="R"}(g||(g={}));class b{constructor(){this.sequences=[],this.lastTimestamp=0,this.enabled=!0;var t=[].slice.call(arguments);let i=0;"number"==typeof t[0]&&(i=t.shift()),this.sequences=t.map(t=>{Array.isArray(t)||(t=[t]);let s=i;return"number"==typeof t[0]&&(s=t.shift()),{position:0,timelapsed:-s,sequence:t.map(t=>"function"!=typeof t.run?"number"==typeof t?new p(t):{run:t}:t).filter(t=>"function"==typeof t.run),label:t.reduce((t,i,s)=>("string"==typeof i&&(t[i]=s-Object.keys(t).length),t),{}),enabled:!0}})}reset(t){void 0===t&&(t=0),this.sequences.forEach(i=>{var s;i.enabled=!0,i.position=0,i.timelapsed=t,null==(s=i.sequence[0])||null==s.reset||s.reset(t)}),this.enabled=!0}play(t,i){if(void 0===t&&(t=""),void 0===i&&(i=0),t){const s=this.sequences.reduce((s,e)=>{var h;return t in e.label?(s=!0,e.position=e.label[t],e.enabled=!0,e.timelapsed=i,null==(h=e.sequence[e.position])||null==h.reset||h.reset()):s=s||e.sequence.some(s=>null==s.play?void 0:s.play(t,i)),s},!1);return s&&(this.enabled=!0),s}return this.sequences.forEach(t=>t.enabled=!0),this.enabled=!0,!0}_(t,i,s){let e=s;for(;i.sequence[i.position]&&e>=0;){if(i.timelapsed+=e,i.timelapsed<0)return-1;const r=i.sequence[i.position].run(t,i.timelapsed);if(!0===r)e=0;else{if(!1===r)return-1;if(r===g.FORCE_DISABLE)return i.enabled=!1,this.enabled=!1,s;if(r===g.STOP)return i.enabled=!1,s;if(r===g.REMOVE)return!0}var h;if(e=r,e>=0&&(i.position=(i.position+1)%i.sequence.length,null==(h=i.sequence[i.position])||null==h.reset||h.reset(),i.timelapsed=0,0===i.position))return i.enabled=!1,e}return e}run(t,i,s){void 0===s&&(s=!1);let e=i;if(s||(e=i-this.lastTimestamp,this.lastTimestamp=i),!this.enabled)return e;const h=this.sequences.length;let r=0,n=Infinity;for(let i=0;i<h;i++)if(this.sequences[i].enabled){const s=this._(t,this.sequences[i],e);if(!0===s)return!0;n=Math.min(n,s)}else r++;return r===h?(this.enabled=!1,e):n}}class M{constructor(t){this.D=!0,this.p=void 0,this.p=this.L(this.N(),t)}L(t,s){const e=Object.entries(t).map(t=>{let[e,h]=t;const r=s[e];return[e,"function"==typeof h?h(r,s):c(i(r),h)]});return Object.fromEntries(e)}B(){return{animation:(t,s)=>{const e=i(t);return Array.isArray(e)?new b(e):e},enabled:!0,isClickable:!1,tag:(t,s)=>{const e=i(t);return Array.isArray(e)?e:e?[e]:[]}}}N(){return this.B()}getElementsByTag(t){if("function"==typeof t){if(this.p.tag.filter(t).length)return[this]}else if((Array.isArray(t)?t:[t]).filter(t=>this.p.tag.includes(t)).length)return[this];return[]}animate(t){return!(!this.p.animation||!0!==this.p.animation.run(this,t,!0)||(this.p.enabled=!1,0))}play(t,i){var s,e;void 0===t&&(t=""),void 0===i&&(i=0),this.p.animation&&(null==(s=(e=this.p.animation).play)||s.call(e,t,i))}init(t,i){}callInit(t,i){this.D&&(this.init(t,i),this.D=!1)}resize(t,i){}R(t,i,s,e,h){let r=!1;return t.enabled&&t.isClickable&&(i.save(),i.translate(t.x,t.y),i.scale(t.scaleX,t.scaleY),i.rotate(t.rotation),i.beginPath(),r=h(),i.restore()),r?this:void 0}W(t,i,s,e,h,r){let{enabled:n,isClickable:o,x:a=0,y:u=0,width:c=0,height:l=0,scaleX:f=1,scaleY:d=1,rotation:v=0}=t,m=!1;if(n&&o){const t=c/2,n=l/2;i.save(),h?i.translate(a+t,u+n):i.translate(a,u),i.scale(f,d),i.rotate(v),i.beginPath(),r?m=r(t,n):(i.rect(-t,-n,c,l),i.closePath(),m=i.isPointInPath(s,e)),i.restore()}return m?this:void 0}detectDraw(t,i){}detect(t,i,s){}draw(t,i){}}const y=Math.PI/180,w={x:0,y:0,rotation:(t,s)=>c(i(t),c(i(s.rotationInRadian),c(i(s.rotationInDegree),0)*y)),scaleX:(t,s)=>c(i(t),c(i(s.scale),1)),scaleY:(t,s)=>c(i(t),c(i(s.scale),1)),alpha:1,compositeOperation:"source-over",color:"#fff"};class x extends M{constructor(t){super(t)}N(){return Object.assign({},super.N(),w,{sprite:[]})}getElementsByTag(t){let i=super.getElementsByTag(t);for(const s of this.p.sprite){const e=s.getElementsByTag(t);e&&(i=i.concat(e))}return i}animate(t){let i=super.animate(t),s=!1;if(this.p.enabled)for(const i of this.p.sprite)s=s||!0===i.animate(t);return this.p.animation?i:(s&&(this.p.enabled=!1),s)}play(t,i){var s,e;void 0===t&&(t=""),void 0===i&&(i=0),this.p.animation&&(null==(s=(e=this.p.animation).play)||s.call(e,t,i));for(const s of this.p.sprite)null==s.play||s.play(t,i)}resize(t,i){for(const s of this.p.sprite)s.resize(t,i)}callInit(t,i){super.callInit(t,i);for(let s of this.p.sprite)s.callInit(t,i)}detectDraw(t,i){if(this.p.enabled)for(const s of this.p.sprite)s.detectDraw(t,i)}detect(t,i,s){if(this.p.enabled)for(const e of this.p.sprite){const h=e.detect(t,i,s);if(h)return h}}draw(t,i){if(this.p.enabled){this.p.alpha<1&&((i=Object.assign({},i)).alpha*=this.p.alpha),t.save(),t.translate(this.p.x,this.p.y),t.scale(this.p.scaleX,this.p.scaleY),t.rotate(this.p.rotation);for(const s of this.p.sprite)s.draw(t,i);t.restore()}}}class k extends x{constructor(t){super(t.self||{});let s=c(i(t.count),1);this.p.sprite=[];const e=t.class;for(let h=0;h<s;h++){const s=Object.entries(t).reduce((t,s)=>{let[e,r]=s;return["self","class","count"].includes(e)||(t[e]=i(r,h)),t},{});this.p.sprite[h]=new e(s)}}}class O extends M{constructor(t){super(t),this.U=void 0,this.X=void 0,this.Y=void 0}N(){return Object.assign({},super.N(),{x:void 0,y:void 0,width:void 0,height:void 0,gridSize:void 0,darker:0,pixel:!1,clear:!1,norm:(t,s)=>c(i(t),void 0===i(s.x)&&void 0===i(s.y)&&void 0===i(s.width)&&void 0===i(s.height)),scaleX:(t,s)=>c(i(t),c(i(s.scale),1)),scaleY:(t,s)=>c(i(t),c(i(s.scale),1)),alpha:1,compositeOperation:"source-over"})}H(t){const i=t.widthInPixel,s=t.heightInPixel,e=this.p;this.U=document.createElement("canvas"),e.gridSize?(this.X=e.gridSize,this.U.width=Math.round(this.X),this.U.height=Math.round(this.X)):(this.U.width=Math.ceil(i/e.scaleX),this.U.height=Math.ceil(s/e.scaleY)),this.Y=this.U.getContext("2d"),this.Y.globalCompositeOperation="source-over",this.Y.globalAlpha=1}normalizeFullScreen(t){const i=this.p;(i.norm||void 0===i.x)&&(i.x=t.visibleScreen.x),(i.norm||void 0===i.y)&&(i.y=t.visibleScreen.y),(i.norm||void 0===i.width)&&(i.width=t.visibleScreen.width),(i.norm||void 0===i.height)&&(i.height=t.visibleScreen.height)}resize(t,i){if(this.U&&this.X!==this.p.gridSize){const t=this.U;this.H(i),this.Y.globalCompositeOperation="copy",this.Y.drawImage(t,0,0,t.width,t.height,0,0,this.U.width,this.U.height),this.Y.globalCompositeOperation="source-over"}this.normalizeFullScreen(i)}detect(t,i,s){return this.W(this.p,t,i,s,!1)}init(t,i){this.H(i),this.normalizeFullScreen(i)}draw(t,i){const s=this.p;if(s.enabled&&s.alpha>0){s.gridSize&&this.X!==s.gridSize&&this.resize(void 0,i);const h=s.alpha*i.alpha,r=s.width,n=s.height,o=this.U.width,a=this.U.height;if(h>0&&o&&a){var e;this.Y.globalCompositeOperation="copy",this.Y.globalAlpha=1,this.Y.drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height,0,0,o,a),s.darker>0&&(this.Y.globalCompositeOperation=s.clear?"source-atop":"source-over",this.Y.fillStyle="rgba(0,0,0,"+s.darker+")",this.Y.fillRect(0,0,o,a)),null==(e=this.additionalBlur)||e.call(this,o,a,i),s.clear&&(t.globalCompositeOperation="source-over",t.globalAlpha=1,t.clearRect(s.x,s.y,r,n)),t.globalCompositeOperation=s.compositeOperation,t.globalAlpha=h;const u=t.imageSmoothingEnabled;t.imageSmoothingEnabled=!s.pixel,t.drawImage(this.U,0,0,o,a,s.x,s.y,r,n),t.imageSmoothingEnabled=u}}else s.clear&&(s.x||(s.x=i.x),s.y||(s.y=i.y),s.width||(s.width=i.width),s.height||(s.height=i.height),t.clearRect(s.x,s.y,s.width,s.height))}}var F;t.Position=void 0,(F=t.Position||(t.Position={}))[F.LEFT_TOP=0]="LEFT_TOP",F[F.CENTER=1]="CENTER";class P extends M{constructor(t){super(t)}N(){return Object.assign({},this.B(),w,{text:t=>{const s=i(t);return(Array.isArray(s)?s.join(""):s)||""},font:"2em monospace",position:t.Position.CENTER,color:void 0,borderColor:void 0,lineWidth:1})}detectDraw(t,i){this.p.enabled&&this.p.isClickable&&(t.save(),t.translate(this.p.x,this.p.y),t.scale(this.p.scaleX,this.p.scaleY),t.rotate(this.p.rotation),this.p.position||(t.textAlign="left",t.textBaseline="top"),t.font=this.p.font,t.fillStyle=i,t.fillText(this.p.text,0,0),t.restore())}detect(t,i,s){return"c"}draw(t,i){this.p.enabled&&(t.globalCompositeOperation=this.p.compositeOperation,t.globalAlpha=this.p.alpha*i.alpha,t.save(),this.p.position||(t.textAlign="left",t.textBaseline="top"),t.translate(this.p.x,this.p.y),t.scale(this.p.scaleX,this.p.scaleY),t.rotate(this.p.rotation),t.font=this.p.font,this.p.color&&(t.fillStyle=this.p.color,t.fillText(this.p.text,0,0)),this.p.borderColor&&(t.strokeStyle=this.p.borderColor,t.lineWidth=this.p.lineWidth,t.strokeText(this.p.text,0,0)),t.restore())}}function I(t,i){(function(t){return"string"==typeof t&&-1!==t.indexOf(".")&&1===parseFloat(t)})(t)&&(t="100%");var s=function(t){return"string"==typeof t&&-1!==t.indexOf("%")}(t);return t=360===i?t:Math.min(i,Math.max(0,parseFloat(t))),s&&(t=parseInt(String(t*i),10)/100),Math.abs(t-i)<1e-6?1:t=360===i?(t<0?t%i+i:t%i)/parseFloat(String(i)):t%i/parseFloat(String(i))}function C(t){return Math.min(1,Math.max(0,t))}function T(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function S(t){return t<=1?"".concat(100*Number(t),"%"):t}function A(t){return 1===t.length?"0"+t:String(t)}function E(t,i,s){t=I(t,255),i=I(i,255),s=I(s,255);var e=Math.max(t,i,s),h=Math.min(t,i,s),r=0,n=0,o=(e+h)/2;if(e===h)n=0,r=0;else{var a=e-h;switch(n=o>.5?a/(2-e-h):a/(e+h),e){case t:r=(i-s)/a+(i<s?6:0);break;case i:r=(s-t)/a+2;break;case s:r=(t-i)/a+4}r/=6}return{h:r,s:n,l:o}}function j(t,i,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*s*(i-t):s<.5?i:s<2/3?t+(i-t)*(2/3-s)*6:t}function _(t,i,s){t=I(t,255),i=I(i,255),s=I(s,255);var e=Math.max(t,i,s),h=Math.min(t,i,s),r=0,n=e,o=e-h,a=0===e?0:o/e;if(e===h)r=0;else{switch(e){case t:r=(i-s)/o+(i<s?6:0);break;case i:r=(s-t)/o+2;break;case s:r=(t-i)/o+4}r/=6}return{h:r,s:a,v:n}}function z(t,i,s,e){var h=[A(Math.round(t).toString(16)),A(Math.round(i).toString(16)),A(Math.round(s).toString(16))];return e&&h[0].startsWith(h[0].charAt(1))&&h[1].startsWith(h[1].charAt(1))&&h[2].startsWith(h[2].charAt(1))?h[0].charAt(0)+h[1].charAt(0)+h[2].charAt(0):h.join("")}function D(t){return L(t)/255}function L(t){return parseInt(t,16)}var q={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},N="(?:".concat("[-\\+]?\\d*\\.\\d+%?",")|(?:").concat("[-\\+]?\\d+%?",")"),B="[\\s|\\(]+(".concat(N,")[,|\\s]+(").concat(N,")[,|\\s]+(").concat(N,")\\s*\\)?"),R="[\\s|\\(]+(".concat(N,")[,|\\s]+(").concat(N,")[,|\\s]+(").concat(N,")[,|\\s]+(").concat(N,")\\s*\\)?"),W={CSS_UNIT:new RegExp(N),rgb:new RegExp("rgb"+B),rgba:new RegExp("rgba"+R),hsl:new RegExp("hsl"+B),hsla:new RegExp("hsla"+R),hsv:new RegExp("hsv"+B),hsva:new RegExp("hsva"+R),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function U(t){return Boolean(W.CSS_UNIT.exec(String(t)))}var X=function(){function t(i,s){var e;if(void 0===i&&(i=""),void 0===s&&(s={}),i instanceof t)return i;"number"==typeof i&&(i=function(t){return{r:t>>16,g:(65280&t)>>8,b:255&t}}(i)),this.originalInput=i;var h=function(t){var i,s,e={r:0,g:0,b:0},h=1,r=null,n=null,o=null,a=!1,u=!1;return"string"==typeof t&&(t=function(t){if(0===(t=t.trim().toLowerCase()).length)return!1;var i=!1;if(q[t])t=q[t],i=!0;else if("transparent"===t)return{r:0,g:0,b:0,a:0,format:"name"};var s=W.rgb.exec(t);return s?{r:s[1],g:s[2],b:s[3]}:(s=W.rgba.exec(t))?{r:s[1],g:s[2],b:s[3],a:s[4]}:(s=W.hsl.exec(t))?{h:s[1],s:s[2],l:s[3]}:(s=W.hsla.exec(t))?{h:s[1],s:s[2],l:s[3],a:s[4]}:(s=W.hsv.exec(t))?{h:s[1],s:s[2],v:s[3]}:(s=W.hsva.exec(t))?{h:s[1],s:s[2],v:s[3],a:s[4]}:(s=W.hex8.exec(t))?{r:L(s[1]),g:L(s[2]),b:L(s[3]),a:D(s[4]),format:i?"name":"hex8"}:(s=W.hex6.exec(t))?{r:L(s[1]),g:L(s[2]),b:L(s[3]),format:i?"name":"hex"}:(s=W.hex4.exec(t))?{r:L(s[1]+s[1]),g:L(s[2]+s[2]),b:L(s[3]+s[3]),a:D(s[4]+s[4]),format:i?"name":"hex8"}:!!(s=W.hex3.exec(t))&&{r:L(s[1]+s[1]),g:L(s[2]+s[2]),b:L(s[3]+s[3]),format:i?"name":"hex"}}(t)),"object"==typeof t&&(U(t.r)&&U(t.g)&&U(t.b)?(i=t.g,s=t.b,e={r:255*I(t.r,255),g:255*I(i,255),b:255*I(s,255)},a=!0,u="%"===String(t.r).substr(-1)?"prgb":"rgb"):U(t.h)&&U(t.s)&&U(t.v)?(r=S(t.s),n=S(t.v),e=function(t,i,s){t=6*I(t,360),i=I(i,100),s=I(s,100);var e=Math.floor(t),h=t-e,r=s*(1-i),n=s*(1-h*i),o=s*(1-(1-h)*i),a=e%6;return{r:255*[s,n,r,r,o,s][a],g:255*[o,s,s,n,r,r][a],b:255*[r,r,o,s,s,n][a]}}(t.h,r,n),a=!0,u="hsv"):U(t.h)&&U(t.s)&&U(t.l)&&(r=S(t.s),o=S(t.l),e=function(t,i,s){var e,h,r;if(t=I(t,360),i=I(i,100),s=I(s,100),0===i)h=s,r=s,e=s;else{var n=s<.5?s*(1+i):s+i-s*i,o=2*s-n;e=j(o,n,t+1/3),h=j(o,n,t),r=j(o,n,t-1/3)}return{r:255*e,g:255*h,b:255*r}}(t.h,r,o),a=!0,u="hsl"),Object.prototype.hasOwnProperty.call(t,"a")&&(h=t.a)),h=T(h),{ok:a,format:t.format||u,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:h}}(i);this.originalInput=i,this.r=h.r,this.g=h.g,this.b=h.b,this.a=h.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(e=s.format)&&void 0!==e?e:h.format,this.gradientType=s.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=h.ok}return t.prototype.isDark=function(){return this.getBrightness()<128},t.prototype.isLight=function(){return!this.isDark()},t.prototype.getBrightness=function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},t.prototype.getLuminance=function(){var t=this.toRgb(),i=t.r/255,s=t.g/255,e=t.b/255;return.2126*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.7152*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))+.0722*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))},t.prototype.getAlpha=function(){return this.a},t.prototype.setAlpha=function(t){return this.a=T(t),this.roundA=Math.round(100*this.a)/100,this},t.prototype.toHsv=function(){var t=_(this.r,this.g,this.b);return{h:360*t.h,s:t.s,v:t.v,a:this.a}},t.prototype.toHsvString=function(){var t=_(this.r,this.g,this.b),i=Math.round(360*t.h),s=Math.round(100*t.s),e=Math.round(100*t.v);return 1===this.a?"hsv(".concat(i,", ").concat(s,"%, ").concat(e,"%)"):"hsva(".concat(i,", ").concat(s,"%, ").concat(e,"%, ").concat(this.roundA,")")},t.prototype.toHsl=function(){var t=E(this.r,this.g,this.b);return{h:360*t.h,s:t.s,l:t.l,a:this.a}},t.prototype.toHslString=function(){var t=E(this.r,this.g,this.b),i=Math.round(360*t.h),s=Math.round(100*t.s),e=Math.round(100*t.l);return 1===this.a?"hsl(".concat(i,", ").concat(s,"%, ").concat(e,"%)"):"hsla(".concat(i,", ").concat(s,"%, ").concat(e,"%, ").concat(this.roundA,")")},t.prototype.toHex=function(t){return void 0===t&&(t=!1),z(this.r,this.g,this.b,t)},t.prototype.toHexString=function(t){return void 0===t&&(t=!1),"#"+this.toHex(t)},t.prototype.toHex8=function(t){return void 0===t&&(t=!1),function(t,i,s,e,h){var r,n=[A(Math.round(t).toString(16)),A(Math.round(i).toString(16)),A(Math.round(s).toString(16)),A((r=e,Math.round(255*parseFloat(r)).toString(16)))];return h&&n[0].startsWith(n[0].charAt(1))&&n[1].startsWith(n[1].charAt(1))&&n[2].startsWith(n[2].charAt(1))&&n[3].startsWith(n[3].charAt(1))?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0)+n[3].charAt(0):n.join("")}(this.r,this.g,this.b,this.a,t)},t.prototype.toHex8String=function(t){return void 0===t&&(t=!1),"#"+this.toHex8(t)},t.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},t.prototype.toRgbString=function(){var t=Math.round(this.r),i=Math.round(this.g),s=Math.round(this.b);return 1===this.a?"rgb(".concat(t,", ").concat(i,", ").concat(s,")"):"rgba(".concat(t,", ").concat(i,", ").concat(s,", ").concat(this.roundA,")")},t.prototype.toPercentageRgb=function(){var t=function(t){return"".concat(Math.round(100*I(t,255)),"%")};return{r:t(this.r),g:t(this.g),b:t(this.b),a:this.a}},t.prototype.toPercentageRgbString=function(){var t=function(t){return Math.round(100*I(t,255))};return 1===this.a?"rgb(".concat(t(this.r),"%, ").concat(t(this.g),"%, ").concat(t(this.b),"%)"):"rgba(".concat(t(this.r),"%, ").concat(t(this.g),"%, ").concat(t(this.b),"%, ").concat(this.roundA,")")},t.prototype.toName=function(){if(0===this.a)return"transparent";if(this.a<1)return!1;for(var t="#"+z(this.r,this.g,this.b,!1),i=0,s=Object.entries(q);i<s.length;i++){var e=s[i];if(t===e[1])return e[0]}return!1},t.prototype.toString=function(t){var i=Boolean(t);t=null!=t?t:this.format;var s=!1;return i||!(this.a<1&&this.a>=0)||!t.startsWith("hex")&&"name"!==t?("rgb"===t&&(s=this.toRgbString()),"prgb"===t&&(s=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(s=this.toHexString()),"hex3"===t&&(s=this.toHexString(!0)),"hex4"===t&&(s=this.toHex8String(!0)),"hex8"===t&&(s=this.toHex8String()),"name"===t&&(s=this.toName()),"hsl"===t&&(s=this.toHslString()),"hsv"===t&&(s=this.toHsvString()),s||this.toHexString()):"name"===t&&0===this.a?this.toName():this.toRgbString()},t.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},t.prototype.clone=function(){return new t(this.toString())},t.prototype.lighten=function(i){void 0===i&&(i=10);var s=this.toHsl();return s.l+=i/100,s.l=C(s.l),new t(s)},t.prototype.brighten=function(i){void 0===i&&(i=10);var s=this.toRgb();return s.r=Math.max(0,Math.min(255,s.r-Math.round(-i/100*255))),s.g=Math.max(0,Math.min(255,s.g-Math.round(-i/100*255))),s.b=Math.max(0,Math.min(255,s.b-Math.round(-i/100*255))),new t(s)},t.prototype.darken=function(i){void 0===i&&(i=10);var s=this.toHsl();return s.l-=i/100,s.l=C(s.l),new t(s)},t.prototype.tint=function(t){return void 0===t&&(t=10),this.mix("white",t)},t.prototype.shade=function(t){return void 0===t&&(t=10),this.mix("black",t)},t.prototype.desaturate=function(i){void 0===i&&(i=10);var s=this.toHsl();return s.s-=i/100,s.s=C(s.s),new t(s)},t.prototype.saturate=function(i){void 0===i&&(i=10);var s=this.toHsl();return s.s+=i/100,s.s=C(s.s),new t(s)},t.prototype.greyscale=function(){return this.desaturate(100)},t.prototype.spin=function(i){var s=this.toHsl(),e=(s.h+i)%360;return s.h=e<0?360+e:e,new t(s)},t.prototype.mix=function(i,s){void 0===s&&(s=50);var e=this.toRgb(),h=new t(i).toRgb(),r=s/100;return new t({r:(h.r-e.r)*r+e.r,g:(h.g-e.g)*r+e.g,b:(h.b-e.b)*r+e.b,a:(h.a-e.a)*r+e.a})},t.prototype.analogous=function(i,s){void 0===i&&(i=6),void 0===s&&(s=30);var e=this.toHsl(),h=360/s,r=[this];for(e.h=(e.h-(h*i>>1)+720)%360;--i;)e.h=(e.h+h)%360,r.push(new t(e));return r},t.prototype.complement=function(){var i=this.toHsl();return i.h=(i.h+180)%360,new t(i)},t.prototype.monochromatic=function(i){void 0===i&&(i=6);for(var s=this.toHsv(),e=s.h,h=s.s,r=s.v,n=[],o=1/i;i--;)n.push(new t({h:e,s:h,v:r})),r=(r+o)%1;return n},t.prototype.splitcomplement=function(){var i=this.toHsl(),s=i.h;return[this,new t({h:(s+72)%360,s:i.s,l:i.l}),new t({h:(s+216)%360,s:i.s,l:i.l})]},t.prototype.onBackground=function(i){var s=this.toRgb(),e=new t(i).toRgb();return new t({r:e.r+(s.r-e.r)*s.a,g:e.g+(s.g-e.g)*s.a,b:e.b+(s.b-e.b)*s.a})},t.prototype.triad=function(){return this.polyad(3)},t.prototype.tetrad=function(){return this.polyad(4)},t.prototype.polyad=function(i){for(var s=this.toHsl(),e=s.h,h=[this],r=360/i,n=1;n<i;n++)h.push(new t({h:(e+n*r)%360,s:s.s,l:s.l}));return h},t.prototype.equals=function(i){return this.toRgbString()===new t(i).toRgbString()},t}();const Y=64;class H extends M{constructor(t){super(t),this.G=void 0,this.J=!1}N(){return Object.assign({},super.N(),{x:0,y:0,scaleX:(t,s)=>c(i(t),c(i(s.scale),1)),scaleY:(t,s)=>c(i(t),c(i(s.scale),1)),color:"#FFF",alpha:1,compositeOperation:"source-over"})}static getGradientImage(t,i,s){let e=t>>4,h=i>>4,r=s>>4;if(!H.V){const t=16;H.V=Array.from({length:t},i=>Array.from({length:t},i=>Array.from({length:t})))}return H.V[e][h][r]||(H.V[e][h][r]=H.generateGradientImage(e,h,r)),H.V[e][h][r]}static generateGradientImage(t,i,s){let e=document.createElement("canvas");e.width=e.height=Y;let h=e.getContext("2d");h.globalAlpha=1,h.globalCompositeOperation="source-over",h.clearRect(0,0,Y,Y);let r=h.createRadialGradient(32,32,0,32,32,32);return r.addColorStop(0,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",1)"),r.addColorStop(.3,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",0.4)"),r.addColorStop(1,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",0)"),h.fillStyle=r,h.fillRect(0,0,Y,Y),e}resize(t,i){this.G=void 0}draw(t,i){const s=this.p;if(s.enabled&&s.alpha>0){s.color&&s.color.r||(s.color=new X(s.color).toRgb()),this.G!==s.scaleX&&(this.G=s.scaleX,this.J=s.scaleX*i.widthInPixel/i.width>Y);const{r:e,g:h,b:r}=s.color;t.globalCompositeOperation=s.compositeOperation,t.globalAlpha=s.alpha*i.alpha,t.imageSmoothingEnabled=this.J,t.drawImage(H.getGradientImage(e,h,r),0,0,Y,Y,s.x-s.scaleX/2,s.y-s.scaleY/2,s.scaleX,s.scaleY),t.imageSmoothingEnabled=!0}}}H.V=void 0,"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var G=function(t){var i={exports:{}};return function(t,i){t.exports=function(){var t=2*Math.PI,i=function(t,i,s,e,h,r,n){var o=t.x,a=t.y;return{x:e*(o*=i)-h*(a*=s)+r,y:h*o+e*a+n}},s=function(t,i){var s=4/3*Math.tan(i/4),e=Math.cos(t),h=Math.sin(t),r=Math.cos(t+i),n=Math.sin(t+i);return[{x:e-h*s,y:h+e*s},{x:r+n*s,y:n-r*s},{x:r,y:n}]},e=function(t,i,s,e){var h=t*e-i*s<0?-1:1,r=(t*s+i*e)/(Math.sqrt(t*t+i*i)*Math.sqrt(t*t+i*i));return r>1&&(r=1),r<-1&&(r=-1),h*Math.acos(r)},h=function(h){var r=h.px,n=h.py,o=h.cx,a=h.cy,u=h.rx,c=h.ry,l=h.xAxisRotation,f=void 0===l?0:l,d=h.largeArcFlag,v=void 0===d?0:d,m=h.sweepFlag,p=void 0===m?0:m,g=[];if(0===u||0===c)return[];var b=Math.sin(f*t/360),M=Math.cos(f*t/360),y=M*(r-o)/2+b*(n-a)/2,w=-b*(r-o)/2+M*(n-a)/2;if(0===y&&0===w)return[];u=Math.abs(u),c=Math.abs(c);var x=Math.pow(y,2)/Math.pow(u,2)+Math.pow(w,2)/Math.pow(c,2);x>1&&(u*=Math.sqrt(x),c*=Math.sqrt(x));var k=function(i,s,h,r,n,o,a,u,c,l,f,d){var v=Math.pow(n,2),m=Math.pow(o,2),p=Math.pow(f,2),g=Math.pow(d,2),b=v*m-v*g-m*p;b<0&&(b=0),b/=v*g+m*p;var M=(b=Math.sqrt(b)*(a===u?-1:1))*n/o*d,y=b*-o/n*f,w=l*M-c*y+(i+h)/2,x=c*M+l*y+(s+r)/2,k=(f-M)/n,O=(d-y)/o,F=(-f-M)/n,P=(-d-y)/o,I=e(1,0,k,O),C=e(k,O,F,P);return 0===u&&C>0&&(C-=t),1===u&&C<0&&(C+=t),[w,x,I,C]}(r,n,o,a,u,c,v,p,b,M,y,w),O=function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,i){var s=[],e=!0,h=!1,r=void 0;try{for(var n,o=t[Symbol.iterator]();!(e=(n=o.next()).done)&&(s.push(n.value),!i||s.length!==i);e=!0);}catch(t){h=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(h)throw r}}return s}(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(k,4),F=O[0],P=O[1],I=O[2],C=O[3],T=Math.max(Math.ceil(Math.abs(C)/(t/4)),1);C/=T;for(var S=0;S<T;S++)g.push(s(I,C)),I+=C;return g.map(function(t){var s=i(t[0],u,c,M,b,F,P),e=s.x,h=s.y,r=i(t[1],u,c,M,b,F,P),n=r.x,o=r.y,a=i(t[2],u,c,M,b,F,P);return{x1:e,y1:h,x2:n,y2:o,x:a.x,y:a.y}})},r={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},n=/([astvzqmhlc])([^astvzqmhlc]*)/gi,o=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;function a(t){var i=t[0][0],s=t[0][1],e=i,h=s;return t.forEach(function(t){var r=t[0],n=t[2],o=t[4],a=t[6],u=t[1],c=t[3],l=t[5],f=t[7];i=Math.min(i,r,n,o,a),s=Math.min(s,u,c,l,f),e=Math.max(e,r,n,o,a),h=Math.max(h,u,c,l,f)}),[i,s,e,h]}var u={};function c(t,i,s,e,h,r,n,o,a,u){var c=(s-t)*a+t,l=(e-i)*a+i,f=(h-s)*a+s,d=(r-e)*a+e,v=(f-c)*a+c,m=(d-l)*a+l,p=(((n-h)*a+h-f)*a+f-v)*a+v,g=(((o-r)*a+r-d)*a+d-m)*a+m;return u?[p,g,v,m,c,l,t,i]:[t,i,c,l,v,m,p,g]}function l(t,i){for(var s=function(i){var s=[];t[t.length-1].forEach(function(t){s.push(t.slice(0))}),t.push(s)},e=0;e<i;e++)s()}return u.parser=function(t){var i=[];return t.replace(n,function(t,s,e){var h=s.toLowerCase();for(e=function(t){var i=t.match(o);return i?i.map(Number):[]}(e),"m"==h&&e.length>2&&(i.push([s].concat(e.splice(0,2))),h="l",s="m"==s?"l":"L");;){if(e.length==r[h])return e.unshift(s),i.push(e);if(e.length<r[h])throw new Error("malformed path data");i.push([s].concat(e.splice(0,r[h])))}}),i},u.lerpCurve=function(t,i,s){return u.lerpPoints(t[0],t[1],i[0],i[1],s).concat(u.lerpPoints(t[2],t[3],i[2],i[3],s)).concat(u.lerpPoints(t[4],t[5],i[4],i[5],s)).concat(u.lerpPoints(t[6],t[7],i[6],i[7],s))},u.lerpPoints=function(t,i,s,e,h){return[t+(s-t)*h,i+(e-i)*h]},u.q2b=function(t,i,s,e,h,r){return[t,i,(t+2*s)/3,(i+2*e)/3,(h+2*s)/3,(r+2*e)/3,h,r]},u.path2shapes=function(t){for(var i=u.parser(t),s=0,e=0,r=0,n=i.length,o=[],a=null,c=void 0,l=void 0,f=void 0,d=void 0,v=void 0,m=void 0,p=void 0;r<n;r++){var g=i[r],b=i[r-1];switch(g[0]){case"m":o[v=o.length]=[],a=o[v],s+=g[1],e+=g[2];break;case"M":o[v=o.length]=[],a=o[v],s=g[1],e=g[2];break;case"l":a.push([s,e,s,e,s,e,s+g[1],e+g[2]]),s+=g[1],e+=g[2];break;case"L":a.push([s,e,g[1],g[2],g[1],g[2],g[1],g[2]]),s=g[1],e=g[2];break;case"h":a.push([s,e,s,e,s,e,s+g[1],e]),s+=g[1];break;case"H":a.push([s,e,g[1],e,g[1],e,g[1],e]),s=g[1];break;case"v":a.push([s,e,s,e,s,e,s,e+g[1]]),e+=g[1];break;case"V":a.push([s,e,s,g[1],s,g[1],s,g[1]]),e=g[1];break;case"C":a.push([s,e,g[1],g[2],g[3],g[4],g[5],g[6]]),s=g[5],e=g[6];break;case"S":"C"===b[0]||"c"===b[0]?a.push([s,e,s+b[5]-b[3],e+b[6]-b[4],g[1],g[2],g[3],g[4]]):"S"!==b[0]&&"s"!==b[0]||a.push([s,e,s+b[3]-b[1],e+b[4]-b[2],g[1],g[2],g[3],g[4]]),s=g[3],e=g[4];break;case"c":a.push([s,e,s+g[1],e+g[2],s+g[3],e+g[4],s+g[5],e+g[6]]),s+=g[5],e+=g[6];break;case"s":"C"===b[0]||"c"===b[0]?a.push([s,e,s+b[5]-b[3],e+b[6]-b[4],s+g[1],e+g[2],s+g[3],e+g[4]]):"S"!==b[0]&&"s"!==b[0]||a.push([s,e,s+b[3]-b[1],e+b[4]-b[2],s+g[1],e+g[2],s+g[3],e+g[4]]),s+=g[3],e+=g[4];break;case"a":p=(m=h({rx:g[1],ry:g[2],px:s,py:e,xAxisRotation:g[3],largeArcFlag:g[4],sweepFlag:g[5],cx:s+g[6],cy:e+g[7]}))[m.length-1],m.forEach(function(t,i){a.push(0===i?[s,e,t.x1,t.y1,t.x2,t.y2,t.x,t.y]:[m[i-1].x,m[i-1].y,t.x1,t.y1,t.x2,t.y2,t.x,t.y])}),s=p.x,e=p.y;break;case"A":p=(m=h({rx:g[1],ry:g[2],px:s,py:e,xAxisRotation:g[3],largeArcFlag:g[4],sweepFlag:g[5],cx:g[6],cy:g[7]}))[m.length-1],m.forEach(function(t,i){a.push(0===i?[s,e,t.x1,t.y1,t.x2,t.y2,t.x,t.y]:[m[i-1].x,m[i-1].y,t.x1,t.y1,t.x2,t.y2,t.x,t.y])}),s=p.x,e=p.y;break;case"Q":a.push(u.q2b(s,e,g[1],g[2],g[3],g[4])),s=g[3],e=g[4];break;case"q":a.push(u.q2b(s,e,s+g[1],e+g[2],g[3]+s,g[4]+e)),s+=g[3],e+=g[4];break;case"T":"Q"===b[0]||"q"===b[0]?a.push(u.q2b(s,e,f=s+b[3]-b[1],d=e+b[4]-b[2],g[1],g[2])):"T"!==b[0]&&"t"!==b[0]||(a.push(u.q2b(s,e,s+s-f,e+e-d,g[1],g[2])),f=s+s-f,d=e+e-d),s=g[1],e=g[2];break;case"t":"Q"===b[0]||"q"===b[0]?a.push(u.q2b(s,e,f=s+b[3]-b[1],d=e+b[4]-b[2],s+g[1],e+g[2])):"T"!==b[0]&&"t"!==b[0]||(a.push(u.q2b(s,e,s+s-f,e+e-d,s+g[1],e+g[2])),f=s+s-f,d=e+e-d),s+=g[1],e+=g[2];break;case"Z":case"z":a.push([s,e,c=a[0][0],l=a[0][1],c,l,c,l])}}return o},u.$=function(t,i){for(var s=0,e=0,h=t.length;s<i;s++)t.push(t[e].slice(0)),++e>h-1&&(e-=h)},u.Z=function(t,i){for(var s=0,e=0;s<i;s++){var h=t[e],r={left:c(n=h[0],o=h[1],a=h[2],u=h[3],l=h[4],f=h[5],d=h[6],v=h[7],.5),right:c(d,v,l,f,a,u,n,o,.5,!0)};t.splice(e,1),t.splice(e,0,r.left,r.right),(e+=2)>=t.length-1&&(e=0)}var n,o,a,u,l,f,d,v},u.lerp=function(t,i,s){return u.K(u.path2shapes(t),u.path2shapes(i),s)},u.MIM_CURVES_COUNT=100,u.tt=function(t,i){var s=t.length,e=i.length,h=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(i));return s>e?l(r,s-e):s<e&&l(h,e-s),(h=function(t,i){var s=function(t){for(var i=[],s=0;s<t;s++)i.push(s);return e=[],h=[],function t(i){var s,r;for(s=0;s<i.length;s++)r=i.splice(s,1)[0],h.push(r),0==i.length&&e.push(h.slice()),t(i),i.splice(s,0,r),h.pop();return e}(i);var e,h}(t.length),e=[];s.forEach(function(s){var h=0;s.forEach(function(s){var e,r;h+=(e=a(t[s]),r=a(i[s]),Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))+Math.sqrt(Math.pow(e[2]-r[2],2)+Math.pow(e[3]-r[3],2)))}),e.push({index:s,distance:h})}),e.sort(function(t,i){return t.distance-i.distance});var h=[];return e[0].index.forEach(function(i){h.push(t[i])}),h}(h,r)).forEach(function(t,i){var s=t.length,e=r[i].length;s>e?s<u.MIM_CURVES_COUNT?(u.Z(t,u.MIM_CURVES_COUNT-s),u.Z(r[i],u.MIM_CURVES_COUNT-e)):u.Z(r[i],s-e):s<e&&(e<u.MIM_CURVES_COUNT?(u.Z(t,u.MIM_CURVES_COUNT-s),u.Z(r[i],u.MIM_CURVES_COUNT-e)):u.Z(t,e-s))}),h.forEach(function(t,i){h[i]=function(t,i){var s=function(t){for(var i=[],s=0;s<t;s++){for(var e=[],h=0;h<t;h++){var r=h+s;r>t-1&&(r-=t),e[r]=h}i.push(e)}return i}(t.length),e=[];s.forEach(function(s){var h=0,r=0;s.forEach(function(s){var e,n,o,a,u,c,l,f,d,v,m,p,g,b,M,y;h+=(n=i[r++],o=(e=t[s])[2],a=e[4],u=e[6],c=e[1],l=e[3],f=e[5],d=e[7],v=n[2],m=n[4],p=n[6],g=n[1],b=n[3],M=n[5],y=n[7],Math.sqrt(Math.pow(n[0]-e[0],2)+Math.pow(g-c,2))+Math.sqrt(Math.pow(v-o,2)+Math.pow(b-l,2))+Math.sqrt(Math.pow(m-a,2)+Math.pow(M-f,2))+Math.sqrt(Math.pow(p-u,2)+Math.pow(y-d,2)))}),e.push({index:s,distance:h})}),e.sort(function(t,i){return t.distance-i.distance});var h=[];return e[0].index.forEach(function(i){h.push(t[i])}),h}(t,r[i])}),[h,r]},u.K=function(t,i,s){var e=[];return t.forEach(function(t,h){var r=[];t.forEach(function(t,e){r.push(u.lerpCurve(t,i[h][e],s))}),e.push(r)}),e},u.animate=function(t){var i=u.path2shapes(t.from),s=u.path2shapes(t.to),e=u.tt(i,s),h=new Date,r=t.end||function(){},n=t.progress||function(){},o=t.easing||function(t){return t},a=null,c=null,l=t.time;(t.begin||function(){})(i),function t(){var i=new Date-h;if(i>=l)return n(c=s,1),r(c),void cancelAnimationFrame(a);var f=o(i/l);c=u.K(e[0],e[1],f),n(c,f),a=requestAnimationFrame(t)}()},u}()}(i),i.exports}(),J=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],V=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function $(t,i,s,e,h,r){for(var n,o=t.data,a=2*r+1,u=e-1,c=h-1,l=r+1,f=l*(l+1)/2,d=new Q,v=d,m=1;m<a;m++)v=v.next=new Q,m===l&&(n=v);v.next=d;for(var p=null,g=null,b=0,M=0,y=J[r],w=V[r],x=0;x<h;x++){v=d;for(var k=o[M],O=o[M+1],F=o[M+2],P=o[M+3],I=0;I<l;I++)v.r=k,v.g=O,v.b=F,v.a=P,v=v.next;for(var C=0,T=0,S=0,A=0,E=l*k,j=l*O,_=l*F,z=l*P,D=f*k,L=f*O,q=f*F,N=f*P,B=1;B<l;B++){var R=M+((u<B?u:B)<<2),W=o[R],U=o[R+1],X=o[R+2],Y=o[R+3],H=l-B;D+=(v.r=W)*H,L+=(v.g=U)*H,q+=(v.b=X)*H,N+=(v.a=Y)*H,C+=W,T+=U,S+=X,A+=Y,v=v.next}p=d,g=n;for(var G=0;G<e;G++){var $=N*y>>w;if(o[M+3]=$,0!==$){var Z=255/$;o[M]=(D*y>>w)*Z,o[M+1]=(L*y>>w)*Z,o[M+2]=(q*y>>w)*Z}else o[M]=o[M+1]=o[M+2]=0;D-=E,L-=j,q-=_,N-=z,E-=p.r,j-=p.g,_-=p.b,z-=p.a;var K=G+r+1;D+=C+=p.r=o[K=b+(K<u?K:u)<<2],L+=T+=p.g=o[K+1],q+=S+=p.b=o[K+2],N+=A+=p.a=o[K+3],p=p.next;var tt=g.r,it=g.g,st=g.b,et=g.a;E+=tt,j+=it,_+=st,z+=et,C-=tt,T-=it,S-=st,A-=et,g=g.next,M+=4}b+=e}for(var ht=0;ht<e;ht++){var rt=o[M=ht<<2],nt=o[M+1],ot=o[M+2],at=o[M+3],ut=l*rt,ct=l*nt,lt=l*ot,ft=l*at,dt=f*rt,vt=f*nt,mt=f*ot,pt=f*at;v=d;for(var gt=0;gt<l;gt++)v.r=rt,v.g=nt,v.b=ot,v.a=at,v=v.next;for(var bt=e,Mt=0,yt=0,wt=0,xt=0,kt=1;kt<=r;kt++){var Ot=l-kt;dt+=(v.r=rt=o[M=bt+ht<<2])*Ot,vt+=(v.g=nt=o[M+1])*Ot,mt+=(v.b=ot=o[M+2])*Ot,pt+=(v.a=at=o[M+3])*Ot,xt+=rt,Mt+=nt,yt+=ot,wt+=at,v=v.next,kt<c&&(bt+=e)}M=ht,p=d,g=n;for(var Ft=0;Ft<h;Ft++){var Pt=M<<2;o[Pt+3]=at=pt*y>>w,at>0?(o[Pt]=(dt*y>>w)*(at=255/at),o[Pt+1]=(vt*y>>w)*at,o[Pt+2]=(mt*y>>w)*at):o[Pt]=o[Pt+1]=o[Pt+2]=0,dt-=ut,vt-=ct,mt-=lt,pt-=ft,ut-=p.r,ct-=p.g,lt-=p.b,ft-=p.a,Pt=ht+((Pt=Ft+l)<c?Pt:c)*e<<2,dt+=xt+=p.r=o[Pt],vt+=Mt+=p.g=o[Pt+1],mt+=yt+=p.b=o[Pt+2],pt+=wt+=p.a=o[Pt+3],p=p.next,ut+=rt=g.r,ct+=nt=g.g,lt+=ot=g.b,ft+=at=g.a,xt-=rt,Mt-=nt,yt-=ot,wt-=at,g=g.next,M+=e}}return t}var Q=function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},Z={Callback:class extends M{constructor(t){"function"==typeof t&&(t={callback:t}),super(t),this.it=0}N(){return Object.assign({},this.B(),{callback:t=>void 0===typeof t?()=>{}:t})}animate(t){return this.p.enabled&&(this.it+=t),super.animate(t)}draw(t,i){this.p.enabled&&this.p.callback(t,this.it,i,this)}},Canvas:class extends x{constructor(t){super(t),this.X=void 0,this.st=2,this.U=void 0,this.Y=void 0}N(){return Object.assign({},super.N(),{x:void 0,y:void 0,width:void 0,height:void 0,canvasWidth:void 0,canvasHeight:void 0,gridSize:void 0,compositeOperation:"source-over",norm:(t,s)=>c(i(t),void 0===i(s.x)&&void 0===i(s.y)&&void 0===i(s.width)&&void 0===i(s.height)),isDrawFrame:(t,i)=>c(t,1)})}H(t){const i=t.widthInPixel,s=t.heightInPixel,e=this.p;this.U=document.createElement("canvas"),e.canvasWidth&&e.canvasHeight?(this.U.width=e.canvasWidth,this.U.height=e.canvasHeight):e.gridSize?(this.X=e.gridSize,this.U.width=Math.round(this.X),this.U.height=Math.round(this.X)):(this.U.width=Math.round(i/e.scaleX),this.U.height=Math.round(s/e.scaleY)),this.Y=this.U.getContext("2d")}et(t){const i=this.p;(i.norm||void 0===i.x)&&(i.x=t.visibleScreen.x),(i.norm||void 0===i.y)&&(i.y=t.visibleScreen.y),(i.norm||void 0===i.width)&&(i.width=t.visibleScreen.width),(i.norm||void 0===i.height)&&(i.height=t.visibleScreen.height)}ht(t){const i=this.p;if(this.U&&this.X!==i.gridSize&&!i.canvasWidth){const i=this.U;this.H(t),this.Y.globalCompositeOperation="copy",this.Y.drawImage(i,0,0,i.width,i.height,0,0,this.U.width,this.U.height),this.Y.globalCompositeOperation="source-over",this.st=2}this.et(t)}resize(t,i){this.ht(i),super.resize(t,i)}detect(t,i,s){return this.W(this.p,t,i,s,!1)}init(t,i){this.H(i),this.et(i)}draw(t,s){const e=this.p;if(e.enabled){e.gridSize&&this.X!==e.gridSize&&this.ht(s),this.st=Math.max(this.st-1,i(e.isDrawFrame,t,s));const h=e.width,r=e.height,n=h/2,o=r/2,a=this.U.width,u=this.U.height;if(this.st){this.Y.textBaseline="middle",this.Y.textAlign="center",this.Y.globalAlpha=1,this.Y.globalCompositeOperation="source-over",this.Y.save();const t=s.cam;if(e.norm&&t){const i=Math.max(a,u)/2;this.Y.translate(a/2,u/2),this.Y.scale(i,i),this.Y.scale(t.zoom,t.zoom),this.Y.translate(-t.x,-t.y)}for(const t of e.sprite)t.draw(this.Y,e.norm?Object.assign({},s,{alpha:1,widthInPixel:a,heightInPixel:u}):{alpha:1,x:0,y:0,width:a,height:u,widthInPixel:a,heightInPixel:u,scaleCanvas:1,visibleScreen:{x:0,y:0,width:a,height:u},fullScreen:{x:0,y:0,width:a,height:u}});this.Y.restore()}t.save(),t.globalCompositeOperation=e.compositeOperation,t.globalAlpha=e.alpha*s.alpha,t.translate(e.x+n,e.y+o),t.scale(e.scaleX,e.scaleY),t.rotate(e.rotation),t.drawImage(this.U,0,0,a,u,-n,-o,h,r),t.restore()}}},Circle:class extends M{constructor(t){super(t)}N(){return Object.assign({},this.B(),w)}detect(t,i,s){return this.R(this.p,t,i,s,()=>(t.arc(0,0,1,Math.PI/2+this.p.rotation,2.5*Math.PI-this.p.rotation,!1),t.isPointInPath(i,s)))}draw(t,i){this.p.enabled&&(t.globalCompositeOperation=this.p.compositeOperation,t.globalAlpha=this.p.alpha*i.alpha,t.save(),t.translate(this.p.x,this.p.y),t.scale(this.p.scaleX,this.p.scaleY),t.beginPath(),t.fillStyle=this.p.color,t.arc(0,0,1,Math.PI/2+this.p.rotation,2.5*Math.PI-this.p.rotation,!1),t.fill(),t.restore())}},Emitter:k,FastBlur:O,Group:x,Image:class extends M{constructor(t){super(t),this.rt=void 0,this.nt=void 0,this.U=void 0,this.Y=void 0}N(){return Object.assign({},super.N(),w,{image:t=>n.getImage(i(t)),position:t.Position.CENTER,frameX:0,frameY:0,frameWidth:0,frameHeight:0,width:void 0,height:void 0,norm:!1,normCover:!1,normToScreen:!1,clickExact:!1,color:"#FFF",tint:0})}resize(t,i){this.D=!0}init(t,i){const s=this.p,e=s.frameWidth||s.image.width,h=s.frameHeight||s.image.height;this.nt=s.normToScreen?s.normCover?Math.max(i.fullScreen.width/e,i.fullScreen.height/h):s.norm?Math.min(i.fullScreen.width/e,i.fullScreen.height/h):1:s.normCover?Math.max(i.width/e,i.height/h):s.norm?Math.min(i.width/e,i.height/h):1}ot(){return[this.p.tint,this.p.frameWidth||this.p.image.width,this.p.frameHeight||this.p.image.height,this.p.color,this.p.frameX,this.p.frameY].join(";")}ut(t,i){return this.U||(this.U=document.createElement("canvas"),this.Y=this.U.getContext("2d")),this.U.width=t,this.U.height=i,this.Y}detectDraw(i,s){const e=this.p;if(e.enabled&&e.isClickable&&e.clickExact){const h=e.frameWidth||e.image.width,r=e.frameHeight||e.image.height,n=(e.width?e.width:h)*this.nt*e.scaleX,o=(e.height?e.height:r)*this.nt*e.scaleY,a=e.position===t.Position.LEFT_TOP,u=this.ut(h,r);u.globalAlpha=1,u.globalCompositeOperation="source-over",u.fillStyle=s,u.fillRect(0,0,h,r),u.globalCompositeOperation="destination-atop",u.drawImage(e.image,e.frameX,e.frameY,h,r,0,0,h,r),i.save(),i.translate(e.x,e.y),i.scale(e.scaleX,e.scaleY),i.rotate(e.rotation),i.drawImage(this.U,0,0,h,r,a?0:-n/2,a?0:-o/2,n,o),i.restore(),this.rt=void 0}}detect(t,i,s){return this.p.enabled&&this.p.isClickable&&this.p.clickExact?"c":this.W(this.p,t,i,s,!1)}draw(i,s){const e=this.p;if(e.enabled&&e.image&&e.alpha>0){const h=e.frameWidth||e.image.width,r=e.frameHeight||e.image.height,n=(e.width?e.width:h)*this.nt*e.scaleX,o=(e.height?e.height:r)*this.nt*e.scaleY;i.globalCompositeOperation=e.compositeOperation,i.globalAlpha=e.alpha*s.alpha;const a=e.position!==t.Position.LEFT_TOP;let u=e.image,c=e.frameX,l=e.frameY;if(e.tint){const t=this.ot();if(this.rt!==t){const i=this.ut(h,r);i.globalAlpha=1,i.globalCompositeOperation="source-over",i.clearRect(0,0,h,r),i.globalAlpha=e.tint,i.fillStyle=e.color,i.fillRect(0,0,h,r),i.globalAlpha=1,i.globalCompositeOperation="destination-atop",i.drawImage(e.image,e.frameX,e.frameY,h,r,0,0,h,r),this.rt=t}u=this.U,c=0,l=0}let f=0,d=0;a&&(f=-n/2,d=-o/2),0==e.rotation?i.drawImage(u,c,l,h,r,e.x+f,e.y+d,n,o):(i.save(),i.translate(e.x,e.y),i.rotate(e.rotation),i.drawImage(u,c,l,h,r,f,d,n,o),i.restore())}}},Text:P,Particle:H,Path:class extends x{constructor(t){if(super(t),this.ct=void 0,this.lt=new Path2D,this.p.polyfill)if("function"!=typeof Path2D){let t=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.src="https://cdn.jsdelivr.net/npm/canvas-5-polyfill@0.1.5/canvas.min.js",t.appendChild(i)}else{let t=document.createElement("canvas").getContext("2d");t.stroke(new Path2D("M0,0H1")),t.getImageData(0,0,1,1).data[3]&&(this.p.polyfill=!1)}}N(){return Object.assign({},super.N(),{path:void 0,color:void 0,borderColor:void 0,lineWidth:1,clip:!1,fixed:!1,polyfill:!0})}changeToPathInit(t,i){return G.tt("string"==typeof t?G.path2shapes(t):Array.isArray(t)?t:[],"string"==typeof i?G.path2shapes(i):Array.isArray(i)?i:[])}changeToPath(t,i){return G.K(i.pathFrom,i.pathTo,t)}detect(t,i,s){return this.W(this.p,t,i,s,!1,()=>t.isPointInPath(this.lt,i,s))}draw(t,i){const s=this.p;if(s.enabled){const e=s.alpha*i.alpha;this.ct!==s.path&&(s.polyfill&&"string"==typeof s.path&&(s.path=G.path2shapes(s.path)),Array.isArray(s.path)?(this.lt=new Path2D,s.path.forEach(t=>{this.lt.moveTo(t[0][0],t[0][1]),t.forEach(t=>{this.lt.bezierCurveTo(t[2],t[3],t[4],t[5],t[6],t[7])}),this.lt.closePath()})):this.lt=s.path instanceof Path2D?s.path:new Path2D(s.path),this.ct=s.path);let h=s.scaleX,r=s.scaleY;s.fixed&&(0==h&&(h=Number.EPSILON),0==r&&(r=Number.EPSILON)),t.globalCompositeOperation=s.compositeOperation,t.globalAlpha=e,t.save(),t.translate(s.x,s.y),t.scale(h,r),t.rotate(s.rotation),s.color&&(t.fillStyle=s.color,t.fill(this.lt)),t.save(),s.clip&&(t.clip(this.lt),s.fixed&&(t.rotate(-s.rotation),t.scale(1/h,1/r),t.translate(-s.x,-s.y)));for(const e of s.sprite)e.draw(t,i);t.restore(),s.borderColor&&(t.strokeStyle=s.borderColor,t.lineWidth=s.lineWidth,t.stroke(this.lt)),t.restore()}}},Rect:class extends M{constructor(t){super(t)}N(){return Object.assign({},super.N(),w,{x:void 0,y:void 0,width:void 0,height:void 0,borderColor:void 0,color:void 0,lineWidth:1,clear:!1,norm:(t,s)=>c(i(t),void 0===i(s.x)&&void 0===i(s.y)&&void 0===i(s.width)&&void 0===i(s.height)),position:t.Position.CENTER})}et(i){(this.p.norm||void 0===this.p.width)&&(this.p.width=i.visibleScreen.width),(this.p.norm||void 0===this.p.height)&&(this.p.height=i.visibleScreen.height),(this.p.norm||void 0===this.p.x)&&(this.p.x=i.visibleScreen.x,this.p.position===t.Position.CENTER&&(this.p.x+=this.p.width/2)),(this.p.norm||void 0===this.p.y)&&(this.p.y=i.visibleScreen.y,this.p.position===t.Position.CENTER&&(this.p.y+=this.p.height/2))}resize(t,i){this.D=!0}init(t,i){this.et(i)}detect(i,s,e){return this.W(this.p,i,s,e,this.p.position===t.Position.LEFT_TOP)}draw(i,s){const e=this.p;if(e.enabled&&e.alpha>0)if(i.globalCompositeOperation=e.compositeOperation,i.globalAlpha=e.alpha*s.alpha,0===e.rotation&&e.position===t.Position.LEFT_TOP)e.clear?i.clearRect(e.x,e.y,e.width,e.height):e.color&&(i.fillStyle=e.color,i.fillRect(e.x,e.y,e.width,e.height)),e.borderColor&&(i.beginPath(),i.lineWidth=e.lineWidth,i.strokeStyle=e.borderColor,i.rect(e.x,e.y,e.width,e.height),i.stroke());else{let s=e.width/2,h=e.height/2;i.save(),e.position===t.Position.LEFT_TOP?i.translate(e.x+s,e.y+h):i.translate(e.x,e.y),i.scale(e.scaleX,e.scaleY),i.rotate(e.rotation),e.clear?i.clearRect(-s,-h,e.width,e.height):e.color&&(i.fillStyle=e.color,i.fillRect(-s,-h,e.width,e.height)),e.borderColor&&(i.beginPath(),i.lineWidth=e.lineWidth,i.strokeStyle=e.borderColor,i.rect(-s,-h,e.width,e.height),i.stroke()),i.restore()}}},Scroller:class extends k{constructor(t){let s=i(t.text),e=Array.isArray(s)?s:[...s];super(Object.assign({},t,{class:P,count:e.length,text:t=>e[t],enabled:s=>" "!==e[s]&&i(t.enabled)}))}},StackBlur:class extends O{constructor(t){super(t),this.ft=void 0}N(){return Object.assign({},super.N(),{onCanvas:!1,radius:void 0,radiusPart:void 0,radiusScale:!0})}normalizeFullScreen(t){const i=this.p;i.norm&&i.onCanvas?(i.x=0,i.y=0,i.width=t.widthInPixel,i.height=t.heightInPixel):super.normalizeFullScreen(t)}resize(t,i){super.resize(t,i),this.p.radiusPart&&(this.p.radius=void 0)}additionalBlur(t,i,s){const e=this.Y.getImageData(0,0,t,i);$(e,0,0,t,i,s.radius||1),this.Y.putImageData(e,0,0)}draw(t,i){const s=this.p;if(s.enabled){void 0!==s.radius&&this.ft===s.radiusPart||(s.radius=Math.round((i.widthInPixel+i.heightInPixel)/2/s.radiusPart),this.ft=s.radiusPart);const e=Math.round(s.radius*(s.radiusScale&&i.cam?i.cam.zoom:1)/i.scaleCanvas);if(e)if(s.onCanvas){void 0!==s.width&&void 0!==s.height||this.normalizeFullScreen(i);const h=Math.round(s.x),r=Math.round(s.y),n=Math.round(s.width),o=Math.round(s.height),a=t.getImageData(h,r,n,o);$(a,0,0,n-h,o-r,e),t.putImageData(a,h,r,0,0,n,o)}else i.radius=e,super.draw(t,i)}else super.draw(t,i)}},StarField:class extends M{constructor(t){super(t),this.dt=[],this.vt=[],this.gt=[],this.bt=[],this.Mt=[],this.yt=[],this.wt=[],this.xt=[],this.kt=[],this.Ot=0,this.Ft=0,this.Pt=0}N(){return Object.assign({},super.N(),{count:40,moveX:0,moveY:0,moveZ:0,lineWidth:void 0,highScale:!0,color:"#FFF"})}init(t,i){const s=this.p;function e(t,i,s){return void 0===s&&(s=-i),void 0===t||t<i||t>=s?Math.random()*(s-i)+i:t}s.width=s.width||i.width,s.height=s.height||i.height,s.x=void 0===s.x?i.x:s.x,s.y=void 0===s.y?i.y:s.y,s.lineWidth=s.lineWidth||Math.min(i.height/i.heightInPixel,i.width/i.widthInPixel)/2,this.Ot=s.width/2+s.x,this.Ft=s.height/2+s.y,this.Pt=Math.max(s.width,s.height)/2;for(let t=0;t<s.count;t++)this.dt[t]=e(this.dt[t],-s.width/2),this.vt[t]=e(this.vt[t],-s.height/2),this.gt[t]=e(this.gt[t],0,this.Pt)}It(t,i,s){const e=this.p,h=e.width/2,r=e.height/2;s&&(this.xt[t]=!0);let n=this.dt[t]+e.moveX*i,o=this.vt[t]+e.moveY*i,a=this.gt[t]+e.moveZ*i;for(;n<-h;)n+=e.width,o=Math.random()*e.height-r,this.xt[t]=!1;for(;n>h;)n-=e.width,o=Math.random()*e.height-r,this.xt[t]=!1;for(;o<-r;)o+=e.height,n=Math.random()*e.width-h,this.xt[t]=!1;for(;o>r;)o-=e.height,n=Math.random()*e.width-h,this.xt[t]=!1;for(;a<=0;)a+=this.Pt,n=Math.random()*e.width-h,o=Math.random()*e.height-r,this.xt[t]=!1;for(;a>this.Pt;)a-=this.Pt,n=Math.random()*e.width-h,o=Math.random()*e.height-r,this.xt[t]=!1;const u=this.Ot+n/a*h,c=this.Ft+o/a*r;if(this.xt[t]=this.xt[t]&&u>=e.x&&c>=e.y&&u<e.x+e.width&&c<e.y+e.height,s)this.dt[t]=n,this.vt[t]=o,this.gt[t]=a,this.yt[t]=u,this.wt[t]=c;else{this.bt[t]=u,this.Mt[t]=c;let i=4*(1-this.gt[t]/this.Pt);e.highScale||(i=Math.ceil(i)),this.kt[t]=i}}animate(t){let i=super.animate(t);if(this.p.enabled&&void 0!==this.Ot){let i=this.p.count;for(;i--;)this.It(i,t/16,!0),this.xt[i]&&this.It(i,-5,!1)}return i}resize(t,i){this.D=!0}detect(t,i,s){return this.W(this.p,t,i,s,!1)}draw(t,i){if(this.p.enabled){const s=this.p;if(t.globalCompositeOperation=s.compositeOperation,t.globalAlpha=s.alpha*i.alpha,0==s.moveY&&0==s.moveZ&&s.moveX<0){t.fillStyle=s.color;let i=s.count;for(;i--;)this.xt[i]&&t.fillRect(this.yt[i],this.wt[i]-this.kt[i]*s.lineWidth/2,this.bt[i]-this.yt[i],this.kt[i]*s.lineWidth)}else if(t.strokeStyle=s.color,s.highScale){let i=s.count;for(;i--;)this.xt[i]&&(t.beginPath(),t.lineWidth=this.kt[i]*s.lineWidth,t.moveTo(this.bt[i],this.Mt[i]),t.lineTo(this.yt[i],this.wt[i]),t.stroke(),t.closePath())}else{let i,e=5;for(;--e;){for(t.beginPath(),t.lineWidth=e*s.lineWidth,i=s.count;i--;)this.xt[i]&&this.kt[i]===e&&(t.moveTo(this.bt[i],this.Mt[i]),t.lineTo(this.yt[i],this.wt[i]));t.stroke(),t.closePath()}}}}}};const K=Math.PI/180;function tt(t,i){return i.from+t*i.delta}function it(t,i){return t>=.5?i.to:i.from}function st(t,i){for(var s,e=[...i.values],h=e.length;h>1;)for(h--,s=0;s<h;s++)e[s]=e[s]+t*(e[s+1]-e[s]);return e[0]}function et(t,i){return i.colorFrom.mix(i.colorTo,100*t).toString()}function ht(t,i,s){let{pathFrom:e,pathTo:h}=i;return s.changeToPath(t,{pathFrom:e,pathTo:h})}var rt={Callback:class{constructor(t,s){this.Ct=void 0,this.j=void 0,this.Tt=!1,this.Ct=t,this.j=c(i(s),void 0)}reset(){this.Tt=!1}run(t,i){let s;return void 0!==this.j?(this.Ct(t,Math.min(i,this.j),!this.Tt),this.Tt=!0,i-this.j):(s=this.Ct(t,i,!this.Tt),this.Tt=!0,s)}},ChangeTo:class{constructor(t,s,e){this.Tt=!1,this.St=void 0,this.j=void 0,this.At=void 0,this.St=[];for(let s in t){const e=t[s],h="rotationInDegree"===s?e*K:e,r="color"===s||"borderColor"===s,n="path"===s,o="text"===s,a="function"==typeof h,u=!r&&Array.isArray(h),c="scale"===s?["scaleX","scaleY"]:"rotationInRadian"===s||"rotationInDegree"===s?["rotation"]:[s];for(const t of c)this.St.push({name:t,to:u?h[h.length-1]:i(h),bezier:u?h:void 0,isColor:r,isPath:n,isStatic:o,isFunction:a?h:void 0,moveAlgorithm:r?et:n?ht:u?st:o?it:tt})}this.j=c(i(s),0),this.At=c(e,t=>t)}reset(){this.Tt=!1}Et(t,i){let s=this.St.length;for(;s--;){const i=this.St[s],e=t.p[i.name];i.isFunction?(i.from=e,i.to=i.isFunction(i.from),i.isColor?(i.colorFrom=new X(i.from),i.colorTo=new X(i.to),i.moveAlgorithm=et):i.isPath?([i.pathFrom,i.pathTo]=t.changeToPathInit(i.from,i.to),i.moveAlgorithm=ht):Array.isArray(i.to)?(i.values=[e,...i.to],i.moveAlgorithm=st):i.isStatic||(i.delta=i.to-i.from,i.moveAlgorithm=tt)):i.isColor?(i.colorFrom=new X(e),i.colorTo=new X(i.to)):i.isPath?[i.pathFrom,i.pathTo]=t.changeToPathInit(e,i.to):i.bezier?i.values=[e,...i.bezier]:(i.from=e,i.delta=i.to-i.from)}}run(t,i){if(this.Tt||(this.Tt=!0,this.Et(t,i)),this.j<=i){let i,s=this.St.length;for(;s--;)i=this.St[s],t.p[i.name]=i.to}else{let s,e=this.St.length;const h=this.At(i/this.j);for(;e--;)s=this.St[e],t.p[s.name]=s.moveAlgorithm(h,s,t)}return i-this.j}},End:class{constructor(){}run(t,i){return g.FORCE_DISABLE}},EndDisabled:class{constructor(){}run(t,i){return t.p.enabled=!1,g.FORCE_DISABLE}},Forever:class{constructor(){this.jt=void 0;var t=[].slice.call(arguments);this.jt=t[0]instanceof b?t[0]:new b(...t)}reset(t){var i,s;void 0===t&&(t=0),null==(i=(s=this.jt).reset)||i.call(s,t)}play(t,i){var s,e;return void 0===t&&(t=""),void 0===i&&(i=0),null==(s=(e=this.jt).play)?void 0:s.call(e,t,i)}run(t,i,s){let e=i;for(;e>=0;){if(e=this.jt.run(t,e,s),s=!0,!0===e)return!0;var h,r;e>=0&&(null==(h=(r=this.jt).reset)||h.call(r))}return e}},If:class{constructor(t,i,s){this._t=void 0,this.jt=void 0,this.zt=void 0,this._t=t,this.jt=i,this.zt=c(s,()=>0)}play(t,i){var s,e,h,r;return void 0===t&&(t=""),void 0===i&&(i=0),(null==(s=(e=this.jt).play)?void 0:s.call(e,t,i))||(null==(h=(r=this.zt).play)?void 0:h.call(r,t,i))}run(t,s){const e=i(this._t)?this.jt:this.zt;return e.run?e.run(t,s):e(t,s)}},Image:class{constructor(t,s){this.Tt=!1,this.Dt=void 0,this.Lt=void 0,this.qt=void 0,this.j=void 0,this.Nt=-1;const e=i(t);this.qt=c(i(s),0),Array.isArray(e)?(this.Dt=e,this.Lt=e.length):(this.Dt=[e],this.Lt=1),this.j=this.Lt*this.qt}reset(){this.Tt=!1}run(t,i){if(this.Tt||(this.Tt=!0,this.Nt=-1),i>=this.j)t.p.image=n.getImage(this.Dt[this.Dt.length-1]);else{let s=Math.floor(i/this.qt);s!==this.Nt&&(this.Nt=s,t.p.image=n.getImage(this.Dt[this.Nt]))}return i-this.j}},ImageFrame:class{constructor(t,s,e){this.Bt=void 0,this.qt=void 0,this.j=void 0,this.Rt=void 0;const h=i(t);this.Rt=c(i(s),!0),this.qt=c(i(e),0),this.Bt=Array.isArray(h)?h:[h],this.j=this.Bt.length*this.qt}run(t,i){let s=0;return s=i>=this.j?this.Bt[this.Bt.length-1]:this.Bt[Math.floor(i/this.qt)],this.Rt?t.p.frameX=t.p.frameWidth*s:t.p.frameY=t.p.frameHeight*s,i-this.j}},Loop:class{constructor(t){this.jt=void 0,this.Wt=void 0,this.Ut=void 0;var s=[].slice.call(arguments,1);this.jt=s[0]instanceof b?s[0]:new b(...s),this.Wt=this.Ut=c(i(t),1)}reset(t){var i,s;void 0===t&&(t=0),this.Wt=this.Ut,null==(i=(s=this.jt).reset)||i.call(s,t)}play(t,i){var s,e;void 0===t&&(t=""),void 0===i&&(i=0),this.Wt=this.Ut;const h=null==(s=(e=this.jt).play)?void 0:s.call(e,t,i);return h&&(this.Wt=this.Ut),h}run(t,i,s){let e=i;for(;e>=0&&this.Wt>0;){if(e=this.jt.run(t,e,s),s=!0,!0===e)return!0;var h,r;e>=0&&(this.Wt--,null==(h=(r=this.jt).reset)||h.call(r))}return e}},Once:class{constructor(t,s){this.jt=void 0,this.Wt=void 0,this.jt=t,this.Wt=c(i(s),1)}run(t,i){if(this.Wt<=0)return i;{let s=this.jt.run(t,i);return s>=0&&this.Wt--,s}}},Remove:class{constructor(){}run(t,i){return g.REMOVE}},Sequence:b,Shake:class{constructor(t,s){this.Tt=!1,this.j=void 0,this.Xt=void 0,this.Yt=void 0,this.Ht=0,this.Gt=0,this.j=i(s),this.Xt=i(t),this.Yt=this.Xt/2}reset(){this.Tt=!1}run(t,i){return this.Tt||(this.Tt=!0,this.Ht=t.p.x,this.Gt=t.p.y),i>=this.j?(t.p.x=this.Ht,t.p.y=this.Gt):(t.p.x=this.Ht+Math.random()*this.Xt-this.Yt,t.p.y=this.Gt+Math.random()*this.Xt-this.Yt),i-this.j}},ShowOnce:class{constructor(){this.Jt=!0}run(t,i){return t.p.enabled=t.p.enabled&&this.Jt,this.Jt=!1,0}},State:class{constructor(t){let{states:i={},transitions:s={},defaultState:e}=t;this.Vt=void 0,this.$t=void 0,this.Qt=void 0,this.Zt=void 0,this.Kt=void 0,this.Vt=Object.fromEntries(Object.entries(i).map(t=>{let[i,s]=t;return[i,Array.isArray(s)?new b(s):s]})),this.$t=Object.fromEntries(Object.entries(s).map(t=>{let[i,s]=t;return[i,Array.isArray(s)?new b(s):s]})),this.Qt=e,this.Zt=this.Vt[e]}setState(t){if(t!==this.Qt){this.Kt=t;const e=""+t.charAt(0).toUpperCase()+t.slice(1),h=[this.Qt+"To"+e,this.Qt+"To","to"+e].find(t=>t in this.$t);var i,s;h?(this.Qt=this.Kt,this.Zt=this.$t[h],null==(i=this.Zt)||null==i.reset||i.reset()):(this.Qt=this.Kt,this.Zt=this.Vt[this.Qt],null==(s=this.Zt)||null==s.reset||s.reset(),this.Kt=void 0)}}play(t,i){var s;return void 0===t&&(t=""),void 0===i&&(i=0),null==(s=this.Zt)||null==s.play?void 0:s.play(t,i)}run(t,i,s){let e=i,h=s;if(this.Zt){if(e=this.Zt.run(t,e,h),!0===e)return!0;h=!0}var r;if(e>=0||!this.Zt)if(this.Kt){if(this.Qt=this.Kt,this.Zt=this.Vt[this.Qt],null==(r=this.Zt)||null==r.reset||r.reset(),this.Kt=void 0,e=this.Zt.run(t,e,h),!0===e)return!0}else this.Zt=void 0;return-1}},Stop:class{constructor(){}run(t,i){return g.STOP}},StopDisabled:class{constructor(){}run(t,i){return t.p.enabled=!1,g.STOP}},Wait:p,WaitDisabled:class{constructor(t){this.duration=void 0,this.duration=c(i(t),0)}run(t,i){return t.p.enabled=i>=this.duration,i-this.duration}}},nt=function(t){var i=t*t;return t<4/11?7.5625*i:t<8/11?9.075*i-9.9*t+3.4:t<.9?4356/361*i-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72},ot={backInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},backIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},backOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},bounceInOut:function(t){return t<.5?.5*(1-nt(1-2*t)):.5*nt(2*t-1)+.5},bounceIn:function(t){return 1-nt(1-t)},bounceOut:nt,circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},cubicInOut:function(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1},cubicIn:function(t){return t*t*t},cubicOut:function(t){var i=t-1;return i*i*i+1},elasticInOut:function(t){return t<.5?.5*Math.sin(13*Math.PI/2*2*t)*Math.pow(2,10*(2*t-1)):.5*Math.sin(-13*Math.PI/2*(2*t-1+1))*Math.pow(2,-10*(2*t-1))+1},elasticIn:function(t){return Math.sin(13*t*Math.PI/2)*Math.pow(2,10*(t-1))},elasticOut:function(t){return Math.sin(-13*(t+1)*Math.PI/2)*Math.pow(2,-10*t)+1},expoInOut:function(t){return 0===t||1===t?t:t<.5?.5*Math.pow(2,20*t-10):-.5*Math.pow(2,10-20*t)+1},expoIn:function(t){return 0===t?t:Math.pow(2,10*(t-1))},expoOut:function(t){return 1===t?t:1-Math.pow(2,-10*t)},linear:function(t){return t},quadInOut:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},quadIn:function(t){return t*t},quadOut:function(t){return-t*(t-2)},quartInOut:function(t){return t<.5?8*Math.pow(t,4):-8*Math.pow(t-1,4)+1},quartIn:function(t){return Math.pow(t,4)},quartOut:function(t){return Math.pow(t-1,3)*(1-t)+1},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},sineInOut:function(t){return-.5*(Math.cos(Math.PI*t)-1)},sineIn:function(t){var i=Math.cos(t*Math.PI*.5);return Math.abs(i)<1e-14?1:1-i},sineOut:function(t){return Math.sin(t*Math.PI/2)}};class at{constructor(t){void 0===t&&(t={}),this.type="camera",this.cam=void 0,this.type="camera",this.cam=Object.assign({zoom:1,x:0,y:0},t)}viewport(t,i){return i.scale(this.cam.zoom,this.cam.zoom).translate(-this.cam.x,-this.cam.y)}viewportByCam(t,i){let{engine:s}=t;const e=s.getWidth()/2,h=s.getHeight()/2,r=s.getRatio()>1?e:h;return(new u).translate(e,h).scale(r,r).scale(i.zoom,i.zoom).translate(-i.x,-i.y)}additionalModifier(t,i){return i.cam=Object.assign({},this.cam),i}clampView(t,i){const{engine:s,scene:e,clampLimits:h}=t,r=h||{x1:e.additionalModifier.x,y1:e.additionalModifier.y,x2:e.additionalModifier.x+e.additionalModifier.width,y2:e.additionalModifier.y+e.additionalModifier.height},n=this.viewportByCam(t,i).invert(),[o,a]=n.transformPoint(0,0),[u,c]=n.transformPoint(s.getWidth(),s.getHeight());return u-o<=r.x2-r.x1?o<r.x1?u<=r.x2&&(i.x+=r.x1-o):u>r.x2&&(i.x+=r.x2-u):o>r.x1?i.x+=r.x1-o:u<r.x2&&(i.x+=r.x2-u),c-a<=r.y2-r.y1?a<r.y1?c<=r.y2&&(i.y+=r.y1-a):c>r.y2&&(i.y+=r.y2-c):a>r.y1?i.y+=r.y1-a:c<r.y2&&(i.y+=r.y2-c),i}set zoom(t){this.cam.zoom=t}set camX(t){this.cam.x=t}set camY(t){this.cam.y=t}get zoom(){return this.cam.zoom}get camX(){return this.cam.x}get camY(){return this.cam.y}zoomToFullScreen(t){let{scene:i}=t;return Math.min(i.additionalModifier.fullScreen.width/i.additionalModifier.width,i.additionalModifier.fullScreen.height/i.additionalModifier.height)}zoomTo(t){const{scene:i,engine:s,cam:e,x1:h,y1:r,x2:n,y2:o}=t,a=i.additionalModifier.scaleCanvas,u=this.viewportByCam(t,e||this.cam).invert(),[c,l]=u.transformPoint(0,0),[f,d]=u.transformPoint(s.getWidth()*a,s.getHeight()*a),v=n-h,m=o-r,p={x:h+v/2,y:r+m/2,zoom:(e||this.cam).zoom*Math.max(Math.min((f-c)/v,(d-l)/m),Number.MIN_VALUE)};e?(e.x=p.x,e.y=p.y,e.zoom=p.zoom):this.cam=p}}class ut{constructor(t){void 0===t&&(t={}),this.type="control",this.ti={},this.toCam={zoom:1,x:0,y:0},this.ii=void 0,this.si=void 0,this.ei=!1,this.ii=Object.assign({zoomMax:10,zoomMin:.5,zoomFactor:1.2,tween:2,callResize:!0},t)}init(t){let{scene:i}=t;this.si=i,this.toCam=Object.assign({},i.camera.cam)}mouseDown(t){var i;let{event:s,position:[e,h],button:r}=t;this.ti[r]=Object.assign({},this.ti[r],{x:e,y:h,hi:this.toCam.x,ri:this.toCam.y,ni:!0,oi:(null==(i=s.touches)?void 0:i.length)||1,ai:void 0,ui:Date.now()})}mouseUp(t){var i;let{event:s,position:[e,h],button:r,scene:n}=t;this.ti[r]||delete this.ti[r];const o=this.ti[r].ni,a=(null==(i=s.changedTouches)?void 0:i.length)||1,u=Math.max(this.ti[r].oi,a);this.ti[r].ni=!1,this.ti[r].oi-=a,!o||u>1?n.stopPropagation():Date.now()-this.ti[r].ui<300&&Math.abs(this.ti[r].x-e)<5&&Math.abs(this.ti[r].y-h)<5&&1===r||n.stopPropagation()}mouseOut(t){let{button:i}=t;this.ti[i]&&(this.ti[i].ni=!1)}mouseMove(t){var i;let{event:s,position:[e,h],button:r,scene:n}=t;if(!this.ti[r]||!this.ti[r].ni||0===s.which&&!s.touches)return;const o=n.additionalModifier.scaleCanvas;if((null==(i=s.touches)?void 0:i.length)>=2){const t=s.touches,i=Math.sqrt((t[0].pageX-t[1].pageX)*(t[0].pageX-t[1].pageX)+(t[0].pageY-t[1].pageY)*(t[0].pageY-t[1].pageY));void 0===this.ti[r].ai?i>0&&(this.ti[r].ai=i,this.ti[r].ci=this.toCam.zoom):(this.toCam.zoom=Math.max(this.ii.zoomMin,Math.min(this.ii.zoomMax,this.ti[r].ci*i/this.ti[r].ai)),this.toCam=n.camera.clampView(arguments[0],this.toCam))}else{this.ti[r].ai=void 0;const t=n.camera.viewportByCam(arguments[0],this.toCam).invert(),[i,s]=t.transformPoint(this.ti[r].x*o,this.ti[r].y*o),[a,u]=t.transformPoint(e*o,h*o);this.toCam.x=this.ti[r].hi+i-a,this.toCam.y=this.ti[r].ri+s-u,this.toCam=n.camera.clampView(arguments[0],this.toCam)}}mouseWheel(t){let{event:i,position:[s,e],scene:h}=t;const r=h.additionalModifier.scaleCanvas,[n,o]=h.camera.viewportByCam(arguments[0],this.toCam).invert().transformPoint(s*r,e*r);if((i.wheelDelta||-1*i.deltaY)/120>0){this.zoomIn();const[t,i]=h.camera.viewportByCam(arguments[0],this.toCam).invert().transformPoint(s*r,e*r);this.toCam.x-=t-n,this.toCam.y-=i-o,this.toCam=h.camera.clampView(arguments[0],this.toCam)}else this.zoomOut(arguments[0])}hasCamChanged(){const t=this.ii.tween||1;return Math.abs(this.toCam.x-this.si.camera.cam.x)>=Number.EPSILON*t||Math.abs(this.toCam.y-this.si.camera.cam.y)>=Number.EPSILON*t||Math.abs(this.toCam.zoom-this.si.camera.cam.zoom)>=Number.EPSILON*t}fixedUpdate(t){let{scene:i,lastCall:s}=t;this.ii.tween&&!this.ei&&this.hasCamChanged()&&(i.camera.cam.x+=(this.toCam.x-i.camera.cam.x)/this.ii.tween,i.camera.cam.y+=(this.toCam.y-i.camera.cam.y)/this.ii.tween,i.camera.cam.zoom+=(this.toCam.zoom-i.camera.cam.zoom)/this.ii.tween,s&&(i.additionalModifier.cam=i.camera.cam,this.ii.callResize?i.resize():i.cacheClear()))}update(t){let{scene:i}=t;this.ii.tween&&!this.ei||!this.hasCamChanged()||(this.ei=!1,i.camera.cam=Object.assign({},this.toCam),this.ii.callResize?i.resize():i.cacheClear())}camInstant(){this.ei=!0}resize(t){this.toCam=t.scene.camera.clampView(t,this.toCam)}zoomToNorm(){return this.toCam.zoom=1,this}zoomIn(){return this.toCam.zoom=Math.min(this.ii.zoomMax,this.toCam.zoom*this.ii.zoomFactor),this}zoomOut(t){return this.toCam.zoom=Math.max(this.ii.zoomMin,this.toCam.zoom/this.ii.zoomFactor),this.toCam=t.scene.camera.clampView(t,this.toCam),this}zoomTo(t){t.scene.camera.zoomTo(Object.assign(t,{cam:this.toCam}))}}var ct={Callback:at,Camera:at,CameraControl:ut,CameraControlSecondButton:class extends ut{mouseUp(t){var i;let{event:s,position:[e,h],button:r,scene:n}=t;this.ti[r]||delete this.ti[r];const o=this.ti[r].ni,a=(null==(i=s.changedTouches)?void 0:i.length)||1,u=Math.max(this.ti[r].oi,a);if(this.ti[r].ni=!1,this.ti[r].oi-=a,!o||u>1)n.stopPropagation();else if((Date.now()-this.ti[r].ui>300||Math.abs(this.ti[r].x-e)>=5||Math.abs(this.ti[r].y-h)>=5)&&1===r){n.stopPropagation();const[t,i]=n.transformPoint(e,h),[o,a]=n.transformPoint(this.ti[r].x,this.ti[r].y);n.map("region",{event:s,x1:Math.min(o,t),y1:Math.min(a,i),x2:Math.max(o,t),y2:Math.max(a,i),fromX:o,fromY:a,toX:t,toY:i})}}mouseMove(t){var i;let{event:s,position:[e,h],button:r,scene:n}=t;if(!this.ti[r]||!this.ti[r].ni||0===s.which&&!s.touches)return;const o=n.additionalModifier.scaleCanvas;if((null==(i=s.touches)?void 0:i.length)>=2){const t=s.touches,i=Math.sqrt((t[0].pageX-t[1].pageX)*(t[0].pageX-t[1].pageX)+(t[0].pageY-t[1].pageY)*(t[0].pageY-t[1].pageY));if(void 0===this.ti[r].ai)i>0&&(this.ti[r].ai=i,this.ti[r].ci=this.toCam.zoom);else{this.toCam.zoom=Math.max(this.ii.zoomMin,Math.min(this.ii.zoomMax,this.ti[r].ci*i/this.ti[r].ai));const t=n.camera.viewportByCam(arguments[0],this.toCam).invert(),[s,a]=t.transformPoint(this.ti[r].x*o,this.ti[r].y*o),[u,c]=t.transformPoint(e*o,h*o);this.toCam.x=this.ti[r].hi+s-u,this.toCam.y=this.ti[r].ri+a-c,this.toCam=n.camera.clampView(arguments[0],this.toCam)}}else{if(this.ti[r].ai=void 0,2===r){const t=n.camera.viewportByCam(arguments[0],this.toCam).invert(),[i,s]=t.transformPoint(this.ti[r].x*o,this.ti[r].y*o),[a,u]=t.transformPoint(e*o,h*o);this.toCam.x=this.ti[r].hi+i-a,this.toCam.y=this.ti[r].ri+s-u,this.toCam=n.camera.clampView(arguments[0],this.toCam)}if(1===r&&n.has("regionMove")&&!(Date.now()-this.ti[r].ui<300&&Math.abs(this.ti[r].x-e)<5&&Math.abs(this.ti[r].y-h)<5)&&(!s.touches||1===s.touches.length)){const[t,i]=n.transformPoint(e,h),[o,a]=n.transformPoint(this.ti[r].x,this.ti[r].y);n.map("regionMove",{event:s,x1:Math.min(o,t),y1:Math.min(a,i),x2:Math.max(o,t),y2:Math.max(a,i),fromX:o,fromY:a,toX:t,toY:i})}}}},Click:class{constructor(t){let{doubleClickDetectInterval:i=350}=void 0===t?{}:t;this.li=void 0,this.fi=void 0,this.fi=i}mouseUp(t){const{scene:i,button:s}=t;1===s&&(i.has("doubleClick")?this.li?(clearTimeout(this.li),this.li=0,i.map("doubleClick",t)):this.li=window.setTimeout(()=>{this.li=0,i.map("click",t)},this.fi):i.map("click",t))}},Element:class{constructor(t){let{doubleClickDetectInterval:i=350}=void 0===t?{}:t;this.di=void 0,this.vi=void 0,this.mi=!1,this.li=void 0,this.fi=void 0,this.fi=i}isDrawFrame(){return this.mi?1:0}pi(t,i,s){i?t.has("doubleClickElement")?this.li?(window.clearTimeout(this.li),this.li=0,t.map("doubleClickElement",s)):this.li=window.setTimeout(()=>{this.li=0,t.map("clickElement",s)},this.fi):t.map("clickElement",s):t.map("hoverElement",s)}gi(t,i,s){i?t.has("doubleClickNonElement")?this.li?(clearTimeout(this.li),this.li=void 0,t.map("doubleClickNonElement",s)):this.li=window.setTimeout(()=>{this.li=void 0,t.map("clickNonElement",s)},this.fi):t.map("clickNonElement",s):t.map("hoverNonElement",s)}initSprites(t){const{scene:i,output:s,layerManager:e,canvasId:h}=t;if(this.mi=!1,this.di||this.vi){const r=!!this.di,{mx:n,my:o}=this.di||this.vi,a=i.additionalModifier.scaleCanvas,u=s.context[h||0],c=Math.round(n/a),l=Math.round(o/a),[f,d]=i.transformPoint(n,o);let v;if(u.save(),u.setTransform(...i.viewport().m),e.forEach(t=>{let{layerId:i,element:s,isFunction:e,elementId:h}=t;if(!e){const t=s.detect(u,c,l);if("c"===t)v="c";else if(t)return v={layerId:i,element:t,elementId:h},!1}}),u.restore(),"c"===v)this.mi=!0;else{this.di=void 0,this.vi=void 0;const s=Object.assign({mx:n,my:o,x:f,y:d},t);v?(Object.assign(s,v),this.pi(i,r,s)):this.gi(i,r,s)}}}draw(t){const{engine:i,scene:s,layerManager:e,output:h,canvasId:r}=t;if(!r&&this.mi){const r=!!this.di,{mx:n,my:o}=this.di||this.vi,a=s.additionalModifier.scaleCanvas,u=h.context[0],c=Math.round(n/a),l=Math.round(o/a),[f,d]=s.transformPoint(n,o),v=Object.assign({mx:n,my:o,x:f,y:d},t),m=u.imageSmoothingEnabled;u.imageSmoothingEnabled=!1,u.clearRect(0,0,u.canvas.width,u.canvas.height),u.save(),u.setTransform(...s.viewport().m),e.forEach(t=>{let{layerId:i,element:s,isFunction:e,elementId:h}=t;e||s.detectDraw(u,"rgb("+(255&h)+", "+((65280&h)>>8)+", "+(255&i)+")")},0),u.restore(),u.imageSmoothingEnabled=m,i.normContext(u),this.di=void 0,this.vi=void 0;const p=u.getImageData(c,l,1,1).data;if(p[3]){const t=p[2],i=p[0]+(p[1]<<8);Object.assign(v,{layerId:t,elementId:i,element:e.getById(t).getById(i)}),this.pi(s,r,v)}else this.gi(s,r,v)}}mouseUp(t){let{scene:i,position:[s,e],button:h}=t;this.di=1===h&&i.has("clickElement")?{mx:s,my:e}:void 0}mouseMove(t){let{scene:i,position:[s,e]}=t;this.vi=i.has("hoverElement")?{mx:s,my:e}:void 0}},Event:class{constructor(){this.type="events",this.bi=!1,this.Mi=[]}yi(t,i,s){if(c(s.value("preventDefault"),!0)&&i.preventDefault(),!this.bi)return;const[e,h]=this.getMousePosition({event:i}),[r,n]=s.transformPoint(e,h);s.pipeBack(t,{event:i,position:[e,h],x:r,y:n,button:this.getMouseButton({event:i})})}events(t){let{scene:i}=t;return[i.has("mouseDown")&&[["touchstart","mousedown"],t=>this.yi("mouseDown",t,i)],i.has("mouseUp")&&[["touchend","mouseup"],t=>this.yi("mouseUp",t,i)],i.has("mouseOut")&&[["touchendoutside","mouseout"],t=>this.yi("mouseOut",t,i)],i.has("mouseMove")&&[["touchmove","mousemove"],t=>this.yi("mouseMove",t,i)],i.has("mouseWheel")&&[["wheel"],t=>this.yi("mouseWheel",t,i)],c(i.value("preventDefault"),!0)&&[["contextmenu"],t=>t.preventDefault()]].filter(t=>t)}init(t){let{output:i,scene:s}=t;const e=i.canvas[0],h=s.map("events",{});this.Mi=h.filter(Array.isArray).reduce((t,i)=>(t.push.apply(t,i),t),[]).map(t=>Array.isArray(t)?t:[[t],i=>{c(s.value("preventDefault"),!0)&&i.preventDefault(),s.pipeBack(t,{event:i})}]).map(t=>{let[i,s]=t;return i.map(t=>({n:e,e:t,f:s}))}).reduce((t,i)=>(Array.isArray(i)?t.push.apply(t,i):t.push(i),t),[]),this.Mi.forEach(t=>{t.n.addEventListener(t.e,t.f,!0)})}destroy(){this.Mi.forEach(t=>{t.n.removeEventListener(t.e,t.f,!0)}),this.Mi=[]}reset(t,i){return this.bi=!0,i}getMousePosition(t){let i,{event:s}=t;if(s.touches&&s.touches.length>0?i=s.targetTouches:s.changedTouches&&s.changedTouches.length>0&&(i=s.changedTouches),i){const t=s.target.getBoundingClientRect(),e=i.length;return i=Array.from(i),[i.reduce((t,i)=>t+i.pageX,0)/e-t.left,i.reduce((t,i)=>t+i.pageY,0)/e-t.top]}if(void 0===s.offsetX){const t=s.target.getBoundingClientRect();return[s.clientX-t.left,s.clientY-t.top]}return[s.offsetX,s.offsetY]}getMouseButton(t){let{event:i}=t;return i.touches?i.touches.length||i.changedTouches.length:c(i.buttons?i.buttons:[0,1,4,2][i.which],1)}},LoadingScreen:class{loading(t){let{output:i,progress:s}=t;const e=i.context[0],h="number"==typeof s,r=h?Math.max(1,s*i.height):i.height;e.globalCompositeOperation="source-over",e.globalAlpha=1,e.clearRect(0,0,i.width,i.height),e.fillStyle="_aaa",e.fillRect(0,i.height/2-r/2,i.width,r),e.font="20px Georgia",e.fillStyle="#fff",e.textAlign="left",e.textBaseline="bottom",e.fillText(h?"Loading "+Math.round(100*s)+"%":s,10+3*Math.random(),i.height-10+3*Math.random())}},Norm:class{viewport(t,i){let{engine:s}=t;const e=s.getWidth()/2,h=s.getHeight()/2,r=s.getRatio()>1?e:h;return i.translate(e,h).scale(r,r)}additionalModifier(t){let{engine:i,output:s,scene:e}=t;e.cacheClear();const[h,r]=e.transformPoint(0,0,1),[n,o]=e.transformPoint(s.width,s.height,1),a=i.getWidth()/2,c=i.getHeight()/2,l=i.getRatio()>1?a:c,f=(new u).translate(a,c).scale(l,l).invert(),[d,v]=f.transformPoint(0,0),[m,p]=f.transformPoint(s.width,s.height);return{alpha:1,x:-1,y:-1,width:2,height:2,widthInPixel:s.width,heightInPixel:s.height,scaleCanvas:s.width/s.canvas[0].clientWidth,visibleScreen:{x:h,y:r,width:n-h,height:o-r},fullScreen:{x:d,y:v,width:m-d,height:p-v}}}},TimingAudio:class extends l{constructor(t){super({...t,maxSkippedTickChunk:Number.POSITIVE_INFINITY}),this.S=Number.POSITIVE_INFINITY,this.wi=void 0,this.xi=void 0,this.ki=!1,this.Oi=void 0,this.Oi=t.audioElement}get audioElement(){return this.Oi}init(t){if(this.Oi)return"function"==typeof MediaController&&(this.Oi.controller=new MediaController,this.ki=!0),this.Oi.preload="auto",new Promise((t,i)=>{const s=()=>{this.Oi.removeEventListener("canplaythrough",s);const i=this.Oi.play();i&&i.catch(t=>{}),t(void 0)};this.Oi.addEventListener("canplaythrough",s),this.Oi.onerror=()=>{this.Oi=void 0,t(void 0)},this.Oi.load()})}endTime(){return this.Oi?1e3*this.Oi.duration:Number.POSITIVE_INFINITY}currentTime(){let t=super.currentTime();if(this.Oi){if(this.Oi.ended&&this.Oi.duration)return 1e3*this.Oi.duration;const i=1e3*this.Oi.currentTime;if(this.ki){if(void 0===this.wi)return this.wi=t,this.xi=i,i;if("playing"===this.Oi.controller.playbackState){if(i===this.xi)return this.xi+Math.min(260,t-this.wi);if(i-this.xi<500&&i>this.xi&&t-this.wi<350)return this.wi=this.wi+(i-this.xi),this.xi=i,this.xi+t-this.wi}return this.wi=t,this.xi=i,this.xi}return i}return t}clampTime(t){let{timePassed:i}=t;return i}shiftTime(){return 0}},TimingDefault:l};t.Animations=rt,t.Easing=ot,t.Engine=class{constructor(t){this.Fi=void 0,this.Mi=void 0,this.si=void 0,this.Pi=void 0,this.Ii=void 0,this.Ci=void 0,this.Ti=void 0,this.Si=void 0,this.Ai=void 0,this.Ei=void 0,this.ji=void 0,this.st=void 0,this._i=void 0,this.zi=void 0,this.Di=!1,this.Li=void 0,this.qi=void 0,this.Ni=void 0,this.Bi=!1;let i=t;if("object"!=typeof t)throw new Error("No canvas given for Engine constructor");if(t.getContext)i={canvas:t};else if(!t.canvas)throw new Error("No canvas given for Engine constructor");let e=Object.assign({},i);if(this.Fi={canvas:[],context:[],width:0,height:0,ratio:1},this.Mi=[],this.si=null,this.Ci=!1,this.Si=0,this.Ti=!1,this.Ai=void 0,this.Fi.canvas=s(e.canvas),e.autoSize){const t={enabled:!0,scaleLimitMin:1,scaleLimitMax:2.5,scaleFactor:1.07,referenceWidth:()=>this.Fi.canvas[0].clientWidth,referenceHeight:()=>this.Fi.canvas[0].clientHeight,currentScale:1,waitTime:100,currentWaitedTime:0,currentOffsetTime:0,offsetTimeLimitUp:300,offsetTimeLimitDown:300,registerResizeEvents:!0,registerVisibilityEvents:!0,setCanvasStyle:!1};this.Ei="object"==typeof e.autoSize?Object.assign({},t,e.autoSize):t,this.Ei.registerResizeEvents&&(this.Mi=["resize","orientationchange"].map(t=>({n:window,e:t,f:this.recalculateCanvas.bind(this)}))),this.Ei.registerVisibilityEvents&&this.Mi.push({n:document,e:"visibilitychange",f:this.handleVisibilityChange.bind(this)}),this.Ri()}else this.Fi.width=this.Fi.canvas[0].width,this.Fi.height=this.Fi.canvas[0].height,this.Fi.ratio=this.Fi.width/this.Fi.height;this.Fi.canvas.forEach((t,i)=>{this.Fi.context[i]=t.getContext("2d")}),this.ji=this.Fi.canvas.length,this.st=Array.from({length:this.ji},t=>0),e.clickToPlayAudio&&this.Mi.push({n:this.Fi.canvas[0],e:"click",f:this.playAudioOfScene.bind(this)}),this._i=!!e.reduceFramerate,this.Mi.forEach(t=>{t.n.addEventListener(t.e,t.f)}),this.switchScene(e.scene,e.sceneParameter||{})}handleVisibilityChange(){this.Ei&&(this.Ei.enabled=!("hidden"==document.visibilityState))}playAudioOfScene(){this.Ci&&this.si&&this.si.timing.audioElement&&this.si.timing.audioElement.play()}normContext(t){t.textBaseline="middle",t.textAlign="center",t.globalAlpha=1,t.globalCompositeOperation="source-over"}getWidth(){return this.Fi.width}getHeight(){return this.Fi.height}getRatio(){return this.Fi.ratio}getOutput(){return this.Fi}recalculateCanvas(){return this.Ti=!0,this}Ri(){if(this.Ei){const t=i(this.Ei.referenceWidth),s=i(this.Ei.referenceHeight);if(t<=0||s<=0)return;this.Fi.canvas.forEach(i=>{i.width=Math.round(t/this.Ei.currentScale),i.height=Math.round(s/this.Ei.currentScale),this.Ei.setCanvasStyle&&(i.style.width=t+"px",i.style.height=s+"px")}),this.Ei.currentWaitedTime=0,this.Ei.currentOffsetTime=0}this.Fi.width=this.Fi.canvas[0].width,this.Fi.height=this.Fi.canvas[0].height,this.Fi.ratio=this.Fi.width/this.Fi.height,this.resize()}recalculateFPS(){try{const t=this;return t.Ai&&(window.cancelAnimationFrame(t.Ai),t.Ai=void 0),Promise.resolve(new Promise(t=>requestAnimationFrame(t))).then(function(){function i(){const i=(t.Wi()-s)/n;t.Ei.offsetTimeTarget=i,t.Ei.offsetTimeDelta=i/3,void 0===t.Ai&&(t.zi=void 0,t.Ai=window.requestAnimationFrame(t.Ui.bind(t)))}const s=t.Wi(),n=3;let o=n;const a=function(t,i,s){for(var n;;){var o=t();if(r(o)&&(o=o.v),!o)return a;if(o.then){n=0;break}var a=s();if(a&&a.then){if(!r(a)){n=1;break}a=a.s}}var u=new h,c=e.bind(null,u,2);return(0===n?o.then(f):1===n?a.then(l):(void 0).then(function(){(o=t())?o.then?o.then(f).then(void 0,c):f(o):e(u,1,a)})).then(void 0,c),u;function l(i){a=i;do{if(!(o=t())||r(o)&&!o.v)return void e(u,1,a);if(o.then)return void o.then(f).then(void 0,c);r(a=s())&&(a=a.v)}while(!a||!a.then);a.then(l).then(void 0,c)}function f(t){t?(a=s())&&a.then?a.then(l).then(void 0,c):l(a):e(u,1,a)}}(function(){return o--},0,function(){return Promise.resolve(new Promise(t=>requestAnimationFrame(t))).then(function(){})});return a&&a.then?a.then(i):i()})}catch(t){return Promise.reject(t)}}resize(){return this.si&&this.si.resize&&this.si.resize(),this}switchScene(t,i){return void 0===i&&(i=void 0),t&&(this.Pi=t,this.Ii=i),this}Wi(){return window.performance?performance.now():Date.now()}Ui(t){if(!this.Ai)return;this.Ai=window.requestAnimationFrame(this.Ui.bind(this));let i=this.Ti&&(!this._i||!this.Di);i&&(this.Ri(),this.Ti=!1);for(let t=0;t<this.ji;t++)this.st[t]=Math.max(this.st[t]-1,i?1:0);if(this.zi||(this.zi=t),this.Li||(this.Li=t),this.Pi&&!this.qi&&(this.qi=Promise.resolve(this.si?this.si.destroy():void 0),this.qi.then(i=>{this.Pi.callInit({run:this.Ni,scene:this.Ii,destroy:i},this),this.si=this.Pi,this.Pi=void 0,this.qi=void 0,this.Ci=!1,this.Si=this.si.currentTime(),this.Li=t})),this.si){let i=!1;const s=this.Wi();if(this._i&&(this.Di=!this.Di),!this._i||this.Di){let s=this.si.currentTime(),e=this.si.clampTime(s-this.Si);const h=this.si.shiftTime(e);if(e+=h,this.Si=s+h,this.Ci){if(i=0!==e||this.Bi,this.Bi=!1,this.Fi.canvas[0].width)for(let t=0;t<this.ji;t++)this.normContext(this.Fi.context[t]),this.si.initSprites(t);const t=this.si.isDrawFrame(e);if(Array.isArray(t))for(let i=0;i<this.ji;i++)this.st[i]=Math.max(this.st[i],t[i],0);else for(let i=0;i<this.ji;i++)this.st[i]=Math.max(this.st[i],t,0);if(i&&this.si.move(e),this.Fi.canvas[0].width)for(let t=0;t<this.ji;t++)this.st[t]&&this.si.draw(t)}else{for(let t=0;t<this.ji;t++)this.normContext(this.Fi.context[t]);this.Ci=this.si.callLoading({timePassed:t-this.zi,totalTimePassed:t-this.Li}),this.Ci&&(this.si.reset(),this.Si=this.si.currentTime(),this.Bi=!0,this.Ei&&(this.Ei.currentWaitedTime=0))}}if(this.Ci&&this.Ei&&this.Ei.enabled){const e=t-this.zi;if(this.Ei.currentWaitedTime<this.Ei.waitTime)this.Ei.currentWaitedTime+=e;else if(i){const t=this.Ei.offsetTimeTarget*(this._i?2:1),i=this.Wi()-s,h=(Math.abs(e-t)>Math.abs(i-t)?e:i)-t;Math.abs(h)<=this.Ei.offsetTimeDelta?this.Ei.currentOffsetTime=this.Ei.currentOffsetTime>=0?Math.max(0,this.Ei.currentOffsetTime-this.Ei.offsetTimeDelta):Math.min(0,this.Ei.currentOffsetTime+this.Ei.offsetTimeDelta):h<0&&this.Ei.currentScale>this.Ei.scaleLimitMin?(this.Ei.currentOffsetTime+=h,this.Ei.currentOffsetTime<=-this.Ei.offsetTimeLimitDown&&(this.Ei.currentScale=Math.max(this.Ei.scaleLimitMin,this.Ei.currentScale/this.Ei.scaleFactor),this.Ti=!0)):h>0&&this.Ei.currentScale<this.Ei.scaleLimitMax&&(this.Ei.currentOffsetTime+=h,this.Ei.currentOffsetTime>=this.Ei.offsetTimeLimitUp&&(this.Ei.currentScale=Math.min(this.Ei.scaleLimitMax,this.Ei.currentScale*this.Ei.scaleFactor),this.Ti=!0))}}}this.zi=t}run(t){try{const i=this;return i.Ni=t||{},Promise.resolve(i.stop()).then(function(){function t(){return i.Ai=window.requestAnimationFrame(i.Ui.bind(i)),i}i.zi=i.Li=void 0;const s=function(){if(i.Ei&&!i.Ei.offsetTimeTarget)return Promise.resolve(i.recalculateFPS()).then(function(){})}();return s&&s.then?s.then(t):t()})}catch(t){return Promise.reject(t)}}stop(){try{const t=this;function i(t){}return t.Ai&&window.cancelAnimationFrame(t.Ai),t.Ai=void 0,Promise.resolve(t.si?Promise.resolve(t.si.destroy()).then(i):void 0)}catch(s){return Promise.reject(s)}}destroy(){try{const t=this;return Promise.resolve(t.stop()).then(function(){return t.Mi.forEach(t=>{t.n.removeEventListener(t.e,t.f)}),t.Mi=[],t})}catch(t){return Promise.reject(t)}}},t.ImageManager=n,t.Middleware=ct,t.Scene=class{constructor(){this.Xi=void 0,this.Yi=void 0,this.Hi=void 0,this.Gi=void 0,this.Ji={Vi:[],init:[],isDrawFrame:[],initSprites:[],fixedUpdate:[],update:[],draw:[],destroy:[],reset:[],resize:[],currentTime:[],clampTime:[],shiftTime:[],isChunked:[],hasOneChunkedFrame:[],calcFrames:[],tickChunk:[],additionalModifier:[]},this.$i=!1,this.Qi=void 0,this.Zi=void 0,this.Ki=void 0,this.ts=!1,this.ss=void 0,this.es=!1,this.Xi=new a,this.Hi=0,this.Yi=n,this.middlewares=[].slice.call(arguments),this.middlewareByType("timing")||(this.middlewares=[l,...this.middlewares])}Fi(){var t;return null==(t=this.Gi)?void 0:t.getOutput()}set middlewares(t){this.Ji=s(t).map(t=>"function"==typeof t?new t:t).reduce((t,i)=>{for(let s of Object.keys(t))s in i&&t[s].push(i);return t.Vi.push(i),"enabled"in i||(i.enabled=!0),i.type&&(t["t_"+i.type]=[i]),t},{Vi:[],init:[],isDrawFrame:[],initSprites:[],fixedUpdate:[],update:[],draw:[],destroy:[],reset:[],resize:[],currentTime:[],clampTime:[],shiftTime:[],isChunked:[],hasOneChunkedFrame:[],calcFrames:[],tickChunk:[],additionalModifier:[]})}get middlewares(){return this.Ji.Vi}middlewareByType(t){const i=this.Ji.Vi.filter(i=>i.type===t);if(i.length)return i[i.length-1]}has(t){return t in this.Ji||this.Ji.Vi.some(i=>t in i)}do(t,i,s,e){let h=this.Ji[t]||this.Ji.Vi.filter(i=>t in i);return h=h.filter(t=>t.enabled),h.length?e(h,this.hs(i),s):s}map(t,i){return this.do(t,i,[],(i,s)=>i.map(i=>i[t](s)))}pipe(t,i,s){return void 0===s&&(s=void 0),this.do(t,i,s,(i,e)=>{let h=s;this.$i=!1;for(let s of i)if(h=s[t](e,h),this.$i)break;return h})}pipeBack(t,i,s){return void 0===s&&(s=void 0),this.do(t,i,s,(i,e)=>{let h=s;this.$i=!1;for(let s=i.length-1;s>=0&&(h=i[s][t](e,h),!this.$i);s--);return h})}pipeMax(t,i,s){return void 0===s&&(s=void 0),this.do(t,i,Array.isArray(s)?s.map(t=>t-0):s-0,(i,s,e)=>{let h=e;if(this.$i=!1,Array.isArray(h))for(let e of i){let i=e[t](s,h);if(h=Array.isArray(i)?h.map((t,s)=>Math.max(t,i[s])):h.map((t,s)=>Math.max(t,i)),this.$i)break}else for(let e of i){let i=e[t](s,h);if(h=Array.isArray(i)?i.map(t=>Math.max(t,h)):Math.max(i,h),this.$i)break}return h})}pipeAsync(t,i,s){void 0===s&&(s=void 0);try{const e=this;return Promise.resolve(e.do(t,i,s,function(i,h){try{let r,n=s;e.$i=!1;const o=function(t,i,s){if("function"==typeof t[f]){var e,h,r,n=t[f]();function c(t){try{for(;!((e=n.next()).done||s&&s());)if((t=i(e.value))&&t.then){if(!m(t))return void t.then(c,r||(r=d.bind(null,h=new v,2)));t=t.v}h?d(h,1,t):h=t}catch(t){d(h||(h=new v),2,t)}}if(c(),n.return){var o=function(t){try{e.done||n.return()}catch(t){}return t};if(h&&h.then)return h.then(o,function(t){throw o(t)});o()}return h}if(!("length"in t))throw new TypeError("Object is not iterable");for(var a=[],u=0;u<t.length;u++)a.push(t[u]);return function(t,i,s){var e,h,r=-1;return function n(o){try{for(;++r<t.length&&(!s||!s());)if((o=i(r))&&o.then){if(!m(o))return void o.then(n,h||(h=d.bind(null,e=new v,2)));o=o.v}e?d(e,1,o):e=o}catch(t){d(e||(e=new v),2,t)}}(),e}(a,function(t){return i(a[t])},s)}(i,function(i){return Promise.resolve(i[t](h,n)).then(function(t){n=t,e.$i&&(r=1)})},function(){return r});return Promise.resolve(o&&o.then?o.then(function(){return n}):n)}catch(t){return Promise.reject(t)}}))}catch(t){return Promise.reject(t)}}value(t,i){void 0===i&&(i=void 0);let s=this.Ji[t]||this.Ji.Vi.filter(i=>t in i);if(s.filter(t=>t.enabled),!s.length)return;const e=s[s.length-1];return"function"==typeof e[t]?e[t].call(e,this.hs(i||{})):e[t]}stopPropagation(){this.$i=!0}currentTime(){return this.pipe("currentTime",{})}clampTime(t){return this.pipe("clampTime",{timePassed:t})}shiftTime(t){return this.pipe("shiftTime",{timePassed:t})}cacheClear(){this.Qi=void 0,this.Zi=void 0}viewport(){return this.Gi?(this.Qi||(this.Qi=this.pipe("viewport",{},new u),this.Zi=void 0),this.Qi):new u}transformPoint(t,i,s){return void 0===s&&(s=this.Ki.scaleCanvas),this.Zi||(this.Zi=this.viewport().clone().invert()),this.Zi.transformPoint(t*s,i*s)}callInit(t,i){this.Gi=i,this.resize();const s=this.value("images");s&&this.Yi.add(s),Promise.all(this.map("init",{parameter:t})).then(t=>{this.ts=!0})}get additionalModifier(){return this.Ki}updateAdditionalModifier(){const t=this.Fi();this.Ki=this.pipe("additionalModifier",{},{alpha:1,x:0,y:0,width:t.width,height:t.height,widthInPixel:t.width,heightInPixel:t.height,scaleCanvas:1,visibleScreen:{x:0,y:0,width:t.width,height:t.height},fullScreen:{x:0,y:0,width:t.width,height:t.height}})}resize(){const t=this.Fi();this.updateAdditionalModifier(),this.pipe("resize",{}),this.Xi.forEach(i=>{let{element:s,isFunction:e}=i;e||s.resize(t,this.Ki)})}destroy(){try{const t=this;return Promise.resolve(t.pipeAsync("destroy",{})).then(function(i){return t.ts=!1,i})}catch(t){return Promise.reject(t)}}get timing(){return this.Ji.t_timing[0]}get camera(){return this.Ji.t_camera[0]}get control(){return this.Ji.t_control[0]}get totalTimePassed(){return this.Hi}hs(t){return void 0===t&&(t=void 0),Object.assign({engine:this.Gi,scene:this,imageManager:this.Yi,layerManager:this.Xi,totalTimePassed:this.Hi,output:this.Fi()},t)}callLoading(t){if(this.Yi.isLoaded()&&this.ts){this.ss=this.value("endTime");const i="Click to play";return this.value("loading",{...t,progress:i}),!0}const i=this.Yi.count?this.Yi.loaded/this.Yi.count:"Loading...";return this.value("loading",{...t,progress:i}),!1}fixedUpdate(t,i){this.map("fixedUpdate",{timePassed:t,lastCall:i})}isDrawFrame(t){return this.pipeMax("isDrawFrame",{timePassed:t},0!==t)}move(t){if(this.Hi+=t,this.es?this.reset():t<0?(t=this.Hi,this.reset(),this.initSprites(),this.Hi=t):this.ss&&this.ss<=this.Hi&&(t-=this.Hi-this.ss,this.Hi=this.ss,this.map("end",{timePassed:t})),this.value("isChunked")){if(this.value("hasOneChunkedFrame",{timePassed:t})){const i=this.value("calcFrames",{timePassed:t})-1;for(let t=0;t<=i;t++)this.fixedUpdate(this.value("tickChunk",{}),t===i)}}else this.fixedUpdate(t,!0);this.map("update",{timePassed:t}),this.Xi.forEach(i=>{let{element:s,isFunction:e,layer:h,elementId:r}=i;e||s.animate(t)&&h.deleteById(r)})}draw(t){this.map("draw",{canvasId:t});const i=this.Fi().context[t];i.save(),i.setTransform(...this.viewport().m),this.Xi.forEach(t=>{let{layer:s,layerId:e,element:h,isFunction:r,elementId:n}=t;r?h(this.hs({layerId:e,elementId:n,layer:s,context:i}))&&s.deleteById(n):h.draw(i,this.Ki)},t),i.restore()}initSprites(t){void 0===t&&(t=void 0);const i=this.Fi().context[t||0];this.Xi.forEach(t=>{let{element:s,isFunction:e}=t;e||s.callInit(i,this.Ki)},t),this.map("initSprites",{canvasId:t})}resetIntend(){this.es=!0}reset(){this.Hi=0,this.es=!1;let t=this.pipe("reset",{},new a);if(Array.isArray(t)){const i=t;t=new a,i.forEach(i=>{t.addLayer().addElements(i)})}t&&(this.Xi=t)}},t.Sprites=Z});
//# sourceMappingURL=animationvideo.umd.js.map
