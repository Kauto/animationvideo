function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var i=require("@ctrl/tinycolor/dist/module/public_api.js"),s=t(require("pasition")),h=require("stackblur-canvas/dist/stackblur-es.js"),n=t(require("eases"));function r(t,i){return void 0===i&&(i=null),"function"==typeof t?t.apply(i,[].slice.call(arguments,2)):t}function e(t){return null==t?[]:Array.isArray(t)?t:[t]}function o(t,i,s){if(!t.s){if(s instanceof f){if(!s.s)return void(s.o=o.bind(null,t,i));1&i&&(i=s.s),s=s.v}if(s&&s.then)return void s.then(o.bind(null,t,i),o.bind(null,t,2));t.s=i,t.v=s;var h=t.o;h&&h(t)}}var u=function(){function t(t){var i=this,s=t;if("object"!=typeof t)throw new Error("No canvas given for Engine constructor");if(t.getContext)s={canvas:t};else if(!t.canvas)throw new Error("No canvas given for Engine constructor");var h=Object.assign({},s);if(this.t={canvas:[],context:[],width:0,height:0,ratio:1},this.i=[],this.h=null,this.u=!1,this.l=0,this.M=!1,this.p=null,this.t.canvas=e(h.canvas),h.autoSize){var n={enabled:!0,scaleLimitMin:1,scaleLimitMax:2.5,scaleFactor:1.07,referenceWidth:function(){return i.t.canvas[0].clientWidth},referenceHeight:function(){return i.t.canvas[0].clientHeight},currentScale:1,waitTime:100,currentWaitedTime:0,currentOffsetTime:0,offsetTimeLimitUp:300,offsetTimeLimitDown:300,registerResizeEvents:!0,registerVisibilityEvents:!0,setCanvasStyle:!1};this.k="object"==typeof h.autoSize?Object.assign({},n,h.autoSize):n,this.k.registerResizeEvents&&(this.i=["resize","orientationchange"].map(function(t){return{n:window,e:t,f:i.recalculateCanvas.bind(i)}})),this.k.registerVisibilityEvents&&this.i.push({n:document,e:"visibilitychange",f:this.handleVisibilityChange.bind(this)}),this.P()}else this.t.width=this.t.canvas[0].width,this.t.height=this.t.canvas[0].height,this.t.ratio=this.t.width/this.t.height;this.t.canvas.forEach(function(t,s){i.t.context[s]=t.getContext("2d")}),this.j=this.t.canvas.length,this.O=Array.from({length:this.j},function(t){return 0}),h.clickToPlayAudio&&this.i.push({n:this.t.canvas[0],e:"click",f:this.playAudioOfScene.bind(this)}),this.C=h.reduceFramerate,this.i.forEach(function(t){t.n.addEventListener(t.e,t.f)}),this.switchScene(h.scene,h.sceneParameter||{})}var i=t.prototype;return i.handleVisibilityChange=function(){this.k.enabled=!("hidden"==document.visibilityState)},i.playAudioOfScene=function(){this.u&&this.h&&this.h.timing.audioElement&&this.h.timing.audioElement.play()},i.normContext=function(t){t.textBaseline="middle",t.textAlign="center",t.globalAlpha=1,t.globalCompositeOperation="source-over"},i.getWidth=function(){return this.t.width},i.getHeight=function(){return this.t.height},i.getRatio=function(){return this.t.ratio},i.getOutput=function(){return this.t},i.recalculateCanvas=function(){return this.M=!0,this},i.P=function(){var t=this;if(this.k){var i=r(this.k.referenceWidth),s=r(this.k.referenceHeight);if(i<=0||s<=0)return;this.t.canvas.forEach(function(h){h.width=Math.round(i/t.k.currentScale),h.height=Math.round(s/t.k.currentScale),t.k.setCanvasStyle&&(h.style.width=i+"px",h.style.height=s+"px")}),this.k.currentWaitedTime=0,this.k.currentOffsetTime=0}this.t.width=this.t.canvas[0].width,this.t.height=this.t.canvas[0].height,this.t.ratio=this.t.width/this.t.height,this.resize()},i.recalculateFPS=function(){try{var t=this;return t.p&&(window.cancelAnimationFrame(t.p),t.p=!1),Promise.resolve(new Promise(function(t){return requestAnimationFrame(t)})).then(function(){function i(){var i=(t.A()-s)/h;t.k.offsetTimeTarget=i,t.k.offsetTimeDelta=i/3,!1===t.p&&(t.S=!1,t.p=window.requestAnimationFrame(t.T.bind(t)))}var s=t.A(),h=3,n=h,r=function(t,i,s){for(var h;;){var n=t();if(c(n)&&(n=n.v),!n)return r;if(n.then){h=0;break}var r=s();if(r&&r.then){if(!c(r)){h=1;break}r=r.s}}var e=new f,u=o.bind(null,e,2);return(0===h?n.then(v):1===h?r.then(a):(void 0).then(function(){(n=t())?n.then?n.then(v).then(void 0,u):v(n):o(e,1,r)})).then(void 0,u),e;function a(i){r=i;do{if(!(n=t())||c(n)&&!n.v)return void o(e,1,r);if(n.then)return void n.then(v).then(void 0,u);c(r=s())&&(r=r.v)}while(!r||!r.then);r.then(a).then(void 0,u)}function v(t){t?(r=s())&&r.then?r.then(a).then(void 0,u):a(r):o(e,1,r)}}(function(){return n--},0,function(){return Promise.resolve(new Promise(function(t){return requestAnimationFrame(t)})).then(function(){})});return r&&r.then?r.then(i):i()})}catch(t){return Promise.reject(t)}},i.resize=function(){return this.h&&this.h.resize&&this.h.resize(),this},i.switchScene=function(t,i){return t&&(this.D=t,this.F=i),this},i.A=function(){return window.performance?performance.now():Date.now()},i.T=function(t){var i=this;if(this.p){this.p=window.requestAnimationFrame(this.T.bind(this));var s=this.M&&(!this.C||!this.I);s&&(this.P(),this.M=!1);for(var h=0;h<this.j;h++)this.O[h]=Math.max(this.O[h]-1,s?1:0);if(this.S||(this.S=t),this.N||(this.N=t),this.D&&!this.W&&(this.W=Promise.resolve(this.h?this.h.destroy():{}),this.W.then(function(s){i.D.callInit({run:i.R,scene:i.F,destroy:s},i),i.h=i.D,i.D=void 0,i.W=void 0,i.u=!1,i.l=i.h.currentTime(),i.N=t})),this.h&&(this.C&&(this.I=!this.I),!this.C||this.I)){var n=this.h.currentTime(),r=this.h.clampTime(n-this.l),e=this.h.shiftTime(r);if(r+=e,this.l=n+e,this.u){var o=0!==r||this.X;this.X=!1;var u=this.A();if(this.t.canvas[0].width)for(var f=0;f<this.j;f++)this.normContext(this.t.context[f]),this.h.initSprites(f);var c=this.h.isDrawFrame(r);if(Array.isArray(c))for(var a=0;a<this.j;a++)this.O[a]=Math.max(this.O[a],c[a],0);else for(var v=0;v<this.j;v++)this.O[v]=Math.max(this.O[v],c,0);if(o&&this.h.move(r),this.t.canvas[0].width)for(var d=0;d<this.j;d++)this.O[d]&&this.h.draw(d);if(this.k&&this.k.enabled){var l=t-this.S;if(this.k.currentWaitedTime<this.k.waitTime)this.k.currentWaitedTime+=l;else if(o){var m=this.k.offsetTimeTarget*(this.C?2:1),y=this.A()-u,M=(Math.abs(l-m)>Math.abs(y-m)?l:y)-m;Math.abs(M)<=this.k.offsetTimeDelta?this.k.currentOffsetTime=this.k.currentOffsetTime>=0?Math.max(0,this.k.currentOffsetTime-this.k.offsetTimeDelta):Math.min(0,this.k.currentOffsetTime+this.k.offsetTimeDelta):M<0&&this.k.currentScale>this.k.scaleLimitMin?(this.k.currentOffsetTime+=M,this.k.currentOffsetTime<=-this.k.offsetTimeLimitDown&&(this.k.currentScale=Math.max(this.k.scaleLimitMin,this.k.currentScale/this.k.scaleFactor),this.M=!0)):M>0&&this.k.currentScale<this.k.scaleLimitMax&&(this.k.currentOffsetTime+=M,this.k.currentOffsetTime>=this.k.offsetTimeLimitUp&&(this.k.currentScale=Math.min(this.k.scaleLimitMax,this.k.currentScale*this.k.scaleFactor),this.M=!0))}}}else{for(var p=0;p<this.j;p++)this.normContext(this.t.context[p]);this.u=this.h.callLoading({timePassed:t-this.S,totalTimePassed:t-this.N}),this.u&&(this.h.reset(),this.l=this.h.currentTime(),this.X=!0,this.k&&(this.k.currentWaitedTime=0))}}this.S=t}},i.run=function(t){try{var i=this;return i.R=t||{},Promise.resolve(i.stop()).then(function(){function t(){return i.p=window.requestAnimationFrame(i.T.bind(i)),i}i.S=i.N=!1;var s=function(){if(i.k&&!i.k.offsetTimeTarget)return Promise.resolve(i.recalculateFPS()).then(function(){})}();return s&&s.then?s.then(t):t()})}catch(t){return Promise.reject(t)}},i.stop=function(){try{return window.cancelAnimationFrame(this.p),this.p=null,Promise.resolve(this.h?Promise.resolve(this.h.destroy()).then(function(t){}):void 0)}catch(t){return Promise.reject(t)}},i.destroy=function(){try{var t=this;return Promise.resolve(t.stop()).then(function(){return t.i.forEach(function(t){t.n.removeEventListener(t.e,t.f)}),t.i=[],t})}catch(t){return Promise.reject(t)}},t}(),f=function(){function t(){}return t.prototype.then=function(i,s){var h=new t,n=this.s;if(n){var r=1&n?i:s;if(r){try{o(h,1,r(this.v))}catch(t){o(h,2,t)}return h}return this}return this.o=function(t){try{var n=t.v;1&t.s?o(h,1,i?i(n):n):s?o(h,1,s(n)):o(h,2,n)}catch(t){o(h,2,t)}},h},t}();function c(t){return t instanceof f&&1&t.s}function a(t,i){for(var s=0;s<i.length;s++){var h=i[s];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}function v(t,i,s){return i&&a(t.prototype,i),s&&a(t,s),t}function d(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i}function l(t,i){return(l=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function y(t,i,s){return(y=m()?Reflect.construct:function(t,i,s){var h=[null];h.push.apply(h,i);var n=new(Function.bind.apply(t,h));return s&&l(n,s.prototype),n}).apply(null,arguments)}function M(t){if(null==t)throw new TypeError("Cannot destructure undefined")}function p(t,i){(null==i||i>t.length)&&(i=t.length);for(var s=0,h=new Array(i);s<i;s++)h[s]=t[s];return h}function w(t,i){var s;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(s=function(t,i){if(t){if("string"==typeof t)return p(t,void 0);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?p(t,void 0):void 0}}(t))||i&&t&&"number"==typeof t.length){s&&(t=s);var h=0;return function(){return h>=t.length?{done:!0}:{done:!1,value:t[h++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(s=t[Symbol.iterator]()).next.bind(s)}var b=function(){function t(){this.Images={},this.count=0,this.loaded=0}return t.add=function(i,s){var h=this||t,n=function(t){if(h.Images[t])s&&"function"==typeof s[t]&&s[t](t,h.Images[t]);else{if(h.Images[t]=new window.Image,h.Images[t].onload=function(){h.loaded++,s&&"function"==typeof s?h.isLoaded()&&s():s&&"function"==typeof s[t]&&s[t](t,h.Images[t]),h.resolve&&h.isLoaded()&&(h.resolve(),h.resolve=null)},"<svg"===i[t].substr(0,4)){var n=window.URL||window.webkitURL||window,r=new window.Blob([i[t]],{type:"image/svg+xml"});h.Images[t].src=n.createObjectURL(r)}else/^(https?:)?\/\//.test(i[t])&&(h.Images[t].onerror=function(){var s=new window.Image;s.onload=h.Images[t].onload,h.Images[t]=s,h.Images[t].src=i[t]},h.Images[t].crossOrigin="anonymous"),h.Images[t].src=i[t];h.count++}};for(var r in i)n(r);return s&&"function"==typeof s&&h.isLoaded()&&s(),h.resolve&&h.isLoaded()&&(h.resolve(),h.resolve=null),h},t.reset=function(){var i=this||t;return i.Images={},i.count=0,i.loaded=0,i},t.getLoaded=function(){return(this||t).loaded},t.getCount=function(){return(this||t).count},t.isLoaded=function(){var i=this||t;return i.loaded===i.count},t.getImage=function(i){return"object"==typeof i?i:(this||t).Images[i]},t.isLoadedPromise=function(){var i=this||t;return!!i.isLoaded()||new Promise(function(t,s){i.resolve=t})},t}();b.Images={},b.count=0,b.loaded=0;var g=function(){function t(t){this.Y=[],this._=[],this.q=0,this.L=0,this.U=void 0===t?[]:Array.isArray(t)?t:[t]}var i=t.prototype;return i.addElement=function(t){return this.addElementForId(t),t},i.addElements=function(t){return this.addElementsForIds(t),t},i.addElementForId=function(t){var i=this.Y.length,s=this.L;this.Y[s]=t,this._[s]="function"==typeof t,i===s&&i++;for(var h=this.L+1;h!==i&&this.Y[h];)h++;return this.L=h,this.q>s&&(this.q=s),s},i.addElementsForIds=function(t){var i=this,s=this.Y.length;return s===this.L?(this.Y=this.Y.concat(t),this.L=this.Y.length,t.forEach(function(t,h){i._[s+h]="function"==typeof t}),Array.from({length:t.length},function(t,i){return i+s})):t.map(function(t){return i.addElement(t)})},i.getById=function(t){return this.Y[t]},i.getIdByElement=function(t){return this.Y.indexOf(t)},i.deleteByElement=function(t){var i=this.getIdByElement(t);i>=0&&this.deleteById(i)},i.deleteById=function(t){var i=this.Y.length-1;if(i>0&&t===i){for(this.Y[t]=null;i&&!this.Y[i-1];)i--;this.Y.length=i,this._.length=i,this.L=Math.min(this.L,i),this.q=Math.min(this.q,i)}else this.Y[t]&&(this.Y[t]=null,this.L=Math.min(this.L,t),this.q===t&&(this.q=t+1))},i.isCanvasId=function(t){return void 0===t||!this.U.length||this.U.includes(t)},i.forEach=function(t,i){var s,h;void 0===i&&(i=0);var n=this.Y.length;for(s=this.q;s<n;s++)if((h=this.Y[s])&&!1===t({elementId:s,layerId:i,element:h,isFunction:this._[s],layer:this}))return},i.getElementsByTag=function(t){var i=[];return this.forEach(function(s){if(!s.isFunction){var h=s.element.getElementsByTag(t);h&&(i=i.concat(h))}}),i},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.forEach(function(s){return!s.isFunction&&s.element.play(t,i)})},i.count=function(){for(var t=0,i=this.Y.length,s=this.q;s<i;s++)this.Y[s]&&t++;return t},i.clear=function(){this.Y=[],this._=[],this.q=0,this.L=0},t}(),x=function(){function t(){this.H=[]}var i=t.prototype;return i.addLayer=function(t){return this.H[this.H.length]=new g(t),this.H[this.H.length-1]},i.addLayers=function(t,i){void 0===t&&(t=1);var s=Array.from({length:t},function(t){return new g(i)});return this.H=this.H.concat(s),s},i.addLayerForId=function(t){return this.H[this.H.length]=new g(t),this.H.length-1},i.addLayersForIds=function(t,i){var s=this;void 0===t&&(t=1);var h=Array.from({length:t},function(t,i){return i+s.H.length});return this.H=this.H.concat(Array.from({length:t},function(t){return new g(i)})),h},i.getById=function(t){return this.H[t]},i.forEach=function(t,i){var s,h=this.H.length;for(s=0;s<h&&(!this.H[s].isCanvasId(i)||!1!==this.H[s].forEach(t,s));s++);},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.forEach(function(s){return!s.isFunction&&s.element.play(t,i)})},i.getElementsByTag=function(t){var i=[];return this.forEach(function(s){if(!s.isFunction){var h=s.element.getElementsByTag(t);h&&(i=i.concat(h))}}),i},i.count=function(){return this.H.length},i.clear=function(){this.H=[]},t}();function k(){this.reset()}function P(t,i){return null==t||""===t?i:t}k.prototype.reset=function(){return this.m=[1,0,0,1,0,0],this},k.prototype.multiply=function(t){var i=this.m[1]*t.m[0]+this.m[3]*t.m[1],s=this.m[0]*t.m[2]+this.m[2]*t.m[3],h=this.m[1]*t.m[2]+this.m[3]*t.m[3],n=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],r=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=this.m[0]*t.m[0]+this.m[2]*t.m[1],this.m[1]=i,this.m[2]=s,this.m[3]=h,this.m[4]=n,this.m[5]=r,this},k.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),i=-this.m[1]*t,s=-this.m[2]*t,h=this.m[0]*t,n=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),r=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=this.m[3]*t,this.m[1]=i,this.m[2]=s,this.m[3]=h,this.m[4]=n,this.m[5]=r,this},k.prototype.rotate=function(t){var i=Math.cos(t),s=Math.sin(t),h=this.m[1]*i+this.m[3]*s,n=this.m[0]*-s+this.m[2]*i,r=this.m[1]*-s+this.m[3]*i;return this.m[0]=this.m[0]*i+this.m[2]*s,this.m[1]=h,this.m[2]=n,this.m[3]=r,this},k.prototype.translate=function(t,i){return this.m[4]+=this.m[0]*t+this.m[2]*i,this.m[5]+=this.m[1]*t+this.m[3]*i,this},k.prototype.scale=function(t,i){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=i,this.m[3]*=i,this},k.prototype.transformPoint=function(t,i){var s=t;return[t=s*this.m[0]+i*this.m[2]+this.m[4],i=s*this.m[1]+i*this.m[3]+this.m[5]]},k.prototype.clone=function(){var t=new k;return t.m=this.m.slice(0),t};var j=function(){function t(t){void 0===t&&(t={}),this.type="timing",this.B=t,this.G=P(r(this.B.tickChunk),100/6),this.V=P(r(this.B.maxSkippedTickChunk),120),this.Z=P(r(this.B.tickChunkTolerance),.1),this.totalTimePassed=0}var i=t.prototype;return i.init=function(){},i.currentTime=function(){return window.performance?performance.now():Date.now()},i.clampTime=function(t){var i=t.timePassed,s=this.G?this.G*this.V:2e3;return i>s?s:i},i.shiftTime=function(t){return this.G?-t.timePassed%this.G:0},i.isChunked=function(){return this.G},i.hasOneChunkedFrame=function(t){return t.timePassed>=this.G-this.Z},i.calcFrames=function(t){return Math.min(this.V,Math.floor((t.timePassed+this.Z)/this.G))},v(t,[{key:"tickChunk",get:function(){return this.G}}]),t}(),O="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function C(t,i,s){if(!t.s){if(s instanceof A){if(!s.s)return void(s.o=C.bind(null,t,i));1&i&&(i=s.s),s=s.v}if(s&&s.then)return void s.then(C.bind(null,t,i),C.bind(null,t,2));t.s=i,t.v=s;var h=t.o;h&&h(t)}}var A=function(){function t(){}return t.prototype.then=function(i,s){var h=new t,n=this.s;if(n){var r=1&n?i:s;if(r){try{C(h,1,r(this.v))}catch(t){C(h,2,t)}return h}return this}return this.o=function(t){try{var n=t.v;1&t.s?C(h,1,i?i(n):n):s?C(h,1,s(n)):C(h,2,n)}catch(t){C(h,2,t)}},h},t}();function S(t){return t instanceof A&&1&t.s}var T=function(){function t(){this.$=new x,this.J=0,this.K=b,this.middlewares=[].slice.call(arguments),this.middlewareByType("timing")||(this.middlewares=[j].concat(this.middlewares))}var i=t.prototype;return i.t=function(){return this.tt.getOutput()},i.middlewareByType=function(t){var i=this.st.it.filter(function(i){return i.type==t});if(i.length)return i[i.length-1]},i.has=function(t){return t in this.st||this.st.it.filter(function(i){return t in i}).length>0},i.do=function(t,i,s,h){var n=this.st[t]||this.st.it.filter(function(i){return t in i});return(n=n.filter(function(t){return t.enabled})).length?h(n,this.ht(i),s):s},i.map=function(t,i){return void 0===i&&(i={}),this.do(t,i,[],function(i,s){return i.map(function(i){return i[t](s)})})},i.pipe=function(t,i,s){var h=this;return void 0===i&&(i={}),this.do(t,i,s,function(i,n){var r=s;h.nt=!1;for(var e,o=w(i);!(e=o()).done&&(r=e.value[t](n,r),!h.nt););return r})},i.pipeBack=function(t,i,s){var h=this;return void 0===i&&(i={}),this.do(t,i,s,function(i,n){var r=s;h.nt=!1;for(var e=i.length-1;e>=0&&(r=i[e][t](n,r),!h.nt);e--);return r})},i.pipeMax=function(t,i,s){var h=this;return void 0===i&&(i={}),this.do(t,i,s,function(i,n){var r=s;h.nt=!1;for(var e,o=function(){var i=e.value[t](n,r);if(r=Array.isArray(i)?Array.isArray(r)?r.map(function(t,s){return Math.max(t,i[s])}):i.map(function(t){return Math.max(t,r)}):Array.isArray(r)?r.map(function(t,s){return Math.max(t,i)}):Math.max(i,r),h.nt)return"break"},u=w(i);!(e=u()).done&&"break"!==o(););return r})},i.pipeAsync=function(t,i,s){var h=this;return void 0===i&&(i={}),this.do(t,i,s,function(i,n){try{var r,e=s;h.nt=!1;var o=function(t,i,s){if("function"==typeof t[O]){var h,n,r,e=t[O]();if(function t(o){try{for(;!((h=e.next()).done||s&&s());)if((o=i(h.value))&&o.then){if(!S(o))return void o.then(t,r||(r=C.bind(null,n=new A,2)));o=o.v}n?C(n,1,o):n=o}catch(t){C(n||(n=new A),2,t)}}(),e.return){var o=function(t){try{h.done||e.return()}catch(t){}return t};if(n&&n.then)return n.then(o,function(t){throw o(t)});o()}return n}if(!("length"in t))throw new TypeError("Object is not iterable");for(var u=[],f=0;f<t.length;f++)u.push(t[f]);return function(t,i,s){var h,n,r=-1;return function e(o){try{for(;++r<t.length&&(!s||!s());)if((o=i(r))&&o.then){if(!S(o))return void o.then(e,n||(n=C.bind(null,h=new A,2)));o=o.v}h?C(h,1,o):h=o}catch(t){C(h||(h=new A),2,t)}}(),h}(u,function(t){return i(u[t])},s)}(i,function(i){return Promise.resolve(i[t](n,e)).then(function(t){e=t,h.nt&&(r=1)})},function(){return r});return Promise.resolve(o&&o.then?o.then(function(){return e}):e)}catch(t){return Promise.reject(t)}})},i.value=function(t,i){void 0===i&&(i={});var s=this.st[t]||this.st.it.filter(function(i){return t in i});if(s.filter(function(t){return t.enabled}),s.length){var h=s[s.length-1];return r(h[t],h,this.ht(i))}},i.stopPropagation=function(){this.nt=!0},i.currentTime=function(){return this.pipe("currentTime")},i.clampTime=function(t){return this.pipe("clampTime",{timePassed:t})},i.shiftTime=function(t){return this.pipe("shiftTime",{timePassed:t})},i.cacheClear=function(){this.rt=0,this.et=0},i.viewport=function(){return this.tt?(this.rt||(this.rt=this.pipe("viewport",{},new k),this.et=null),this.rt):new k},i.transformPoint=function(t,i,s){return void 0===s&&(s=this.ot.scaleCanvas),this.et||(this.et=this.viewport().clone().invert()),this.et.transformPoint(t*s,i*s)},i.callInit=function(t,i){var s=this;this.tt=i,this.resize();var h=this.value("images");h&&this.K.add(h),Promise.all(this.map("init",{parameter:t})).then(function(t){return s.ut=!0})},i.updateAdditionalModifier=function(){var t=this.t();this.ot=this.pipe("additionalModifier",{},{alpha:1,x:0,y:0,width:t.width,height:t.height,widthInPixel:t.width,heightInPixel:t.height,scaleCanvas:1,visibleScreen:{x:0,y:0,width:t.width,height:t.height},fullScreen:{x:0,y:0,width:t.width,height:t.height}})},i.resize=function(){var t=this,i=this.t();this.updateAdditionalModifier(),this.pipe("resize"),this.$.forEach(function(s){s.isFunction||s.element.resize(i,t.ot)})},i.destroy=function(){try{var t=this;return Promise.resolve(t.pipeAsync("destroy")).then(function(i){return t.ut=!1,i})}catch(t){return Promise.reject(t)}},i.ht=function(t){return Object.assign({engine:this.tt,scene:this,imageManager:this.K,layerManager:this.$,totalTimePassed:this.J,output:this.tt&&this.t()},t)},i.callLoading=function(t){return this.K.isLoaded()&&this.ut?(this.ft=this.value("endTime"),t.progress="Click to play",this.value("loading",t),!0):(t.progress=this.K.getCount()?this.K.getLoaded()/this.K.getCount():"Loading...",this.value("loading",t),!1)},i.fixedUpdate=function(t,i){this.map("fixedUpdate",{timePassed:t,lastCall:i})},i.isDrawFrame=function(t){return this.pipeMax("isDrawFrame",{timePassed:t},0!==t)},i.move=function(t){if(this.J+=t,this.ct?this.reset():t<0?(t=this.J,this.reset(),this.initSprites(),this.J=t):this.ft&&this.ft<=this.J&&(t-=this.J-this.ft,this.J=this.ft,this.map("end",{timePassed:t})),this.value("isChunked")){if(this.value("hasOneChunkedFrame",{timePassed:t}))for(var i=this.value("calcFrames",{timePassed:t})-1,s=0;s<=i;s++)this.fixedUpdate(this.value("tickChunk"),s===i)}else this.fixedUpdate(t,!0);this.map("update",{timePassed:t}),this.$.forEach(function(i){var s=i.layer,h=i.elementId;i.isFunction||i.element.animate(t)&&s.deleteById(h)})},i.draw=function(t){var i=this;this.map("draw",{canvasId:t});var s=this.t().context[t];s.save(),s.setTransform.apply(s,this.viewport().m),this.$.forEach(function(t){var h=t.layer,n=t.element,r=t.elementId;t.isFunction?n(i.ht({layerId:t.layerId,elementId:r,layer:h,context:s}))&&h.deleteById(r):n.draw(s,i.ot)},t),s.restore()},i.initSprites=function(t){var i=this,s=this.t().context[t];this.$.forEach(function(t){t.isFunction||t.element.callInit(s,i.ot)},t),this.map("initSprites",{canvasId:t})},i.resetIntend=function(){this.ct=!0},i.reset=function(){this.J=0,this.ct=!1;var t=this.pipe("reset",{engine:this.tt,scene:this,layerManager:this.$,imageManager:this.K},new x);if(Array.isArray(t)){var i=t;t=new x,i.forEach(function(i){t.addLayer().addElements(i)})}t&&(this.$=t)},v(t,[{key:"middlewares",set:function(t){this.st=e(t).map(function(t){return"function"==typeof t?new t:t}).reduce(function(t,i){for(var s=0,h=Object.keys(t);s<h.length;s++){var n=h[s];n in i&&t[n].push(i)}return t.it.push(i),"enabled"in i||(i.enabled=!0),i.type&&(t["t_"+i.type]=i),t},{it:[],init:[],isDrawFrame:[],initSprites:[],fixedUpdate:[],update:[],draw:[],destroy:[],reset:[],resize:[],currentTime:[],clampTime:[],shiftTime:[],isChunked:[],hasOneChunkedFrame:[],calcFrames:[],tickChunk:[],additionalModifier:[]})},get:function(){return this.st.it}},{key:"additionalModifier",get:function(){return this.ot}},{key:"timing",get:function(){return this.st.t_timing}},{key:"camera",get:function(){return this.st.t_camera}},{key:"control",get:function(){return this.st.t_control}},{key:"totalTimePassed",get:function(){return this.J}}]),t}(),D=function(){function t(t){this.duration=r(t)-0}return t.prototype.run=function(t,i){return i-this.duration},t}(),E=function(){function t(){var t=[].slice.call(arguments),i=0;"number"==typeof t[0]&&(i=t.shift()),this.sequences=t.map(function(t){Array.isArray(t)||(t=[t]);var s=i;return"number"==typeof t[0]&&(s=t.shift()),{position:0,timelapsed:-s,sequence:t.map(function(t){return"function"!=typeof t.run?"number"==typeof t?new D(t):{run:t}:t}).filter(function(t){return"function"==typeof t.run}),label:t.reduce(function(t,i,s){return"string"==typeof i&&(t[i]=s-Object.keys(t).length),t},{}),enabled:!0}}),this.lastTimestamp=0,this.enabled=!0}var i=t.prototype;return i.reset=function(t){void 0===t&&(t=0),this.sequences.forEach(function(i){i.enabled=!0,i.position=0,i.timelapsed=t,i.sequence[0]&&i.sequence[0].reset&&i.sequence[0].reset(t)}),this.enabled=!0},i.play=function(t,i){if(void 0===t&&(t=""),void 0===i&&(i=0),t){var s=this.sequences.reduce(function(s,h){return h.label.hasOwnProperty(t)?(s=!0,h.position=h.label[t],h.enabled=!0,h.timelapsed=i,h.sequence[h.position]&&h.sequence[h.position].reset&&h.sequence[h.position].reset()):s|=h.sequence.find(function(s){return s.play&&s.play(t,i)})>=0,s},!1);return s&&(this.enabled=!0),s}return this.sequences.forEach(function(t){return t.enabled=!0}),this.enabled=!0,!0},i.at=function(i,s,h){for(var n=h;s.sequence[s.position]&&n>=0;){if(s.timelapsed+=n,s.timelapsed<0)return-1;if(!0===(n=s.sequence[s.position].run(i,s.timelapsed)))n=0;else{if(!1===n)return-1;if(n===t.vt)return s.enabled=!1,this.enabled=!1,h;if(n===t.dt)return s.enabled=!1,h;if(n===t.lt)return!0}if(n>=0&&(s.position=(s.position+1)%s.sequence.length,s.sequence[s.position]&&s.sequence[s.position].reset&&s.sequence[s.position].reset(),s.timelapsed=0,0===s.position))return s.enabled=!1,n}return n},i.run=function(t,i,s){var h=i;if(s||(h=i-this.lastTimestamp,this.lastTimestamp=i),!this.enabled)return h;for(var n=this.sequences.length,r=0,e=Infinity,o=0;o<n;o++)if(this.sequences[o].enabled){var u=this.at(t,this.sequences[o],h);if(!0===u)return!0;e=Math.min(e,u)}else r++;return r===n?(this.enabled=!1,h):e},t}();E.vt="F",E.dt="S",E.lt="R";var F=function(){function t(t){this.yt(this,this.Mt(),t),this.pt=!0}var i=t.prototype;return i.yt=function(t,i,s){Object.keys(i).forEach(function(h){var n=i[h];t[h]="function"==typeof n?n(s[h],s,t):P(r(s[h]),n)})},i.wt=function(){return{animation:function(t,i){var s=r(t);return Array.isArray(s)?new E(s):s},enabled:!0,isClickable:!1,tag:function(t){return Array.isArray(t)?t:t?[t]:[]}}},i.Mt=function(){return Object.assign({},this.wt(),{x:0,y:0,rotation:function(t,i){return P(r(t),P(r(i.rotationInRadian),.017453292519943295*P(r(i.rotationInDegree),0)))},scaleX:function(t,i){return P(r(t),P(r(i.scale),1))},scaleY:function(t,i){return P(r(t),P(r(i.scale),1))},alpha:1,compositeOperation:"source-over",color:"#fff"})},i.getElementsByTag=function(t){var i=this;if("function"==typeof t){if(this.tag.filter(t).length)return[this]}else if((Array.isArray(t)?t:[t]).filter(function(t){return i.tag.includes(t)}).length)return[this];return[]},i.animate=function(t){return!(!this.animation||!0!==this.animation.run(this,t,!0)||(this.enabled=!1,0))},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.animation&&this.animation.play&&this.animation.play(t,i)},i.init=function(t,i){},i.callInit=function(t,i){this.pt&&(this.init(t,i),this.pt=!1)},i.resize=function(t,i){},i.bt=function(t,i,s,h,n){var r=!1;if(this.enabled&&this.isClickable){var e=this.width/2,o=this.height/2;t.save(),h?t.translate(this.x+e,this.y+o):t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.beginPath(),n?r=n(e,o):(t.rect(-e,-o,this.width,this.height),t.closePath(),r=t.isPointInPath(i,s)),t.restore()}return!!r&&this},i.detectDraw=function(t,i){},i.detect=function(t,i,s){var h=this;return this.bt(t,i,s,!1,function(){return t.arc(0,0,1,Math.PI/2+h.rotation,2.5*Math.PI-h.rotation,!1),t.isPointInPath(i,s)})},i.draw=function(t,i){this.enabled&&(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.beginPath(),t.fillStyle=this.color,t.arc(0,0,1,Math.PI/2+this.rotation,2.5*Math.PI-this.rotation,!1),t.fill(),t.restore())},t}(),I=function(t){function i(i){var s;return"function"==typeof i&&(i={callback:i}),(s=t.call(this,i)||this).gt=0,s.xt=0,s}d(i,t);var s=i.prototype;return s.Mt=function(){return Object.assign({},this.wt(),{callback:function(t){return void 0===typeof t?function(){}:t}})},s.animate=function(i){return this.enabled&&(this.gt+=i,this.xt+=i),t.prototype.animate.call(this,i)},s.detect=function(t,i){},s.draw=function(t,i){this.enabled&&this.callback(t,this.gt,i,this),this.xt=0},i}(F),N=function(t){function i(i){return t.call(this,i)||this}d(i,t);var s=i.prototype;return s.Mt=function(){return Object.assign({},t.prototype.Mt.call(this),{sprite:[]})},s.getElementsByTag=function(i){for(var s,h=t.prototype.getElementsByTag.call(this,i),n=w(this.sprite);!(s=n()).done;){var r=s.value.getElementsByTag(i);r&&(h=h.concat(r))}return h},s.animate=function(i){var s=t.prototype.animate.call(this,i),h=!1;if(this.enabled)for(var n,r=w(this.sprite);!(n=r()).done;)h=h||!0===n.value.animate(i);return this.animation?s:(h&&(this.enabled=!1),h)},s.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.animation&&this.animation.play&&this.animation.play(t,i);for(var s,h=w(this.sprite);!(s=h()).done;){var n=s.value;n.play&&n.play(t,i)}},s.resize=function(t,i){for(var s,h=w(this.sprite);!(s=h()).done;)s.value.resize(t,i)},s.callInit=function(i,s){t.prototype.callInit.call(this,i,s);for(var h,n=w(this.sprite);!(h=n()).done;)h.value.callInit(i,s)},s.detectImage=function(t,i){if(this.enabled)for(var s,h=w(this.sprite);!(s=h()).done;)s.value.detectImage(t,i)},s.detect=function(t,i,s){if(this.enabled)for(var h,n=w(this.sprite);!(h=n()).done;){var r=h.value.detect(t,i,s);if(r)return r}return!1},s.draw=function(t,i){if(this.enabled){this.alpha<1&&((i=Object.assign({},i)).alpha*=this.alpha),t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation);for(var s,h=w(this.sprite);!(s=h()).done;)s.value.draw(t,i);t.restore()}},i}(F),z=function(t){function i(i){var s;return(s=t.call(this,i)||this).kt=!1,s.O=2,s}d(i,t);var s=i.prototype;return s.Mt=function(){return Object.assign({},t.prototype.Mt.call(this),{x:void 0,y:void 0,width:void 0,height:void 0,canvasWidth:void 0,canvasHeight:void 0,gridSize:void 0,norm:function(t,i,s){return P(r(t),void 0===s.x&&void 0===s.y&&void 0===s.width&&void 0===s.height)},isDrawFrame:function(t,i,s){return P(t,!0)}})},s.Pt=function(t){var i=t.widthInPixel,s=t.heightInPixel;this.jt=document.createElement("canvas"),this.canvasWidth&&this.canvasHeight?(this.jt.width=this.canvasWidth,this.jt.height=this.canvasHeight):this.gridSize?(this.kt=this.gridSize,this.jt.width=Math.round(this.kt),this.jt.height=Math.round(this.kt)):(this.jt.width=Math.round(i/this.scaleX),this.jt.height=Math.round(s/this.scaleY)),this.Ot=this.jt.getContext("2d")},s.normalizeFullScreen=function(t){(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y),(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height)},s.resize=function(i,s){if(this.jt&&this.kt!==this.gridSize&&!this.canvasWidth){var h=this.jt;this.Pt(s),this.Ot.globalCompositeOperation="copy",this.Ot.drawImage(h,0,0,h.width,h.height,0,0,this.jt.width,this.jt.height),this.Ot.globalCompositeOperation="source-over",this.O=2}this.normalizeFullScreen(s),t.prototype.resize.call(this,i,s)},s.detect=function(t,i,s){return this.bt(t,i,s,!1)},s.init=function(t,i){this.Pt(i),this.normalizeFullScreen(i)},s.draw=function(t,i){if(this.enabled){this.gridSize&&this.kt!==this.gridSize&&this.resize(i),this.O=Math.max(this.O-1,r(this.isDrawFrame,t,i));var s=this.width,h=this.height,n=s/2,e=h/2,o=this.jt.width,u=this.jt.height;if(this.O){this.Ot.textBaseline="middle",this.Ot.textAlign="center",this.Ot.globalAlpha=1,this.Ot.globalCompositeOperation="source-over",this.Ot.save();var f=i.cam;if(this.norm&&f){var c=Math.max(o,u)/2;this.Ot.translate(o/2,u/2),this.Ot.scale(c,c),this.Ot.scale(f.zoom,f.zoom),this.Ot.translate(-f.x,-f.y)}for(var a,v=w(this.sprite);!(a=v()).done;)a.value.draw(this.Ot,this.norm?Object.assign({},i,{alpha:1,widthInPixel:o,heightInPixel:u}):{alpha:1,x:0,y:0,width:o,height:u,widthInPixel:o,heightInPixel:u,visibleScreen:{x:0,y:0,width:o,height:u}});this.Ot.restore()}t.save(),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,t.translate(this.x+n,this.y+e),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.drawImage(this.jt,0,0,o,u,-n,-e,s,h),t.restore()}},i}(N),W=function(t){function i(i){var s;s=t.call(this,i.self||{})||this;var h=P(r(i.count),1);s.sprite=[];for(var n=i.class,e=0;e<h;e++){var o={};for(var u in i)["self","class","count"].includes(u)||(o[u]="function"==typeof i[u]?i[u].call(i,e):i[u]);s.sprite[e]=new n(o)}return s}return d(i,t),i}(N),R=function(t){function i(i){var s;return(s=t.call(this,i)||this).kt=!1,s}d(i,t);var s=i.prototype;return s.Mt=function(){return Object.assign({},t.prototype.Mt.call(this),{x:void 0,y:void 0,width:void 0,height:void 0,gridSize:void 0,darker:0,pixel:!1,clear:!1,norm:function(t,i,s){return P(r(t),void 0===s.x&&void 0===s.y&&void 0===s.width&&void 0===s.height)}})},s.Pt=function(t){var i=t.widthInPixel,s=t.heightInPixel;this.jt=document.createElement("canvas"),this.gridSize?(this.kt=this.gridSize,this.jt.width=Math.round(this.kt),this.jt.height=Math.round(this.kt)):(this.jt.width=Math.ceil(i/this.scaleX),this.jt.height=Math.ceil(s/this.scaleY)),this.Ot=this.jt.getContext("2d"),this.Ot.globalCompositeOperation="source-over",this.Ot.globalAlpha=1},s.normalizeFullScreen=function(t){(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y),(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height)},s.resize=function(t,i){if(this.jt&&this.kt!==this.gridSize){var s=this.jt;this.Pt(i),this.Ot.globalCompositeOperation="copy",this.Ot.drawImage(s,0,0,s.width,s.height,0,0,this.jt.width,this.jt.height),this.Ot.globalCompositeOperation="source-over"}this.normalizeFullScreen(i)},s.detect=function(t,i,s){return this.bt(t,i,s,!1)},s.init=function(t,i){this.Pt(i),this.normalizeFullScreen(i)},s.draw=function(t,i){if(this.enabled&&this.alpha>0){this.gridSize&&this.kt!==this.gridSize&&this.resize(t,i);var s=this.alpha*i.alpha,h=this.width,n=this.height,r=this.jt.width,e=this.jt.height;if(s>0&&r&&e){this.Ot.globalCompositeOperation="copy",this.Ot.globalAlpha=1,this.Ot.drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height,0,0,r,e),this.darker>0&&(this.Ot.globalCompositeOperation=this.clear?"source-atop":"source-over",this.Ot.fillStyle="rgba(0,0,0,"+this.darker+")",this.Ot.fillRect(0,0,r,e)),this.additionalBlur&&this.additionalBlur(r,e,i),this.clear&&(t.globalCompositeOperation="source-over",t.globalAlpha=1,t.clearRect(this.x,this.y,h,n)),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=s;var o=t.imageSmoothingEnabled;t.imageSmoothingEnabled=!this.pixel,t.drawImage(this.jt,0,0,r,e,this.x,this.y,h,n),t.imageSmoothingEnabled=o}}else this.clear&&(this.x||(this.x=i.x),this.y||(this.y=i.y),this.width||(this.width=i.width),this.height||(this.height=i.height),t.clearRect(this.x,this.y,this.width,this.height))},i}(F),X=function(t){function i(i){var s;return(s=t.call(this,i)||this).Ct=!1,s}d(i,t);var s=i.prototype;return s.Mt=function(){return Object.assign({},t.prototype.Mt.call(this),{image:function(t){return b.getImage(r(t))},position:i.CENTER,frameX:0,frameY:0,frameWidth:0,frameHeight:0,width:void 0,height:void 0,norm:!1,normCover:!1,normToScreen:!1,clickExact:!1,color:"#FFF",tint:0})},s.resize=function(t,i){this.pt=!0},s.init=function(t,i){var s=this.frameWidth||this.image.width,h=this.frameHeight||this.image.height;this.At=this.normToScreen?this.normCover?Math.max(i.fullScreen.width/s,i.fullScreen.height/h):this.norm?Math.min(i.fullScreen.width/s,i.fullScreen.height/h):1:this.normCover?Math.max(i.width/s,i.height/h):this.norm?Math.min(i.width/s,i.height/h):1},s.St=function(){return[this.tint,this.frameWidth||this.image.width,this.frameHeight||this.image.height,this.color,this.frameX,this.frameY].join(";")},s.Tt=function(t,i){return this.jt||(this.jt=document.createElement("canvas"),this.Ot=this.jt.getContext("2d")),this.jt.width=t,this.jt.height=i,this.Ot},s.detectDraw=function(t,s){if(this.enabled&&this.isClickable&&this.clickExact){var h=this.frameWidth||this.image.width,n=this.frameHeight||this.image.height,r=(this.width?this.width:h)*this.At*this.scaleX,e=(this.height?this.height:n)*this.At*this.scaleY,o=this.position===i.LEFT_TOP,u=this.Tt(h,n);u.globalAlpha=1,u.globalCompositeOperation="source-over",u.fillStyle=s,u.fillRect(0,0,h,n),u.globalCompositeOperation="destination-atop",u.drawImage(this.image,this.frameX,this.frameY,h,n,0,0,h,n),t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.drawImage(this.jt,0,0,h,n,o?0:-r/2,o?0:-e/2,r,e),t.restore(),this.Ct=!1}},s.detect=function(t,i,s){return this.enabled&&this.isClickable&&this.clickExact?"c":this.bt(t,i,s,!1)},s.draw=function(t,s){if(this.enabled&&this.image&&this.alpha>0){var h=this.frameWidth||this.image.width,n=this.frameHeight||this.image.height,r=(this.width?this.width:h)*this.At*this.scaleX,e=(this.height?this.height:n)*this.At*this.scaleY;t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*s.alpha;var o=this.position===i.LEFT_TOP;if(this.tint&&this.Ct!==this.St()){var u=this.Tt(h,n);u.globalAlpha=1,u.globalCompositeOperation="source-over",u.clearRect(0,0,h,n),u.globalAlpha=this.tint,u.fillStyle=this.color,u.fillRect(0,0,h,n),u.globalAlpha=1,u.globalCompositeOperation="destination-atop",u.drawImage(this.image,this.frameX,this.frameY,h,n,0,0,h,n),this.Ct=this.St()}0==this.rotation?o?t.drawImage(this.tint?this.jt:this.image,this.tint?0:this.frameX,this.tint?0:this.frameY,h,n,this.x,this.y,r,e):t.drawImage(this.tint?this.jt:this.image,this.tint?0:this.frameX,this.tint?0:this.frameY,h,n,this.x-r/2,this.y-e/2,r,e):(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.drawImage(this.tint?this.jt:this.image,this.tint?0:this.frameX,this.tint?0:this.frameY,h,n,o?0:-r/2,o?0:-e/2,r,e),t.restore())}},i}(F);X.LEFT_TOP=0,X.CENTER=1;var Y=function(t){function i(i){return t.call(this,i)||this}d(i,t);var s=i.prototype;return s.Mt=function(){return Object.assign({},t.prototype.Mt.call(this),{text:void 0,font:"2em monospace",position:i.CENTER,color:void 0,borderColor:void 0,lineWidth:1})},s.detectDraw=function(t,i){this.enabled&&this.isClickable&&(t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),this.position||(t.textAlign="left",t.textBaseline="top"),t.font=this.font,t.fillStyle=i,t.fillText(this.text,0,0),t.restore())},s.detect=function(t,i){return"c"},s.draw=function(t,i){this.enabled&&(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,t.save(),this.position||(t.textAlign="left",t.textBaseline="top"),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.font=this.font,this.color&&(t.fillStyle=this.color,t.fillText(this.text,0,0)),this.borderColor&&(t.strokeStyle=this.borderColor,t.lineWidth=this.lineWidth,t.strokeText(this.text,0,0)),t.restore())},i}(F);Y.LEFT_TOP=0,Y.CENTER=1;var _=function(t){function s(i){var s;return(s=t.call(this,i)||this).Dt=void 0,s.Et=!1,s}d(s,t),s.getGradientImage=function(t,i,h){var n=t>>4,r=i>>4,e=h>>4;return s.Ft||(s.Ft=Array.from({length:16},function(t){return Array.from({length:16},function(t){return Array.from({length:16})})})),s.Ft[n][r][e]||(s.Ft[n][r][e]=s.generateGradientImage(n,r,e)),s.Ft[n][r][e]},s.generateGradientImage=function(t,i,s){var h=document.createElement("canvas");h.width=h.height=64;var n=h.getContext("2d");n.globalAlpha=1,n.globalCompositeOperation="source-over",n.clearRect(0,0,64,64);var r=n.createRadialGradient(32,32,0,32,32,32);return r.addColorStop(0,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",1)"),r.addColorStop(.3,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",0.4)"),r.addColorStop(1,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",0)"),n.fillStyle=r,n.fillRect(0,0,64,64),h};var h=s.prototype;return h.resize=function(t,i){this.Dt=void 0},h.draw=function(t,h){if(this.enabled){this.color&&this.color.r||(this.color=new i.TinyColor(this.color).toRgb()),this.Dt!==this.scaleX&&(this.Dt=this.scaleX,this.Et=this.scaleX*h.widthInPixel/h.width>64);var n=this.color,r=n.r,e=n.g,o=n.b;t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*h.alpha,t.imageSmoothingEnabled=this.Et,t.drawImage(s.getGradientImage(r,e,o),0,0,64,64,this.x-this.scaleX/2,this.y-this.scaleY/2,this.scaleX,this.scaleY),t.imageSmoothingEnabled=!0}},s}(F),q=function(t){function i(i){var s;if((s=t.call(this,i)||this).oldPath=void 0,s.path2D=new Path2D,s.polyfill)if("function"!=typeof Path2D){var h=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src="https://cdn.jsdelivr.net/npm/canvas-5-polyfill@0.1.5/canvas.min.js",h.appendChild(n)}else{var r=document.createElement("canvas").getContext("2d");r.stroke(new Path2D("M0,0H1")),r.getImageData(0,0,1,1).data[3]&&(s.polyfill=!1)}return s}d(i,t);var h=i.prototype;return h.Mt=function(){return Object.assign({},t.prototype.Mt.call(this),{path:void 0,color:void 0,borderColor:void 0,lineWidth:1,clip:!1,fixed:!1,polyfill:!0})},h.changeToPathInit=function(t,i){return s.It("string"==typeof t?s.path2shapes(t):t,"string"==typeof i?s.path2shapes(i):i)},h.changeToPath=function(t,i,h){return s.Nt(i.pathFrom,i.pathTo,t)},h.detect=function(t,i,s){var h=this;return this.bt(t,i,s,!1,function(){return t.isPath(h.path2D,i,s)})},h.draw=function(t,i){var h=this;if(this.enabled){var n=this.alpha*i.alpha;this.oldPath!==this.path&&(this.polyfill&&"string"==typeof this.path&&(this.path=s.path2shapes(this.path)),Array.isArray(this.path)?(this.path2D=new Path2D,this.path.forEach(function(t){h.path2D.moveTo(t[0][0],t[0][1]),t.forEach(function(t){h.path2D.bezierCurveTo(t[2],t[3],t[4],t[5],t[6],t[7])}),h.path2D.closePath()})):this.path2D=this.path instanceof Path2D?this.path:new Path2D(this.path),this.oldPath=this.path);var r=this.scaleX,e=this.scaleY;this.fixed&&(0==r&&(r=Number.EPSILON),0==e&&(e=Number.EPSILON)),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=n,t.save(),t.translate(this.x,this.y),t.scale(r,e),t.rotate(this.rotation),this.color&&(t.fillStyle=this.color,t.fill(this.path2D)),t.save(),this.clip&&(t.clip(this.path2D),this.fixed&&(t.rotate(-this.rotation),t.scale(1/r,1/e),t.translate(-this.x,-this.y)));for(var o,u=w(this.sprite);!(o=u()).done;)o.value.draw(t,i);t.restore(),this.borderColor&&(t.strokeStyle=this.borderColor,t.lineWidth=this.lineWidth,t.stroke(this.path2D)),t.restore()}},i}(N),L=function(t){function i(i){return t.call(this,i)||this}d(i,t);var s=i.prototype;return s.Mt=function(){return Object.assign({},t.prototype.Mt.call(this),{x:void 0,y:void 0,width:void 0,height:void 0,borderColor:void 0,color:void 0,lineWidth:1,clear:!1,norm:function(t,i,s){return P(r(t),void 0===s.x&&void 0===s.y&&void 0===s.width&&void 0===s.height)},position:i.CENTER})},s.normalizeFullScreen=function(t){(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height),(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x,this.position===i.CENTER&&(this.x+=this.width/2)),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y,this.position===i.CENTER&&(this.y+=this.height/2))},s.resize=function(t,i){this.pt=!0},s.init=function(t,i){this.normalizeFullScreen(i)},s.detect=function(t,s,h){return this.bt(t,s,h,this.position===i.LEFT_TOP)},s.draw=function(t,s){if(this.enabled&&this.alpha>0)if(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*s.alpha,0===this.rotation&&this.position===i.LEFT_TOP)this.clear?t.clearRect(this.x,this.y,this.width,this.height):this.color&&(t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height)),this.borderColor&&(t.beginPath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.borderColor,t.rect(this.x,this.y,this.width,this.height),t.stroke());else{var h=this.width/2,n=this.height/2;t.save(),this.position===i.LEFT_TOP?t.translate(this.x+h,this.y+n):t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),this.clear?t.clearRect(-h,-n,this.width,this.height):this.color&&(t.fillStyle=this.color,t.fillRect(-h,-n,this.width,this.height)),this.borderColor&&(t.beginPath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.borderColor,t.rect(-h,-n,this.width,this.height),t.stroke()),t.restore()}},i}(F);L.LEFT_TOP=0,L.CENTER=1;var U={Callback:I,Canvas:z,Circle:F,Emitter:W,FastBlur:R,Group:N,Image:X,Text:Y,Particle:_,Path:q,Rect:L,Scroller:function(t){function i(i){var s=r(i.text),h=Array.isArray(s)?s:[].concat(s);return t.call(this,Object.assign({},i,{class:Y,count:h.length,text:function(t){return h[t]},enabled:function(t){return" "!==h[t]&&r(i.enabled,t)}}))||this}return d(i,t),i}(W),StackBlur:function(t){function i(i){var s;return(s=t.call(this,i)||this).kt=!1,s.zt=void 0,s}d(i,t);var s=i.prototype;return s.Mt=function(){return Object.assign({},t.prototype.Mt.call(this),{onCanvas:!1,radius:void 0,radiusPart:void 0,radiusScale:!0})},s.normalizeFullScreen=function(i){this.norm&&this.onCanvas?(this.x=0,this.y=0,this.width=i.widthInPixel,this.height=i.heightInPixel):t.prototype.normalizeFullScreen.call(this,i)},s.resize=function(i,s){t.prototype.resize.call(this,i,s),this.radiusPart&&(this.radius=void 0)},s.additionalBlur=function(t,i,s){var n=this.Ot.getImageData(0,0,t,i);h.imageDataRGBA(n,0,0,t,i,s.radius),this.Ot.putImageData(n,0,0)},s.detect=function(t,i,s){return this.bt(t,i,s,!1)},s.draw=function(i,s){if(this.enabled){void 0!==this.radius&&this.zt===this.radiusPart||(this.radius=Math.round((s.widthInPixel+s.heightInPixel)/2/this.radiusPart),this.zt=this.radiusPart);var n=Math.round(this.radius*(this.radiusScale&&(s.cam?s.cam.zoom:1)/s.scaleCanvas));if(n)if(this.onCanvas){void 0!==this.width&&void 0!==this.height||this.normalizeFullScreen(s);var r=Math.round(this.x),e=Math.round(this.y),o=Math.round(this.width),u=Math.round(this.height);this.imageData=i.getImageData(r,e,o,u),h.imageDataRGBA(this.imageData,0,0,o-r,u-e,n),i.putImageData(this.imageData,r,e,0,0,o,u)}else s.radius=n,t.prototype.draw.call(this,i,s)}else t.prototype.draw.call(this,i,s)},i}(R),StarField:function(t){function i(i){var s;return(s=t.call(this,i)||this).Wt=[],s.Rt=[],s.Xt=[],s.Yt=[],s._t=[],s.qt=[],s.Lt=[],s.Ut=[],s.Ht=[],s}d(i,t);var s=i.prototype;return s.Mt=function(){return Object.assign({},t.prototype.Mt.call(this),{count:40,moveX:0,moveY:0,moveZ:0,lineWidth:void 0,highScale:!0,color:"#FFF"})},s.init=function(t,i){function s(t,i,s){return void 0===s&&(s=-i),void 0===t||t<i||t>=s?Math.random()*(s-i)+i:t}this.width=this.width||i.width,this.height=this.height||i.height,this.x=void 0===this.x?i.x:this.x,this.y=void 0===this.y?i.y:this.y,this.lineWidth=this.lineWidth||Math.min(i.height/i.heightInPixel,i.width/i.widthInPixel)/2,this.Bt=this.width/2+this.x,this.Gt=this.height/2+this.y,this.Vt=Math.max(this.width,this.height)/2;for(var h=0;h<this.count;h++)this.Wt[h]=s(this.Wt[h],-this.width/2),this.Rt[h]=s(this.Rt[h],-this.height/2),this.Xt[h]=s(this.Xt[h],0,this.Vt)},s.moveStar=function(t,i,s){s&&(this.Ut[t]=!0);for(var h=this.width/2,n=this.height/2,r=this.Wt[t]+this.moveX*i,e=this.Rt[t]+this.moveY*i,o=this.Xt[t]+this.moveZ*i;r<-h;)r+=this.width,e=Math.random()*this.height-n,this.Ut[t]=!1;for(;r>h;)r-=this.width,e=Math.random()*this.height-n,this.Ut[t]=!1;for(;e<-n;)e+=this.height,r=Math.random()*this.width-h,this.Ut[t]=!1;for(;e>n;)e-=this.height,r=Math.random()*this.width-h,this.Ut[t]=!1;for(;o<=0;)o+=this.Vt,r=Math.random()*this.width-h,e=Math.random()*this.height-n,this.Ut[t]=!1;for(;o>this.Vt;)o-=this.Vt,r=Math.random()*this.width-h,e=Math.random()*this.height-n,this.Ut[t]=!1;var u=this.Bt+r/o*h,f=this.Gt+e/o*n;if(this.Ut[t]=this.Ut[t]&&u>=this.x&&f>=this.y&&u<this.x+this.width&&f<this.y+this.height,s)this.Wt[t]=r,this.Rt[t]=e,this.Xt[t]=o,this.qt[t]=u,this.Lt[t]=f;else{this.Yt[t]=u,this._t[t]=f;var c=4*(1-this.Xt[t]/this.Vt);this.highScale||(c=Math.ceil(c)),this.Ht[t]=c}},s.animate=function(i){var s=t.prototype.animate.call(this,i);if(this.enabled&&void 0!==this.Bt)for(var h=this.count;h--;)this.moveStar(h,i/16,!0),this.Ut[h]&&this.moveStar(h,-5,!1);return s},s.resize=function(t,i){this.pt=!0},s.detect=function(t,i,s){return this.bt(t,i,s,!1)},s.draw=function(t,i){if(this.enabled)if(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,0==this.moveY&&0==this.moveZ&&this.moveX<0){t.fillStyle=this.color;for(var s=this.count;s--;)this.Ut[s]&&t.fillRect(this.qt[s],this.Lt[s]-this.Ht[s]*this.lineWidth/2,this.Yt[s]-this.qt[s],this.Ht[s]*this.lineWidth)}else if(t.strokeStyle=this.color,this.highScale)for(var h=this.count;h--;)this.Ut[h]&&(t.beginPath(),t.lineWidth=this.Ht[h]*this.lineWidth,t.moveTo(this.Yt[h],this._t[h]),t.lineTo(this.qt[h],this.Lt[h]),t.stroke(),t.closePath());else for(var n,r=5;--r;){for(t.beginPath(),t.lineWidth=r*this.lineWidth,n=this.count;n--;)this.Ut[n]&&this.Ht[n]===r&&(t.moveTo(this.Yt[n],this._t[n]),t.lineTo(this.qt[n],this.Lt[n]));t.stroke(),t.closePath()}},i}(L)},H=function(){function t(t,i){this.callback=t,this.duration=P(r(i),void 0),this.initialized=!1}var i=t.prototype;return i.reset=function(){this.initialized=!1},i.run=function(t,i){var s;return void 0!==this.duration?(this.callback(t,Math.min(i,this.duration),!this.initialized),this.initialized=!0,i-this.duration):(s=this.callback(t,i,!this.initialized),this.initialized=!0,s)},t}();function B(t,i){return i.from+t*i.delta}function G(t,i){for(var s,h=[].concat(i.values),n=h.length;n>1;)for(n--,s=0;s<n;s++)h[s]=h[s]+t*(h[s+1]-h[s]);return h[0]}function V(t,i,s){return i.colorFrom.mix(i.colorTo,100*t).toString()}function Z(t,i,s){return s.changeToPath(t,i,s)}var $=function(){function t(t,i,s){for(var h in this.initialized=!1,this.changeValues=[],t)for(var n=t[h],e="rotationInDegree"===h?.017453292519943295*n:n,o="color"===h||"borderColor"===h,u="path"===h,f="function"==typeof e,c=!o&&Array.isArray(e),a=0,v="scale"===h?["scaleX","scaleY"]:"rotationInRadian"===h||"rotationInDegree"===h?["rotation"]:[h];a<v.length;a++)this.changeValues.push({name:v[a],to:c?e[e.length-1]:r(e,1,{}),bezier:!!c&&e,isColor:o,isPath:u,isFunction:!!f&&e,moveAlgorithm:o?V:u?Z:c?G:B});this.duration=P(r(i),0),this.ease=P(s,function(t){return t})}var s=t.prototype;return s.reset=function(){this.initialized=!1},s.init=function(t,s){for(var h,n=this.changeValues.length;n--;)if((h=this.changeValues[n]).isFunction)if(h.from=t[h.name],h.to=h.isFunction(h.from),h.isColor)h.colorFrom=new i.TinyColor(h.from),h.colorTo=new i.TinyColor(h.to),h.moveAlgorithm=V;else if(h.isPath){var r=t.changeToPathInit(h.from,h.to);h.pathFrom=r[0],h.pathTo=r[1],h.moveAlgorithm=Z}else Array.isArray(h.to)?(h.values=[t[h.name]].concat(h.to),h.moveAlgorithm=G):(h.delta=h.to-h.from,h.moveAlgorithm=B);else if(h.isColor)h.colorFrom=new i.TinyColor(t[h.name]),h.colorTo=new i.TinyColor(h.to);else if(h.isPath){var e=t.changeToPathInit(t[h.name],h.to);h.pathFrom=e[0],h.pathTo=e[1]}else h.bezier?h.values=[t[h.name]].concat(h.bezier):(h.from=t[h.name],h.delta=h.to-h.from)},s.run=function(t,i){if(this.initialized||(this.initialized=!0,this.init(t,i)),this.duration<=i)for(var s,h=this.changeValues.length;h--;)t[(s=this.changeValues[h]).name]=s.to;else for(var n,r=this.changeValues.length,e=this.ease(i/this.duration);r--;)t[(n=this.changeValues[r]).name]=n.moveAlgorithm(e,n,t);return i-this.duration},t}(),J=function(){function t(){}return t.prototype.run=function(t,i){return E.vt},t}(),K=function(){function t(){}return t.prototype.run=function(t,i){return t.enabled=!1,E.vt},t}(),Q=function(){function t(){var t=[].slice.call(arguments);this.Aniobject=t[0]instanceof E?t[0]:y(E,t)}var i=t.prototype;return i.reset=function(t){void 0===t&&(t=0),this.Aniobject.reset&&this.Aniobject.reset(t)},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.Aniobject.play&&this.Aniobject.play(t,i)},i.run=function(t,i,s){for(var h=i;h>=0;){if(h=this.Aniobject.run(t,h,s),s=!0,!0===h)return!0;h>=0&&this.Aniobject.reset&&this.Aniobject.reset()}return h},t}(),tt=function(){function t(t,i,s){this.ifCallback=t,this.Aniobject=i,this.AniobjectElse=P(s,function(){return 0})}return t.prototype.run=function(t,i){var s=r(this.ifCallback)?this.Aniobject:this.AniobjectElse;return s.run?s.run(t,i):s(t,i)},t}(),it=function(){function t(t,i){this.initialized=!1,this.image=r(t),this.durationBetweenFrames=P(r(i),0),Array.isArray(this.image)?this.count=this.image.length:(this.image=[this.image],this.count=1),this.duration=this.count*this.durationBetweenFrames}var i=t.prototype;return i.reset=function(){this.initialized=!1},i.run=function(t,i){if(this.initialized||(this.initialized=!0,this.current=-1),i>=this.duration)t.image=b.getImage(this.image[this.image.length-1]);else{var s=Math.floor(i/this.durationBetweenFrames);s!==this.current&&(this.current=s,t.image=b.getImage(this.image[this.current]))}return i-this.duration},t}(),st=function(){function t(t,i,s){this.initialized=!1,this.frameNumber=r(t),this.framesToRight=P(r(i),!0),this.durationBetweenFrames=P(r(s),0),Array.isArray(this.frameNumber)||(this.frameNumber=[this.frameNumber]),this.duration=this.frameNumber.length*this.durationBetweenFrames}return t.prototype.run=function(t,i){var s;return s=i>=this.duration?this.frameNumber[this.frameNumber.length-1]:this.frameNumber[Math.floor(i/this.durationBetweenFrames)],this.framesToRight?t.frameX=t.frameWidth*s:t.frameY=t.frameHeight*s,i-this.duration},t}(),ht=function(){function t(t){var i=[].slice.call(arguments,1);this.Aniobject=i[0]instanceof E?i[0]:y(E,i),this.times=this.timesOrg=P(r(t),1)}var i=t.prototype;return i.reset=function(t){void 0===t&&(t=0),this.times=this.timesOrg,this.Aniobject.reset&&this.Aniobject.reset(t)},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.times=this.timesOrg,this.Aniobject.play&&this.Aniobject.play(t,i)},i.run=function(t,i,s){for(var h=i;h>=0&&this.times>0;){if(h=this.Aniobject.run(t,h,s),s=!0,!0===h)return!0;h>=0&&(this.times--,this.Aniobject.reset&&this.Aniobject.reset())}return h},t}(),nt=function(t){function i(i,s,h,n){var e;return(e=t.call(this,{x:i,y:s},0,n)||this).speed=r(h)||1,e}return d(i,t),i.prototype.init=function(i,s){if(0==this.speed||this.targetX===i.x&&this.targetY===i.y)this.duration=0;else{var h=this.changeValues[0],n=this.changeValues[1];h.from=i.x,n.from=i.y,h.delta=h.to-h.from,n.delta=n.to-n.from;var r=Math.sqrt(h.delta*h.delta+n.delta*n.delta);this.duration=10*r/this.speed}t.prototype.init.call(this,i,s)},i}($),rt=function(){function t(){}return t.prototype.run=function(t,i){return E.lt},t}(),et=function(){function t(t,i){this.Aniobject=t,this.times=P(r(i),1)}return t.prototype.run=function(t,i){if(this.times<=0)return i;var s=this.Aniobject.run(t,i);return s>=0&&this.times--,s},t}(),ot=function(){function t(t,i){this.initialized=!1,this.duration=r(i),this.shakeDiff=r(t),this.shakeDiffHalf=this.shakeDiff/2}var i=t.prototype;return i.reset=function(){this.initialized=!1},i.run=function(t,i){return this.initialized||(this.initialized=!0,this.x=t.x,this.y=t.y),i>=this.duration?(t.x=this.x,t.y=this.y):(t.x=this.x+Math.random()*this.shakeDiff-this.shakeDiffHalf,t.y=this.y+Math.random()*this.shakeDiff-this.shakeDiffHalf),i-this.duration},t}(),ut=function(){function t(){this.showOnce=!0}return t.prototype.run=function(t,i){return t.enabled=t.enabled&&this.showOnce,this.showOnce=!1,0},t}(),ft=function(){function t(t){var i=this,s=void 0===t?{}:t,h=s.states,n=s.transitions,r=void 0===n?{}:n,e=s.default,o=void 0===e?void 0:e,u=s.delegateTo,f=void 0===u?void 0:u;this.states=void 0===h?{}:h,Object.keys(this.states).forEach(function(t){Array.isArray(i.states[t])&&(i.states[t]=new E(i.states[t]))}),this.transitions=r,this.delegateTo=f,this.currentStateName=o,this.currentState=this.states[o],this.isTransitioningToStateName=void 0}var i=t.prototype;return i.setState=function(t,i){var s=this;if(t!==this.currentStateName){this.isTransitioningToStateName=t;var h=""+t.charAt(0).toUpperCase()+t.slice(1),n=[this.currentStateName+"To"+h,this.currentStateName+"To","to"+h].find(function(t){return s.transitions[t]});n?(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.transitions[n],this.currentState&&this.currentState.reset&&this.currentState.reset()):(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.states[this.currentStateName],this.currentState&&this.currentState.reset&&this.currentState.reset(),this.isTransitioningToStateName=void 0)}},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.currentState.play&&this.currentState.play(t,i)},i.run=function(t,i,s){var h=i,n=s;if(this.currentState){if(!0===(h=this.currentState.run(t,h,n)))return!0;n=!0}if(h>=0||!this.currentState)if(this.isTransitioningToStateName){if(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.states[this.currentStateName],this.currentState&&this.currentState.reset&&this.currentState.reset(),this.isTransitioningToStateName=void 0,!0===(h=this.currentState.run(t,h,n)))return!0}else this.currentState=void 0;return-1},t}(),ct=function(){function t(){}return t.prototype.run=function(t,i){return E.dt},t}(),at=function(){function t(){}return t.prototype.run=function(t,i){return t.enabled=!1,E.dt},t}(),vt={Callback:H,ChangeTo:$,End:J,EndDisabled:K,Forever:Q,If:tt,Image:it,ImageFrame:st,Loop:ht,Move:nt,Once:et,Remove:rt,Sequence:E,Shake:ot,ShowOnce:ut,State:ft,Stop:ct,StopDisabled:at,Wait:D,WaitDisabled:function(){function t(t){this.duration=P(r(t),0)}return t.prototype.run=function(t,i){return t.enabled=i>=this.duration,i-this.duration},t}()},dt=function(){function t(t){void 0===t&&(t={}),this.type="camera",this.cam=Object.assign({zoom:1,x:0,y:0},t)}var i=t.prototype;return i.viewport=function(t,i){return M(t),i.scale(this.cam.zoom,this.cam.zoom).translate(-this.cam.x,-this.cam.y)},i.viewportByCam=function(t,i){var s=t.engine,h=s.getWidth()/2,n=s.getHeight()/2,r=s.getRatio()>1?h:n;return(new k).translate(h,n).scale(r,r).scale(i.zoom,i.zoom).translate(-i.x,-i.y)},i.additionalModifier=function(t,i){return M(t),i.cam=Object.assign({},this.cam),i},i.clampView=function(t,i){var s=t.engine,h=t.scene,n=t.clampLimits||{x1:h.additionalModifier.x,y1:h.additionalModifier.y,x2:h.additionalModifier.x+h.additionalModifier.width,y2:h.additionalModifier.y+h.additionalModifier.height},r=this.viewportByCam({engine:s},i).invert(),e=r.transformPoint(0,0),o=e[0],u=e[1],f=r.transformPoint(s.getWidth(),s.getHeight()),c=f[0],a=f[1];return c-o<=n.x2-n.x1?o<n.x1?c<=n.x2&&(i.x+=n.x1-o):c>n.x2&&(i.x+=n.x2-c):o>n.x1?i.x+=n.x1-o:c<n.x2&&(i.x+=n.x2-c),a-u<=n.y2-n.y1?u<n.y1?a<=n.y2&&(i.y+=n.y1-u):a>n.y2&&(i.y+=n.y2-a):u>n.y1?i.y+=n.y1-u:a<n.y2&&(i.y+=n.y2-a),i},i.zoomToFullScreen=function(t){var i=t.scene;return Math.min(i.additionalModifier.fullScreen.width/i.additionalModifier.width,i.additionalModifier.fullScreen.height/i.additionalModifier.height)},i.zoomTo=function(t){var i=t.engine,s=t.cam,h=t.x1,n=t.y1,r=t.x2,e=t.y2,o=t.scene.additionalModifier.scaleCanvas,u=this.viewportByCam({engine:i},s||this.cam).invert(),f=u.transformPoint(0,0),c=f[0],a=f[1],v=u.transformPoint(i.getWidth()*o,i.getHeight()*o),d=r-h,l=e-n,m={x:h+d/2,y:n+l/2,zoom:s.zoom*Math.max(Math.min((v[0]-c)/d,(v[1]-a)/l),Number.MIN_VALUE)};s?(s.x=m.x,s.y=m.y,s.zoom=m.zoom):this.cam=m},v(t,[{key:"zoom",set:function(t){this.cam.zoom=t},get:function(){return this.cam.zoom}},{key:"camX",set:function(t){this.cam.x=t},get:function(){return this.cam.x}},{key:"camY",set:function(t){this.cam.y=t},get:function(){return this.cam.y}}]),t}(),lt=function(){function t(t){void 0===t&&(t={}),this.type="control",this.Zt={},this.toCam={},this.config=Object.assign({zoomMax:10,zoomMin:.5,zoomFactor:1.2,tween:2,callResize:!0},t)}var i=t.prototype;return i.init=function(t){var i=t.scene;this.h=i,this.toCam=Object.assign({},i.camera.cam)},i.mouseDown=function(t){var i=t.event,s=t.position,h=t.button;this.Zt[h]=Object.assign({},this.Zt[h],{x:s[0],y:s[1],$t:this.toCam.x,Jt:this.toCam.y,Kt:!0,Qt:i.touches&&i.touches.length||1,ti:void 0,ii:Date.now()})},i.mouseUp=function(t){var i=t.event,s=t.position,h=s[0],n=s[1],r=t.button,e=t.scene;this.Zt[r]||(this.Zt[r]={});var o=this.Zt[r].Kt,u=i.changedTouches&&i.changedTouches.length||1,f=Math.max(this.Zt[r].Qt,u);this.Zt[r].Kt=!1,this.Zt[r].Qt-=u,!o||f>1?e.stopPropagation():Date.now()-this.Zt[r].ii<300&&Math.abs(this.Zt[r].x-h)<5&&Math.abs(this.Zt[r].y-n)<5&&1===r||e.stopPropagation()},i.mouseOut=function(t){var i=t.button;this.Zt[i]&&(this.Zt[i].Kt=!1)},i.mouseMove=function(t){var i=t.event,s=t.position,h=s[0],n=s[1],r=t.button,e=t.scene;if(this.Zt[r]&&this.Zt[r].Kt&&(0!==i.which||i.touches)){var o=e.additionalModifier.scaleCanvas;if(i.touches&&i.touches.length>=2){var u=i.touches,f=Math.sqrt((u[0].pageX-u[1].pageX)*(u[0].pageX-u[1].pageX)+(u[0].pageY-u[1].pageY)*(u[0].pageY-u[1].pageY));void 0===this.Zt[r].ti?f>0&&(this.Zt[r].ti=f,this.Zt[r].si=this.toCam.zoom):(this.toCam.zoom=Math.max(this.config.zoomMin,Math.min(this.config.zoomMax,this.Zt[r].si*f/this.Zt[r].ti)),this.toCam=e.camera.clampView(arguments[0],this.toCam))}else{this.Zt[r].ti=void 0;var c=e.camera.viewportByCam(arguments[0],this.toCam).invert(),a=c.transformPoint(this.Zt[r].x*o,this.Zt[r].y*o),v=a[0],d=a[1],l=c.transformPoint(h*o,n*o),m=l[0],y=l[1];this.toCam.x=this.Zt[r].$t+v-m,this.toCam.y=this.Zt[r].Jt+d-y,this.toCam=e.camera.clampView(arguments[0],this.toCam)}}},i.mouseWheel=function(t){var i=t.event,s=t.position,h=s[0],n=s[1],r=t.scene,e=r.additionalModifier.scaleCanvas,o=r.camera.viewportByCam(arguments[0],this.toCam).invert().transformPoint(h*e,n*e),u=o[0],f=o[1],c=i.wheelDelta||-1*i.deltaY;if(c/120>0){this.zoomIn();var a=r.camera.viewportByCam(arguments[0],this.toCam).invert().transformPoint(h*e,n*e),v=a[0],d=a[1];this.toCam.x-=v-u,this.toCam.y-=d-f,this.toCam=r.camera.clampView(arguments[0],this.toCam)}else this.zoomOut(arguments[0])},i.hasCamChanged=function(){var t=this.config.tween||1;return Math.abs(this.toCam.x-this.h.camera.cam.x)>=Number.EPSILON*t||Math.abs(this.toCam.y-this.h.camera.cam.y)>=Number.EPSILON*t||Math.abs(this.toCam.zoom-this.h.camera.cam.zoom)>=Number.EPSILON*t},i.fixedUpdate=function(t){var i=t.scene,s=t.lastCall;this.config.tween&&!this.hi&&this.hasCamChanged()&&(i.camera.cam.x+=(this.toCam.x-i.camera.cam.x)/this.config.tween,i.camera.cam.y+=(this.toCam.y-i.camera.cam.y)/this.config.tween,i.camera.cam.zoom+=(this.toCam.zoom-i.camera.cam.zoom)/this.config.tween,s&&(i.additionalModifier.cam=this.cam,this.config.callResize?i.resize():i.cacheClear()))},i.update=function(t){var i=t.scene;this.config.tween&&!this.hi||!this.hasCamChanged()||(this.hi=!1,i.camera.cam=Object.assign({},this.toCam),this.config.callResize?i.resize():i.cacheClear())},i.camInstant=function(){this.hi=!0},i.resize=function(t){this.toCam=t.scene.camera.clampView(t,this.toCam)},i.zoomToNorm=function(){return this.toCam.zoom=1,this},i.zoomIn=function(){return this.toCam.zoom=Math.min(this.config.zoomMax,this.toCam.zoom*this.config.zoomFactor),this},i.zoomOut=function(t){return this.toCam.zoom=Math.max(this.config.zoomMin,this.toCam.zoom/this.config.zoomFactor),t&&(this.toCam=this.h.camera.clampView(t,this.toCam)),this},i.zoomTo=function(t){t.cam=this.toCam,t.scene.camera.zoomTo(t)},t}(),mt={Callback:dt,Camera:dt,CameraControl:lt,CameraControlSecondButton:function(t){function i(){return t.apply(this,arguments)||this}d(i,t);var s=i.prototype;return s.mouseUp=function(t){var i=t.event,s=t.position,h=s[0],n=s[1],r=t.button,e=t.scene;this.Zt[r]||(this.Zt[r]={});var o=this.Zt[r].Kt,u=i.changedTouches&&i.changedTouches.length||1,f=Math.max(this.Zt[r].Qt,u);if(this.Zt[r].Kt=!1,this.Zt[r].Qt-=u,!o||f>1)e.stopPropagation();else if((Date.now()-this.Zt[r].ii>300||Math.abs(this.Zt[r].x-h)>=5||Math.abs(this.Zt[r].y-n)>=5)&&1===r){e.stopPropagation();var c=e.transformPoint(h,n),a=c[0],v=c[1],d=e.transformPoint(this.Zt[r].x,this.Zt[r].y),l=d[0],m=d[1];e.map("region",{event:i,x1:Math.min(l,a),y1:Math.min(m,v),x2:Math.max(l,a),y2:Math.max(m,v),fromX:l,fromY:m,toX:a,toY:v})}},s.mouseMove=function(t){var i=t.event,s=t.position,h=s[0],n=s[1],r=t.button,e=t.scene;if(this.Zt[r]&&this.Zt[r].Kt&&(0!==i.which||i.touches)){var o=e.additionalModifier.scaleCanvas;if(i.touches&&i.touches.length>=2){var u=i.touches,f=Math.sqrt((u[0].pageX-u[1].pageX)*(u[0].pageX-u[1].pageX)+(u[0].pageY-u[1].pageY)*(u[0].pageY-u[1].pageY));if(void 0===this.Zt[r].ti)f>0&&(this.Zt[r].ti=f,this.Zt[r].si=this.toCam.zoom);else{this.toCam.zoom=Math.max(this.config.zoomMin,Math.min(this.config.zoomMax,this.Zt[r].si*f/this.Zt[r].ti));var c=e.camera.viewportByCam(arguments[0],this.toCam).invert(),a=c.transformPoint(this.Zt[r].x*o,this.Zt[r].y*o),v=a[0],d=a[1],l=c.transformPoint(h*o,n*o),m=l[0],y=l[1];this.toCam.x=this.Zt[r].$t+v-m,this.toCam.y=this.Zt[r].Jt+d-y,this.toCam=e.camera.clampView(arguments[0],this.toCam)}}else{if(this.Zt[r].ti=void 0,2===r){var M=e.camera.viewportByCam(arguments[0],this.toCam).invert(),p=M.transformPoint(this.Zt[r].x*o,this.Zt[r].y*o),w=p[0],b=p[1],g=M.transformPoint(h*o,n*o),x=g[0],k=g[1];this.toCam.x=this.Zt[r].$t+w-x,this.toCam.y=this.Zt[r].Jt+b-k,this.toCam=e.camera.clampView(arguments[0],this.toCam)}if(1===r&&e.has("regionMove")&&!(Date.now()-this.Zt[r].ii<300&&Math.abs(this.Zt[r].x-h)<5&&Math.abs(this.Zt[r].y-n)<5)&&(!i.touches||1===i.touches.length)){var P=e.transformPoint(h,n),j=P[0],O=P[1],C=e.transformPoint(this.Zt[r].x,this.Zt[r].y),A=C[0],S=C[1];e.map("regionMove",{event:i,x1:Math.min(A,j),y1:Math.min(S,O),x2:Math.max(A,j),y2:Math.max(S,O),fromX:A,fromY:S,toX:j,toY:O})}}}},i}(lt),Click:function(){function t(t){var i=(void 0===t?{}:t).doubleClickDetectInterval;this.ni=void 0===i?350:i}return t.prototype.mouseUp=function(t){var i=this,s=t.scene;1===t.button&&(s.has("doubleClick")?this.ri?(clearTimeout(this.ri),this.ri=0,s.map("doubleClick",t)):this.ri=setTimeout(function(){i.ri=0,s.map("click",t)},this.ni):s.map("click",t))},t}(),Element:function(){function t(t){var i=(void 0===t?{}:t).doubleClickDetectInterval;this.ni=void 0===i?350:i}var i=t.prototype;return i.isDrawFrame=function(){return this.ei?1:0},i.oi=function(t,i,s){var h=this;i?t.has("doubleClickElement")?this.ri?(clearTimeout(this.ri),this.ri=0,t.map("doubleClickElement",s)):this.ri=setTimeout(function(){h.ri=0,t.map("clickElement",s)},this.ni):t.map("clickElement",s):t.map("hoverElement",s)},i.ui=function(t,i,s){var h=this;i?t.has("doubleClickNonElement")?this.ri?(clearTimeout(this.ri),this.ri=void 0,t.map("doubleClickNonElement",s)):this.ri=setTimeout(function(){h.ri=void 0,t.map("clickNonElement",s)},this.ni):t.map("clickNonElement",s):t.map("hoverNonElement",s)},i.initSprites=function(t){var i=t.scene,s=t.output,h=t.layerManager,n=t.canvasId;if(this.ei=!1,this.fi||this.ci){var r=!!this.fi,e=this.fi||this.ci,o=e.mx,u=e.my,f=i.additionalModifier.scaleCanvas,c=s.context[n],a=Math.round(o/f),v=Math.round(u/f),d=i.transformPoint(o,u),l=d[0],m=d[1];c.save(),c.setTransform.apply(c,i.viewport().m);var y=0;if(h.forEach(function(t){var i=t.layerId,s=t.elementId;if(!t.isFunction){var h=t.element.detect(c,a,v);if("c"===h)y="c";else if(h)return y={layerId:i,element:h,elementId:s},!1}}),c.restore(),"c"===y)this.ei=!0;else{this.fi=!1,this.ci=!1;var M={mx:o,my:u,x:l,y:m};y?(Object.assign(M,y),this.oi(i,r,M)):this.ui(i,r,M)}}},i.draw=function(t){var i=t.engine,s=t.scene,h=t.layerManager,n=t.canvasId;if(!n&&this.ei){var r=!!this.fi,e=this.fi||this.ci,o=e.mx,u=e.my,f=s.additionalModifier.scaleCanvas,c=t.output.context[n],a=Math.round(o/f),v=Math.round(u/f),d=s.transformPoint(o,u),l={mx:o,my:u,x:d[0],y:d[1]},m=c.imageSmoothingEnabled;c.imageSmoothingEnabled=!1,c.clearRect(0,0,c.canvas.width,c.canvas.height),c.save(),c.setTransform.apply(c,s.viewport().m),h.forEach(function(t){var i=t.elementId;t.isFunction||t.element.detectDraw(c,"rgb("+(255&i)+", "+((65280&i)>>8)+", "+(255&t.layerId)+")")},0),c.restore(),c.imageSmoothingEnabled=m,i.normContext(c),this.fi=!1,this.ci=!1;var y=c.getImageData(a,v,1,1).data;y[3]?(l.layerId=y[2],l.elementId=y[0]+(y[1]<<8),l.element=h.getById(l.layerId).getById(l.elementId),this.oi(s,r,l)):this.ui(s,r,l)}},i.mouseUp=function(t){var i=t.position,s=i[0],h=i[1];this.fi=1===t.button&&t.scene.has("clickElement")&&{mx:s,my:h}},i.mouseMove=function(t){var i=t.position,s=i[0],h=i[1];this.ci=t.scene.has("hoverElement")&&{mx:s,my:h}},t}(),Event:function(){function t(){this.type="events"}var i=t.prototype;return i.ai=function(t,i,s){P(s.value("preventDefault"),!0)&&i.preventDefault();var h=this.getMousePosition({event:i}),n=h[0],r=h[1],e=s.transformPoint(n,r);s.pipeBack(t,{event:i,position:[n,r],x:e[0],y:e[1],button:this.getMouseButton({event:i})})},i.init=function(t){var i=this,s=t.scene,h=t.output.canvas[0],n=s.map("events");n.push([s.has("mouseDown")&&[["touchstart","mousedown"],function(t){return i.ai("mouseDown",t,s)}],s.has("mouseUp")&&[["touchend","mouseup"],function(t){return i.ai("mouseUp",t,s)}],s.has("mouseOut")&&[["touchendoutside","mouseout"],function(t){return i.ai("mouseOut",t,s)}],s.has("mouseMove")&&[["touchmove","mousemove"],function(t){return i.ai("mouseMove",t,s)}],s.has("mouseWheel")&&[["wheel"],function(t){return i.ai("mouseWheel",t,s)}],P(s.value("preventDefault"),!0)&&[["contextmenu"],function(t){return t.preventDefault()}]].filter(function(t){return t})),this.i=n.filter(Array.isArray).reduce(function(t,i){return t.push.apply(t,i),t},[]).map(function(t){var i=t[1];return t[0].map(function(t){return{n:h,e:t,f:i}})}).reduce(function(t,i){return Array.isArray(i)?t.push.apply(t,i):t.push(i),t},[]),this.i.forEach(function(t){t.n.addEventListener(t.e,t.f,!0)})},i.destroy=function(){this.i.forEach(function(t){t.n.removeEventListener(t.e,t.f,!0)}),this.i=[]},i.getMousePosition=function(t){var i,s=t.event;if(s.touches&&s.touches.length>0?i=s.targetTouches:s.changedTouches&&s.changedTouches.length>0&&(i=s.changedTouches),i){var h=s.target.getBoundingClientRect(),n=i.length;return[(i=Array.from(i)).reduce(function(t,i){return t+i.pageX},0)/n-h.left,i.reduce(function(t,i){return t+i.pageY},0)/n-h.top]}if(void 0===s.offsetX){var r=s.target.getBoundingClientRect();return[s.clientX-r.left,s.clientY-r.top]}return[s.offsetX,s.offsetY]},i.getMouseButton=function(t){var i=t.event;return i.touches?i.touches.length||i.changedTouches.length:P(i.buttons?i.buttons:[0,1,4,2][i.which],1)},t}(),LoadingScreen:function(){function t(){}return t.prototype.loading=function(t){var i=t.output,s=t.progress,h=i.context[0],n="number"==typeof s?Math.max(1,s*i.height):i.height;h.globalCompositeOperation="source-over",h.globalAlpha=1,h.clearRect(0,0,i.width,i.height),h.fillStyle="#aaa",h.fillRect(0,i.height/2-n/2,i.width,n),h.font="20px Georgia",h.fillStyle="#fff",h.textAlign="left",h.textBaseline="bottom",h.fillText(isNaN(parseFloat(s))?s:"Loading "+Math.round(100*s)+"%",10+3*Math.random(),i.height-10+3*Math.random())},t}(),Norm:function(){function t(){}var i=t.prototype;return i.viewport=function(t,i){var s=t.engine,h=s.getWidth()/2,n=s.getHeight()/2,r=s.getRatio()>1?h:n;return i.translate(h,n).scale(r,r)},i.additionalModifier=function(t){var i=t.engine,s=t.output,h=t.scene;h.cacheClear();var n={alpha:1,x:-1,y:-1,width:2,height:2,widthInPixel:s.width,heightInPixel:s.height,scaleCanvas:s.width/s.canvas[0].clientWidth},r=h.transformPoint(0,0,1),e=r[0],o=r[1],u=h.transformPoint(s.width,s.height,1);n.visibleScreen={x:e,y:o,width:u[0]-e,height:u[1]-o};var f=i.getWidth()/2,c=i.getHeight()/2,a=i.getRatio()>1?f:c,v=(new k).translate(f,c).scale(a,a).invert(),d=v.transformPoint(0,0,1),l=d[0],m=d[1],y=v.transformPoint(s.width,s.height,1);return n.fullScreen={x:l,y:m,width:y[0]-l,height:y[1]-m},n},t}(),TimingAudio:function(t){function i(i){var s;return void 0===i&&(i={}),(s=t.call(this,i)||this).V=Number.POSITIVE_INFINITY,s.vi=null,s.di=null,s.li=!1,s.mi=s.B.audioElement,s}d(i,t);var s=i.prototype;return s.init=function(){var t=this;if(this.mi)return"function"==typeof MediaController&&(this.mi.controller=new MediaController,this.li=!0),this.mi.preload="auto",new Promise(function(i){t.mi.addEventListener("canplaythrough",function s(){t.mi.removeEventListener("canplaythrough",s);var h=t.mi.play();h&&h.catch(function(t){}),i()}),t.mi.load()})},s.endTime=function(){return 1e3*this.mi.duration},s.currentTime=function(){var i=t.prototype.currentTime.call(this);if(this.mi){var s=1e3*(this.mi.ended?this.mi.duration:this.mi.currentTime);if(this.li){if(null===this.vi)return this.vi=i,this.di=s,s;if("playing"===this.mi.controller.playbackState){if(s===this.di)return this.di+Math.min(260,i-this.vi);if(s-this.di<500&&s>this.di&&i-this.vi<350)return this.vi=this.vi+(s-this.di),this.di=s,this.di+i-this.vi}return this.vi=i,this.di=s,this.di}return s}return i},s.clampTime=function(t){return t.timePassed},s.shiftTime=function(){return 0},v(i,[{key:"audioElement",get:function(){return this.mi}}]),i}(j),TimingDefault:j};exports.Easing=n,exports.Animations=vt,exports.Engine=u,exports.ImageManager=b,exports.Middleware=mt,exports.Scene=T,exports.Sprites=U;
//# sourceMappingURL=animationvideo.js.map
