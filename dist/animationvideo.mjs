import t from"@ctrl/tinycolor";import i from"pasition";import*as s from"stackblur-canvas";import h from"stackblur-canvas";export{default as Easing}from"eases";const n=function(){function t(){}return t.prototype.then=function(i,s){const h=new t,n=this.s;if(n){const t=1&n?i:s;if(t){try{r(h,1,t(this.v))}catch(t){r(h,2,t)}return h}return this}return this.o=function(t){try{const n=t.v;1&t.s?r(h,1,i?i(n):n):s?r(h,1,s(n)):r(h,2,n)}catch(t){r(h,2,t)}},h},t}();function r(t,i,s){if(!t.s){if(s instanceof n){if(!s.s)return void(s.o=r.bind(null,t,i));1&i&&(i=s.s),s=s.v}if(s&&s.then)return void s.then(r.bind(null,t,i),r.bind(null,t,2));t.s=i,t.v=s;const h=t.o;h&&h(t)}}function e(t){return t instanceof n&&1&t.s}function o(t){for(var i=arguments.length,s=new Array(i>1?i-1:0),h=1;h<i;h++)s[h-1]=arguments[h];return"function"==typeof t?t.apply(null,s):t}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var u=function(){function t(t){var i=this,s=t;if("object"!=typeof t)throw new Error("No canvas given for Engine constructor");if(t.getContext)s={canvas:t};else if(!t.canvas)throw new Error("No canvas given for Engine constructor");var h=Object.assign({},s);if(this.t={canvas:[],context:[],width:0,height:0,ratio:1},this.i=[],this.h=null,this.u=!1,this.l=0,this.M=!1,this.p=null,this.t.canvas=Array.isArray(h.canvas)?h.canvas:[h.canvas],h.autoSize){var n={enabled:!0,scaleLimitMin:1,scaleLimitMax:2.5,scaleFactor:1.07,referenceWidth:function(){return i.t.canvas[0].clientWidth},referenceHeight:function(){return i.t.canvas[0].clientHeight},currentScale:1,waitTime:100,currentWaitedTime:0,currentOffsetTime:0,offsetTimeLimitUp:300,offsetTimeLimitDown:300,registerResizeEvents:!0,registerVisibilityEvents:!0,setCanvasStyle:!1};this.P="object"==typeof h.autoSize?Object.assign({},n,h.autoSize):n,this.P.registerResizeEvents&&(this.i=["resize","orientationchange"].map(function(t){return{n:window,e:t,f:i.recalculateCanvas.bind(i)}})),this.P.registerVisibilityEvents&&this.i.push({n:document,e:"visibilitychange",f:this.handleVisibilityChange.bind(this)}),this.A()}else this.t.width=this.t.canvas[0].width,this.t.height=this.t.canvas[0].height,this.t.ratio=this.t.width/this.t.height;this.t.canvas.forEach(function(t,s){i.t.context[s]=t.getContext("2d")}),this.k=this.t.canvas.length,this.S=Array.from({length:this.k},function(t){return 0}),h.clickToPlayAudio&&this.i.push({n:this.t.canvas[0],e:"click",f:this.playAudioOfScene.bind(this)}),this.j=h.reduceFramerate,this.i.forEach(function(t){t.n.addEventListener(t.e,t.f)}),this.switchScene(h.scene,h.sceneParameter||{})}var i=t.prototype;return i.handleVisibilityChange=function(){this.P.enabled=!("hidden"==document.visibilityState)},i.playAudioOfScene=function(){this.u&&this.h&&this.h.timing.audioElement&&this.h.timing.audioElement.play()},i.O=function(t){t.textBaseline="middle",t.textAlign="center",t.globalAlpha=1,t.globalCompositeOperation="source-over"},i.getWidth=function(){return this.t.width},i.getHeight=function(){return this.t.height},i.getRatio=function(){return this.t.ratio},i.getOutput=function(){return this.t},i.recalculateCanvas=function(){return this.M=!0,this},i.A=function(){var t=this;if(this.P){var i=o(this.P.referenceWidth),s=o(this.P.referenceHeight);if(i<=0||s<=0)return;this.t.canvas.forEach(function(h){h.width=Math.round(i/t.P.currentScale),h.height=Math.round(s/t.P.currentScale),t.P.setCanvasStyle&&(h.style.width=i+"px",h.style.height=s+"px")}),this.P.currentWaitedTime=0,this.P.currentOffsetTime=0}this.t.width=this.t.canvas[0].width,this.t.height=this.t.canvas[0].height,this.t.ratio=this.t.width/this.t.height,this.resize()},i.recalculateFPS=function(){try{var t=this;return t.p&&(window.cancelAnimationFrame(t.p),t.p=!1),Promise.resolve(new Promise(function(t){return requestAnimationFrame(t)})).then(function(){function i(){var i=(t.D()-s)/h;t.P.offsetTimeTarget=i,t.P.offsetTimeDelta=i/3,!1===t.p&&(t.I=!1,t.p=window.requestAnimationFrame(t.C.bind(t)))}var s=t.D(),h=3,o=h,u=function(t,i,s){for(var h;;){var o=t();if(e(o)&&(o=o.v),!o)return u;if(o.then){h=0;break}var u=s();if(u&&u.then){if(!e(u)){h=1;break}u=u.s}}var f=new n,a=r.bind(null,f,2);return(0===h?o.then(v):1===h?u.then(c):(void 0).then(function(){(o=t())?o.then?o.then(v).then(void 0,a):v(o):r(f,1,u)})).then(void 0,a),f;function c(i){u=i;do{if(!(o=t())||e(o)&&!o.v)return void r(f,1,u);if(o.then)return void o.then(v).then(void 0,a);e(u=s())&&(u=u.v)}while(!u||!u.then);u.then(c).then(void 0,a)}function v(t){t?(u=s())&&u.then?u.then(c).then(void 0,a):c(u):r(f,1,u)}}(function(){return o--},0,function(){return Promise.resolve(new Promise(function(t){return requestAnimationFrame(t)})).then(function(){})});return u&&u.then?u.then(i):i()})}catch(t){return Promise.reject(t)}},i.resize=function(){return this.h&&this.h.resize&&this.h.resize(this.t),this},i.switchScene=function(t,i){return t&&(this.T=t,this.F=i),this},i.D=function(){return window.performance?performance.now():Date.now()},i.C=function(t){var i=this;if(this.p){this.p=window.requestAnimationFrame(this.C.bind(this));var s=this.M&&(!this.j||!this._);s&&(this.A(),this.M=!1);for(var h=0;h<this.k;h++)this.S[h]=Math.max(this.S[h]-1,s?1:0);if(this.I||(this.I=t),this.N||(this.N=t),this.T&&!this.R&&(this.R=Promise.resolve(this.h?this.h.destroy(this.t):{}),this.R.then(function(s){i.T.callInit(i.t,{run:i.W,scene:i.F,destroy:s},i),i.h=i.T,i.T=void 0,i.R=void 0,i.u=!1,i.l=i.h.currentTime(),i.N=t})),this.h&&(this.j&&(this._=!this._),!this.j||this._)){var n=this.h.currentTime(),r=this.h.clampTime(n-this.l),e=this.h.shiftTime(r);if(r+=e,this.l=n+e,this.u){var o=0!==r||this.X;this.X=!1;var u=this.D();if(this.t.canvas[0].width)for(var f=0;f<this.k;f++)this.O(this.t.context[f]),this.h.init(this.t,f),this.h.detect(this.t,f);var a=this.h.isDrawFrame(this.t,r),c=this.h.hasDetectImage();if(Array.isArray(a))for(var v=0;v<this.k;v++)this.S[v]=Math.max(this.S[v],a[v],c);else for(var l=0;l<this.k;l++)this.S[l]=Math.max(this.S[l],a,c);if(o&&this.h.move(this.t,r),this.t.canvas[0].width)for(var d=0;d<this.k;d++)this.S[d]&&(this.h.detectImage(this.t,d),this.h.draw(this.t,d));if(this.P&&this.P.enabled){var m=t-this.I;if(this.P.currentWaitedTime<this.P.waitTime)this.P.currentWaitedTime+=m;else if(o){var y=this.P.offsetTimeTarget*(this.j?2:1),g=this.D()-u,M=(Math.abs(m-y)>Math.abs(g-y)?m:g)-y;Math.abs(M)<=this.P.offsetTimeDelta?this.P.currentOffsetTime=this.P.currentOffsetTime>=0?Math.max(0,this.P.currentOffsetTime-this.P.offsetTimeDelta):Math.min(0,this.P.currentOffsetTime+this.P.offsetTimeDelta):M<0&&this.P.currentScale>this.P.scaleLimitMin?(this.P.currentOffsetTime+=M,this.P.currentOffsetTime<=-this.P.offsetTimeLimitDown&&(this.P.currentScale=Math.max(this.P.scaleLimitMin,this.P.currentScale/this.P.scaleFactor),this.M=!0)):M>0&&this.P.currentScale<this.P.scaleLimitMax&&(this.P.currentOffsetTime+=M,this.P.currentOffsetTime>=this.P.offsetTimeLimitUp&&(this.P.currentScale=Math.min(this.P.scaleLimitMax,this.P.currentScale*this.P.scaleFactor),this.M=!0))}}}else{for(var b=0;b<this.k;b++)this.O(this.t.context[b]);this.u=this.h.callLoading({output:this.t,timePassed:t-this.I,totalTimePassed:t-this.N}),this.u&&(this.h.reset(),this.l=this.h.currentTime(),this.X=!0,this.P&&(this.P.currentWaitedTime=0))}}this.I=t}},i.run=function(t){try{var i=this;return i.W=t||{},Promise.resolve(i.stop()).then(function(){function t(){return i.p=window.requestAnimationFrame(i.C.bind(i)),i}i.I=i.N=!1;var s=function(){if(i.P&&!i.P.offsetTimeTarget)return Promise.resolve(i.recalculateFPS()).then(function(){})}();return s&&s.then?s.then(t):t()})}catch(t){return Promise.reject(t)}},i.stop=function(){try{return window.cancelAnimationFrame(this.p),this.p=null,Promise.resolve(this.h?Promise.resolve(this.h.destroy(this.t)).then(function(t){}):void 0)}catch(t){return Promise.reject(t)}},i.destroy=function(){try{var t=this;return Promise.resolve(t.stop()).then(function(){return t.i.forEach(function(t){t.n.removeEventListener(t.e,t.f)}),t.i=[],t})}catch(t){return Promise.reject(t)}},t}();function f(t,i){for(var s=0;s<i.length;s++){var h=i[s];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}function a(t,i,s){return i&&f(t.prototype,i),s&&f(t,s),t}function c(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i}function v(t,i){return(v=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function d(t,i,s){return(d=l()?Reflect.construct:function(t,i,s){var h=[null];h.push.apply(h,i);var n=new(Function.bind.apply(t,h));return s&&v(n,s.prototype),n}).apply(null,arguments)}var m=function(){function t(){this.Images={},this.count=0,this.loaded=0}return t.add=function(i,s){var h=this||t,n=function(t){if(h.Images[t])s&&"function"==typeof s[t]&&s[t](t,h.Images[t]);else{if(h.Images[t]=new window.Image,h.Images[t].onload=function(){h.loaded++,s&&"function"==typeof s?h.isLoaded()&&s():s&&"function"==typeof s[t]&&s[t](t,h.Images[t]),h.resolve&&h.isLoaded()&&(h.resolve(),h.resolve=null)},"<svg"===i[t].substr(0,4)){var n=window.URL||window.webkitURL||window,r=new window.Blob([i[t]],{type:"image/svg+xml"});h.Images[t].src=n.createObjectURL(r)}else/^(https?:)?\/\//.test(i[t])&&(h.Images[t].onerror=function(){var s=new window.Image;s.onload=h.Images[t].onload,h.Images[t]=s,h.Images[t].src=i[t]},h.Images[t].crossOrigin="anonymous"),h.Images[t].src=i[t];h.count++}};for(var r in i)n(r);return s&&"function"==typeof s&&h.isLoaded()&&s(),h.resolve&&h.isLoaded()&&(h.resolve(),h.resolve=null),h},t.reset=function(){var i=this||t;return i.Images={},i.count=0,i.loaded=0,i},t.getLoaded=function(){return(this||t).loaded},t.getCount=function(){return(this||t).count},t.isLoaded=function(){var i=this||t;return i.loaded===i.count},t.getImage=function(i){return"object"==typeof i?i:(this||t).Images[i]},t.isLoadedPromise=function(){var i=this||t;return!!i.isLoaded()||new Promise(function(t,s){i.resolve=t})},t}();m.Images={},m.count=0,m.loaded=0;var y=function(){function t(t){this.Y=[],this.L=[],this.q=0,this.H=0,this.B=void 0===t?[]:Array.isArray(t)?t:[t]}var i=t.prototype;return i.addElement=function(t){return this.addElementForId(t),t},i.addElements=function(t){return this.addElementsForIds(t),t},i.addElementForId=function(t){var i=this.Y.length,s=this.H;this.Y[s]=t,this.L[s]="function"==typeof t,i===s&&i++;for(var h=this.H+1;h!==i&&this.Y[h];)h++;return this.H=h,this.q>s&&(this.q=s),s},i.addElementsForIds=function(t){var i=this,s=this.Y.length;return s===this.H?(this.Y=this.Y.concat(t),this.H=this.Y.length,t.forEach(function(t,h){i.L[s+h]="function"==typeof t}),Array.from({length:t.length},function(t,i){return i+s})):t.map(function(t){return i.addElement(t)})},i.getById=function(t){return this.Y[t]},i.getIdByElement=function(t){return this.Y.indexOf(t)},i.deleteByElement=function(t){var i=this.getIdByElement(t);i>=0&&this.deleteById(i)},i.deleteById=function(t){var i=this.Y.length-1;if(i>0&&t===i){for(this.Y[t]=null;i&&!this.Y[i-1];)i--;this.Y.length=i,this.L.length=i,this.H=Math.min(this.H,i),this.q=Math.min(this.q,i)}else this.Y[t]&&(this.Y[t]=null,this.H=Math.min(this.H,t),this.q===t&&(this.q=t+1))},i.isCanvasId=function(t){return void 0===t||!this.B.length||this.B.includes(t)},i.forEach=function(t,i){var s,h;void 0===i&&(i=0);var n=this.Y.length;for(s=this.q;s<n;s++)if((h=this.Y[s])&&!1===t({elementId:s,layerId:i,element:h,isFunction:this.L[s],layer:this}))return},i.getElementsByTag=function(t){var i=[];return this.forEach(function(s){if(!s.isFunction){var h=s.element.getElementsByTag(t);h&&(i=i.concat(h))}}),i},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.forEach(function(s){return!s.isFunction&&s.element.play(t,i)})},i.count=function(){for(var t=0,i=this.Y.length,s=this.q;s<i;s++)this.Y[s]&&t++;return t},i.clear=function(){this.Y=[],this.L=[],this.q=0,this.H=0},t}(),g=function(){function t(){this.G=[]}var i=t.prototype;return i.addLayer=function(t){return this.G[this.G.length]=new y(t),this.G[this.G.length-1]},i.addLayers=function(t,i){void 0===t&&(t=1);var s=Array.from({length:t},function(t){return new y(i)});return this.G=this.G.concat(s),s},i.addLayerForId=function(t){return this.G[this.G.length]=new y(t),this.G.length-1},i.addLayersForIds=function(t,i){var s=this;void 0===t&&(t=1);var h=Array.from({length:t},function(t,i){return i+s.G.length});return this.G=this.G.concat(Array.from({length:t},function(t){return new y(i)})),h},i.getById=function(t){return this.G[t]},i.forEach=function(t,i){var s,h=this.G.length;for(s=0;s<h&&(!this.G[s].isCanvasId(i)||!1!==this.G[s].forEach(t,s));s++);},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.forEach(function(s){return!s.isFunction&&s.element.play(t,i)})},i.getElementsByTag=function(t){var i=[];return this.forEach(function(s){if(!s.isFunction){var h=s.element.getElementsByTag(t);h&&(i=i.concat(h))}}),i},i.count=function(){return this.G.length},i.clear=function(){this.G=[]},t}();function M(t,i){return null==t||""===t?i:t}var b=function(){function t(t){void 0===t&&(t={}),this.U=t,this.V=M(o(this.U.tickChunk),100/6),this.Z=M(o(this.U.maxSkippedTickChunk),120),this.J=M(o(this.U.tickChunkTolerance),.1),this.totalTimePassed=0}var i=t.prototype;return i.init=function(){},i.isLoaded=function(){return!0},i.currentTime=function(){return window.performance?performance.now():Date.now()},i.clampTime=function(t){var i=this.V?this.V*this.Z:2e3;return t>i?i:t},i.shiftTime=function(t){return this.V?-t%this.V:0},i.isChunked=function(){return this.V},i.hasOneChunkedFrame=function(t){return t>=this.V-this.J},i.calcFrames=function(t){return Math.min(this.Z,Math.floor((t+this.J)/this.V))},a(t,[{key:"tickChunk",get:function(){return this.V}}]),t}(),p=function(){function t(t){this.U="function"==typeof t?new t:t,this.K=new g,this.$=null,this.tt=!1,this.it=void 0,this.st=m,this.ht=this.U.timing||new b}var i=t.prototype;return i.currentTime=function(){return this.ht.currentTime()},i.clampTime=function(t){return this.ht.clampTime(t)},i.shiftTime=function(t){return this.ht.shiftTime(t)},i.callInit=function(t,i,s){var h=this;this.$=s,this.resize(t);var n=o(this.U.images);n&&this.st.add(n),this.ht.init(),Promise.resolve(this.U.init&&this.U.init({engine:s,output:t,scene:this,parameter:i,imageManager:this.st})).then(function(t){return h.tt=!0})},i.resize=function(t){var i=this;this.it={alpha:1,x:0,y:0,width:t.width,height:t.height,widthInPixel:t.width,heightInPixel:t.height,scaleCanvas:1,visibleScreen:{x:0,y:0,width:t.width,height:t.height},fullScreen:{x:0,y:0,width:t.width,height:t.height}},this.K.forEach(function(s){s.isFunction||s.element.resize(t,i.it)})},i.destroy=function(t){var i=this.U.destroy&&this.U.destroy({engine:this.$,scene:this,output:t,layerManager:this.K,imageManager:this.st});return this.tt=!1,i},i.loadingScreen=function(t){var i=t.output,s=t.progress;if(this.U.loading)return this.U.loading({engine:this.$,scene:this,output:i,timePassed:t.timePassed,totalTimePassed:t.totalTimePassed,progress:s,imageManager:this.st});var h=i.context[0],n="number"==typeof s?Math.max(1,s*i.height):i.height;h.globalCompositeOperation="source-over",h.globalAlpha=1,h.clearRect(0,0,i.width,i.height),h.fillStyle="#aaa",h.fillRect(0,i.height/2-n/2,i.width,n),h.font="20px Georgia",h.fillStyle="#fff",h.textAlign="left",h.textBaseline="bottom",h.fillText(isNaN(parseFloat(s))?s:"Loading "+Math.round(100*s)+"%",10+3*Math.random(),i.height-10+3*Math.random())},i.callLoading=function(t){var i=this.ht.isLoaded();return this.st.isLoaded()&&this.tt&&i?(this.U.endTime||!0===i||(this.U.endTime=i),t.progress="Click to play",this.loadingScreen(t),!0):(t.progress=this.st.getCount()?this.st.getLoaded()/this.st.getCount():"Loading...",this.loadingScreen(t),!1)},i.fixedUpdate=function(t,i,s){this.U.fixedUpdate&&this.U.fixedUpdate({engine:this.$,scene:this,layerManager:this.K,output:t,timePassed:i,totalTimePassed:this.ht.totalTimePassed,imageManager:this.st,lastCall:s})},i.isDrawFrame=function(t,i){return this.U.isDrawFrame?this.U.isDrawFrame({engine:this.$,scene:this,layerManager:this.K,output:t,timePassed:i,totalTimePassed:this.ht.totalTimePassed,imageManager:this.st}):0!==i},i.detect=function(t){},i.detectImage=function(t,i){},i.hasDetectImage=function(){return 0},i.move=function(t,i){if(this.ht.totalTimePassed+=i,this.nt?this.reset():i<0?(i=this.ht.totalTimePassed,this.reset(),this.ht.totalTimePassed=i):this.U.endTime&&this.U.endTime<=this.ht.totalTimePassed&&(i-=this.ht.totalTimePassed-this.U.endTime,this.ht.totalTimePassed=this.U.endTime,this.U.end&&this.U.end({engine:this.$,scene:this,output:t,timePassed:i,totalTimePassed:this.ht.totalTimePassed,imageManager:this.st})),this.ht.isChunked()){if(this.ht.hasOneChunkedFrame(i))for(var s=this.ht.calcFrames(i)-1,h=0;h<=s;h++)this.fixedUpdate(t,this.ht.tickChunk,h===s)}else this.fixedUpdate(t,i,!0);this.U.update&&this.U.update({engine:this.$,scene:this,layerManager:this.K,output:t,timePassed:i,totalTimePassed:this.ht.totalTimePassed,imageManager:this.st}),this.K.forEach(function(t){var s=t.layer,h=t.elementId;t.isFunction||t.element.animate(i)&&s.deleteById(h)})},i.draw=function(t,i,s){var h=this,n=t.context[i];this.K.forEach(function(i){var s=i.layer,r=i.element,e=i.elementId;i.isFunction?r({layerId:i.layerId,elementId:e,engine:h.$,scene:h,layerManager:h.K,layer:s,output:t,context:n,totalTimePassed:h.ht.totalTimePassed,imageManager:h.st})&&s.deleteById(e):r.draw(n,h.it)},i)},i.init=function(t,i){var s=this,h=t.context[i];this.K.forEach(function(t){t.isFunction||t.element.callInit(h,s.it)},i)},i.resetIntend=function(){this.nt=!0},i.reset=function(){this.ht.totalTimePassed=0,this.nt=!1;var t=this.U.reset?this.U.reset({engine:this.$,scene:this,layerManager:this.K,output:this.$.getOutput(),imageManager:this.st}):new g;if(Array.isArray(t)){var i=t;t=new g,i.forEach(function(i){t.addLayer().addElements(i)})}t&&(this.K=t)},a(t,[{key:"configuration",get:function(){return this.U}},{key:"timing",get:function(){return this.ht}}]),t}();function w(){this.reset()}w.prototype.reset=function(){return this.m=[1,0,0,1,0,0],this},w.prototype.multiply=function(t){var i=this.m[1]*t.m[0]+this.m[3]*t.m[1],s=this.m[0]*t.m[2]+this.m[2]*t.m[3],h=this.m[1]*t.m[2]+this.m[3]*t.m[3],n=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],r=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=this.m[0]*t.m[0]+this.m[2]*t.m[1],this.m[1]=i,this.m[2]=s,this.m[3]=h,this.m[4]=n,this.m[5]=r,this},w.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),i=-this.m[1]*t,s=-this.m[2]*t,h=this.m[0]*t,n=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),r=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=this.m[3]*t,this.m[1]=i,this.m[2]=s,this.m[3]=h,this.m[4]=n,this.m[5]=r,this},w.prototype.rotate=function(t){var i=Math.cos(t),s=Math.sin(t),h=this.m[1]*i+this.m[3]*s,n=this.m[0]*-s+this.m[2]*i,r=this.m[1]*-s+this.m[3]*i;return this.m[0]=this.m[0]*i+this.m[2]*s,this.m[1]=h,this.m[2]=n,this.m[3]=r,this},w.prototype.translate=function(t,i){return this.m[4]+=this.m[0]*t+this.m[2]*i,this.m[5]+=this.m[1]*t+this.m[3]*i,this},w.prototype.scale=function(t,i){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=i,this.m[3]*=i,this},w.prototype.transformPoint=function(t,i){var s=t;return[t=s*this.m[0]+i*this.m[2]+this.m[4],i=s*this.m[1]+i*this.m[3]+this.m[5]]},w.prototype.clone=function(){var t=new w;return t.m=this.m.slice(0),t};var x=function(t){function i(){for(var i,s=arguments.length,h=new Array(s),n=0;n<s;n++)h[n]=arguments[n];return(i=t.call.apply(t,[this].concat(h))||this).rt=null,i.et=null,i.cam={zoom:1,x:0,y:0},i}c(i,t);var s=i.prototype;return s.ot=function(){return this.$?(this.rt||(this.rt=this.ut(this.cam),this.et=null),this.rt):new w},s.ut=function(t){var i=this.$.getWidth()/2,s=this.$.getHeight()/2,h=this.$.getRatio()>1?i:s;return(new w).translate(i,s).scale(h,h).scale(t.zoom,t.zoom).translate(-t.x,-t.y)},s.resize=function(t){var i=this;this.rt=null,this.et=null,this.it={alpha:1,x:-1,y:-1,width:2,height:2,widthInPixel:t.width,heightInPixel:t.height,scaleCanvas:t.width/t.canvas[0].clientWidth};var s=this.transformPoint(0,0,1),h=s[0],n=s[1],r=this.transformPoint(t.width,t.height,1);this.it.visibleScreen={x:h,y:n,width:r[0]-h,height:r[1]-n};var e=this.ut({x:0,y:0,zoom:1}).invert(),o=e.transformPoint(0,0,1),u=o[0],f=o[1],a=e.transformPoint(t.width,t.height,1);this.it.fullScreen={x:u,y:f,width:a[0]-u,height:a[1]-f},this.it.cam=this.cam,this.K.forEach(function(s){s.isFunction||s.element.resize(t,i.it)})},s.transformPoint=function(t,i,s){return void 0===s&&(s=this.it.scaleCanvas),this.et||(this.et=this.ot().clone().invert()),this.et.transformPoint(t*s,i*s)},s.draw=function(i,s){var h=i.context[s];h.save(),h.setTransform.apply(h,this.ot().m),t.prototype.draw.call(this,i,s),h.restore()},i}(p),P={Default:p,Norm:x,NormCamera:function(t){function i(){for(var i,s=arguments.length,h=new Array(s),n=0;n<s;n++)h[n]=arguments[n];return(i=t.call.apply(t,[this].concat(h))||this).i=[],i.camConfig=Object.assign({},{zoomMax:10,zoomMin:.5,zoomFactor:1.2,tween:2,registerEvents:!0,preventDefault:!0,enabled:!0,callResize:!0,doubleClickDetectInterval:350,alternative:!1,clickElement:!!i.U.clickElement,hoverElement:!!i.U.hoverElement},o(i.U.cam)||{}),i.U.click||(i.U.click=function(){}),i.toCam={x:i.camConfig.currentX||0,y:i.camConfig.currentY||0,zoom:i.camConfig.currentZoom||1},i.ft=!1,i.at={ct:-1,vt:-1,lt:1,dt:1,yt:2,gt:2},i.Mt=[],i.bt=!1,i.pt=!1,i}c(i,t);var s=i.prototype;return s.camEnable=function(){return this.camConfig.enabled=!0,this},s.camDisable=function(){return this.camConfig.enabled=!1,this},s.camReset=function(){return this.toCam={x:0,y:0,zoom:1},this},s.camInstant=function(){this.ft=!0},s.camTween=function(t){return this.camConfig.tween=t,this},s.camAlternative=function(t){return this.Mt=[],this.camConfig.alternative=t,this},s.setClampLimit=function(t,i,s,h){return this.at={ct:t,vt:i,lt:s,dt:h,yt:s-t,gt:h-i},this},s.callInit=function(i,s,h){return this.camConfig.registerEvents&&this.wt(i.canvas[0]),t.prototype.callInit.call(this,i,s,h)},s.destroy=function(i){return this.camConfig.registerEvents&&this.xt(),t.prototype.destroy.call(this,i)},s.hasCamChanged=function(){var t=this.camConfig.tween||1;return Math.abs(this.toCam.x-this.cam.x)>=Number.EPSILON*t||Math.abs(this.toCam.y-this.cam.y)>=Number.EPSILON*t||Math.abs(this.toCam.zoom-this.cam.zoom)>=Number.EPSILON*t},s.fixedUpdate=function(i,s,h){return this.camConfig.tween&&!this.ft&&this.hasCamChanged()&&(this.cam.x+=(this.toCam.x-this.cam.x)/this.camConfig.tween,this.cam.y+=(this.toCam.y-this.cam.y)/this.camConfig.tween,this.cam.zoom+=(this.toCam.zoom-this.cam.zoom)/this.camConfig.tween,h&&(this.it.cam=this.cam,this.camConfig.callResize?t.prototype.resize.call(this,i):(this.rt=null,this.et=null))),t.prototype.fixedUpdate.call(this,i,s,h)},s.Pt=function(t,i){var s=this;t?this.U.doubleClickElement?this.At?(clearTimeout(this.At),this.At=void 0,this.U.doubleClickElement(i)):this.At=setTimeout(function(){s.At=void 0,s.U.clickElement&&s.U.clickElement(i)},this.camConfig.doubleClickDetectInterval):this.U.clickElement&&this.U.clickElement(i):this.U.hoverElement&&this.U.hoverElement(i)},s.kt=function(t,i){var s=this;t?this.U.doubleClickElement?this.At?(clearTimeout(this.At),this.At=void 0,this.U.doubleClickElement(i)):this.At=setTimeout(function(){s.At=void 0,s.U.clickNonElement&&s.U.clickNonElement(i)},this.camConfig.doubleClickDetectInterval):this.U.clickNonElement&&this.U.clickNonElement(i):this.U.hoverNonElement&&this.U.hoverNonElement(i)},s.detect=function(t,i){if(this.St=!1,this.bt||this.pt){var s=!!this.bt,h=this.bt||this.pt,n=h.mx,r=h.my,e=this.it.scaleCanvas,o=t.context[i],u=Math.round(n/e),f=Math.round(r/e),a=this.transformPoint(n,r),c=a[0],v=a[1];o.save(),o.setTransform.apply(o,this.ot().m);var l=null;if(this.K.forEach(function(t){var i=t.layerId,s=t.elementId;if(!t.isFunction){var h=t.element.detect(o,u,f);if("c"===h)l="c";else if(h)return l={layerId:i,element:h,elementId:s},!1}}),o.restore(),"c"===l)this.St=!0;else{this.bt=!1,this.pt=!1;var d={mx:n,my:r,x:c,y:v,scene:this,engine:this.$,imageManager:this.st,layerManager:this.K,output:t};l?(Object.assign(d,l),this.Pt(s,d)):this.kt(s,d)}}},s.detectImage=function(t,i){if(!i&&this.St){var s=!!this.bt,h=this.bt||this.pt,n=h.mx,r=h.my,e=this.it.scaleCanvas,o=t.context[i],u=Math.round(n/e),f=Math.round(r/e),a=this.transformPoint(n,r),c={mx:n,my:r,x:a[0],y:a[1],scene:this,engine:this.$,imageManager:this.st,layerManager:this.K,output:t},v=o.imageSmoothingEnabled;o.imageSmoothingEnabled=!1,o.clearRect(0,0,o.canvas.width,o.canvas.height),o.save(),o.setTransform.apply(o,this.ot().m),this.K.forEach(function(t){var i=t.elementId;t.isFunction||t.element.detectDraw(o,"rgb("+(255&i)+", "+((65280&i)>>8)+", "+(255&t.layerId)+")")},0),o.restore(),o.imageSmoothingEnabled=v,this.$.O(o),this.bt=!1,this.pt=!1;var l=o.getImageData(u,f,1,1).data;l[3]?(c.layerId=l[2],c.elementId=l[0]+(l[1]<<8),c.element=this.K.getById(c.layerId).getById(c.elementId),this.Pt(s,c)):this.kt(s,c)}},s.hasDetectImage=function(){return this.St?1:0},s.move=function(i,s){var h=t.prototype.move.call(this,i,s);return this.camConfig.tween&&!this.ft||!this.hasCamChanged()||(this.ft=!1,this.cam=Object.assign({},this.toCam),this.camConfig.callResize?t.prototype.resize.call(this,i):(this.rt=null,this.et=null)),h},s.resize=function(i){t.prototype.resize.call(this,i),this.clampView()},s.wt=function(t){var i=this;this.i=[[["touchstart","mousedown"],this.jt],[["touchend","mouseup"],this.Ot],[["touchendoutside","mouseout"],this.Dt],[["touchmove","mousemove"],this.It],[["wheel"],this.Ct],[["contextmenu"],this.ePrevent]].map(function(s){var h=s[1];return s[0].map(function(s){return{n:t,e:s,f:h.bind(i)}})}).reduce(function(t,i){return Array.isArray(i)?t.push.apply(t,i):t.push(i),t},[]),this.i.forEach(function(t){t.n.addEventListener(t.e,t.f,!0)})},s.xt=function(){this.i.forEach(function(t){t.n.removeEventListener(t.e,t.f,!0)}),this.i=[]},s.ePrevent=function(t){t.preventDefault()},s.Tt=function(t){var i;if(t.touches&&t.touches.length>0?i=t.targetTouches:t.changedTouches&&t.changedTouches.length>0&&(i=t.changedTouches),i){var s=t.target.getBoundingClientRect(),h=i.length;return[(i=Array.from(i)).reduce(function(t,i){return t+i.pageX},0)/h-s.left,i.reduce(function(t,i){return t+i.pageY},0)/h-s.top]}if(void 0===t.offsetX){var n=t.target.getBoundingClientRect();return[t.clientX-n.left,t.clientY-n.top]}return[t.offsetX,t.offsetY]},s.Ft=function(t){return this.camConfig.alternative?t.which?t.which-1:t.button||0:0},s.jt=function(t){this.camConfig.preventDefault&&t.preventDefault();var i=this.Tt(t),s=i[0],h=i[1],n=this.Ft(t);if(this.Mt[n]=Object.assign({},this.Mt[n],{x:s,y:h,_t:this.toCam.x,Et:this.toCam.y,zt:!0,Nt:t.touches&&t.touches.length||1,Rt:void 0,Wt:Date.now()}),this.U.mouseDown){var r=this.transformPoint(s,h);this.U.mouseDown({event:t,x:r[0],y:r[1],scene:this,engine:this.$,imageManager:this.st})}},s.Ot=function(t){var i=this;this.camConfig.preventDefault&&t.preventDefault();var s=this.Ft(t);this.Mt[s]||(this.Mt[s]={});var h=this.Mt[s].zt,n=t.changedTouches&&t.changedTouches.length||1,r=Math.max(this.Mt[s].Nt,n);this.Mt[s].zt=!1,this.Mt[s].Nt-=n;var e=this.Tt(t),o=e[0],u=e[1];if(this.U.mouseUp){var f=this.transformPoint(o,u);this.U.mouseUp({event:t,x:f[0],y:f[1],scene:this,engine:this.$,imageManager:this.st})}if(h&&!(r>1))if(Date.now()-this.Mt[s].Wt<300&&Math.abs(this.Mt[s].x-o)<5&&Math.abs(this.Mt[s].y-u)<5&&!s){var a=this.transformPoint(o,u),c=a[0],v=a[1];this.bt=this.camConfig.clickElement&&{mx:o,my:u},this.U.doubleClick?this.Mt[s].Xt?(clearTimeout(this.Mt[s].Xt),this.Mt[s].Xt=void 0,this.U.doubleClick({event:t,x:c,y:v,scene:this,engine:this.$,imageManager:this.st})):this.Mt[s].Xt=setTimeout(function(){i.Mt[s].Xt=void 0,i.U.click({event:t,x:c,y:v,scene:i,engine:i.$,imageManager:i.st})},this.camConfig.doubleClickDetectInterval):this.U.click({event:t,x:c,y:v,scene:this,engine:this.$,imageManager:this.st})}else if(this.camConfig.alternative&&!s){var l=this.transformPoint(o,u),d=l[0],m=l[1],y=this.transformPoint(this.Mt[s].x,this.Mt[s].y),g=y[0],M=y[1];this.U.region&&this.U.region({event:t,x1:Math.min(g,d),y1:Math.min(M,m),x2:Math.max(g,d),y2:Math.max(M,m),fromX:g,fromY:M,toX:d,toY:m,scene:this})}},s.Dt=function(t){var i=this.Ft(t);this.Mt[i]&&(this.Mt[i].zt=!1),this.U.mouseOut&&this.U.mouseOut({event:t,scene:this,engine:this.$,imageManager:this.st})},s.It=function(t){this.camConfig.preventDefault&&t.preventDefault();var i=this.Ft(t),s=this.Tt(t),h=s[0],n=s[1];if(this.pt=this.camConfig.hoverElement&&{mx:h,my:n},this.U.mouseMove){var r=this.transformPoint(h,n);this.U.mouseMove({event:t,x:r[0],y:r[1],scene:this,engine:this.$,imageManager:this.st})}if(this.Mt[i]&&this.Mt[i].zt&&(0!==t.which||t.touches)){var e=this.it.scaleCanvas;if(this.camConfig.enabled){if(t.touches&&t.touches.length>=2){var o=t.touches,u=Math.sqrt((o[0].pageX-o[1].pageX)*(o[0].pageX-o[1].pageX)+(o[0].pageY-o[1].pageY)*(o[0].pageY-o[1].pageY));if(void 0===this.Mt[i].Rt)u>0&&(this.Mt[i].Rt=u,this.Mt[i].Yt=this.toCam.zoom);else{if(this.toCam.zoom=Math.max(this.camConfig.zoomMin,Math.min(this.camConfig.zoomMax,this.Mt[i].Yt*u/this.Mt[i].Rt)),this.camConfig.alternative){var f=this.ut(this.toCam).invert(),a=f.transformPoint(this.Mt[i].x*e,this.Mt[i].y*e),c=a[0],v=a[1],l=f.transformPoint(h*e,n*e),d=l[1];this.toCam.x=this.Mt[i]._t+c-l[0],this.toCam.y=this.Mt[i].Et+v-d}this.clampView()}return}if(this.Mt[i].Rt=void 0,!this.camConfig.alternative||2===i){var m=this.ut(this.toCam).invert(),y=m.transformPoint(this.Mt[i].x*e,this.Mt[i].y*e),g=y[0],M=y[1],b=m.transformPoint(h*e,n*e),p=b[1];this.toCam.x=this.Mt[i]._t+g-b[0],this.toCam.y=this.Mt[i].Et+M-p,this.clampView()}}if(this.camConfig.alternative&&0===i&&this.U.regionMove&&!(Date.now()-this.Mt[i].Wt<300&&Math.abs(this.Mt[i].x-h)<5&&Math.abs(this.Mt[i].y-n)<5)&&(!t.touches||1===t.touches.length)){var w=this.transformPoint(h,n),x=w[0],P=w[1],A=this.transformPoint(this.Mt[i].x,this.Mt[i].y),k=A[0],S=A[1];this.U.regionMove({event:t,x1:Math.min(k,x),y1:Math.min(S,P),x2:Math.max(k,x),y2:Math.max(S,P),fromX:k,fromY:S,toX:x,toY:P,scene:this})}}},s.Ct=function(t){if(this.camConfig.preventDefault&&t.preventDefault(),this.camConfig.enabled){var i=this.it.scaleCanvas,s=this.Tt(t),h=s[0],n=s[1],r=this.ut(this.toCam).invert().transformPoint(h*i,n*i),e=r[0],o=r[1];if((t.wheelDelta||-1*t.deltaY)/120>0){this.zoomIn();var u=this.ut(this.toCam).invert().transformPoint(h*i,n*i),f=u[1];this.toCam.x-=u[0]-e,this.toCam.y-=f-o,this.clampView()}else this.zoomOut()}},s.zoomToFullScreen=function(){return this.toCam.zoom=Math.min(this.it.fullScreen.width/this.it.width,this.it.fullScreen.height/this.it.height),this},s.zoomToNorm=function(){return this.toCam.zoom=1,this},s.zoomIn=function(){return this.toCam.zoom=Math.min(this.camConfig.zoomMax,this.toCam.zoom*this.camConfig.zoomFactor),this},s.zoomOut=function(){return this.toCam.zoom=Math.max(this.camConfig.zoomMin,this.toCam.zoom/this.camConfig.zoomFactor),this.clampView(),this},s.zoomTo=function(t,i,s,h){var n=this.it.scaleCanvas,r=this.ut(this.toCam).invert(),e=r.transformPoint(0,0),o=e[0],u=e[1],f=r.transformPoint(this.$.getWidth()*n,this.$.getHeight()*n),a=s-t,c=h-i,v=i+c/2,l=(f[0]-o)/a,d=(f[1]-u)/c;return this.toCam.x=t+a/2,this.toCam.y=v,this.toCam.zoom=this.toCam.zoom*Math.max(Math.min(l,d),Number.MIN_VALUE),this},s.clampView=function(){var t=this.ut(this.toCam).invert(),i=t.transformPoint(0,0),s=i[0],h=i[1],n=t.transformPoint(this.$.getWidth(),this.$.getHeight()),r=n[0],e=n[1];return r-s<=this.at.yt?s<this.at.ct?r<=this.at.lt&&(this.toCam.x+=this.at.ct-s):r>this.at.lt&&(this.toCam.x+=this.at.lt-r):s>this.at.ct?this.toCam.x+=this.at.ct-s:r<this.at.lt&&(this.toCam.x+=this.at.lt-r),e-h<=this.at.gt?h<this.at.vt?e<=this.at.dt&&(this.toCam.y+=this.at.vt-h):e>this.at.dt&&(this.toCam.y+=this.at.dt-e):h>this.at.vt?this.toCam.y+=this.at.vt-h:e<this.at.dt&&(this.toCam.y+=this.at.dt-e),this},i}(x)},A=function(){function t(t){this.duration=o(t)-0}return t.prototype.run=function(t,i){return i-this.duration},t}(),k=function(){function t(){for(var t=0,i=arguments.length,s=new Array(i),h=0;h<i;h++)s[h]=arguments[h];"number"==typeof s[0]&&(t=s.shift()),this.sequences=s.map(function(i){Array.isArray(i)||(i=[i]);var s=t;return"number"==typeof i[0]&&(s=i.shift()),{position:0,timelapsed:-s,sequence:i.map(function(t){return"function"!=typeof t.run?"number"==typeof t?new A(t):{run:t}:t}).filter(function(t){return"function"==typeof t.run}),label:i.reduce(function(t,i,s){return"string"==typeof i&&(t[i]=s-Object.keys(t).length),t},{}),enabled:!0}}),this.lastTimestamp=0,this.enabled=!0}var i=t.prototype;return i.reset=function(t){void 0===t&&(t=0),this.sequences.forEach(function(i){i.enabled=!0,i.position=0,i.timelapsed=t,i.sequence[0]&&i.sequence[0].reset&&i.sequence[0].reset(t)}),this.enabled=!0},i.play=function(t,i){if(void 0===t&&(t=""),void 0===i&&(i=0),t){var s=this.sequences.reduce(function(s,h){return h.label.hasOwnProperty(t)?(s=!0,h.position=h.label[t],h.enabled=!0,h.timelapsed=i,h.sequence[h.position]&&h.sequence[h.position].reset&&h.sequence[h.position].reset()):s|=h.sequence.find(function(s){return s.play&&s.play(t,i)})>=0,s},!1);return s&&(this.enabled=!0),s}return this.sequences.forEach(function(t){return t.enabled=!0}),this.enabled=!0,!0},i.runSequence=function(i,s,h){for(var n=h;s.sequence[s.position]&&n>=0;){if(s.timelapsed+=n,s.timelapsed<0)return-1;if(!0===(n=s.sequence[s.position].run(i,s.timelapsed)))n=0;else{if(!1===n)return-1;if(n===t.Lt)return s.enabled=!1,this.enabled=!1,h;if(n===t.qt)return s.enabled=!1,h;if(n===t.Ht)return!0}if(n>=0&&(s.position=(s.position+1)%s.sequence.length,s.sequence[s.position]&&s.sequence[s.position].reset&&s.sequence[s.position].reset(),s.timelapsed=0,0===s.position))return s.enabled=!1,n}return n},i.run=function(t,i,s){var h=i;if(s||(h=i-this.lastTimestamp,this.lastTimestamp=i),!this.enabled)return h;for(var n=this.sequences.length,r=0,e=Infinity,o=0;o<n;o++)if(this.sequences[o].enabled){var u=this.runSequence(t,this.sequences[o],h);if(!0===u)return!0;e=Math.min(e,u)}else r++;return r===n?(this.enabled=!1,h):e},t}();k.Lt="F",k.qt="S",k.Ht="R";var S=function(){function t(t){this.Bt(this,this.Gt(),t),this.Ut=!0}var i=t.prototype;return i.Bt=function(t,i,s){Object.keys(i).forEach(function(h){var n=i[h];t[h]="function"==typeof n?n(s[h],s,t):M(o(s[h]),n)})},i.Vt=function(){return{animation:function(t,i){var s=o(t);return Array.isArray(s)?new k(s):s},enabled:!0,isClickable:!1,tag:function(t){return Array.isArray(t)?t:t?[t]:[]}}},i.Gt=function(){return Object.assign({},this.Vt(),{x:0,y:0,rotation:function(t,i){return M(o(t),M(o(i.rotationInRadian),.017453292519943295*M(o(i.rotationInDegree),0)))},scaleX:function(t,i){return M(o(t),M(o(i.scale),1))},scaleY:function(t,i){return M(o(t),M(o(i.scale),1))},alpha:1,compositeOperation:"source-over",color:"#fff"})},i.getElementsByTag=function(t){var i=this;if("function"==typeof t){if(this.tag.filter(t).length)return[this]}else if((Array.isArray(t)?t:[t]).filter(function(t){return i.tag.includes(t)}).length)return[this];return[]},i.animate=function(t){return!(!this.animation||!0!==this.animation.run(this,t,!0)||(this.enabled=!1,0))},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.animation&&this.animation.play&&this.animation.play(t,i)},i.init=function(t,i){},i.callInit=function(t,i){this.Ut&&(this.init(t,i),this.Ut=!1)},i.resize=function(t,i){},i.Zt=function(t,i,s,h,n){var r=!1;if(this.enabled&&this.isClickable){var e=this.width/2,o=this.height/2;t.save(),h?t.translate(this.x+e,this.y+o):t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.beginPath(),n?r=n(e,o):(t.rect(-e,-o,this.width,this.height),t.closePath(),r=t.isPointInPath(i,s)),t.restore()}return!!r&&this},i.detectDraw=function(t,i){},i.detect=function(t,i,s){var h=this;return this.Zt(t,i,s,!1,function(){return t.arc(0,0,1,Math.PI/2+h.rotation,2.5*Math.PI-h.rotation,!1),t.isPointInPath(i,s)})},i.draw=function(t,i){this.enabled&&(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.beginPath(),t.fillStyle=this.color,t.arc(0,0,1,Math.PI/2+this.rotation,2.5*Math.PI-this.rotation,!1),t.fill(),t.restore())},t}(),j=function(t){function i(i){var s;return"function"==typeof i&&(i={callback:i}),(s=t.call(this,i)||this).Jt=0,s.Kt=0,s}c(i,t);var s=i.prototype;return s.Gt=function(){return Object.assign({},this.Vt(),{callback:function(t){return void 0===typeof t?function(){}:t}})},s.animate=function(i){return this.enabled&&(this.Jt+=i,this.Kt+=i),t.prototype.animate.call(this,i)},s.detect=function(t,i){},s.draw=function(t,i){this.enabled&&this.callback(t,this.Jt,i,this),this.Kt=0},i}(S),O=function(t){function i(i){return t.call(this,i)||this}c(i,t);var s=i.prototype;return s.Gt=function(){return Object.assign({},t.prototype.Gt.call(this),{sprite:[]})},s.getElementsByTag=function(i){var s=t.prototype.getElementsByTag.call(this,i),h=this.sprite,n=Array.isArray(h),r=0;for(h=n?h:h[Symbol.iterator]();;){var e;if(n){if(r>=h.length)break;e=h[r++]}else{if((r=h.next()).done)break;e=r.value}var o=e.getElementsByTag(i);o&&(s=s.concat(o))}return s},s.animate=function(i){var s=t.prototype.animate.call(this,i),h=!1;if(this.enabled){var n=this.sprite,r=Array.isArray(n),e=0;for(n=r?n:n[Symbol.iterator]();;){var o;if(r){if(e>=n.length)break;o=n[e++]}else{if((e=n.next()).done)break;o=e.value}h=h||!0===o.animate(i)}}return this.animation?s:(h&&(this.enabled=!1),h)},s.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.animation&&this.animation.play&&this.animation.play(t,i);var s=this.sprite,h=Array.isArray(s),n=0;for(s=h?s:s[Symbol.iterator]();;){var r;if(h){if(n>=s.length)break;r=s[n++]}else{if((n=s.next()).done)break;r=n.value}r.play&&r.play(t,i)}},s.resize=function(t,i){var s=this.sprite,h=Array.isArray(s),n=0;for(s=h?s:s[Symbol.iterator]();;){var r;if(h){if(n>=s.length)break;r=s[n++]}else{if((n=s.next()).done)break;r=n.value}r.resize(t,i)}},s.callInit=function(i,s){t.prototype.callInit.call(this,i,s);var h=this.sprite,n=Array.isArray(h),r=0;for(h=n?h:h[Symbol.iterator]();;){var e;if(n){if(r>=h.length)break;e=h[r++]}else{if((r=h.next()).done)break;e=r.value}e.callInit(i,s)}},s.detectImage=function(t,i){if(this.enabled){var s=this.sprite,h=Array.isArray(s),n=0;for(s=h?s:s[Symbol.iterator]();;){var r;if(h){if(n>=s.length)break;r=s[n++]}else{if((n=s.next()).done)break;r=n.value}r.detectImage(t,i)}}},s.detect=function(t,i,s){if(this.enabled){var h=this.sprite,n=Array.isArray(h),r=0;for(h=n?h:h[Symbol.iterator]();;){var e;if(n){if(r>=h.length)break;e=h[r++]}else{if((r=h.next()).done)break;e=r.value}var o=e.detect(t,i,s);if(o)return o}}return!1},s.draw=function(t,i){if(this.enabled){this.alpha<1&&((i=Object.assign({},i)).alpha*=this.alpha),t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation);var s=this.sprite,h=Array.isArray(s),n=0;for(s=h?s:s[Symbol.iterator]();;){var r;if(h){if(n>=s.length)break;r=s[n++]}else{if((n=s.next()).done)break;r=n.value}r.draw(t,i)}t.restore()}},i}(S),D=function(t){function i(i){var s;return(s=t.call(this,i)||this).Qt=!1,s.S=2,s}c(i,t);var s=i.prototype;return s.Gt=function(){return Object.assign({},t.prototype.Gt.call(this),{x:void 0,y:void 0,width:void 0,height:void 0,canvasWidth:void 0,canvasHeight:void 0,gridSize:void 0,norm:function(t,i,s){return M(o(t),void 0===s.x&&void 0===s.y&&void 0===s.width&&void 0===s.height)},isDrawFrame:function(t,i,s){return M(t,!0)}})},s.$t=function(t){var i=t.widthInPixel,s=t.heightInPixel;this.ti=document.createElement("canvas"),this.canvasWidth&&this.canvasHeight?(this.ti.width=this.canvasWidth,this.ti.height=this.canvasHeight):this.gridSize?(this.Qt=this.gridSize,this.ti.width=Math.round(this.Qt),this.ti.height=Math.round(this.Qt)):(this.ti.width=Math.round(i/this.scaleX),this.ti.height=Math.round(s/this.scaleY)),this.ii=this.ti.getContext("2d")},s.normalizeFullScreen=function(t){(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y),(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height)},s.resize=function(i,s){if(this.ti&&this.Qt!==this.gridSize&&!this.canvasWidth){var h=this.ti;this.$t(s),this.ii.globalCompositeOperation="copy",this.ii.drawImage(h,0,0,h.width,h.height,0,0,this.ti.width,this.ti.height),this.ii.globalCompositeOperation="source-over",this.S=2}this.normalizeFullScreen(s),t.prototype.resize.call(this,i,s)},s.detect=function(t,i,s){return this.Zt(t,i,s,!1)},s.init=function(t,i){this.$t(i),this.normalizeFullScreen(i)},s.draw=function(t,i){if(this.enabled){this.gridSize&&this.Qt!==this.gridSize&&this.resize(i),this.S=Math.max(this.S-1,o(this.isDrawFrame,t,i));var s=this.width,h=this.height,n=s/2,r=h/2,e=this.ti.width,u=this.ti.height;if(this.S){this.ii.textBaseline="middle",this.ii.textAlign="center",this.ii.globalAlpha=1,this.ii.globalCompositeOperation="source-over",this.ii.save();var f=i.cam;if(this.norm&&f){var a=Math.max(e,u)/2;this.ii.translate(e/2,u/2),this.ii.scale(a,a),this.ii.scale(f.zoom,f.zoom),this.ii.translate(-f.x,-f.y)}var c=this.sprite,v=Array.isArray(c),l=0;for(c=v?c:c[Symbol.iterator]();;){var d;if(v){if(l>=c.length)break;d=c[l++]}else{if((l=c.next()).done)break;d=l.value}d.draw(this.ii,this.norm?Object.assign({},i,{alpha:1,widthInPixel:e,heightInPixel:u}):{alpha:1,x:0,y:0,width:e,height:u,widthInPixel:e,heightInPixel:u,visibleScreen:{x:0,y:0,width:e,height:u}})}this.ii.restore()}t.save(),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,t.translate(this.x+n,this.y+r),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.drawImage(this.ti,0,0,e,u,-n,-r,s,h),t.restore()}},i}(O),I=function(t){function i(i){var s;s=t.call(this,i.self||{})||this;var h=M(o(i.count),1);s.sprite=[];for(var n=i.class,r=0;r<h;r++){var e={};for(var u in i)["self","class","count"].includes(u)||(e[u]="function"==typeof i[u]?i[u].call(i,r):i[u]);s.sprite[r]=new n(e)}return s}return c(i,t),i}(O),C=function(t){function i(i){var s;return(s=t.call(this,i)||this).Qt=!1,s}c(i,t);var s=i.prototype;return s.Gt=function(){return Object.assign({},t.prototype.Gt.call(this),{x:void 0,y:void 0,width:void 0,height:void 0,gridSize:void 0,darker:0,pixel:!1,clear:!1,norm:function(t,i,s){return M(o(t),void 0===s.x&&void 0===s.y&&void 0===s.width&&void 0===s.height)}})},s.$t=function(t){var i=t.widthInPixel,s=t.heightInPixel;this.ti=document.createElement("canvas"),this.gridSize?(this.Qt=this.gridSize,this.ti.width=Math.round(this.Qt),this.ti.height=Math.round(this.Qt)):(this.ti.width=Math.ceil(i/this.scaleX),this.ti.height=Math.ceil(s/this.scaleY)),this.ii=this.ti.getContext("2d"),this.ii.globalCompositeOperation="source-over",this.ii.globalAlpha=1},s.normalizeFullScreen=function(t){(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y),(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height)},s.resize=function(t,i){if(this.ti&&this.Qt!==this.gridSize){var s=this.ti;this.$t(i),this.ii.globalCompositeOperation="copy",this.ii.drawImage(s,0,0,s.width,s.height,0,0,this.ti.width,this.ti.height),this.ii.globalCompositeOperation="source-over"}this.normalizeFullScreen(i)},s.detect=function(t,i,s){return this.Zt(t,i,s,!1)},s.init=function(t,i){this.$t(i),this.normalizeFullScreen(i)},s.draw=function(t,i){if(this.enabled&&this.alpha>0){this.gridSize&&this.Qt!==this.gridSize&&this.resize(t,i);var s=this.alpha*i.alpha,h=this.width,n=this.height,r=this.ti.width,e=this.ti.height;if(s>0&&r&&e){this.ii.globalCompositeOperation="copy",this.ii.globalAlpha=1,this.ii.drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height,0,0,r,e),this.darker>0&&(this.ii.globalCompositeOperation=this.clear?"source-atop":"source-over",this.ii.fillStyle="rgba(0,0,0,"+this.darker+")",this.ii.fillRect(0,0,r,e)),this.additionalBlur&&this.additionalBlur(r,e,i),this.clear&&(t.globalCompositeOperation="source-over",t.globalAlpha=1,t.clearRect(this.x,this.y,h,n)),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=s;var o=t.imageSmoothingEnabled;t.imageSmoothingEnabled=!this.pixel,t.drawImage(this.ti,0,0,r,e,this.x,this.y,h,n),t.imageSmoothingEnabled=o}}else this.clear&&(this.x||(this.x=i.x),this.y||(this.y=i.y),this.width||(this.width=i.width),this.height||(this.height=i.height),t.clearRect(this.x,this.y,this.width,this.height))},i}(S),T=function(t){function i(i){var s;return(s=t.call(this,i)||this).si=!1,s}c(i,t);var s=i.prototype;return s.Gt=function(){return Object.assign({},t.prototype.Gt.call(this),{image:function(t){return m.getImage(o(t))},position:i.CENTER,frameX:0,frameY:0,frameWidth:0,frameHeight:0,width:void 0,height:void 0,norm:!1,normCover:!1,normToScreen:!1,clickExact:!1,color:"#FFF",tint:0})},s.resize=function(t,i){this.Ut=!0},s.init=function(t,i){var s=this.frameWidth||this.image.width,h=this.frameHeight||this.image.height;this.hi=this.normToScreen?this.normCover?Math.max(i.fullScreen.width/s,i.fullScreen.height/h):this.norm?Math.min(i.fullScreen.width/s,i.fullScreen.height/h):1:this.normCover?Math.max(i.width/s,i.height/h):this.norm?Math.min(i.width/s,i.height/h):1},s.ni=function(){return[this.tint,this.frameWidth||this.image.width,this.frameHeight||this.image.height,this.color,this.frameX,this.frameY].join(";")},s.ri=function(t,i){return this.ti||(this.ti=document.createElement("canvas"),this.ii=this.ti.getContext("2d")),this.ti.width=t,this.ti.height=i,this.ii},s.detectDraw=function(t,s){if(this.enabled&&this.isClickable&&this.clickExact){var h=this.frameWidth||this.image.width,n=this.frameHeight||this.image.height,r=(this.width?this.width:h)*this.hi*this.scaleX,e=(this.height?this.height:n)*this.hi*this.scaleY,o=this.position===i.LEFT_TOP,u=this.ri(h,n);u.globalAlpha=1,u.globalCompositeOperation="source-over",u.fillStyle=s,u.fillRect(0,0,h,n),u.globalCompositeOperation="destination-atop",u.drawImage(this.image,this.frameX,this.frameY,h,n,0,0,h,n),t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.drawImage(this.ti,0,0,h,n,o?0:-r/2,o?0:-e/2,r,e),t.restore(),this.si=!1}},s.detect=function(t,i,s){return this.enabled&&this.isClickable&&this.clickExact?"c":this.Zt(t,i,s,!1)},s.draw=function(t,s){if(this.enabled&&this.image&&this.alpha>0){var h=this.frameWidth||this.image.width,n=this.frameHeight||this.image.height,r=(this.width?this.width:h)*this.hi*this.scaleX,e=(this.height?this.height:n)*this.hi*this.scaleY;t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*s.alpha;var o=this.position===i.LEFT_TOP;if(this.tint&&this.si!==this.ni()){var u=this.ri(h,n);u.globalAlpha=1,u.globalCompositeOperation="source-over",u.clearRect(0,0,h,n),u.globalAlpha=this.tint,u.fillStyle=this.color,u.fillRect(0,0,h,n),u.globalAlpha=1,u.globalCompositeOperation="destination-atop",u.drawImage(this.image,this.frameX,this.frameY,h,n,0,0,h,n),this.si=this.ni()}0==this.rotation?o?t.drawImage(this.tint?this.ti:this.image,this.tint?0:this.frameX,this.tint?0:this.frameY,h,n,this.x,this.y,r,e):t.drawImage(this.tint?this.ti:this.image,this.tint?0:this.frameX,this.tint?0:this.frameY,h,n,this.x-r/2,this.y-e/2,r,e):(t.save(),t.translate(this.x,this.y),t.rotate(this.rotation),t.drawImage(this.tint?this.ti:this.image,this.tint?0:this.frameX,this.tint?0:this.frameY,h,n,o?0:-r/2,o?0:-e/2,r,e),t.restore())}},i}(S);T.LEFT_TOP=0,T.CENTER=1;var F=function(t){function i(i){return t.call(this,i)||this}c(i,t);var s=i.prototype;return s.Gt=function(){return Object.assign({},t.prototype.Gt.call(this),{text:void 0,font:"2em monospace",position:i.CENTER,color:void 0,borderColor:void 0,lineWidth:1})},s.detectDraw=function(t,i){this.enabled&&this.isClickable&&(t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),this.position||(t.textAlign="left",t.textBaseline="top"),t.font=this.font,t.fillStyle=i,t.fillText(this.text,0,0),t.restore())},s.detect=function(t,i){return"c"},s.draw=function(t,i){this.enabled&&(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,t.save(),this.position||(t.textAlign="left",t.textBaseline="top"),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),t.font=this.font,this.color&&(t.fillStyle=this.color,t.fillText(this.text,0,0)),this.borderColor&&(t.strokeStyle=this.borderColor,t.lineWidth=this.lineWidth,t.strokeText(this.text,0,0)),t.restore())},i}(S);F.LEFT_TOP=0,F.CENTER=1;var _="function"==typeof t?t:t.tinycolor,E=function(t){function i(i){var s;return(s=t.call(this,i)||this).ei=void 0,s.oi=!1,s}c(i,t),i.getGradientImage=function(t,s,h){var n=t>>4,r=s>>4,e=h>>4;return i.ui||(i.ui=Array.from({length:16},function(t){return Array.from({length:16},function(t){return Array.from({length:16})})})),i.ui[n][r][e]||(i.ui[n][r][e]=i.generateGradientImage(n,r,e)),i.ui[n][r][e]},i.generateGradientImage=function(t,i,s){var h=document.createElement("canvas");h.width=h.height=64;var n=h.getContext("2d");n.globalAlpha=1,n.globalCompositeOperation="source-over",n.clearRect(0,0,64,64);var r=n.createRadialGradient(32,32,0,32,32,32);return r.addColorStop(0,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",1)"),r.addColorStop(.3,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",0.4)"),r.addColorStop(1,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(s<<4)-1)+",0)"),n.fillStyle=r,n.fillRect(0,0,64,64),h};var s=i.prototype;return s.resize=function(t,i){this.ei=void 0},s.draw=function(t,s){if(this.enabled){this.color&&this.color.r||(this.color=_(this.color).toRgb()),this.ei!==this.scaleX&&(this.ei=this.scaleX,this.oi=this.scaleX*s.widthInPixel/s.width>64);var h=this.color,n=h.r,r=h.g,e=h.b;t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*s.alpha,t.imageSmoothingEnabled=this.oi,t.drawImage(i.getGradientImage(n,r,e),0,0,64,64,this.x-this.scaleX/2,this.y-this.scaleY/2,this.scaleX,this.scaleY),t.imageSmoothingEnabled=!0}},i}(S),z=function(t){function s(i){var s;if((s=t.call(this,i)||this).oldPath=void 0,s.path2D=new Path2D,s.polyfill)if("function"!=typeof Path2D){var h=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src="https://cdn.jsdelivr.net/npm/canvas-5-polyfill@0.1.5/canvas.min.js",h.appendChild(n)}else{var r=document.createElement("canvas").getContext("2d");r.stroke(new Path2D("M0,0H1")),r.getImageData(0,0,1,1).data[3]&&(s.polyfill=!1)}return s}c(s,t);var h=s.prototype;return h.Gt=function(){return Object.assign({},t.prototype.Gt.call(this),{path:void 0,color:void 0,borderColor:void 0,lineWidth:1,clip:!1,fixed:!1,polyfill:!0})},h.changeToPathInit=function(t,s){return i.fi("string"==typeof t?i.path2shapes(t):t,"string"==typeof s?i.path2shapes(s):s)},h.changeToPath=function(t,s,h){return i.ai(s.pathFrom,s.pathTo,t)},h.detect=function(t,i,s){var h=this;return this.Zt(t,i,s,!1,function(){return t.isPath(h.path2D,i,s)})},h.draw=function(t,s){var h=this;if(this.enabled){var n=this.alpha*s.alpha;this.oldPath!==this.path&&(this.polyfill&&"string"==typeof this.path&&(this.path=i.path2shapes(this.path)),Array.isArray(this.path)?(this.path2D=new Path2D,this.path.forEach(function(t){h.path2D.moveTo(t[0][0],t[0][1]),t.forEach(function(t){h.path2D.bezierCurveTo(t[2],t[3],t[4],t[5],t[6],t[7])}),h.path2D.closePath()})):this.path2D=this.path instanceof Path2D?this.path:new Path2D(this.path),this.oldPath=this.path);var r=this.scaleX,e=this.scaleY;this.fixed&&(0==r&&(r=Number.EPSILON),0==e&&(e=Number.EPSILON)),t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=n,t.save(),t.translate(this.x,this.y),t.scale(r,e),t.rotate(this.rotation),this.color&&(t.fillStyle=this.color,t.fill(this.path2D)),t.save(),this.clip&&(t.clip(this.path2D),this.fixed&&(t.rotate(-this.rotation),t.scale(1/r,1/e),t.translate(-this.x,-this.y)));var o=this.sprite,u=Array.isArray(o),f=0;for(o=u?o:o[Symbol.iterator]();;){var a;if(u){if(f>=o.length)break;a=o[f++]}else{if((f=o.next()).done)break;a=f.value}a.draw(t,s)}t.restore(),this.borderColor&&(t.strokeStyle=this.borderColor,t.lineWidth=this.lineWidth,t.stroke(this.path2D)),t.restore()}},s}(O),N=function(t){function i(i){return t.call(this,i)||this}c(i,t);var s=i.prototype;return s.Gt=function(){return Object.assign({},t.prototype.Gt.call(this),{x:void 0,y:void 0,width:void 0,height:void 0,borderColor:void 0,color:void 0,lineWidth:1,clear:!1,norm:function(t,i,s){return M(o(t),void 0===s.x&&void 0===s.y&&void 0===s.width&&void 0===s.height)},position:i.CENTER})},s.normalizeFullScreen=function(t){(this.norm||void 0===this.width)&&(this.width=t.visibleScreen.width),(this.norm||void 0===this.height)&&(this.height=t.visibleScreen.height),(this.norm||void 0===this.x)&&(this.x=t.visibleScreen.x,this.position===i.CENTER&&(this.x+=this.width/2)),(this.norm||void 0===this.y)&&(this.y=t.visibleScreen.y,this.position===i.CENTER&&(this.y+=this.height/2))},s.resize=function(t,i){this.Ut=!0},s.init=function(t,i){this.normalizeFullScreen(i)},s.detect=function(t,s,h){return this.Zt(t,s,h,this.position===i.LEFT_TOP)},s.draw=function(t,s){if(this.enabled&&this.alpha>0)if(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*s.alpha,0===this.rotation&&this.position===i.LEFT_TOP)this.clear?t.clearRect(this.x,this.y,this.width,this.height):this.color&&(t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height)),this.borderColor&&(t.beginPath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.borderColor,t.rect(this.x,this.y,this.width,this.height),t.stroke());else{var h=this.width/2,n=this.height/2;t.save(),this.position===i.LEFT_TOP?t.translate(this.x+h,this.y+n):t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(this.rotation),this.clear?t.clearRect(-h,-n,this.width,this.height):this.color&&(t.fillStyle=this.color,t.fillRect(-h,-n,this.width,this.height)),this.borderColor&&(t.beginPath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.borderColor,t.rect(-h,-n,this.width,this.height),t.stroke()),t.restore()}},i}(S);N.LEFT_TOP=0,N.CENTER=1;var R=(h||s).imageDataRGBA,W={Callback:j,Canvas:D,Circle:S,Emitter:I,FastBlur:C,Group:O,Image:T,Text:F,Particle:E,Path:z,Rect:N,Scroller:function(t){function i(i){var s=o(i.text),h=Array.isArray(s)?s:[].concat(s);return t.call(this,Object.assign({},i,{class:F,count:h.length,text:function(t){return h[t]},enabled:function(t){return" "!==h[t]&&o(i.enabled,t)}}))||this}return c(i,t),i}(I),StackBlur:function(t){function i(i){var s;return(s=t.call(this,i)||this).Qt=!1,s.ci=void 0,s}c(i,t);var s=i.prototype;return s.Gt=function(){return Object.assign({},t.prototype.Gt.call(this),{onCanvas:!1,radius:void 0,radiusPart:void 0,radiusScale:!0})},s.normalizeFullScreen=function(i){this.norm&&this.onCanvas?(this.x=0,this.y=0,this.width=i.widthInPixel,this.height=i.heightInPixel):t.prototype.normalizeFullScreen.call(this,i)},s.resize=function(i,s){t.prototype.resize.call(this,i,s),this.radiusPart&&(this.radius=void 0)},s.additionalBlur=function(t,i,s){var h=this.ii.getImageData(0,0,t,i);R(h,0,0,t,i,s.radius),this.ii.putImageData(h,0,0)},s.detect=function(t,i,s){return this.Zt(t,i,s,!1)},s.draw=function(i,s){if(this.enabled){void 0!==this.radius&&this.ci===this.radiusPart||(this.radius=Math.round((s.widthInPixel+s.heightInPixel)/2/this.radiusPart),this.ci=this.radiusPart);var h=Math.round(this.radius*(this.radiusScale&&(s.cam?s.cam.zoom:1)/s.scaleCanvas));if(h)if(this.onCanvas){void 0!==this.width&&void 0!==this.height||this.normalizeFullScreen(s);var n=Math.round(this.x),r=Math.round(this.y),e=Math.round(this.width),o=Math.round(this.height);this.imageData=i.getImageData(n,r,e,o),R(this.imageData,0,0,e-n,o-r,h),i.putImageData(this.imageData,n,r,0,0,e,o)}else s.radius=h,t.prototype.draw.call(this,i,s)}else t.prototype.draw.call(this,i,s)},i}(C),StarField:function(t){function i(i){var s;return(s=t.call(this,i)||this).vi=[],s.li=[],s.di=[],s.mi=[],s.yi=[],s.gi=[],s.Mi=[],s.bi=[],s.pi=[],s}c(i,t);var s=i.prototype;return s.Gt=function(){return Object.assign({},t.prototype.Gt.call(this),{count:40,moveX:0,moveY:0,moveZ:0,lineWidth:void 0,highScale:!0,color:"#FFF"})},s.init=function(t,i){function s(t,i,s){return void 0===s&&(s=-i),void 0===t||t<i||t>=s?Math.random()*(s-i)+i:t}this.width=this.width||i.width,this.height=this.height||i.height,this.x=void 0===this.x?i.x:this.x,this.y=void 0===this.y?i.y:this.y,this.lineWidth=this.lineWidth||Math.min(i.height/i.heightInPixel,i.width/i.widthInPixel)/2,this.wi=this.width/2+this.x,this.xi=this.height/2+this.y,this.Pi=Math.max(this.width,this.height)/2;for(var h=0;h<this.count;h++)this.vi[h]=s(this.vi[h],-this.width/2),this.li[h]=s(this.li[h],-this.height/2),this.di[h]=s(this.di[h],0,this.Pi)},s.moveStar=function(t,i,s){s&&(this.bi[t]=!0);for(var h=this.width/2,n=this.height/2,r=this.vi[t]+this.moveX*i,e=this.li[t]+this.moveY*i,o=this.di[t]+this.moveZ*i;r<-h;)r+=this.width,e=Math.random()*this.height-n,this.bi[t]=!1;for(;r>h;)r-=this.width,e=Math.random()*this.height-n,this.bi[t]=!1;for(;e<-n;)e+=this.height,r=Math.random()*this.width-h,this.bi[t]=!1;for(;e>n;)e-=this.height,r=Math.random()*this.width-h,this.bi[t]=!1;for(;o<=0;)o+=this.Pi,r=Math.random()*this.width-h,e=Math.random()*this.height-n,this.bi[t]=!1;for(;o>this.Pi;)o-=this.Pi,r=Math.random()*this.width-h,e=Math.random()*this.height-n,this.bi[t]=!1;var u=this.wi+r/o*h,f=this.xi+e/o*n;if(this.bi[t]=this.bi[t]&&u>=this.x&&f>=this.y&&u<this.x+this.width&&f<this.y+this.height,s)this.vi[t]=r,this.li[t]=e,this.di[t]=o,this.gi[t]=u,this.Mi[t]=f;else{this.mi[t]=u,this.yi[t]=f;var a=4*(1-this.di[t]/this.Pi);this.highScale||(a=Math.ceil(a)),this.pi[t]=a}},s.animate=function(i){var s=t.prototype.animate.call(this,i);if(this.enabled&&void 0!==this.wi)for(var h=this.count;h--;)this.moveStar(h,i/16,!0),this.bi[h]&&this.moveStar(h,-5,!1);return s},s.resize=function(t,i){this.Ut=!0},s.detect=function(t,i,s){return this.Zt(t,i,s,!1)},s.draw=function(t,i){if(this.enabled)if(t.globalCompositeOperation=this.compositeOperation,t.globalAlpha=this.alpha*i.alpha,0==this.moveY&&0==this.moveZ&&this.moveX<0){t.fillStyle=this.color;for(var s=this.count;s--;)this.bi[s]&&t.fillRect(this.gi[s],this.Mi[s]-this.pi[s]*this.lineWidth/2,this.mi[s]-this.gi[s],this.pi[s]*this.lineWidth)}else if(t.strokeStyle=this.color,this.highScale)for(var h=this.count;h--;)this.bi[h]&&(t.beginPath(),t.lineWidth=this.pi[h]*this.lineWidth,t.moveTo(this.mi[h],this.yi[h]),t.lineTo(this.gi[h],this.Mi[h]),t.stroke(),t.closePath());else for(var n,r=5;--r;){for(t.beginPath(),t.lineWidth=r*this.lineWidth,n=this.count;n--;)this.bi[n]&&this.pi[n]===r&&(t.moveTo(this.mi[n],this.yi[n]),t.lineTo(this.gi[n],this.Mi[n]));t.stroke(),t.closePath()}},i}(N)},X=function(){function t(t,i){this.callback=t,this.duration=M(o(i),void 0),this.initialized=!1}var i=t.prototype;return i.reset=function(){this.initialized=!1},i.run=function(t,i){var s;return void 0!==this.duration?(this.callback(t,Math.min(i,this.duration),!this.initialized),this.initialized=!0,i-this.duration):(s=this.callback(t,i,!this.initialized),this.initialized=!0,s)},t}(),Y="function"==typeof t?t:t.tinycolor;function L(t,i){return i.from+t*i.delta}function q(t,i){for(var s,h=[].concat(i.values),n=h.length;n>1;)for(n--,s=0;s<n;s++)h[s]=h[s]+t*(h[s+1]-h[s]);return h[0]}function H(t,i,s){return i.colorFrom.mix(i.colorTo,100*t).toString()}function B(t,i,s){return s.changeToPath(t,i,s)}var G=function(){function t(t,i,s){for(var h in this.initialized=!1,this.changeValues=[],t)for(var n=t[h],r="rotationInDegree"===h?.017453292519943295*n:n,e="color"===h||"borderColor"===h,u="path"===h,f="function"==typeof r,a=!e&&Array.isArray(r),c=0,v="scale"===h?["scaleX","scaleY"]:"rotationInRadian"===h||"rotationInDegree"===h?["rotation"]:[h];c<v.length;c++)this.changeValues.push({name:v[c],to:a?r[r.length-1]:o(r,1,{}),bezier:!!a&&r,isColor:e,isPath:u,isFunction:!!f&&r,moveAlgorithm:e?H:u?B:a?q:L});this.duration=M(o(i),0),this.ease=M(s,function(t){return t})}var i=t.prototype;return i.reset=function(){this.initialized=!1},i.init=function(t,i){for(var s,h=this.changeValues.length;h--;)if((s=this.changeValues[h]).isFunction)if(s.from=t[s.name],s.to=s.isFunction(s.from),s.isColor)s.colorFrom=Y(s.from),s.colorTo=Y(s.to),s.moveAlgorithm=H;else if(s.isPath){var n=t.changeToPathInit(s.from,s.to);s.pathFrom=n[0],s.pathTo=n[1],s.moveAlgorithm=B}else Array.isArray(s.to)?(s.values=[t[s.name]].concat(s.to),s.moveAlgorithm=q):(s.delta=s.to-s.from,s.moveAlgorithm=L);else if(s.isColor)s.colorFrom=Y(t[s.name]),s.colorTo=Y(s.to);else if(s.isPath){var r=t.changeToPathInit(t[s.name],s.to);s.pathFrom=r[0],s.pathTo=r[1]}else s.bezier?s.values=[t[s.name]].concat(s.bezier):(s.from=t[s.name],s.delta=s.to-s.from)},i.run=function(t,i){if(this.initialized||(this.initialized=!0,this.init(t,i)),this.duration<=i)for(var s,h=this.changeValues.length;h--;)t[(s=this.changeValues[h]).name]=s.to;else for(var n,r=this.changeValues.length,e=this.ease(i/this.duration);r--;)t[(n=this.changeValues[r]).name]=n.moveAlgorithm(e,n,t);return i-this.duration},t}(),U=function(){function t(){}return t.prototype.run=function(t,i){return k.Lt},t}(),V=function(){function t(){}return t.prototype.run=function(t,i){return t.enabled=!1,k.Lt},t}(),Z=function(){function t(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];this.Aniobject=i[0]instanceof k?i[0]:d(k,i)}var i=t.prototype;return i.reset=function(t){void 0===t&&(t=0),this.Aniobject.reset&&this.Aniobject.reset(t)},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.Aniobject.play&&this.Aniobject.play(t,i)},i.run=function(t,i,s){for(var h=i;h>=0;){if(h=this.Aniobject.run(t,h,s),s=!0,!0===h)return!0;h>=0&&this.Aniobject.reset&&this.Aniobject.reset()}return h},t}(),J=function(){function t(t,i,s){this.ifCallback=t,this.Aniobject=i,this.AniobjectElse=M(s,function(){return 0})}return t.prototype.run=function(t,i){var s=o(this.ifCallback)?this.Aniobject:this.AniobjectElse;return s.run?s.run(t,i):s(t,i)},t}(),K=function(){function t(t,i){this.initialized=!1,this.image=o(t),this.durationBetweenFrames=M(o(i),0),Array.isArray(this.image)?this.count=this.image.length:(this.image=[this.image],this.count=1),this.duration=this.count*this.durationBetweenFrames}var i=t.prototype;return i.reset=function(){this.initialized=!1},i.run=function(t,i){if(this.initialized||(this.initialized=!0,this.current=-1),i>=this.duration)t.image=m.getImage(this.image[this.image.length-1]);else{var s=Math.floor(i/this.durationBetweenFrames);s!==this.current&&(this.current=s,t.image=m.getImage(this.image[this.current]))}return i-this.duration},t}(),Q=function(){function t(t,i,s){this.initialized=!1,this.frameNumber=o(t),this.framesToRight=M(o(i),!0),this.durationBetweenFrames=M(o(s),0),Array.isArray(this.frameNumber)||(this.frameNumber=[this.frameNumber]),this.duration=this.frameNumber.length*this.durationBetweenFrames}return t.prototype.run=function(t,i){var s;return s=i>=this.duration?this.frameNumber[this.frameNumber.length-1]:this.frameNumber[Math.floor(i/this.durationBetweenFrames)],this.framesToRight?t.frameX=t.frameWidth*s:t.frameY=t.frameHeight*s,i-this.duration},t}(),$=function(){function t(t){for(var i=arguments.length,s=new Array(i>1?i-1:0),h=1;h<i;h++)s[h-1]=arguments[h];this.Aniobject=s[0]instanceof k?s[0]:d(k,s),this.times=this.timesOrg=M(o(t),1)}var i=t.prototype;return i.reset=function(t){void 0===t&&(t=0),this.times=this.timesOrg,this.Aniobject.reset&&this.Aniobject.reset(t)},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.times=this.timesOrg,this.Aniobject.play&&this.Aniobject.play(t,i)},i.run=function(t,i,s){for(var h=i;h>=0&&this.times>0;){if(h=this.Aniobject.run(t,h,s),s=!0,!0===h)return!0;h>=0&&(this.times--,this.Aniobject.reset&&this.Aniobject.reset())}return h},t}(),tt=function(t){function i(i,s,h,n){var r;return(r=t.call(this,{x:i,y:s},0,n)||this).speed=o(h)||1,r}return c(i,t),i.prototype.init=function(i,s){if(0==this.speed||this.targetX===i.x&&this.targetY===i.y)this.duration=0;else{var h=this.changeValues[0],n=this.changeValues[1];h.from=i.x,n.from=i.y,h.delta=h.to-h.from,n.delta=n.to-n.from;var r=Math.sqrt(h.delta*h.delta+n.delta*n.delta);this.duration=10*r/this.speed}t.prototype.init.call(this,i,s)},i}(G),it=function(){function t(){}return t.prototype.run=function(t,i){return k.Ht},t}(),st=function(){function t(t,i){this.Aniobject=t,this.times=M(o(i),1)}return t.prototype.run=function(t,i){if(this.times<=0)return i;var s=this.Aniobject.run(t,i);return s>=0&&this.times--,s},t}(),ht=function(){function t(t,i){this.initialized=!1,this.duration=o(i),this.shakeDiff=o(t),this.shakeDiffHalf=this.shakeDiff/2}var i=t.prototype;return i.reset=function(){this.initialized=!1},i.run=function(t,i){return this.initialized||(this.initialized=!0,this.x=t.x,this.y=t.y),i>=this.duration?(t.x=this.x,t.y=this.y):(t.x=this.x+Math.random()*this.shakeDiff-this.shakeDiffHalf,t.y=this.y+Math.random()*this.shakeDiff-this.shakeDiffHalf),i-this.duration},t}(),nt=function(){function t(){this.showOnce=!0}return t.prototype.run=function(t,i){return t.enabled=t.enabled&&this.showOnce,this.showOnce=!1,0},t}(),rt=function(){function t(t){var i=this,s=void 0===t?{}:t,h=s.states,n=s.transitions,r=void 0===n?{}:n,e=s.default,o=void 0===e?void 0:e,u=s.delegateTo,f=void 0===u?void 0:u;this.states=void 0===h?{}:h,Object.keys(this.states).forEach(function(t){Array.isArray(i.states[t])&&(i.states[t]=new k(i.states[t]))}),this.transitions=r,this.delegateTo=f,this.currentStateName=o,this.currentState=this.states[o],this.isTransitioningToStateName=void 0}var i=t.prototype;return i.setState=function(t,i){var s=this;if(t!==this.currentStateName){this.isTransitioningToStateName=t;var h=""+t.charAt(0).toUpperCase()+t.slice(1),n=[this.currentStateName+"To"+h,this.currentStateName+"To","to"+h].find(function(t){return s.transitions[t]});n?(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.transitions[n],this.currentState&&this.currentState.reset&&this.currentState.reset()):(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.states[this.currentStateName],this.currentState&&this.currentState.reset&&this.currentState.reset(),this.isTransitioningToStateName=void 0)}},i.play=function(t,i){void 0===t&&(t=""),void 0===i&&(i=0),this.currentState.play&&this.currentState.play(t,i)},i.run=function(t,i,s){var h=i,n=s;if(this.currentState){if(!0===(h=this.currentState.run(t,h,n)))return!0;n=!0}if(h>=0||!this.currentState)if(this.isTransitioningToStateName){if(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.states[this.currentStateName],this.currentState&&this.currentState.reset&&this.currentState.reset(),this.isTransitioningToStateName=void 0,!0===(h=this.currentState.run(t,h,n)))return!0}else this.currentState=void 0;return-1},t}(),et=function(){function t(){}return t.prototype.run=function(t,i){return k.qt},t}(),ot=function(){function t(){}return t.prototype.run=function(t,i){return t.enabled=!1,k.qt},t}(),ut={Callback:X,ChangeTo:G,End:U,EndDisabled:V,Forever:Z,If:J,Image:K,ImageFrame:Q,Loop:$,Move:tt,Once:st,Remove:it,Sequence:k,Shake:ht,ShowOnce:nt,State:rt,Stop:et,StopDisabled:ot,Wait:A,WaitDisabled:function(){function t(t){this.duration=M(o(t),0)}return t.prototype.run=function(t,i){return t.enabled=i>=this.duration,i-this.duration},t}()},ft={Default:b,Audio:function(t){function i(i){var s;return void 0===i&&(i={}),(s=t.call(this,i)||this).Z=Number.POSITIVE_INFINITY,s.Ai=null,s.ki=null,s.Si=!1,s.ji=s.U.audioElement,s}c(i,t);var s=i.prototype;return s.init=function(){this.ji&&("function"==typeof MediaController&&(this.ji.controller=new MediaController,this.Si=!0),this.ji.preload="auto",this.ji.load())},s.isLoaded=function(){if(this.ji){if(!(this.ji.readyState>=this.ji.HAVE_ENOUGH_DATA))return!1;var t=this.ji.play();if(t&&t.catch(function(t){}),this.ji.duration>0)return 1e3*this.ji.duration}return!0},s.currentTime=function(){var i=t.prototype.currentTime.call(this);if(this.ji){var s=1e3*(this.ji.ended?this.ji.duration:this.ji.currentTime);if(this.Si){if(null===this.Ai)return this.Ai=i,this.ki=s,s;if("playing"===this.ji.controller.playbackState){if(s===this.ki)return this.ki+Math.min(260,i-this.Ai);if(s-this.ki<500&&s>this.ki&&i-this.Ai<350)return this.Ai=this.Ai+(s-this.ki),this.ki=s,this.ki+i-this.Ai}return this.Ai=i,this.ki=s,this.ki}return s}return i},s.clampTime=function(t){return t},s.shiftTime=function(t){return 0},a(i,[{key:"audioElement",get:function(){return this.ji}}]),i}(b)};export{ut as Animations,u as Engine,m as ImageManager,P as Scenes,W as Sprites,ft as Timing};
//# sourceMappingURL=animationvideo.mjs.map
