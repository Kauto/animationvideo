import t from"color";import e from"pasition";import n from"eases";export{default as Easing}from"eases";function s(t){for(var i=[],e=arguments.length-1;e-- >0;)i[e]=arguments[e+1];return"function"==typeof t?t.apply(null,i):t}var o=function(t){var i=this,e=t;if("object"!=typeof t)throw new Error("No canvas given for Engine constructor");if(t.getContext)e={canvas:t};else if(!t.canvas)throw new Error("No canvas given for Engine constructor");var n=Object.assign({},{scene:null,canvas:null,autoSize:!1,clickToPlayAudio:!1},e);if(this._output={canvas:null,context:null,w:0,h:0,ratio:1},this._scene=null,this._isSceneInitialized=!1,this._newScene=null,this._lastTimestamp=0,this._timePassed=0,this._recalculateCanvas=!1,this._referenceRequestAnimationFrame=null,this._output.canvas=n.canvas,"object"!=typeof n.canvas||null===n.canvas||!n.canvas.getContext)throw new Error("Countn't create contect for canvas in Engine");if(n.autoSize){var s={enabled:!0,scaleLimitMin:1,scaleLimitMax:8,scaleFactor:1.1,referenceWidth:function(){return i._output.canvas.clientWidth},referenceHeight:function(){return i._output.canvas.clientHeight},currentScale:1,waitTime:800,currentWaitedTime:0,currentOffsetTime:0,offsetTimeLimitUp:300,offsetTimeLimitDown:300,offsetTimeTarget:1e3/60,offsetTimeDelta:3,registerResizeEvents:!0,registerVisibilityEvents:!0,setCanvasStyle:!1};this._autoSize="object"==typeof n.autoSize?Object.assign({},s,n.autoSize):s,this._autoSize.registerResizeEvents&&(window.addEventListener("resize",this.recalculateCanvas.bind(this),!1),window.addEventListener("orientationchange",this.recalculateCanvas.bind(this),!1)),this._autoSize.registerVisibilityEvents&&document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this),!1),this.recalculateCanvas()}else this._output.w=this._output.canvas.width,this._output.h=this._output.canvas.height,this._output.ratio=this._output.w/this._output.h;this._output.context=n.canvas.getContext("2d"),n.clickToPlayAudio&&n.canvas.addEventListener("click",this.playAudioOfScene.bind(this),!1),this.switchScene(n.scene),this.normalizeContext(this._output.context)};o.prototype.handleVisibilityChange=function(){this._autoSize.enabled=!("hidden"==document.visibilityState)},o.prototype.playAudioOfScene=function(){this._isSceneInitialized&&this._scene&&this._scene.audioElement&&this._scene.audioElement.play()},o.prototype.normalizeContext=function(t){t.textBaseline="middle",t.textAlign="center",t.globalAlpha=1,t.globalCompositeOperation="source-over"},o.prototype.getWidth=function(){return this._output.w},o.prototype.getHeight=function(){return this._output.h},o.prototype.recalculateCanvas=function(){if(this._autoSize){var t=s(this._autoSize.referenceWidth),i=s(this._autoSize.referenceHeight);if(t<=0||i<=0)return;this._output.canvas.width=Math.round(t/this._autoSize.currentScale),this._output.canvas.height=Math.round(i/this._autoSize.currentScale),this._autoSize.setCanvasStyle&&(this._output.canvas.style.width=t+"px",this._output.canvas.style.height=i+"px"),this._autoSize.currentWaitedTime=0,this._autoSize.currentOffsetTime=0}return this._output.w=this._output.canvas.width,this._output.h=this._output.canvas.height,this._output.ratio=this._output.w/this._output.h,this.resize(),this},o.prototype.resize=function(){return this._scene&&this._scene.resize&&this._scene.resize(this._output),this},o.prototype.switchScene=function(t){return t&&(this._newScene=t),this},o.prototype.loadingscreen=function(){var t=this._output.context;t.globalCompositeOperation="source-over",t.globalAlpha=1,t.fillStyle="rgba(0,0,0,0.5)",t.fillRect(0,0,this._output.w,this._output.h),t.font="20px Georgia",t.fillStyle="#FFF";var i=this._isSceneInitialized?this._scene.getPercentLoaded():0;t.textAlign="left",t.textBaseline="bottom",t.fillText("Loading "+i+"%",10+3*Math.random(),this._output.h-10+3*Math.random()),this.normalizeContext(t)},o.prototype.run=function(t){return t=t||{},this._referenceRequestAnimationFrame=window.requestAnimationFrame(function i(e){if(this._referenceRequestAnimationFrame=window.requestAnimationFrame(i.bind(this)),this._recalculateCanvas&&(this.recalculateCanvas(),this._recalculateCanvas=!1),this._realLastTimestamp||(this._realLastTimestamp=e),null!==this._newScene){var n=this._scene?this._scene.destroy(this._output):t;n&&(this._newScene.callInit(this._output,n,this),this._scene=this._newScene,this._newScene=null,this._isSceneInitialized=!1)}if(this._scene&&this._output.canvas.width){var s=this._scene.currentTime();this._timePassed=this._scene.clampTime(s-this._lastTimestamp);var o=this._scene.shiftTime(this._timePassed);if(this._timePassed=this._timePassed+o,this._lastTimestamp=s+o,this._isSceneInitialized){if(0!==this._timePassed&&(this._autoSize&&this._autoSize.enabled&&(s=window.performance?performance.now():Date.now()),this._scene.move(this._output,this._timePassed),this._timePassed<0&&(this._timePassed=this._scene.totalTimePassed),this._scene.draw(this._output),this._autoSize&&this._autoSize.enabled)){var a=(window.performance?performance.now():Date.now())-s-this._autoSize.offsetTimeTarget;this._autoSize.currentWaitedTime<this._autoSize.waitTime?this._autoSize.currentWaitedTime+=e-this._realLastTimestamp:Math.abs(a)<=this._autoSize.offsetTimeDelta?this._autoSize.currentOffsetTime=this._autoSize.currentOffsetTime>=0?Math.max(0,this._autoSize.currentOffsetTime-this._autoSize.offsetTimeDelta):Math.min(0,this._autoSize.currentOffsetTime+this._autoSize.offsetTimeDelta):a<0&&this._autoSize.currentScale>this._autoSize.scaleLimitMin?(this._autoSize.currentOffsetTime+=a,this._autoSize.currentOffsetTime<=this._autoSize.offsetTimeLimitDown&&(this._autoSize.currentScale=Math.max(this._autoSize.scaleLimitMin,this._autoSize.currentScale/this._autoSize.scaleFactor),this._recalculateCanvas=!0)):a>0&&this._autoSize.currentScale<this._autoSize.scaleLimitMax&&(this._autoSize.currentOffsetTime+=a,this._autoSize.currentOffsetTime>=this._autoSize.offsetTimeLimitUp&&(this._autoSize.currentScale=Math.min(this._autoSize.scaleLimitMax,this._autoSize.currentScale*this._autoSize.scaleFactor),this._recalculateCanvas=!0))}}else this._isSceneInitialized=this._scene.callLoading(this._output),this._isSceneInitialized&&this._autoSize&&(this._autoSize.currentWaitedTime=0)}this._realLastTimestamp=e}.bind(this)),this},o.prototype.destroy=function(){return this._referenceRequestAnimationFrame&&window.cancelAnimationFrame(this._referenceRequestAnimationFrame),this._referenceRequestAnimationFrame=null,window.removeEventListener("resize",this.recalculateCanvas.bind(this),!1),window.removeEventListener("orientationchange",this.recalculateCanvas.bind(this),!1),document.removeEventListener("visibilitychange",this.handleVisibilityChange.bind(this),!1),this._output.canvas.removeEventListener("click",this.playAudioOfScene.bind(this),!1),this};var a=function(){};a.add=function(t,i){var e=this||a,n=function(n){e.Images[n]?i&&"function"==typeof i[n]&&i[n](n,e.Images[n]):(e.Images[n]=new window.Image,e.Images[n].onload=function(){e.loaded++,i&&"function"==typeof i?e.isLoaded()&&i():i&&"function"==typeof i[n]&&i[n](n,e.Images[n])},e.Images[n].src=t[n],e.count++)};for(var s in t)n(s);return i&&"function"==typeof i&&e.isLoaded()&&i(),e},a.reset=function(){var t=this||a;return t.Images={},t.count=0,t.loaded=0,t},a.getLoaded=function(){return(this||a).loaded},a.getCount=function(){return(this||a).count},a.isLoaded=function(){var t=this||a;return t.loaded===t.count},a.getImage=function(t){return"object"==typeof t?t:(this||a).Images[t]},a.Images={},a.count=0,a.loaded=0;var r=function(){this.layer=[],this.isFunction=[],this.start=0,this.nextFree=0};r.prototype.addElement=function(t){return this.addElementForId(t),t},r.prototype.addElements=function(t){return this.addElementsForIds(t),t},r.prototype.addElementForId=function(t){var i=this.layer.length,e=this.nextFree;this.layer[e]=t,this.isFunction[e]="function"==typeof t,i===e&&i++;for(var n=this.nextFree+1;n!==i&&layer[n];)n++;return this.nextFree=n,this.start>e&&(this.start=e),e},r.prototype.addElementsForIds=function(t){var i=this,e=this.layer.length;return e===this.nextFree?(this.layer=this.layer.concat(t),this.nextFree=this.layer.length,t.forEach(function(t,n){i.isFunction[e+n]="function"==typeof t}),Array.from({length:t.length},function(t,i){return i+e})):t.map(function(t){return i.addElement(t)})},r.prototype.getById=function(t){return this.layer[t]},r.prototype.getIdByElement=function(t){return this.layer.indexOf(t)},r.prototype.deleteByElement=function(t){var i=this.getIdByElement(t);i>=0&&this.deleteById(i)},r.prototype.deleteById=function(t){var i=this.layer.length-1;if(i>0&&t===i){for(this.layer[t]=null;i&&!this.layer[i-1];)i--;this.layer.length=i,this.isFunction.length=i,this.nextFree=Math.min(this.nextFree,i),this.start=Math.min(this.start,i)}else this.layer[t]=null,this.nextFree=Math.min(this.nextFree,t),this.start===t&&(this.start=t+1)},r.prototype.forEach=function(t){var i,e,n=this.layer.length;for(i=this.start;i<n;i++)(e=this.layer[i])&&t({index:i,element:e,isFunction:this.isFunction[i],layer:this})},r.prototype.count=function(){return this.layer.length},r.prototype.clear=function(){this.layer=[],this.isFunction=[],this.start=0,this.nextFree=0};var h=function(){this.layers=[]};function l(t,i){return null==t||""===t?i:t}h.prototype.addLayer=function(){return this.layers[this.layers.length]=new r,this.layers[this.layers.length-1]},h.prototype.addLayerForId=function(){return this.layers[this.layers.length]=new r,this.layers.length-1},h.prototype.addLayersForIds=function(t){var i=this;void 0===t&&(t=1);var e=Array.from({length:t},function(t,e){return e+i.layers.length});return this.layers=this.layers.concat(Array.from({length:t},function(t){return new r})),e},h.prototype.getById=function(t){return this.layers[t]},h.prototype.forEach=function(t){var i,e=this.layers.length;for(i=0;i<e;i++)this.layers[i].forEach(t)},h.prototype.count=function(){return this.layers.length},h.prototype.clear=function(){this.layers=[]};var c=function(t){this.configuration="function"==typeof t?new t:t,this.layerManager=new h,this.totalTimePassed=0,this.engine=null,this.initDone=!1,this.additionalModifier=void 0,this.tickChunk=s(this.configuration.tickChunk),this.maxSkippedTickChunk=l(s(this.configuration.maxSkippedTickChunk),3),this.tickChunkTolerance=l(s(this.configuration.tickChunkTolerance),.1)};c.prototype.currentTime=function(){return window.performance?performance.now():Date.now()},c.prototype.clampTime=function(t){var i=2e3;return this.tickChunk&&(i=this.tickChunk*this.maxSkippedTickChunk),t>i?i:t},c.prototype.shiftTime=function(t){return this.tickChunk?-t%this.tickChunk:0},c.prototype.callInit=function(t,i,e){var n=this;this.engine=e,this.resize(t);var o=s(this.configuration.images);o&&a.add(o),Promise.resolve(this.configuration.init&&this.configuration.init({engine:e,output:t,scene:this,parameter:i})).then(function(t){return n.initDone=!0})},c.prototype.resize=function(t){var i=this;this.additionalModifier={a:1,x:0,y:0,w:t.w,h:t.h,orgW:t.w,orgH:t.h,visibleScreen:{x:0,y:0,w:t.w,h:t.h}},this.layerManager.forEach(function(e){e.isFunction||e.element.resize(t,i.additionalModifier)})},c.prototype.callDestroy=function(t){this.configuration.destroy&&this.configuration.destroy({engine:this.engine,scene:this,output:t}),this.initDone=!1},c.prototype.loadingscreen=function(t,i){var e=t.context,n=Math.max(1,i*t.h);e.globalCompositeOperation="source-over",e.globalAlpha=1,e.clearRect(0,0,t.w,t.h),e.fillStyle="#aaa",e.fillRect(0,t.h/2-n/2,t.w,n),e.font="20px Georgia",e.fillStyle="#fff",e.textAlign="left",e.textBaseline="bottom";var s=i;isNaN(parseFloat(i))||isNaN(i-0)||(s="Loading "+Math.round(100*i)+"%"),e.fillText(s,10+3*Math.random(),t.h-10+3*Math.random()),this.engine&&this.engine.normalizeContext(e)},c.prototype.callLoading=function(t){if(a.isLoaded()&&this.initDone)return this.reset(t),!0;var i=a.getCount()?a.getLoaded()/a.getCount():"Loading...";return this.configuration.loading?this.configuration.loading({engine:this.engine,scene:this,output:t,value:i}):this.loadingscreen(t,i),!1},c.prototype.move=function(t,i){if(this.totalTimePassed+=i,i<0?(this.reset(t),i=this.totalTimePassed):this.configuration.endTime&&this.configuration.endTime<=this.totalTimePassed&&(i-=this.totalTimePassed-this.endTime,this.totalTimePassed=this.endTime,this.configuration.end&&this.configuration.end({engine:this.engine,scene:this,output:t})),this.configuration.beforeMove)if(this.tickChunk){if(i>=this.tickChunk-this.tickChunkTolerance)for(var e=0,n=Math.min(this.maxSkippedTickChunk,Math.floor(i/this.tickChunk));e<n;e++)this.configuration.beforeMove({engine:this.engine,scene:this,layerManager:this.layerManager,output:t,timepassed:i})}else this.configuration.beforeMove({engine:this.engine,scene:this,layerManager:this.layerManager,output:t,timepassed:i});this.layerManager.forEach(function(t){var e=t.layer,n=t.index;t.isFunction||t.element.animate(i)&&e.deleteById(n)}),this.configuration.afterMove&&this.configuration.afterMove({engine:this.engine,scene:this,layerManager:this.layerManager,output:t,timepassed:i})},c.prototype.draw=function(t){var i=this;this.layerManager.forEach(function(e){var n=e.layer,s=e.element,o=e.index;e.isFunction?s({engine:i.engine,scene:i,layerManager:i.layerManager,layer:n,output:t,timepassed:i.totalTimePassed})&&n.deleteById(o):s.draw(t.context,i.additionalModifier)})},c.prototype.reset=function(t){var i=this.configuration.reset?this.configuration.reset({engine:this.engine,scene:this,layerManager:this.layerManager,output:t}):new h;if(Array.isArray(i)){var e=i;i=new h,e.forEach(function(t){i.addLayer().addElements(t)})}i&&(this.layerManager=i)};var u=function(t){function i(i){t.call(this),this.audioStartTime=null,this.audioPosition=null,this.enableAndroidHack=!1,this.audioElement=i}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.currentTime=function(){var i=t.prototype.currentTime.call(this);if(this.audioElement){if(this.enableAndroidHack){if(null===this.audioStartTime)return this.audioStartTime=i,this.audioPosition=this.audioElement.currentTime,1e3*this.audioElement.currentTime;if("playing"===this.audioElement.controller.playbackState){if(this.audioElement.currentTime===this.audioPosition)return 1e3*this.audioPosition+Math.min(260,i-this.audioStartTime);if(this.audioElement.currentTime-this.audioPosition<.5&&this.audioElement.currentTime>this.audioPosition&&i-this.audioStartTime<350)return this.audioStartTime=this.audioStartTime+1e3*(this.audioElement.currentTime-this.audioPosition),this.audioPosition=this.audioElement.currentTime,1e3*this.audioPosition+i-this.audioStartTime}return this.audioStartTime=i,this.audioPosition=this.audioElement.currentTime,1e3*this.audioPosition}return 1e3*this.audioElement.currentTime}return i},i.prototype.clampTime=function(t){return t},i.prototype.init=function(){for(var i=[],e=arguments.length;e--;)i[e]=arguments[e];return this.audioElement&&(this.audioElement.canPlayType("audio/mp3").match(/maybe|probably/i),"function"==typeof MediaController&&(this.audioElement.controller=new MediaController,this.enableAndroidHack=!0),this.audioElement.preload="auto",this.audioElement.load()),t.prototype.init.apply(this,i)},i.prototype.callLoading=function(i){var e=t.prototype.callLoading.call(this,i);if(e&&this.audioElement){if(!(this.audioElement.readyState>=this.audioElement.HAVE_ENOUGH_DATA))return this.loadingscreen(i,"Waiting for Audio"),!1;this.audioElement.play(),this.loadingscreen(i,"Click to play")}return e},i}(c);function p(){this.reset()}p.prototype.reset=function(){return this.m=[1,0,0,1,0,0],this},p.prototype.multiply=function(t){var i=this.m[1]*t.m[0]+this.m[3]*t.m[1],e=this.m[0]*t.m[2]+this.m[2]*t.m[3],n=this.m[1]*t.m[2]+this.m[3]*t.m[3],s=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],o=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=this.m[0]*t.m[0]+this.m[2]*t.m[1],this.m[1]=i,this.m[2]=e,this.m[3]=n,this.m[4]=s,this.m[5]=o,this},p.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),i=-this.m[1]*t,e=-this.m[2]*t,n=this.m[0]*t,s=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=this.m[3]*t,this.m[1]=i,this.m[2]=e,this.m[3]=n,this.m[4]=s,this.m[5]=o,this},p.prototype.rotate=function(t){var i=Math.cos(t),e=Math.sin(t),n=this.m[1]*i+this.m[3]*e,s=this.m[0]*-e+this.m[2]*i,o=this.m[1]*-e+this.m[3]*i;return this.m[0]=this.m[0]*i+this.m[2]*e,this.m[1]=n,this.m[2]=s,this.m[3]=o,this},p.prototype.translate=function(t,i){return this.m[4]+=this.m[0]*t+this.m[2]*i,this.m[5]+=this.m[1]*t+this.m[3]*i,this},p.prototype.scale=function(t,i){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=i,this.m[3]*=i,this},p.prototype.transformPoint=function(t,i){var e=t;return[t=e*this.m[0]+i*this.m[2]+this.m[4],i=e*this.m[1]+i*this.m[3]+this.m[5]]},p.prototype.clone=function(){var t=new p;return t.m=this.m.slice(0),t};var d=function(t){function i(){for(var i=[],e=arguments.length;e--;)i[e]=arguments[e];t.apply(this,i),this.transform=null,this.transformInvert=null}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype._getViewport=function(){if(!this.engine)return new p;if(!this.transform){var t=this.engine._output.w/2,i=this.engine._output.h/2,e=this.engine._output.ratio>1?t:i;this.transform=(new p).translate(t,i).scale(e,e),this.transformInvert=null}return this.transform},i.prototype.resize=function(t){var i=this;this.transform=null,this.transformInvert=null,this.additionalModifier={a:1,x:-1,y:-1,w:2,h:2,orgW:t.w,orgH:t.h,scaleCanvas:t.w/t.canvas.clientWidth};var e=this.transformPoint(0,0,1),n=e[0],s=e[1],o=this.transformPoint(t.w,t.h,1);this.additionalModifier.visibleScreen={x:n,y:s,w:o[0]-n,h:o[1]-s},this.layerManager.forEach(function(e){e.isFunction||e.element.resize(t,i.additionalModifier)})},i.prototype.transformPoint=function(t,i,e){return void 0===e&&(e=this.additionalModifier.scaleCanvas),this.transformInvert||(this.transformInvert=this._getViewport().clone().invert()),this.transformInvert.transformPoint(t*e,i*e)},i.prototype.draw=function(i){var e;i.context.save(),(e=i.context).setTransform.apply(e,this._getViewport().m),t.prototype.draw.call(this,i),i.context.restore()},i}(c),m=function(t){function i(i){t.call(this,i)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.resize=function(t){this.additionalModifier={a:1,x:-1,y:-1,w:2,h:2,orgW:t.w,orgH:t.h}},i.prototype.draw=function(i){i.context.save(),i.context.translate(i.w/2,i.h/2),i.context.scale(i.w,i.h),i.context.translate(-.5,-.5),t.prototype.draw.call(this,i),i.context.restore()},i}(u),f={Default:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(c,[null].concat(t)))},Audio:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(u,[null].concat(t)))},Norm:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(d,[null].concat(t)))},NormAudio:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(m,[null].concat(t)))}},g=function(t){this.x=l(s(t.x),0),this.y=l(s(t.y),0),this.arc=l(s(t.arc),0),this.scaleX=l(s(t.scaleX),1),this.scaleY=l(s(t.scaleY),1),this.a=l(s(t.a),1),this.alphaMode=l(s(t.alphaMode),"source-over"),this.color=l(s(t.color),"#fff"),this.animation=s(t.animation),this.enabled=l(s(t.enabled),!0)};g.prototype.changeAnimationStatus=function(t){"object"==typeof this.animation&&this.animation.changeAnimationStatus(t)},g.prototype.animate=function(t){return"object"==typeof this.animation&&this.animation.run(this,t,!0)>=0},g.prototype.resize=function(t,i){},g.prototype.draw=function(t,i){this.enabled&&(t.globalCompositeOperation=this.alphaMode,t.globalAlpha=this.a*i.a,t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.beginPath(),t.fillStyle=this.color,t.arc(0,0,1,.017453292519943295*(90+this.arc),.017453292519943295*(450-this.arc),!1),t.fill(),t.closePath(),t.restore())};var y=function(t){function i(i){"function"==typeof i&&(i={callback:i}),t.call(this,i),this.callback=i.callback,this.timepassed=0,this.deltaTime=0}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.animate=function(i){return this.enabled&&(this.timepassed+=i,this.deltaTime+=i),t.prototype.animate.call(this,i)},i.prototype.draw=function(t,i){this.enabled&&this.callback(t,this.timepassed,i,this),this.deltaTime=0},i}(g),v=function(t){function i(i){t.call(this,i),this.sprite=l(i.sprite,[])}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.changeAnimationStatus=function(i){for(var e in t.prototype.changeAnimationStatus.call(this,i),this.sprite)this.sprite[e].changeAnimationStatus(i)},i.prototype.animate=function(i){var e=t.prototype.animate.call(this,i),n=!0;if(this.enabled)for(var s in this.sprite)n=this.sprite[s].animate(i)&&n;return this.animation?e:(n&&(this.enabled=!1),n)},i.prototype.draw=function(t,i){if(this.enabled){for(var e in this.a<1&&((i=Object.assign({},i)).a*=this.a),t.save(),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(.017453292519943295*this.arc),this.sprite)this.sprite[e].draw(t,i);t.restore()}},i}(g),_=function(t){function i(i){t.call(this,i),this.x=s(i.x),this.y=s(i.y),this.width=s(i.width),this.height=s(i.height),this.gridSize=s(i.gridSize),this.norm=ifNull(s(i.norm),void 0===this.x&&void 0===this.y&&void 0===this.width&&void 0===this.height),this.currentGridSize=!1}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.generateTempCanvas=function(t,i){var e=i.orgW||t.canvas.width,n=i.orgH||t.canvas.height;this.temp_canvas=document.createElement("canvas"),this.gridSize?(this.currentGridSize=this.gridSize,this.temp_canvas.width=Math.round(this.currentGridSize),this.temp_canvas.height=Math.round(this.currentGridSize)):(this.temp_canvas.width=Math.round(e/this.scaleX),this.temp_canvas.height=Math.round(n/this.scaleY)),this.tctx=this.temp_canvas.getContext("2d"),this.tctx.globalCompositeOperation="source-over",this.tctx.globalAlpha=1},i.prototype.normalizeFullScreen=function(t){(void 0===this.x||this.norm)&&(this.x=t.visibleScreen.x),(void 0===this.y||this.norm)&&(this.y=t.visibleScreen.y),(void 0===this.width||this.norm)&&(this.width=t.visibleScreen.w),(void 0===this.height||this.norm)&&(this.height=t.visibleScreen.h)},i.prototype.resize=function(t,i){if(this.temp_canvas&&this.currentGridSize!==this.gridSize){var e=this.temp_canvas;this.generateTempCanvas(t,i),this.tctx.globalCompositeOperation="copy",this.tctx.drawImage(e,0,0,e.width,e.height,0,0,this.temp_canvas.width,this.temp_canvas.height),this.tctx.globalCompositeOperation="source-over"}this.normalizeFullScreen(i)},i.prototype.draw=function(t,i){if(this.enabled){this.temp_canvas||(this.generateTempCanvas(t,i),this.normalizeFullScreen(i)),this.gridSize&&this.currentGridSize!==this.gridSize&&this.resize(t,i);var e=this.width,n=this.height,s=e/2,o=n/2,a=this.temp_canvas.width,r=this.temp_canvas.height;for(var h in this.sprite)this.sprite[h].draw(this.tctx,{a:1,x:0,y:0,w:a,h:r,orgW:a,orgH:r,visibleScreen:{x:0,y:0,w:a,h:r}});t.save(),t.globalCompositeOperation=this.alphaMode,t.globalAlpha=this.a*i.a,t.translate(this.x+s,this.y+o),t.scale(this.scaleX,this.scaleY),t.rotate(.017453292519943295*this.arc),t.drawImage(this.temp_canvas,0,0,this.temp_canvas.width,this.temp_canvas.height,-s,-o,e,n),t.restore()}},i}(v),b=function(t){function i(i){t.call(this,i.self||{});var e={},n={};for(var o in i)-1===["self","class","count"].indexOf(o)&&("function"==typeof i[o]?n[o]=i[o]:e[o]=i[o]);var a=l(s(i.count),1);this.sprite=[];for(var r=0;r<a;r++){var h=i.class,c={};for(var u in e)c[u]=e[u];for(var p in n)c[p]=n[p].call(null,r);this.sprite[r]=new h(c)}}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i}(v),w=function(t){function i(i){t.call(this,i),this.x=s(i.x),this.y=s(i.y),this.width=s(i.width),this.height=s(i.height),this.gridSize=s(i.gridSize),this.darker=l(s(i.darker),0),this.pixel=l(s(i.pixel),!1),this.clear=l(s(i.clear),!1),this.norm=l(s(i.norm),void 0===this.x&&void 0===this.y&&void 0===this.width&&void 0===this.height),this.currentGridSize=!1}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.generateTempCanvas=function(t,i){var e=i.orgW||t.canvas.width,n=i.orgH||t.canvas.height;this.temp_canvas=document.createElement("canvas"),this.gridSize?(this.currentGridSize=this.gridSize,this.temp_canvas.width=Math.round(this.currentGridSize),this.temp_canvas.height=Math.round(this.currentGridSize)):(this.temp_canvas.width=Math.ceil(e/this.scaleX),this.temp_canvas.height=Math.ceil(n/this.scaleY)),this.tctx=this.temp_canvas.getContext("2d"),this.tctx.globalCompositeOperation="source-over",this.tctx.globalAlpha=1},i.prototype.normalizeFullScreen=function(t){(void 0===this.x||this.norm)&&(this.x=t.visibleScreen.x),(void 0===this.y||this.norm)&&(this.y=t.visibleScreen.y),(void 0===this.width||this.norm)&&(this.width=t.visibleScreen.w),(void 0===this.height||this.norm)&&(this.height=t.visibleScreen.h)},i.prototype.resize=function(t,i){if(this.temp_canvas&&this.currentGridSize!==this.gridSize){var e=this.temp_canvas;this.generateTempCanvas(t,i),this.tctx.globalCompositeOperation="copy",this.tctx.drawImage(e,0,0,e.width,e.height,0,0,this.temp_canvas.width,this.temp_canvas.height),this.tctx.globalCompositeOperation="source-over"}this.normalizeFullScreen(i)},i.prototype.draw=function(t,i){if(this.enabled){this.temp_canvas||(this.generateTempCanvas(t,i),this.normalizeFullScreen(i)),this.gridSize&&this.currentGridSize!==this.gridSize&&this.resize(t,i);var e=this.a*i.a,n=this.width,s=this.height,o=this.temp_canvas.width,a=this.temp_canvas.height;e>0&&o&&a&&(this.tctx.globalCompositeOperation="copy",this.tctx.globalAlpha=1,this.tctx.drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height,0,0,o,a),this.darker>0&&(this.tctx.globalCompositeOperation=this.clear?"source-atop":"source-over",this.tctx.fillStyle="rgba(0,0,0,"+this.darker+")",this.tctx.fillRect(0,0,o,a)),this.clear&&t.clearRect(this.x,this.y,n,s),t.globalCompositeOperation=this.alphaMode,t.globalAlpha=e,t.imageSmoothingEnabled=!this.pixel,t.drawImage(this.temp_canvas,0,0,o,a,this.x,this.y,n,s),t.imageSmoothingEnabled=!0)}else this.clear&&(this.x||(this.x=i.x),this.y||(this.y=i.y),this.width||(this.width=i.w),this.height||(this.height=i.h),t.clearRect(this.x,this.y,this.width,this.height))},i}(g),S=function(t){function i(e){t.call(this,e),this.image=a.getImage(s(e.image)),this.position=l(s(e.position),i.CENTER),this.frameX=l(s(e.frameX),0),this.frameY=l(s(e.frameY),0),this.frameWidth=l(s(e.frameWidth),0),this.frameHeight=l(s(e.frameHeight),0),this.norm=l(s(e.norm),!1)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.resize=function(){this.normScale=void 0},i.prototype.draw=function(t,e){if(this.enabled&&this.image){var n=this.frameWidth||this.image.width,s=this.frameHeight||this.image.height;this.normScale||(this.normScale=this.norm?Math.min(e.w/n,e.h/s):1);var o=n*this.normScale*this.scaleX,a=s*this.normScale*this.scaleY;t.globalCompositeOperation=this.alphaMode,t.globalAlpha=this.a*e.a,0==this.arc?this.position===i.LEFT_TOP?t.drawImage(this.image,this.frameX,this.frameY,n,s,this.x,this.y,o,a):t.drawImage(this.image,this.frameX,this.frameY,n,s,this.x-o/2,this.y-a/2,o,a):(t.save(),t.translate(this.x,this.y),t.rotate(.017453292519943295*this.arc),t.drawImage(this.image,this.frameX,this.frameY,n,s,-o/2,-a/2,o,a),t.restore())}},i}(g);S.LEFT_TOP=0,S.CENTER=1;var T=function(t){function i(e){t.call(this,e),this.text=s(e.text),this.font=l(s(e.font),"26px monospace"),this.position=l(s(e.position),i.CENTER),this.color=s(e.color),this.borderColor=s(e.borderColor),this.lineWidth=l(s(e.lineWidth),1)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.draw=function(t,e){this.enabled&&(t.globalCompositeOperation=this.alphaMode,t.globalAlpha=this.a*e.a,t.save(),i.LEFT_TOP&&(t.textAlign="left",t.textBaseline="top"),t.translate(this.x,this.y),t.scale(this.scaleX,this.scaleY),t.rotate(.017453292519943295*this.arc),t.font=this.font,this.color&&(t.fillStyle=this.color,t.fillText(this.text,0,0)),this.borderColor&&(t.strokeStyle=this.borderColor,t.lineWidth=this.lineWidth,t.strokeText(this.text,0,0)),t.restore())},i}(g);T.LEFT_TOP=0,T.CENTER=1;var x=function(i){function e(t){i.call(this,t)}return i&&(e.__proto__=i),(e.prototype=Object.create(i&&i.prototype)).constructor=e,e.getGradientImage=function(t,i,n){var s,o,a=t>>4,r=i>>4,h=n>>4;if(!e.Gradient)for(e.Gradient=new Array(16),s=0;s<e.Gradient.length;s++)for(e.Gradient[s]=new Array(16),o=0;o<e.Gradient[s].length;o++)e.Gradient[s][o]=new Array(16);return e.Gradient[a][r][h]||(e.Gradient[a][r][h]=e.generateGradientImage(a,r,h)),e.Gradient[a][r][h]},e.generateGradientImage=function(t,i,e){var n=document.createElement("canvas");n.width=n.height=64;var s=n.getContext("2d");s.globalAlpha=1,s.globalCompositeOperation="source-over",s.clearRect(0,0,64,64);var o=s.createRadialGradient(32,32,0,32,32,32);return o.addColorStop(0,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(e<<4)-1)+",1)"),o.addColorStop(.3,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(e<<4)-1)+",0.4)"),o.addColorStop(1,"rgba("+(16+(t<<4)-1)+","+(16+(i<<4)-1)+","+(16+(e<<4)-1)+",0)"),s.fillStyle=o,s.fillRect(0,0,64,64),n},e.prototype.draw=function(i,n){if(this.enabled){this.color&&this.color.color||(this.color=t(this.color).rgb());var s=this.color.color;i.globalCompositeOperation=this.alphaMode,i.globalAlpha=this.a*n.a,i.imageSmoothingEnabled=this.scaleX*n.orgW/n.w>64,i.drawImage(e.getGradientImage(s[0],s[1],s[2]),0,0,64,64,this.x-this.scaleX/2,this.y-this.scaleY/2,this.scaleX,this.scaleY),i.imageSmoothingEnabled=!0}},e}(g);x.Gradient=null;var E=function(t){function i(i){t.call(this,i),this.oldPath=void 0,this.path=s(i.path),this.path2D=new Path2D,this.color=s(i.color),this.borderColor=s(i.borderColor),this.lineWidth=l(s(i.lineWidth),1),this.clip=l(s(i.clip),!1),this.fixed=l(s(i.fixed),!1)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.draw=function(t,i){var e=this;if(this.enabled){var n=this.a;this.oldPath!==this.path&&(Array.isArray(this.path)?(this.path2D=new Path2D,this.path.forEach(function(t){e.path2D.moveTo(t[0][0],t[0][1]),t.forEach(function(t){e.path2D.bezierCurveTo(t[2],t[3],t[4],t[5],t[6],t[7])}),e.path2D.closePath()})):this.path2D=new Path2D(this.path),this.oldPath=this.path),i&&(n*=i.a);var s=this.scaleX,o=this.scaleY;for(var a in this.fixed&&(0==s&&(s=1e-10),0==o&&(o=1e-10)),t.globalCompositeOperation=this.alphaMode,t.globalAlpha=n,t.save(),t.translate(this.x,this.y),t.scale(s,o),t.rotate(.017453292519943295*this.arc),this.color&&(t.fillStyle=this.color,t.fill(this.path2D)),t.save(),this.clip&&(t.clip(this.path2D),this.fixed&&(t.rotate(.017453292519943295*-this.arc),t.scale(1/s,1/o),t.translate(-this.x,-this.y))),this.sprite)this.sprite[a].draw(t,i);t.restore(),this.borderColor&&(t.strokeStyle=this.borderColor,t.lineWidth=this.lineWidth,t.stroke(this.path2D)),t.restore()}},i}(v),z=function(t){function i(i){t.call(this,i),this.width=s(i.width),this.height=s(i.height),this.x=s(i.x),this.y=s(i.y),this.borderColor=s(i.borderColor),this.lineWidth=l(s(i.lineWidth),1),this.clear=l(s(i.clear),!1)}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.draw=function(t,i){if(this.enabled)if(this.width||(this.width=i.w),this.height||(this.height=i.h),void 0===this.x&&(this.x=i.x),void 0===this.y&&(this.y=i.y),t.globalCompositeOperation=this.alphaMode,t.globalAlpha=this.a*i.a,0===this.arc)this.clear?t.clearRect(this.x,this.y,this.width,this.height):(t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height)),this.borderColor&&(t.beginPath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.borderColor,t.rect(this.x,this.y,this.width,this.height),t.stroke());else{var e=this.width/2,n=this.height/2;t.save(),t.translate(this.x+e,this.y+n),t.rotate(.017453292519943295*this.arc),this.clear?t.clearRect(-e,-n,this.width,this.height):(t.fillStyle=this.color,t.fillRect(-e,-n,this.width,this.height)),this.borderColor&&(t.beginPath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.borderColor,t.rect(-e,-n,this.width,this.height),t.stroke()),t.restore()}},i}(g),C=function(t){function i(i){var e=s(i.text),n=Array.isArray(e)?e:[].concat(e);t.call(this,Object.assign({},i,{class:T,count:n.length,text:function(t){return n[t]},enabled:function(t){return" "!==n[t]&&s(i.enabled,t)}}))}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i}(b),F=function(t){function e(i){t.call(this,i),this.count=l(s(i.count),40),this.moveX=l(s(i.moveX),0),this.moveY=l(s(i.moveY),0),this.moveZ=l(s(i.moveZ),0),this.lineWidth=s(i.lineWidth),this.highScale=l(s(i.highScale),!0),void 0!==this.x&&void 0!==this.y&&this.width&&this.height&&this.lineWidth?this.init():this.centerX=void 0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.init=function(){this.centerX=this.width/2+this.x,this.centerY=this.height/2+this.y,this.scaleZ=Math.max(this.width,this.height)/2,this.starsX=[],this.starsY=[],this.starsZ=[],this.starsOldX=[],this.starsOldY=[],this.starsNewX=[],this.starsNewY=[],this.starsEnabled=[],this.starsLineWidth=[];for(var t=0;t<this.count;t++)this.starsX[t]=Math.random()*this.width-this.width/2,this.starsY[t]=Math.random()*this.height-this.height/2,this.starsZ[t]=Math.random()*this.scaleZ},e.prototype.moveStar=function(t,i,e){e&&(this.starsEnabled[t]=!0);for(var n=this.width/2,s=this.height/2,o=this.starsX[t]+this.moveX*i,a=this.starsY[t]+this.moveY*i,r=this.starsZ[t]+this.moveZ*i;o<-n;)o+=this.width,a=Math.random()*this.height-s,this.starsEnabled[t]=!1;for(;o>n;)o-=this.width,a=Math.random()*this.height-s,this.starsEnabled[t]=!1;for(;a<-s;)a+=this.height,o=Math.random()*this.width-n,this.starsEnabled[t]=!1;for(;a>s;)a-=this.height,o=Math.random()*this.width-n,this.starsEnabled[t]=!1;for(;r<=0;)r+=this.scaleZ,o=Math.random()*this.width-n,a=Math.random()*this.height-s,this.starsEnabled[t]=!1;for(;r>this.scaleZ;)r-=this.scaleZ,o=Math.random()*this.width-n,a=Math.random()*this.height-s,this.starsEnabled[t]=!1;var h=this.centerX+o/r*n,l=this.centerY+a/r*s;if(this.starsEnabled[t]=this.starsEnabled[t]&&h>=this.x&&l>=this.y&&h<this.x+this.width&&l<this.y+this.height,e)this.starsX[t]=o,this.starsY[t]=a,this.starsZ[t]=r,this.starsNewX[t]=h,this.starsNewY[t]=l;else{this.starsOldX[t]=h,this.starsOldY[t]=l;var c=4*(1-this.starsZ[t]/this.scaleZ);this.highScale||(c=Math.ceil(c)),this.starsLineWidth[t]=c}},e.prototype.animate=function(i){var e=t.prototype.animate.call(this,i);if(this.enabled&&void 0!==this.centerX)for(var n=this.count;n--;)this.moveStar(n,i/16,!0),this.starsEnabled[n]&&this.moveStar(n,-5,!1);return e},e.prototype.draw=function(t,e){if(this.enabled){if(void 0===this.centerX)return this.width=this.width||e.w,this.height=this.height||e.h,this.x=void 0===this.x?e.x:this.x,this.y=void 0===this.y?e.y:this.y,this.lineWidth=this.lineWidth||Math.min(e.h/e.orgH,e.w/e.orgW)/2,void this.init();if(t.globalCompositeOperation=this.alphaMode,t.globalAlpha=this.a*e.a,0==this.moveY&&0==this.moveZ&&this.moveX<0){t.fillStyle=this.color;for(var n=this.count;n--;)this.starsEnabled[n]&&t.fillRect(this.starsNewX[n],this.starsNewY[n]-this.starsLineWidth[n]*this.lineWidth/2,this.starsOldX[n]-this.starsNewX[n],this.starsLineWidth[n]*this.lineWidth)}else if(t.strokeStyle=this.color,this.highScale)for(i=this.count;i--;)this.starsEnabled[i]&&(t.beginPath(),t.lineWidth=this.starsLineWidth[i]*this.lineWidth,t.moveTo(this.starsOldX[i],this.starsOldY[i]),t.lineTo(this.starsNewX[i],this.starsNewY[i]),t.stroke(),t.closePath());else for(var s,o=5;--o;){for(t.beginPath(),t.lineWidth=o*this.lineWidth,s=this.count;s--;)this.starsEnabled[s]&&this.starsLineWidth[s]===o&&(t.moveTo(this.starsOldX[s],this.starsOldY[s]),t.lineTo(this.starsNewX[s],this.starsNewY[s]));t.stroke(),t.closePath()}}},e}(z),M=function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(S,[null].concat(t)))},O=function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(T,[null].concat(t)))};M.LEFT_TOP=S.LEFT_TOP,M.CENTER=S.CENTER,O.LEFT_TOP=T.LEFT_TOP,O.CENTER=T.CENTER;var P={Callback:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(y,[null].concat(t)))},Canvas:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(_,[null].concat(t)))},Circle:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(g,[null].concat(t)))},Emitter:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(b,[null].concat(t)))},FastBlur:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(w,[null].concat(t)))},Group:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(v,[null].concat(t)))},Image:M,Text:O,Particle:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(t)))},Path:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(E,[null].concat(t)))},Rect:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(z,[null].concat(t)))},Scroller:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(C,[null].concat(t)))},StarField:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(F,[null].concat(t)))}},A=function(t,i,e){for(var n in this.loop=t,this.timeWait=l(i,0),this.animation=Array.isArray(e)&&!Array.isArray(e[0])?[e]:e||{},this.animationPosition={},this.animation){var o={position:0,timelapsed:-s(this.timeWait),object:null,loop:s("object"==typeof t?t[n]:t),enabled:!("object"==typeof t&&!1===s(t[n])||!1===s(t))};o.orgTimelapsed=o.timelapsed,o.orgLoop=o.loop,o.orgEnabled=o.enabled,this.animationPosition[n]=o,this.setObject(n)}this.last_timestamp=0,this.hide_vote=!1};A.prototype.reset=function(t){for(var i in void 0===t&&(t=void 0),this.animation){var e=this.animationPosition[i];e.position=0,e.timelapsed=void 0===t?e.orgTimelapsed:t,e.loop=e.orgLoop,e.enabled=e.orgEnabled,this.setObject(i)}},A.prototype.setObject=function(t){this.animationPosition[t].position<this.animation[t].length&&null!==this.animation[t][this.animationPosition[t].position]?(this.animationPosition[t].object=this.animation[t][this.animationPosition[t].position],"function"==typeof this.animationPosition[t].object.reset&&this.animationPosition[t].object.reset(),"function"!=typeof this.animationPosition[t].object.run&&(this.animationPosition[t].object={run:this.animationPosition[t].object})):this.animationPosition[t].object=null},A.prototype.changeAnimationStatus=function(t){var i;for(i in t)"object"==typeof this.animationPosition[i]&&(null!==t[i].position&&(this.animationPosition[i].position=t[i].position),null!==t[i].loop&&(this.animationPosition[i].loop=t[i].loop,this.animationPosition[i].enabled=!(!1===t[i].loop)),null!==t[i].timelapsed&&(this.animationPosition[i].timelapsed=t[i].timelapsed),this.setObject(i));for(i in this.animation)"object"==typeof this.animationPosition[i]&&this.animationPosition[i].object instanceof A&&this.animationPosition[i].object.changeAnimationStatus(t)},A.prototype.run=function(t,i,e){var n=i,s=0,o=0,a=0,r=0,h=null;for(var l in e||(n=i-this.last_timestamp,this.last_timestamp=i),this.animation)if(a++,!0===(h=this.animationPosition[l]).enabled)if(r=n,null===h.object)s++,o++,r=0;else if(r>0)for(;r>0;)if(h.timelapsed+=r,h.timelapsed>=0){if(!0===(r=h.object.run(t,h.timelapsed))&&(r=0),r===A.TIMELAPSE_TO_FORCE_DISABLE)return n;r===A.TIMELAPSE_TO_STOP?(h.timelapsed=0,this.setObject(l),h.object=null,r=0):!1!==r&&r>=0&&(h.position++,h.position>=this.animation[l].length&&(!0!==h.loop&&h.loop--,h.loop?h.position=h.position%this.animation[l].length:h.enabled=!1),h.timelapsed=0,this.setObject(l),h.enabled||(h.object=null,h.enabled=!0),null===h.object&&(s++,r=0))}else r=0,o++;if(a>0){if(s===a)return n;t.enabled&&o===a?(t.enabled=!1,this.hide_vote=!0):this.hide_vote&&o!==a&&(this.hide_vote=!1,t.enabled=!0)}return-1},A.TIMELAPSE_TO_FORCE_DISABLE="FORCE_DISABLE",A.TIMELAPSE_TO_STOP="STOP";var k=function(t){void 0===t&&(t={});var i=t.states;void 0===i&&(i={});var e=t.transitions;void 0===e&&(e={});var n=t.default;void 0===n&&(n=void 0);var s=t.delegateTo;void 0===s&&(s=void 0),this.states=i,this.transitions=e,this.delegateTo=s,this.currentStateName=n,this.currentState=this.states[n],this.isTransitioningToStateName=void 0};k.prototype.setState=function(t,i){var e=this;if(t!==this.currentStateName){console.log(t),this.isTransitioningToStateName=t;var n=""+t.charAt(0).toUpperCase()+t.slice(1),s=[this.currentStateName+"To"+n,this.currentStateName+"To","to"+n].find(function(t){return e.transitions[t]});s?(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.transitions[s],this.currentState&&this.currentState.reset&&this.currentState.reset()):(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.states[this.currentStateName],this.currentState&&this.currentState.reset&&this.currentState.reset(),this.isTransitioningToStateName=void 0)}},k.prototype.run=function(t,i,e){var n=i,s=e;return this.currentState&&(n=this.currentState.run(t,n,s),s=!0),(n>=0||!this.currentState)&&(this.isTransitioningToStateName?(this.currentStateName=this.isTransitioningToStateName,this.currentState=this.states[this.currentStateName],this.currentState&&this.currentState.reset&&this.currentState.reset(),this.isTransitioningToStateName=void 0,n=this.currentState.run(t,n,s)):this.currentState=void 0),-1};var I=function(t,i){this.callback=t,this.duration=l(s(i),void 0),this.initialized=!1};function L(t,i){return i.from+t*i.delta}function W(t,i){for(var e,n=[].concat(i.values),s=n.length;s>1;)for(s--,e=0;e<s;e++)n[e]=n[e]+t*(n[e+1]-n[e]);return n[0]}function N(t,i,e){return i.colorFrom.mix(i.colorTo,t).string()}function j(t,i,n){return e._lerp(i.pathFrom,i.pathTo,t)}I.prototype.reset=function(){this.initialized=!1},I.prototype.run=function(t,i){var e;return void 0!==this.duration?(this.callback(t,Math.min(i,this.duration),!this.initialized),this.initialized=!0,i-this.duration):(e=this.callback(t,i,!this.initialized),this.initialized=!0,e)};var X=function(t,i,e){for(var n in this.initialized=!1,this.changeValues=[],t){var o=t[n],a="color"===n,r="path"===n,h="function"==typeof o,c=!a&&Array.isArray(o);this.changeValues.push({name:n,to:c?o[o.length-1]:s(o,1,{}),bezier:!!c&&o,isColor:a,isPath:r,isFunction:!!h&&o,moveAlgorithm:a?N:r?j:c?W:L})}this.duration=l(s(i),0),this.ease=l(e,function(t){return t})};X.prototype.reset=function(){this.initialized=!1},X.prototype.init=function(i,n){for(var s,o,a,r=this.changeValues.length;r--;)(a=this.changeValues[r]).isFunction?(a.from=i[a.name],a.to=a.isFunction(a.from),a.isColor?(a.colorFrom=t(a.from),a.colorTo=t(a.to),a.moveAlgorithm=N):a.isPath?(s=e._preprocessing(e.path2shapes(a.from),e.path2shapes(a.to)),a.pathFrom=s[0],a.pathTo=s[1],a.moveAlgorithm=j):Array.isArray(a.to)?(a.values=[i[a.name]].concat(a.to),a.moveAlgorithm=W):(a.delta=a.to-a.from,a.moveAlgorithm=L)):a.isColor?(a.colorFrom=t(i[a.name]),a.colorTo=t(a.to)):a.isPath?(o=e._preprocessing(e.path2shapes(i[a.name]),e.path2shapes(a.to)),a.pathFrom=o[0],a.pathTo=o[1]):a.bezier?a.values=[i[a.name]].concat(a.bezier):(a.from=i[a.name],a.delta=a.to-a.from)},X.prototype.run=function(t,i){if(this.initialized||(this.initialized=!0,this.init(t,i)),this.duration<=i)for(var e,n=this.changeValues.length;n--;)t[(e=this.changeValues[n]).name]=e.to;else for(var s,o=this.changeValues.length,a=this.ease(i/this.duration);o--;)t[(s=this.changeValues[o]).name]=s.moveAlgorithm(a,s,t);return i-this.duration};var D=function(){};D.prototype.run=function(t,i){return A.TIMELAPSE_TO_FORCE_DISABLE};var R=function(){};R.prototype.run=function(t,i){return t.enabled=!1,A.TIMELAPSE_TO_FORCE_DISABLE};var Y=function(t,i){this.initialized=!1,this.image=s(t),this.durationBetweenFrames=l(s(i),0),Array.isArray(this.image)?this.count=this.image.length:(this.image=[this.image],this.count=1),this.duration=this.count*this.durationBetweenFrames};Y.prototype.reset=function(){this.initialized=!1},Y.prototype.run=function(t,i){if(this.initialized||(this.initialized=!0,this.current=-1),i>=this.duration)t.image=a.getImage(this.image[this.image.length-1]);else{var e=Math.floor(i/this.durationBetweenFrames);e!==this.current&&(this.current=e,t.image=a.getImage(this.image[this.current]))}return i-this.duration};var G=function(t,i,e){this.initialized=!1,this.frameNumber=s(t),this.framesToRight=l(s(i),!0),this.durationBetweenFrames=l(s(e),0),Array.isArray(this.frameNumber)||(this.frameNumber=[this.frameNumber]),this.duration=this.frameNumber.length*this.durationBetweenFrames};G.prototype.run=function(t,i){var e;return e=i>=this.duration?this.frameNumber[this.frameNumber.length-1]:this.frameNumber[Math.floor(i/this.durationBetweenFrames)],this.framesToRight?t.frameX=t.frameWidth*e:t.frameY=t.frameHeight*e,i-this.duration};var B=function(t){function i(i,e,n,o){t.call(this,{x:i,y:e},0,o),this.speed=s(n)||1}return t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i,i.prototype.init=function(i,e){if(0==this.speed||this.targetX===i.x&&this.targetY===i.y)this.duration=0;else{var n=this.changeValues[0],s=this.changeValues[1];n.from=i.x,s.from=i.y,n.delta=n.to-n.from,s.delta=s.to-s.from;var o=Math.sqrt(n.delta*n.delta+s.delta*s.delta);this.duration=10*o/this.speed}t.prototype.init.call(this,i,e)},i}(X),H=function(t,i){this.Aniobject=t,this.times=l(s(i),1)};H.prototype.run=function(t,i){if(this.times<=0)return i;var e=this.Aniobject.run(t,i);return e>0&&this.times--,e};var V=function(t,i,e){this.duration=l(s(i),1),this.name=s(t),this.loop=s(l(e,1))};V.prototype.run=function(t,i){var e;return i>=this.duration&&t.changeAnimationStatus(((e={})[this.name]={position:0,timelapsed:i-this.duration,loop:this.loop},e)),i-this.duration};var Z=function(t,i){this.initialized=!1,this.duration=s(i),this.shakeDiff=s(t),this.shakeDiffHalf=this.shakeDiff/2};Z.prototype.reset=function(){this.initialized=!1},Z.prototype.run=function(t,i){return this.initialized||(this.initialized=!0,this.x=t.x,this.y=t.y),i>=this.duration?(t.x=this.x,t.y=this.y):(t.x=this.x+Math.random()*this.shakeDiff-this.shakeDiffHalf,t.y=this.y+Math.random()*this.shakeDiff-this.shakeDiffHalf),i-this.duration};var q=function(){this.showOnce=!0};q.prototype.run=function(t,i){return t.enabled=t.enabled&&this.showOnce,this.showOnce=!1,0};var U=function(){};U.prototype.run=function(t,i){return A.TIMELAPSE_TO_STOP};var J=function(t){this.duration=s(t)};J.prototype.run=function(t,i){return this.duration?i-this.duration:-1};var K=function(t){this.duration=s(t)};K.prototype.run=function(t,i){return t.enabled=i>=this.duration,i-this.duration};var Q={Callback:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(I,[null].concat(t)))},ChangeTo:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(X,[null].concat(t)))},End:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(D,[null].concat(t)))},EndDisabled:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(R,[null].concat(t)))},Image:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(Y,[null].concat(t)))},ImageFrame:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(G,[null].concat(t)))},Move:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(B,[null].concat(t)))},Once:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(H,[null].concat(t)))},Play:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(V,[null].concat(t)))},Shake:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(Z,[null].concat(t)))},ShowOnce:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(q,[null].concat(t)))},Stop:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(U,[null].concat(t)))},Wait:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(J,[null].concat(t)))},WaitDisabled:function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(K,[null].concat(t)))}},$=function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(o,[null].concat(t)))},tt=function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(A,[null].concat(t)))},it=function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return new(Function.prototype.bind.apply(k,[null].concat(t)))};export{$ as Engine,f as Scenes,a as ImageManager,P as Sprites,tt as Sequence,it as State,Q as Animations};
//# sourceMappingURL=animationvideo.mjs.map
