<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<canvas id="canvas" width="800" height="300">Browser too old</canvas>
<canvas id="canvasNorm" width="800" height="300">Browser too old</canvas>
<script src="lib/animationvideo.js"></script>
<script>
  var scene = new AnimationVideo.Scenes.Default(),
    engine = new AnimationVideo.Engine(document.getElementById('canvas'), scene),
    sceneNorm = new AnimationVideo.Scenes.Norm(),
    engineNorm = new AnimationVideo.Engine(document.getElementById('canvasNorm'), sceneNorm),
    SP = AnimationVideo.Sprites,
    ANI = AnimationVideo.Animations,
    Sequence = AnimationVideo.Sequence,
    Easing = AnimationVideo.Easing;

  let x = 0, y = -2, click = false;
  document.getElementById('canvasNorm').addEventListener('mousemove', function(e) {[x, y] = sceneNorm.transformPoint(e.offsetX, e.offsetY)});
  document.getElementById('canvasNorm').addEventListener('mousedown', function(e) {click = true;});
  document.getElementById('canvasNorm').addEventListener('mouseup', function(e) {click = false;});
  sceneNorm.init().scene((scene, layer) => {
    var l;
    l = [
      new SP.FastBlur({
        a: 0.9,
        x: -1,
        y: -0.375,
        width: 2,
        height: 0.75,
        scaleX: 10,
        scaleY: 10,
        darker: 0.3,
        clear: true,
        pixel: true
      })
    ];
    layer.unshift(l);
    l = [
      new SP.Circle({
        x: x,
        y: y,
        scaleX: 0.1,
        scaleY: 0.1,
        color: '#F00',
        animation: Sequence(true, 0, [[
          ANI.ChangeTo({
            x: () => x,
            y: () => y
          }, 500, Easing.cubicInOut)
        ],[
            ANI.ChangeTo({
            color: () => click ? '#00F' : '#F00'
          }, 100, Easing.cubicInOut)
        ]])
      })
    ];
    layer.unshift(l);
    return layer;
  });

  engineNorm.run();

  scene.init({
    "arrow": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAp1JREFUeNqEU21IU1EYfu7unW5Ty6aBszYs6MeUjGVYokHYyH5E1B9rZWFEFPQnAwmy6Hc/oqhfJsRKSSZGH1JIIX3MNCsqLTD9o1Oj6ebnnDfvvefezrnbdCHhCw/n433P8z7nPe/hBEEAtX0U7hc164uwuvVSXKwZLoOmaRDim+7m9vZa0WiEKSUFFpNpCWlmMyypqTDRuYn6t3k8vmQ2gRDCxs0t9fW45F52aBTROJLtZl7nEZad2m+KtoQCQ0FBARyOCGRZ/q92I1WgqqXlfdd95VsrK8/pChIEqqpCkiQsiCII0aBQZZoWl8lzFDwsFjMl0DBLY8Lj41hBwK4jSQrWOIphL6xYyhwJDWGo6wFSaH1Y3PTCAsITE1oyAa8flhWkbSiCLX8vun11eiGIpiJ/z2nYdx5HqLdVV7elrOzsuqysL3rmBIGiKPizKCHHWY4PLVeQbnXAdegqdhy+hu8dDTBnbqQJZJ1A7u+vz7RaiymWCZgCRSF6Edk8b9cx+B/W6WuVxPaZnyiqXoPpyUmVYvkKTIFClHigEieKjYuSvETUllaF4GAUM1NT6ooaJDKx+aDfC9fByxj90REb+9ppmIoAscH/6leg8MS9DJXPAM9xHCM443K57C6biMjcHDaVVCHw9RmCA2/RGC5C00AqXk/m4p20HZK4CM/J3Zk9n0ecMBhDQnJHcrTisyMfdQXOilrdMfxcwoHq/fg5R59TiQV3hYGKo6X2J/c7LyQIjOx9GXhOw/zoJ8wEevRGyp53o/lGMNYsBgPtEwLecwov7/jGDKa1twT6o3KpL4MdZgGsWZLtfPr7f1q58k1JNHy7YYaM+J+K3Y2PmAIbRavX66229hrGVvvL5uzsHDEUvUu+NT1my78CDAAMK1a8/QaZCgAAAABJRU5ErkJggg=="
  }).loading(false).scene((scene, layer) => {
    var l;
    l = [
      new SP.FastBlur({
        a: 0.6,
        clear: true
      })
//      (ctx) => {
//        ctx.globalCompositeOperation = 'source-over';
//        ctx.globalAlpha = 1;
//        ctx.fillStyle = '#334';
//        ctx.fillRect(0, 0, scene.w, scene.h);
//      },
    ];
    layer.unshift(l);
    l = [
      new SP.Scroller({
        text: "Hi People! This is a D€mø!!!\uD83D\uDCA9",
        x: 820,
        y: 10,
        animation: function (i) {
          return new Sequence(true, -i * 100, [[
            new ANI.ChangeTo({
              x: [-400, 1800, -200, -200, 1500, 0],
              y: 290
            }, 3000, Easing.quadOut),
            new ANI.WaitDisabled(10000),
            new ANI.ChangeTo({
              x: 820,
              y: 10,
              a: 1
            })
          ], [
            new ANI.Wait(2700),
            new ANI.ChangeTo({
              a: 0
            }, 300),
            new ANI.WaitDisabled(10000),
          ], [
            new ANI.ChangeTo({
              color: '#FF0'
            }, 300),
            new ANI.ChangeTo({
              color: '#F00'
            }, 300)
          ]])
        }

      }),
      new SP.Path({
        sprite: [


          new SP.Group({
            sprite: [
              glow(120, 120, 300),
              new SP.Image({
                image: 'arrow',

                scaleX: 10,
                scaleY: 10
              })

            ],
            y: 200,
            animation: new Sequence(true, 0, [[
              new ANI.ChangeTo({
                x: 500,
                y: 150
              }, 500, Easing.quadInOut),
              new ANI.ChangeTo({
                x: 200,
                y: 150
              }, 500, Easing.quadInOut)
            ]])
          }),
          new SP.Path({
            path: 'M 40 40 Q 60 80 80 40T 120 40 T 160 40 z',
            x: 30,
            y: 30,
            color: '#F00',
            borderColor: '#F0F',
            animation: new Sequence(true, 0, [[
              new ANI.Wait(500),
              new ANI.ChangeTo({
                scaleX: 0.2,
                scaleY: 0.2,
                path: 'M595,82.1c1,1-1,2-1,2s-6.9,2-8.9,4.9c-2,2-4.9,8.8-4.9,8.8c3.9-1,8.9-2,13.8-4c1,0,2,1,3,2c1,0-11.8,4.9-14.8,6.9c-2,2-11.8,9.9-14.8,9.9c-2.9,0-9.9,1-9.9,1c1,2,2,3.9,3.9,6.9c0,0-6.9,4-6.9,4.9c-1,1-5.9,6.9-5.9,6.9s17.7,1.9,23.6-7.9c-5.9,9.8-19.7,19.7-48.2,19.7c-29.5,0-53.1-11.8-68.9-17.7c-16.7-6.9-38.4-14.8-56.1-14.8c-16.7,0-36.4,4.9-49.2,16.8c-22.6-8.8-54.1-4-68.9,9.8c-13.8,13.8-27.5,30.5-29.5,42.3c-2.9,12.9-9.8,43.3-19.7,57.2c-13.8,22.5-29.5,28.5-34.5,38.3c-4.9,9.9-4.9,30.5-4,30.5c2,1,8.9,0,12.8-2c7.9-2.9,29.5-25.6,37.4-36.4c7.9-10.9,34.5-58.1,38.4-74.8s7.9-33.5,19.7-42.3c12.8-8.8,28.5-4.9,28.5-3.9c0,0-14.7,11.8-15.7,44.3s18.7,28.6,8.8,49.2c-9.9,17.7-39.3,5.9-49.2,16.7c-7.9,8.9,0,40.3,0,46.2c0,6-3,33.5-4.9,40.4c-1,5.9,0,9.8-1,13.8c-1,3,6,3.9,6,3.9s-6,7.8-8.9,5.9c-2.9-1-4.9-1-6.9,0c-2,0-5.9,1.9-9.9,0L232.9,401c2,1,4.9,1.9,7.9,1c4-1,23.6-9.9,25.6-11.9c2.9-1,19.7-10.8,22.6-16.7c2-5.9,5.9-24.6,5.9-30.5c1-6,2-24.6,2-29.5s-1-13.8,0-17.7c2-2.9,4.9-6.9,8.9-8.9c4.9-1,10.8-1,11.8-1c2,0,18.7,2,21.6,2c3.9,0,19.7-2.9,23.6-5c4.9-0.9,7.8,0,8.9,2c2,1.9-2,4.9-2,5.9c-1,1-8.8,10.8-10.8,14.7c-2,4.9-8.8,13.8-6.9,17.7c2,3.9,2,4.9,7.8,7.9c5.9,1.9,28.5,13.8,41.3,25.6c13.8,12.7,26.6,28.4,28.6,36.4c2.9,8.9,7.8,9.8,10.8,9.8c3,1,8.9,2,8.9,5.9s-1,8.8-1,8.8l36.4,13.8c0,0,0-12.8-1-17.7c-1-5.9-6.9-11.8-11.8-17.7c-4.9-6.9-56-57.1-61-61c-4.9-3-8.9-6.9-9.8-14.7c-1-7.9,8.8-13.8,14.8-20.6c3.9-4.9,14.7-27.6,16.7-30.6c2-2.9,8.9-10.8,12.8-10.8c4.9,0,15.8,6.9,29.5,11.8c5.9,2,48.2,12.8,54.1,14.8c5.9,1,18.6,0,22.6,3.9c3.9,2.9,0,10.9-1,15.8c-1,5.9-11.8,27.5-11.8,27.5s2,7.8,2,13.8c0,6.9-2.9,31.5-5.9,39.3c-2,8.9-15.8,31.6-18.7,35.5c-2,2.9-4.9,4.9-4.9,9.9c0,4.9,8.8,6,11.8,9.8c4,3,1,8.8,0,14.8l39.4,16.7c0-2.9,2-7.9,0-9.9c-1-2.9-5.9-8.8-8.8-12.8c-2-2.9-8.9-13.8-10.8-15.8c-2-2.9-2-8.8,0-13.8c1-4.9,13.8-38.3,14.7-42.3c2-4.9,20.7-44.3,22.6-49.2c2-5.9,17.7-34.4,19.7-39.4c2-5.9,14.8-10.8,18.7-10.8c4.9,0,29.5,8.8,33.4,10.8c2.9,1,25.6,10.9,29.5,12.8c4.9,1.9,2,5.9-1,6.9c-2.9,1.9-39.4,26.5-42.3,27.5c-2.9,1-5.9,3.9-7.9,3.9c-2.9,0-6.9,3.1-6.9,4c0,2-1,5.9-5.9,5.9c-3.9,0-11.8-5.9-16.7-11.8c-6.9,3.9-11.8,6.9-14.8,12.8c-4.9,4.9-6.9,8.9-9.8,15.8c2,2,5.9,2.9,8.8,2.9h31.5c3,0,6.9-0.9,9.9-1.9c2.9-2,80.7-53.1,80.7-53.1s12.8-9.9,12.8-18.7c0-6.9-5.9-8.9-7.9-11.8c-3-1.9-20.7-13.8-23.6-15.7c-4-2.9-17.7-10.9-21.6-12.9c-3-1.9-13.8-5.8-13.8-5.8c3-8.9,5-15.8,5.9-17.7c1-2,1-19.7,2-22.7c0-2.9,5-15.7,6.9-17.7c2-2,6.9-17.7,7.9-20.7c1-1.9,8.8-24.6,12.8-24.6c3.9-1,7.9,2.9,11.8,2.9c4,1,18.7-1,26.6,0c6.9,1,15.8,9.9,17.7,10.8c2.9,1,9.8,3.9,11.8,3.9c1,0,10.8-6.9,10.8-8.8c0-2-6.9-5.9-7.9-5.9c-1-1-7.8-4.9-7.8-4.9c0,1,2.9-1.9,7.8-1.9c3.9,0,7.9,3.9,8.8,4.9c2,1,6.9,3.9,7.9,1.9c1-1,4.9-5.9,4.9-8.9c0-4-3.9-8.8-5.9-10.8s-24.6-23.6-26.6-24.6c-2.9-1-14.7-11.8-14.7-14.7c-1-2-6.9-6.9-7.9-7.9s-30.5-21.6-34.5-24.6c-3.9-2.9-7.9-7.8-7.9-12.7s-2-17.7-2-17.7s-6.9-1-9.8,1.9c-2.9,2-9.8,17.8-13.8,17.8c-10.9-2-24.6,1-24.6,2.9c1,2.9,10.8,1,10.8,1c0,1-3.9,5.9-6.9,5.9c-2,0-7.8,2-8.8,2.9c-2,0-5.9,3.1-5.9,3.1c2.9,0,5.9,0,9.8,0.9c0,0-5.9,4-8.9,4c-2.9,0-12.8,2.9-15.7,3.9c-2,1.9-9.9,7.9-9.9,7.9H589l1,2h4.9L595,82.1L595,82.1z'
              }, 3000, Easing.elasticInOut),
              new ANI.Wait(500),
              new ANI.ChangeTo({
                scaleX: 1,
                scaleY: 1,
                path: 'M 40 40 Q 60 80 80 40T 120 40 T 160 40 z'
              }, 3000, Easing.elasticInOut)
            ]])
          }),

          new SP.Group({
            sprite: [
              new SP.Image({
                image: 'arrow',
                y: -20,
                animation: new Sequence(true, 0, [[
                  new ANI.ChangeTo({
                    scaleX: 5,
                    scaleY: 5
                  }, 250),
                  new ANI.ChangeTo({
                    scaleX: 1
                  }, 250),
                  new ANI.ChangeTo({
                    scaleY: 1
                  }, 250)
                ]])
              }),
              new SP.Image({
                image: 'arrow',
                y: 20
              })
            ],
            y: 200,
            x: -50,
            animation: new Sequence(true, -1000, [[
              new ANI.ChangeTo({
                x: 850,
                y: [400, 0, 200]
              }, 1000),
              new ANI.ChangeTo({
                x: -50
              })
            ], [
              new ANI.ChangeTo({
                arc: 360
              }, 250),
              new ANI.ChangeTo({
                arc: 0
              })
            ]])
          }),
          explosion(100, 100, 0),
          explosion(600, 180, 200),
          explosion(270, 230, 400),
          explosion(520, 80, 600),
          explosion(200, 160, 800),

        ],
        path: 'M 0 0 H 800 V 300 H 0 Z',
        borderColor: '#000000',
        clip: true,
        animation: new Sequence(true, 0, [[
          new ANI.Wait(500),
          new ANI.ChangeTo({
            path: 'M 350 140 H 400 V 160 H 300 Z'
          }, 3000, Easing.quadInOut),
          new ANI.Wait(500),
          new ANI.ChangeTo({
            path: 'M 0 0 H 800 V 300 H 0 Z'
          }, 3000, Easing.quadInOut)
        ]])
      }),
    ];
    layer.unshift(l);
    l = [
      new SP.FastBlur({
        alphaMode: 'lighter',
        scaleX: 20,
        scaleY: 20,
        darker: 0.3,
        a: 0.4
      })
    ];
    layer.unshift(l);

    function explosion(x, y, timeshift) {
      return new SP.Emitter({
        'class': SP.Particle,
        x: x,
        y: y,
        scaleX: 48,
        scaleY: 48,
        alphaMode: function (i) {
          return ((i % 2)) ? 'lighter' : 'source-over'
        },
        count: 30,
        color: function () {
          return 'rgb(' + ~~(Math.random() * 128 + 127) + ',' + ~~(Math.random() * 64 + 32) + ',' + ~~(Math.random() * 16) + ')'
        },
        a: function (i) {
          return ((i % 2)) ? 0.8 : 0.5
        },
        animation: function (i) {
          return new Sequence(true, -i * 1 - timeshift, [[
            new ANI.ChangeTo({
              x: function (p) {
                return p + Math.random() * 50 - 25;
              },
              y: function (p) {
                return p + Math.random() * 50 - 25;
              }
            }, 300),
            new ANI.ChangeTo({
              x: function (p) {
                return p + Math.random() * 100 - 50;
              },
              y: function (p) {
                return p + Math.random() * 100 - 50;
              },
              a: 0,
              scaleX: 10,
              scaleY: 10
            }, 300),
            new ANI.WaitDisabled(2000),
            new ANI.ChangeTo({
              x: function () {
                return x
              },
              y: function () {
                return y
              },
              a: ((i % 2)) ? 0.8 : 0.5,
              scaleX: 48,
              scaleY: 48
            }),
          ]])
        }
      })
    }

    function glow(width, height, count) {
      function getX(i) {
        var t = i / count;
        if (t < 0.25) {
          return 4 * t * width - width / 2;
        } else if (t < 0.5) {
          return width / 2;
        } else if (t < 0.75) {
          return -width / 2;
        }
        return (1 - t) * 4 * width - width / 2;
      }

      function getY(i) {
        var t = i / count;
        if (t < 0.25) {
          return -height / 2;
        } else if (t < 0.5) {
          return (t - 0.25) * 4 * height - height / 2;
        } else if (t < 0.75) {
          return (t - 0.5) * 4 * height - height / 2;
        }
        return height / 2;
      }


      return new SP.Emitter({
        'class': SP.Particle,
        x: getX,
        y: getY,
        scaleX: 48,
        scaleY: 48,
        alphaMode: 'lighter',
        count: count,
        color: function () {
          return 'rgb(' + ~~(Math.random() * 16) + ',' + ~~(Math.random() * 16) + ',' + ~~(Math.random() * 64 + 195) + ')'
        },
        a: 0,
        animation: function (i) {
          var x = getX(i),
            y = getY(i);
          return new Sequence(true, 0, [[
            new ANI.ChangeTo({
              x: function () {
                return x + Math.random() * 50 - 25;
              },
              y: function () {
                return y + Math.random() * 50 - 25;
              }
            }, 800),
            new ANI.ChangeTo({
              x: function () {
                return x + Math.random() * 50 - 25;
              },
              y: function () {
                return y + Math.random() * 50 - 25;
              }
            }, 800),
          ], [
            new ANI.Wait(1000),
            new ANI.ChangeTo({
              a: 1
            }, 1500),

            new ANI.Stop()
          ]])
        }
      })
    }

    return layer;
  });
  engine.run();
</script>
</body>
</html>
