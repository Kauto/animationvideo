<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Title</title>
</head>

<body>
  <canvas id="canvas" width="800" height="300">Browser too old</canvas>
  <canvas id="canvasNorm" width="800" height="300">Browser too old</canvas>
  <canvas id="canvasStarNorm" width="800" height="300">Browser too old</canvas>
  <canvas id="canvasCameraNorm" width="800" height="300">Browser too old</canvas>
  <div>
    <canvas id="canvasAudio" width="800" height="300">Browser too old</canvas><br />
    <audio id="audio" controls style="width:800px"
      src="https://incompetech.com/music/royalty-free/mp3-royaltyfree/The%20Curtain%20Rises.mp3"></audio>
    <div> Tick: <span id="tick">0</span></div>
    <p>"The Curtain Rises" Kevin MacLeod (incompetech.com)<br />
      Licensed under Creative Commons: By Attribution 3.0 License<br />
      http://creativecommons.org/licenses/by/3.0/</p>
  </div>
  <script src="dist/animationvideo.umd.js"></script>
  <script>
    var SP = AnimationVideo.Sprites,
      ANI = AnimationVideo.Animations,
      Sequence = AnimationVideo.Sequence,
      State = AnimationVideo.State,
      Easing = AnimationVideo.Easing;

    var scene = new AnimationVideo.Scenes.Default({
      images: {
        arrow:
          "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAp1JREFUeNqEU21IU1EYfu7unW5Ty6aBszYs6MeUjGVYokHYyH5E1B9rZWFEFPQnAwmy6Hc/oqhfJsRKSSZGH1JIIX3MNCsqLTD9o1Oj6ebnnDfvvefezrnbdCHhCw/n433P8z7nPe/hBEEAtX0U7hc164uwuvVSXKwZLoOmaRDim+7m9vZa0WiEKSUFFpNpCWlmMyypqTDRuYn6t3k8vmQ2gRDCxs0t9fW45F52aBTROJLtZl7nEZad2m+KtoQCQ0FBARyOCGRZ/q92I1WgqqXlfdd95VsrK8/pChIEqqpCkiQsiCII0aBQZZoWl8lzFDwsFjMl0DBLY8Lj41hBwK4jSQrWOIphL6xYyhwJDWGo6wFSaH1Y3PTCAsITE1oyAa8flhWkbSiCLX8vun11eiGIpiJ/z2nYdx5HqLdVV7elrOzsuqysL3rmBIGiKPizKCHHWY4PLVeQbnXAdegqdhy+hu8dDTBnbqQJZJ1A7u+vz7RaiymWCZgCRSF6Edk8b9cx+B/W6WuVxPaZnyiqXoPpyUmVYvkKTIFClHigEieKjYuSvETUllaF4GAUM1NT6ooaJDKx+aDfC9fByxj90REb+9ppmIoAscH/6leg8MS9DJXPAM9xHCM443K57C6biMjcHDaVVCHw9RmCA2/RGC5C00AqXk/m4p20HZK4CM/J3Zk9n0ecMBhDQnJHcrTisyMfdQXOilrdMfxcwoHq/fg5R59TiQV3hYGKo6X2J/c7LyQIjOx9GXhOw/zoJ8wEevRGyp53o/lGMNYsBgPtEwLecwov7/jGDKa1twT6o3KpL4MdZgGsWZLtfPr7f1q58k1JNHy7YYaM+J+K3Y2PmAIbRavX66229hrGVvvL5uzsHDEUvUu+NT1my78CDAAMK1a8/QaZCgAAAABJRU5ErkJggg=="
      },
      reset({ output: scene }) {
        layer = [];
        var l;
        l = [
          // new SP.FastBlur({
          //   alpha: 0.6,
          //   clear: true
          // })
          ({ output }) => {
            output.context.globalCompositeOperation = "source-over";
            output.context.globalAlpha = 1;
            output.context.fillStyle = "#334";
            output.context.fillRect(0, 0, scene.width, scene.height);
          }
        ];
        layer.push(l);
        l = [
          new SP.Scroller({
            text: "Hi People! This is a D€mø!!!\uD83D\uDCA9",
            x: 820,
            y: 10,
            animation: function (i) {
              return new ANI.Sequence(i * 100,
                new ANI.Forever([
                  new ANI.ChangeTo(
                    {
                      x: [-400, 1800, -200, -200, 1500, 0],
                      y: 290
                    },
                    3000,
                    Easing.quadOut
                  ),
                  new ANI.WaitDisabled(10000),
                  new ANI.ChangeTo({
                    x: 820,
                    y: 10,
                    alpha: 1
                  })
                ]),
                new ANI.Forever([
                  new ANI.Wait(2700),
                  new ANI.ChangeTo(
                    {
                      alpha: 0
                    },
                    300
                  ),
                  new ANI.WaitDisabled(10000)
                ]),
                new ANI.Forever([
                  new ANI.ChangeTo(
                    {
                      color: "#FF0"
                    },
                    300
                  ),
                  new ANI.ChangeTo(
                    {
                      color: "#F00"
                    },
                    300
                  )
                ])
              );
            }
          }),
          new SP.Path({
            sprite: [
              new SP.Group({
                sprite: [
                  glow(120, 120, 300),
                  new SP.Image({
                    image: "arrow",

                    scale: 10,
                  })
                ],
                y: 200,
                animation: new ANI.Forever(
                  [
                    new ANI.ChangeTo(
                      {
                        x: 500,
                        y: 150
                      },
                      500,
                      Easing.quadInOut
                    ),
                    new ANI.ChangeTo(
                      {
                        x: 200,
                        y: 150
                      },
                      500,
                      Easing.quadInOut
                    )
                  ]
                )
              }),
              new SP.Path({
                path: 'M123.3 5.5c-5.7 1.3-10.9 4.8-14.6 9.8-9 12.1-4.8 31 8.6 37.8L121 55v47.7l-4 3.2c-3.7 3-5.3 3.4-19.9 5.7l-15.9 2.5-3.6-2.5c-8.3-5.6-24.3-6.2-31.6-1.1-2.8 1.9-4.3 3.9-5 6.5l-1 3.7-9.7 1.6c-12 2-16.5 4.8-20.5 12.7-3.5 6.9-4.8 13.8-4.8 25.4 0 10 2.3 16.9 7.2 21.3 2.2 2.1 68.6 37.5 80.3 42.9l5 2.3 36-2.9c19.8-1.6 39.2-3.1 43-3.4 40.2-3.1 37.7-2.8 42.2-6.2 5.5-4.2 7.5-12.4 6.3-25.1-1-9.5-2.5-12.8-20.3-43.8-20.4-35.6-22.3-38.4-29.1-41.9-3.3-1.7-6.9-3.9-8-5-5.8-5.1-13.9-7.1-23.7-5.8l-5.6.8-.6-14c-1.2-25.1-1.3-24.2 3.2-26.5 14.2-7.3 17.6-27.4 6.8-39.7-2.2-2.5-5.1-5.1-6.6-5.8-4.7-2.5-12.2-3.3-17.8-2.1z',
                x: 30,
                y: 30,
                color: "#F00",
                borderColor: "#F0F",
                animation: new ANI.Forever(
                  [
                    new ANI.Wait(500),
                    new ANI.ChangeTo(
                      {
                        scale: 0.2,
                        path:
                          "M595,82.1c1,1-1,2-1,2s-6.9,2-8.9,4.9c-2,2-4.9,8.8-4.9,8.8c3.9-1,8.9-2,13.8-4c1,0,2,1,3,2c1,0-11.8,4.9-14.8,6.9c-2,2-11.8,9.9-14.8,9.9c-2.9,0-9.9,1-9.9,1c1,2,2,3.9,3.9,6.9c0,0-6.9,4-6.9,4.9c-1,1-5.9,6.9-5.9,6.9s17.7,1.9,23.6-7.9c-5.9,9.8-19.7,19.7-48.2,19.7c-29.5,0-53.1-11.8-68.9-17.7c-16.7-6.9-38.4-14.8-56.1-14.8c-16.7,0-36.4,4.9-49.2,16.8c-22.6-8.8-54.1-4-68.9,9.8c-13.8,13.8-27.5,30.5-29.5,42.3c-2.9,12.9-9.8,43.3-19.7,57.2c-13.8,22.5-29.5,28.5-34.5,38.3c-4.9,9.9-4.9,30.5-4,30.5c2,1,8.9,0,12.8-2c7.9-2.9,29.5-25.6,37.4-36.4c7.9-10.9,34.5-58.1,38.4-74.8s7.9-33.5,19.7-42.3c12.8-8.8,28.5-4.9,28.5-3.9c0,0-14.7,11.8-15.7,44.3s18.7,28.6,8.8,49.2c-9.9,17.7-39.3,5.9-49.2,16.7c-7.9,8.9,0,40.3,0,46.2c0,6-3,33.5-4.9,40.4c-1,5.9,0,9.8-1,13.8c-1,3,6,3.9,6,3.9s-6,7.8-8.9,5.9c-2.9-1-4.9-1-6.9,0c-2,0-5.9,1.9-9.9,0L232.9,401c2,1,4.9,1.9,7.9,1c4-1,23.6-9.9,25.6-11.9c2.9-1,19.7-10.8,22.6-16.7c2-5.9,5.9-24.6,5.9-30.5c1-6,2-24.6,2-29.5s-1-13.8,0-17.7c2-2.9,4.9-6.9,8.9-8.9c4.9-1,10.8-1,11.8-1c2,0,18.7,2,21.6,2c3.9,0,19.7-2.9,23.6-5c4.9-0.9,7.8,0,8.9,2c2,1.9-2,4.9-2,5.9c-1,1-8.8,10.8-10.8,14.7c-2,4.9-8.8,13.8-6.9,17.7c2,3.9,2,4.9,7.8,7.9c5.9,1.9,28.5,13.8,41.3,25.6c13.8,12.7,26.6,28.4,28.6,36.4c2.9,8.9,7.8,9.8,10.8,9.8c3,1,8.9,2,8.9,5.9s-1,8.8-1,8.8l36.4,13.8c0,0,0-12.8-1-17.7c-1-5.9-6.9-11.8-11.8-17.7c-4.9-6.9-56-57.1-61-61c-4.9-3-8.9-6.9-9.8-14.7c-1-7.9,8.8-13.8,14.8-20.6c3.9-4.9,14.7-27.6,16.7-30.6c2-2.9,8.9-10.8,12.8-10.8c4.9,0,15.8,6.9,29.5,11.8c5.9,2,48.2,12.8,54.1,14.8c5.9,1,18.6,0,22.6,3.9c3.9,2.9,0,10.9-1,15.8c-1,5.9-11.8,27.5-11.8,27.5s2,7.8,2,13.8c0,6.9-2.9,31.5-5.9,39.3c-2,8.9-15.8,31.6-18.7,35.5c-2,2.9-4.9,4.9-4.9,9.9c0,4.9,8.8,6,11.8,9.8c4,3,1,8.8,0,14.8l39.4,16.7c0-2.9,2-7.9,0-9.9c-1-2.9-5.9-8.8-8.8-12.8c-2-2.9-8.9-13.8-10.8-15.8c-2-2.9-2-8.8,0-13.8c1-4.9,13.8-38.3,14.7-42.3c2-4.9,20.7-44.3,22.6-49.2c2-5.9,17.7-34.4,19.7-39.4c2-5.9,14.8-10.8,18.7-10.8c4.9,0,29.5,8.8,33.4,10.8c2.9,1,25.6,10.9,29.5,12.8c4.9,1.9,2,5.9-1,6.9c-2.9,1.9-39.4,26.5-42.3,27.5c-2.9,1-5.9,3.9-7.9,3.9c-2.9,0-6.9,3.1-6.9,4c0,2-1,5.9-5.9,5.9c-3.9,0-11.8-5.9-16.7-11.8c-6.9,3.9-11.8,6.9-14.8,12.8c-4.9,4.9-6.9,8.9-9.8,15.8c2,2,5.9,2.9,8.8,2.9h31.5c3,0,6.9-0.9,9.9-1.9c2.9-2,80.7-53.1,80.7-53.1s12.8-9.9,12.8-18.7c0-6.9-5.9-8.9-7.9-11.8c-3-1.9-20.7-13.8-23.6-15.7c-4-2.9-17.7-10.9-21.6-12.9c-3-1.9-13.8-5.8-13.8-5.8c3-8.9,5-15.8,5.9-17.7c1-2,1-19.7,2-22.7c0-2.9,5-15.7,6.9-17.7c2-2,6.9-17.7,7.9-20.7c1-1.9,8.8-24.6,12.8-24.6c3.9-1,7.9,2.9,11.8,2.9c4,1,18.7-1,26.6,0c6.9,1,15.8,9.9,17.7,10.8c2.9,1,9.8,3.9,11.8,3.9c1,0,10.8-6.9,10.8-8.8c0-2-6.9-5.9-7.9-5.9c-1-1-7.8-4.9-7.8-4.9c0,1,2.9-1.9,7.8-1.9c3.9,0,7.9,3.9,8.8,4.9c2,1,6.9,3.9,7.9,1.9c1-1,4.9-5.9,4.9-8.9c0-4-3.9-8.8-5.9-10.8s-24.6-23.6-26.6-24.6c-2.9-1-14.7-11.8-14.7-14.7c-1-2-6.9-6.9-7.9-7.9s-30.5-21.6-34.5-24.6c-3.9-2.9-7.9-7.8-7.9-12.7s-2-17.7-2-17.7s-6.9-1-9.8,1.9c-2.9,2-9.8,17.8-13.8,17.8c-10.9-2-24.6,1-24.6,2.9c1,2.9,10.8,1,10.8,1c0,1-3.9,5.9-6.9,5.9c-2,0-7.8,2-8.8,2.9c-2,0-5.9,3.1-5.9,3.1c2.9,0,5.9,0,9.8,0.9c0,0-5.9,4-8.9,4c-2.9,0-12.8,2.9-15.7,3.9c-2,1.9-9.9,7.9-9.9,7.9H589l1,2h4.9L595,82.1L595,82.1z"
                      },
                      3000,
                      Easing.elasticInOut
                    ),
                    new ANI.Wait(500),
                    new ANI.ChangeTo(
                      {
                        scale: 1,
                        path: "M 40 40 Q 60 80 80 40T 120 40 T 160 40 z"
                      },
                      3000,
                      Easing.elasticInOut
                    )
                  ]
                )
              }),

              new SP.Group({
                sprite: [
                  new SP.Image({
                    image: "arrow",
                    y: -20,
                    animation: new ANI.Forever(
                      [
                        new ANI.ChangeTo(
                          {
                            scaleX: 5,
                            scaleY: 5
                          },
                          250
                        ),
                        new ANI.ChangeTo(
                          {
                            scaleX: 1
                          },
                          250
                        ),
                        new ANI.ChangeTo(
                          {
                            scaleY: 1
                          },
                          250
                        )
                      ]
                    )
                  }),
                  new SP.Image({
                    image: "arrow",
                    y: 20
                  })
                ],
                y: 200,
                x: -50,
                animation: new ANI.Sequence(-1000,
                  new ANI.Forever([
                    new ANI.ChangeTo(
                      {
                        x: 850,
                        y: [400, 0, 200]
                      },
                      1000
                    ),
                    new ANI.ChangeTo({
                      x: -50
                    })
                  ]),
                  new ANI.Forever([
                    new ANI.ChangeTo(
                      {
                        rotationInDegree: 360
                      },
                      250
                    ),
                    new ANI.ChangeTo({
                      rotationInDegree: 0
                    })
                  ])
                )
              }),
              explosion(100, 100, 0),
              explosion(600, 180, 200),
              explosion(270, 230, 400),
              explosion(520, 80, 600),
              explosion(200, 160, 800)
            ],
            path: "M 0 0 H 800 V 300 H 0 Z",
            borderColor: "#000000",
            clip: true,
            animation: new ANI.Forever(
              [
                new ANI.Wait(500),
                new ANI.ChangeTo(
                  {
                    path: "M 350 140 H 400 V 160 H 300 Z"
                  },
                  3000,
                  Easing.quadInOut
                ),
                new ANI.Wait(500),
                new ANI.ChangeTo(
                  {
                    path: "M 0 0 H 800 V 300 H 0 Z"
                  },
                  3000,
                  Easing.quadInOut
                )
              ]
            )
          })
        ];
        layer.push(l);
        l = [
          new SP.FastBlur({
            compositeOperation: "lighter",
            scaleX: 20,
            scaleY: 20,
            darker: 0.3,
            alpha: 0.4
          })
        ];
        layer.push(l);

        function explosion(x, y, timeshift) {
          return new SP.Emitter({
            class: SP.Particle,
            x: x,
            y: y,
            scaleX: 48,
            scaleY: 48,
            compositeOperation: function (i) {
              return i % 2 ? "lighter" : "source-over";
            },
            count: 30,
            color: function () {
              return (
                "rgb(" +
                ~~(Math.random() * 128 + 127) +
                "," +
                ~~(Math.random() * 64 + 32) +
                "," +
                ~~(Math.random() * 16) +
                ")"
              );
            },
            alpha: function (i) {
              return i % 2 ? 0.8 : 0.5;
            },
            animation: function (i) {
              return new ANI.Forever(-i * 1 - timeshift,
                [
                  new ANI.ChangeTo(
                    {
                      x: function (p) {
                        return p + Math.random() * 50 - 25;
                      },
                      y: function (p) {
                        return p + Math.random() * 50 - 25;
                      }
                    },
                    300
                  ),
                  new ANI.ChangeTo(
                    {
                      x: function (p) {
                        return p + Math.random() * 100 - 50;
                      },
                      y: function (p) {
                        return p + Math.random() * 100 - 50;
                      },
                      alpha: 0,
                      scaleX: 10,
                      scaleY: 10
                    },
                    300
                  ),
                  new ANI.WaitDisabled(2000),
                  new ANI.ChangeTo({
                    x: function () {
                      return x;
                    },
                    y: function () {
                      return y;
                    },
                    alpha: i % 2 ? 0.8 : 0.5,
                    scaleX: 48,
                    scaleY: 48
                  })
                ]
              );
            }
          });
        }

        function glow(width, height, count) {
          function getX(i) {
            var t = i / count;
            if (t < 0.25) {
              return 4 * t * width - width / 2;
            } else if (t < 0.5) {
              return width / 2;
            } else if (t < 0.75) {
              return -width / 2;
            }
            return (1 - t) * 4 * width - width / 2;
          }

          function getY(i) {
            var t = i / count;
            if (t < 0.25) {
              return -height / 2;
            } else if (t < 0.5) {
              return (t - 0.25) * 4 * height - height / 2;
            } else if (t < 0.75) {
              return (t - 0.5) * 4 * height - height / 2;
            }
            return height / 2;
          }

          return new SP.Emitter({
            class: SP.Particle,
            x: getX,
            y: getY,
            scaleX: 48,
            scaleY: 48,
            compositeOperation: "lighter",
            count: count,
            color: function () {
              return (
                "rgb(" +
                ~~(Math.random() * 16) +
                "," +
                ~~(Math.random() * 16) +
                "," +
                ~~(Math.random() * 64 + 195) +
                ")"
              );
            },
            alpha: 0,
            animation: function (i) {
              var x = getX(i),
                y = getY(i);
              return new ANI.Sequence(
                new ANI.Forever([
                  new ANI.ChangeTo(
                    {
                      x: function () {
                        return x + Math.random() * 50 - 25;
                      },
                      y: function () {
                        return y + Math.random() * 50 - 25;
                      }
                    },
                    800
                  ),
                  new ANI.ChangeTo(
                    {
                      x: function () {
                        return x + Math.random() * 50 - 25;
                      },
                      y: function () {
                        return y + Math.random() * 50 - 25;
                      }
                    },
                    800
                  )
                ]),
                [
                  new ANI.Wait(1000),
                  new ANI.ChangeTo(
                    {
                      alpha: 1
                    },
                    1500
                  )
                ]
              );
            }
          });
        }

        return layer;
      }
    });
    var engine = new AnimationVideo.Engine({
      canvas: document.getElementById("canvas"),
      scene: scene
    });
    engine.run();

    // -------
    var sceneNorm = new AnimationVideo.Scenes.Norm(
      class test {
        eventMouseMove(e) {
          [this.mx, this.my] = this.scene.transformPoint(
            e.offsetX,
            e.offsetY
          );
          this.newThings.push(
            SP.Rect({
              x: this.mx - 0.1,
              y: this.my - 0.1,
              width: 0.2,
              height: 0.2,
              alpha: 1,
              color: function () {
                return (
                  "rgb(" +
                  ~~(Math.random() * 255) +
                  "," +
                  ~~(Math.random() * 255) +
                  "," +
                  ~~(Math.random() * 255) +
                  ")"
                );
              },
              animation: [
                ANI.ChangeTo(
                  {
                    alpha: 0
                  },
                  2000,
                  Easing.quadOut
                ),
                ANI.Remove()
              ]
            })
          );
        }
        eventMouseDown(e) {
          this.click = true;
        }
        eventMouseUp(e) {
          this.click = false;
        }

        init({ engine, output, scene }) {
          this.mx = 1;
          this.my = 0.5;
          this.click = false;
          this.scene = scene;
          this.newThings = [];

          output.canvas.addEventListener(
            "mousemove",
            this.eventMouseMove.bind(this)
          );
          output.canvas.addEventListener(
            "mousedown",
            this.eventMouseDown.bind(this)
          );
          output.canvas.addEventListener(
            "mouseup",
            this.eventMouseUp.bind(this)
          );
        }

        update() {
          this.layerMove.addElements(this.newThings);
          this.layerCount.forEach(
            ({ element }) => (element.text = this.layerMove.count())
          );
          this.layerStart.forEach(
            ({ element }) => (element.text = this.layerMove.start)
          );
          this.layerNext.forEach(
            ({ element }) => (element.text = this.layerMove.nextFree)
          );
          this.newThings = [];
        }

        destroy({ output }) {
          output.canvas.removeEventListener("mousemove", this.eventMouseMove);
          output.canvas.removeEventListener("mousedown", this.eventMouseDown);
          output.canvas.removeEventListener("mouseup", this.eventMouseUp);
        }

        reset({ layerManager }) {
          layerManager.addLayer().addElement(
            new SP.FastBlur({
              alpha: 0.9,
              x: -1,
              y: -0.375,
              width: 2,
              height: 0.75,
              scaleX: 10,
              scaleY: 10,
              darker: 0.3,
              clear: true,
              pixel: true
            })
          );
          this.layerMove = layerManager.addLayer();
          layerManager.addLayer().addElements([
            new SP.Circle({
              x: this.mx,
              y: this.my,
              scaleX: 0.1,
              scaleY: 0.1,
              color: "#F00",
              animation: new ANI.Sequence(
                new ANI.Forever([
                  new ANI.ChangeTo(
                    {
                      x: () => this.mx,
                      y: () => this.my
                    },
                    500,
                    Easing.cubicInOut
                  )
                ]),
                new ANI.Forever([
                  new ANI.ChangeTo(
                    {
                      color: () => (this.click ? "#00F" : "#F00")
                    },
                    100,
                    Easing.cubicInOut
                  )
                ])
              )
            })
          ]);
          this.layerCount = layerManager.addLayer();
          this.layerCount.addElements([
            new SP.Text({
              x: -0.905,
              y: -0.305,
              scaleX: 0.005,
              scaleY: 0.005,
              color: "#fff",
              text: "0"
            }),
            new SP.Text({
              x: -0.895,
              y: -0.295,
              scaleX: 0.005,
              scaleY: 0.005,
              color: "#fff",
              text: "0"
            }),
            new SP.Text({
              x: -0.9,
              y: -0.3,
              scaleX: 0.005,
              scaleY: 0.005,
              color: "#000",
              text: "0"
            })
          ]);
          this.layerStart = layerManager.addLayer();
          this.layerStart.addElements([
            new SP.Text({
              x: -0.905,
              y: -0.155,
              scaleX: 0.005,
              scaleY: 0.005,
              color: "#fff",
              text: "0"
            }),
            new SP.Text({
              x: -0.895,
              y: -0.145,
              scaleX: 0.005,
              scaleY: 0.005,
              color: "#fff",
              text: "0"
            }),
            new SP.Text({
              x: -0.9,
              y: -0.15,
              scaleX: 0.005,
              scaleY: 0.005,
              color: "#000",
              text: "0"
            })
          ]);
          this.layerNext = layerManager.addLayer();
          this.layerNext.addElements([
            new SP.Text({
              x: -0.905,
              y: -0.005,
              scaleX: 0.005,
              scaleY: 0.005,
              color: "#fff",
              text: "0"
            }),
            new SP.Text({
              x: -0.895,
              y: 0.005,
              scaleX: 0.005,
              scaleY: 0.005,
              color: "#fff",
              text: "0"
            }),
            new SP.Text({
              x: -0.9,
              y: 0,
              scaleX: 0.005,
              scaleY: 0.005,
              color: "#000",
              text: "0"
            })
          ]);
          return layerManager;
        }
      }
    );
    var engineNorm = new AnimationVideo.Engine({
      reduceFramerate: true,
      canvas: document.getElementById("canvasNorm"),
      autoSize: { setCanvasStyle: true, currentScale: 4 }
    })
      .switchScene(sceneNorm)
      .run();

    // -------
    AnimationVideo.Engine({
      canvas: document.getElementById("canvasStarNorm"),
      scene: AnimationVideo.Scenes.Norm(
        class StateTest {
          constructor() {
            this.keyMap = [];

            this.key = {
              left: 37,
              up: 38,
              right: 39,
              down: 40
            };

            this.keyValues = Object.values(this.key);

            this.x = -0.6;
            this.y = -0.2;
          }

          tickChunk() {
            return 1000 / 60;
          }
          eventKeyDown(e) {
            if (this.keyValues.includes(e.keyCode)) {
              this.keyMap[e.keyCode] = true;
              e.preventDefault();
            }
          }
          eventKeyUp(e) {
            if (this.keyValues.includes(e.keyCode)) {
              this.keyMap[e.keyCode] = false;
              e.preventDefault();
            }
          }
          init({ engine, output, scene }) {
            document.addEventListener(
              "keydown",
              this.eventKeyDown.bind(this)
            );
            document.addEventListener(
              "keyup",
              this.eventKeyUp.bind(this)
            );
          }
          destroy({ output }) {
            document.removeEventListener("keydown", this.eventKeyDown);
            document.removeEventListener("keyup", this.eventKeyUp);
          }
          fixedUpdate({ }) {
            let state = "neutral";
            if (this.keyMap[this.key.down]) {
              this.sprite.ship.y += 0.01;
              state = "down";
            }
            if (this.keyMap[this.key.up]) {
              this.sprite.ship.y -= 0.01;
              state = "up";
            }
            if (this.keyMap[this.key.right]) {
              this.sprite.ship.x += 0.01;
              state = "right";
            }
            if (this.keyMap[this.key.left]) {
              this.sprite.ship.x -= 0.01;
              state = "left";
            }
            this.sprite.ship.animation.setState(state);
          }
          reset({ layerManager }) {
            layerManager.clear();
            this.sprite = {};
            this.layers = {};
            this.layers.background = layerManager.addLayer();
            this.layers.background.addElements([
              SP.Rect({
                color: "#000"
              }),
              SP.StarField({
                moveX: -0.01
                //moveZ: -0.02,
              })
            ]);
            this.layers.player = layerManager.addLayer();
            this.sprite.ship = this.layers.player.addElement(
              SP.Text({
                text: "Neutral",
                color: "#FF8",
                x: this.x,
                y: this.y,
                scaleX: 0.002,
                scaleY: 0.002,
                animation: ANI.State({
                  default: "neutral",
                  states: {
                    up: ANI.Sequence(
                      ANI.ChangeTo(
                        {
                          text: "UP"
                        },
                        0
                      ),
                      ANI.ChangeTo(
                        {
                          color: "#F88"
                        },
                        1000
                      )
                    ),
                    down: ANI.Sequence(
                      ANI.ChangeTo(
                        {
                          text: "DOWN"
                        },
                        0
                      ),
                      ANI.ChangeTo(
                        {
                          color: "#F8F"
                        },
                        1000
                      )
                    ),
                    left: ANI.Sequence(
                      ANI.ChangeTo(
                        {
                          text: "LEFT"
                        },
                        0
                      ),
                      ANI.ChangeTo(
                        {
                          color: "#8F8"
                        },
                        1000
                      )
                    ),
                    right: ANI.Sequence(
                      ANI.ChangeTo(
                        {
                          text: "RIGHT"
                        },
                        0
                      ),
                      ANI.ChangeTo(
                        {
                          color: "#88F"
                        },
                        1000
                      )
                    ),
                    neutral: ANI.Sequence(
                      ANI.ChangeTo(
                        {
                          text: "Neutral"
                        },
                        0
                      ),
                      ANI.ChangeTo(
                        {
                          color: "#FF8"
                        },
                        1000
                      )
                    )
                  }
                })
              })
            );
            layerManager.addLayer().addElements([new SP.Path({
              path: 'M-.5,0a.5,.5,0,1,1,1,0a.5,.5,0,1,1,-1,0',
              color: '#0F0'
            }),
            new SP.Path({
              path: 'M-.5,0A.5,.5,0,1,1,.5,0A.5,.5,0,1,1,-.5,0',
              color: '#0F0'
            })
            ])
          }
        }
      )
    }).run();
    // -----
    new AnimationVideo.Engine({
      clickToPlayAudio: true,
      canvas: document.getElementById("canvasAudio"),
      // The Engine uses the scene "Audio"
      scene: AnimationVideo.Scenes.Audio({
        audioElement: document.getElementById('audio'),
        end() {
          window.alert('audio done');
        },
        // show totalTimePassed
        update({ totalTimePassed }) {
          document.getElementById('tick').innerText = Math.round(totalTimePassed);
        },
        // initialisation of the scene with sprites
        reset() {
          // the scene resets with two layers
          return [
            // first layer consits of a Image
            [
              SP.Rect({
                color: "#117",
                animation: [
                  500,
                  ANI.ChangeTo({
                    color: "#88C"
                  }, 1000),
                  ANI.Wait(14500),
                  ANI.ChangeTo({
                    color: "#C88"
                  }, 300),
                  ANI.ChangeTo({
                    color: "#FCC"
                  }, 3000),
                ]
              })
            ],
            [
              SP.Rect({
                color: "#66b",
                width: 100,
                x: -100,
                animation: [
                  500,
                  ANI.ChangeTo({
                    x: 100
                  }, 1000, Easing.elasticOut),
                  ANI.Wait(14500),
                  ANI.ChangeTo({
                    alpha: 0
                  }, 300),
                  ANI.Remove()
                ]
              }),
              SP.Rect({
                color: "#66b",
                width: 100,
                x: 800,
                animation: [
                  500,
                  ANI.ChangeTo({
                    x: 600
                  }, 1000, Easing.elasticOut),
                  ANI.Wait(14500),
                  ANI.ChangeTo({
                    alpha: 0
                  }, 300),
                  ANI.Remove()
                ]
              }),
              SP.Rect({
                color: "#449",
                width: 100,
                x: -100,
                animation: [
                  500,
                  ANI.ChangeTo({
                    x: 200
                  }, 1000, Easing.elasticOut),
                  ANI.Wait(14500),
                  ANI.ChangeTo({
                    alpha: 0
                  }, 300),
                  ANI.Remove()
                ]
              }),
              SP.Rect({
                color: "#449",
                width: 100,
                x: 800,
                animation: [
                  500,
                  ANI.ChangeTo({
                    x: 500
                  }, 1000, Easing.elasticOut),
                  ANI.Wait(14500),
                  ANI.ChangeTo({
                    alpha: 0
                  }, 300),
                  ANI.Remove()
                ]
              }),
              SP.Rect({
                color: "#227",
                width: 100,
                x: -100,
                animation: [
                  500,
                  ANI.ChangeTo({
                    x: 300
                  }, 1000, Easing.elasticOut),
                  ANI.Wait(14500),
                  ANI.ChangeTo({
                    alpha: 0
                  }, 300),
                  ANI.Remove()
                ]
              }),
              SP.Rect({
                color: "#227",
                width: 100,
                x: 800,
                animation: [
                  500,
                  ANI.ChangeTo({
                    x: 400
                  }, 1000, Easing.elasticOut),
                  ANI.Wait(14500),
                  ANI.ChangeTo({
                    alpha: 0
                  }, 300),
                  ANI.Remove()
                ]
              }),
            ],
            // second layer controls the logo
            [
              SP.Path({
                path: "M123.3 5.5c-5.7 1.3-10.9 4.8-14.6 9.8-9 12.1-4.8 31 8.6 37.8L121 55v47.7l-4 3.2c-3.7 3-5.3 3.4-19.9 5.7l-15.9 2.5-3.6-2.5c-8.3-5.6-24.3-6.2-31.6-1.1-2.8 1.9-4.3 3.9-5 6.5l-1 3.7-9.7 1.6c-12 2-16.5 4.8-20.5 12.7-3.5 6.9-4.8 13.8-4.8 25.4 0 10 2.3 16.9 7.2 21.3 2.2 2.1 68.6 37.5 80.3 42.9l5 2.3 36-2.9c19.8-1.6 39.2-3.1 43-3.4 40.2-3.1 37.7-2.8 42.2-6.2 5.5-4.2 7.5-12.4 6.3-25.1-1-9.5-2.5-12.8-20.3-43.8-20.4-35.6-22.3-38.4-29.1-41.9-3.3-1.7-6.9-3.9-8-5-5.8-5.1-13.9-7.1-23.7-5.8l-5.6.8-.6-14c-1.2-25.1-1.3-24.2 3.2-26.5 14.2-7.3 17.6-27.4 6.8-39.7-2.2-2.5-5.1-5.1-6.6-5.8-4.7-2.5-12.2-3.3-17.8-2.1z",
                color: '#000',
                borderColor: '#FFF',
                lineWidth: 3,
                x: 270,
                y: 30,
                alpha: 0,
                scaleY: 0.7,
                rotationInDegree: -5,
                animation: [
                  2000,
                  ANI.ChangeTo({
                    rotation: 0,
                    scaleY: 1,
                    alpha: 1
                  }, 1500, Easing.bounceOut),
                  ANI.Wait(500),
                  ANI.ChangeTo({
                    x: 260,
                    y: 20,
                    scaleX: 1.1,
                    scaleY: 1.1
                  }, 4000, Easing.quadInOut),
                  ANI.Wait(1000),
                  ANI.ChangeTo({
                    path: 'M384,48.734c-70.692,0-128,57.308-128,128c0-70.692-57.308-128-128-128s-128,57.308-128,128c0,137.424,188.048,252.681,241.805,282.821c8.823,4.947,19.567,4.947,28.39,0C323.952,429.416,512,314.158,512,176.734C512,106.042,454.692,48.734,384,48.734z',
                    scaleX: 0.5,
                    scaleY: 0.5,
                  }, 1000, Easing.bounceOut),
                  ANI.Wait(6000),
                  ANI.ChangeTo({
                    x: 215,
                    y: -25,
                    scaleX: 0.7,
                    scaleY: 0.7,
                  }, 6500, Easing.quadInOut)
                ]
              })
            ],
            [
              SP.StackBlurCanvas({
                radius: 1,
                sprite: [
                  SP.StarField({
                    moveX: 0,
                    animation: [
                      4000,
                      ANI.ChangeTo({
                        moveY: -4
                      }, 1000, Easing.quadInOut),
                      ANI.Wait(2000),
                      ANI.ChangeTo({
                        moveY: 0
                      }, 200, Easing.quadOut),
                      ANI.Wait(3300),
                      ANI.ChangeTo({
                        moveX: 4,
                        moveY: -2
                      }, 1000, Easing.quadInOut),
                      ANI.Wait(3000),
                      ANI.ChangeTo({
                        moveX: 0,
                        moveY: 0
                      }, 200, Easing.quadOut),
                      ANI.End()
                    ]
                  })
                ]
              })
            ],
            // third layer consits of a blur effect
            [
              SP.StackBlur({
                radiusPart: 10, // the glow will be 1/10 of the canvas
                alpha: 0, // not visible
                animation: [2000,
                  // blend in the half visible glow for half a second with easing
                  ANI.ChangeTo({ alpha: 0.4 }, 1500, Easing.QuadInOut)
                ]
              })
            ]
          ];
        }
      })
    }).run(); // start the engine
    // -----------
    new AnimationVideo.Engine({
      canvas: document.getElementById("canvasCameraNorm"),
      // The Engine uses the scene "Audio"
      scene: AnimationVideo.Scenes.NormCamera({
        cam: {
          alternative: true
        },
        click({ scene, x, y }) {
          scene.zoomTo(x - 0.2, y - 0.2, x + 0.2, y + 0.2);
        },
        doubleClick({ scene }) {
          scene.zoomTo(-1, -1, 1, 1);
        },
        rangeMove({ x1, y1, x2, y2 }) {
          this.spriteMarker.enabled = true;
          this.spriteMarker.x = x1;
          this.spriteMarker.y = y1;
          this.spriteMarker.width = x2 - x1;
          this.spriteMarker.height = y2 - y1;
        },
        range({ x1, y1, x2, y2 }){
          this.spriteMarker.enabled = false;
          this.layerOverlay.addElement(
            SP.Rect({
              x: x1,
              y: y1,
              width: x2-x1,
              height: y2-y1,
              color: '#fff',
              compositeOperation: 'lighter',
              animation: [
                ANI.ChangeTo({ alpha: 0 }, 3000, Easing.quadOut),
                ANI.Remove()
              ]
            })
          )
        },
        images() {
          return { imageFile: "https://placekitten.com/400/400" };
        },
        reset({ layerManager }) {
          layerManager.addLayer().addElement(
            SP.Rect({ clear: true })
          );
          layerManager.addLayer().addElement(
            SP.Image({
              normCover: true,
              image: 'imageFile'
            })
          )
          this.layerOverlay = layerManager.addLayer()
          this.spriteMarker = this.layerOverlay.addElement(
            SP.Rect({
              enabled: false,
              color: '#fff',
              norm: false, 
              compositeOperation: 'difference'
            })
          )
          return layerManager;
        }
      })
    }).run()
  </script>
</body>

</html>